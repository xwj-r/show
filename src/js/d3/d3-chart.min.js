!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).d3Chart={})}(this,function(t){"use strict";function F(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2*Math.PI,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,o=t,a=e,r=i;Math.abs(r-a-2*Math.PI)<=1e-5&&(r-=1e-5);var l=Math.cos(a-Math.PI/2)*o,s=Math.sin(a-Math.PI/2)*o,u=Math.cos(r-Math.PI/2)*o,h=Math.sin(r-Math.PI/2)*o,c=0,_=1;function d(){return o+" "+o+" 0 "+c+" "+_+" "}return Math.abs(r-a)>=Math.PI&&(c=1),void 0!==n?_=isNaN(Number(n))?1:Number(n):void 0===n&&(r+a)/2>Math.PI/2&&(r+a)/2<Math.PI/2*3&&(_=0),_?"M"+l+" "+s+"A"+d()+" "+u+" "+h:"M"+u+" "+h+"A"+d()+" "+l+" "+s}function dt(t){return"none"!==t.style("display")?t.node().getBBox():{x:0,y:0,width:0,height:0}}function e(t){t.style("display","block")}function i(t){t.style("display","none")}function z(t,e,i){t.attr("transform","translate("+e+","+i+")")}function n(t){var e=t+Math.floor(1e9*Math.random()).toString(32)+Date.now().toString(32);return null==document.getElementById(e)?e:n(t)}function x(t,e){var i=window.location.href;return void 0===e&&(e=!/\/#\//.test(i)),e?i+t:t}function T(t,e){var i=/[^\u4e00-\u9fa5\w-]/gi;return e=null==e||i.test(e)?"-":e,t.toString().replace(i,e)}function l(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.abs(parseFloat(t))||e}function yt(t){var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,a=t.width,r=void 0===a?100:a,l=t.height,s=void 0===l?100:l,u=t.cornerRadius,h=void 0===u?0:u,c=t.roundCorners,_=void 0===c?[0,1,2,3]:c,d=t.type,y=void 0===d?"normal":d,f=i,p=o,v=i+r,g=o+s;if(Array.isArray(h)){var S=0,x=0,m=0,k=0;0==h.length||h.length<4?k=m=x=S=0:(S=isNaN(Math.min("horizontal"==y?s:r,h[0]))?0:Math.min("horizontal"==y?s:r,h[0]),x=isNaN(Math.min("horizontal"==y?s:r,h[1]))?0:Math.min("horizontal"==y?s:r,h[1]),m=isNaN(Math.min("horizontal"==y?s:r,h[2]))?0:Math.min("horizontal"==y?s:r,h[2]),k=isNaN(Math.min("horizontal"==y?s:r,h[3]))?0:Math.min("horizontal"==y?s:r,h[3]));for(var b=["L"+f+" "+p,"L"+v+" "+p,"L"+v+" "+g,"L"+f+" "+g],w=["A"+(S+" "+S+" 0 0 1")+" "+(f+S)+" "+p,"A"+(x+" "+x+" 0 0 1")+" "+v+" "+(p+x),"A"+(k+" "+k+" 0 0 1")+" "+(v-k)+" "+g,"A"+(m+" "+m+" 0 0 1")+" "+f+" "+(g-m)],C=[],O=0;O<=3;O++){var F=_.includes(O)?w[O]:b[O];C.push(F)}return"\n    M"+f+" "+(p+S)+"\n    "+C[0]+"\n    H"+(v-x)+"\n    "+C[1]+"\n    V"+(g-k)+"\n    "+C[2]+"\n    H"+(f+m)+"\n    "+C[3]+"\n    Z\n  "}for(var P=Math.min("horizontal"==y?s:r,h),W=P+" "+P+" 0 0 1",A=["L"+f+" "+p,"L"+v+" "+p,"L"+v+" "+g,"L"+f+" "+g],z=["A"+W+" "+(f+P)+" "+p,"A"+W+" "+v+" "+(p+P),"A"+W+" "+(v-P)+" "+g,"A"+W+" "+f+" "+(g-P)],L=[],D=0;D<=3;D++){var T=_.includes(D)?z[D]:A[D];L.push(T)}return"\n    M"+f+" "+(p+P)+"\n    "+L[0]+"\n    H"+(v-P)+"\n    "+L[1]+"\n    V"+(g-P)+"\n    "+L[2]+"\n    H"+(f+P)+"\n    "+L[3]+"\n    Z\n  "}function ft(t,e){var i=t.x,n=t.y,o=t.x+t.width,a=t.y+t.height,r=e.x,l=e.y,s=e.x+e.width,u=e.y+e.height;return!(s<i||o<r||u<n||a<l)}var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},h=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o=function(){function t(){a(this,t),this.elem=null,this._pos=[0,0],this._show=!0,this.id=n("")}return r(t,[{key:"update",value:function(){}},{key:"show",value:function(){return e(this.elem),this._show=!0,this}},{key:"hide",value:function(){return i(this.elem),this._show=!1,this}},{key:"width",value:function(){return dt(this.elem).width}},{key:"height",value:function(){return dt(this.elem).height}},{key:"translate",value:function(t,e){return arguments.length?(this.pos=[t,e],z(this.elem,t,e),this):this.pos}},{key:"isShow",get:function(){return this._show}}]),t}();function M(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=arguments[2];return!e.length||e[0].length<(i||2)||t.some(function(t){return void 0===e[0][t]})}function y(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return t.slice(1).some(function(t){return!isNaN(parseFloat(t[e]))})}function c(t,e){var o=0,a=1;if(e.forEach(function(t){"objCol"===t.function?o=t.index:"vCol"===t.function&&(a=t.index)}),M(t,[o,a])||!y(t,a))return[];var r=[],l=t[0][o],s=t[0][a];return t.slice(1).forEach(function(t,e){var i=parseFloat(t[a]);if(!isNaN(i)){var n=t[o];""!=t[o]&&null!=t[o]&&null!=t[o]||(n="$-"+e),r.push({name:n,showLegend:n!="$-"+e,value:parseFloat(t[a]),nameLabel:l,valueLabel:s})}}),r.forEach(function(t,e){t.key=T(t.name)+"-"+e,t.index=e}),r}function R(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(1===e.length)return t;var i=e.filter(function(t){return"objCol"===t.function||"vCol"===t.function&&t.configurable}).map(function(t){return t.index});return t.map(function(t){return t.filter(function(t,e){return 0<=i.indexOf(e)})})}function _(t,e){var i=0,n=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(i=t.index,n=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),M(t,[i],2))return[];for(var a=R(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var y=0;y<c[0];y++)h.push(isNaN(parseFloat(a[d][y])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(n){for(var f=[],p=1;p<s;p++)f.push(a[p].length);f.sort(function(t,e){return e-t});for(var v=1;v<s;v++){var g=a[v],S=g[i];if(""!=S&&null!=S&&null!=S||(S="$-"+v),S){for(var x={name:S,showLegend:S!="$-"+v,data:[]},m=0;m<f[0];m++){var k=u[m];""!=k&&null!=k&&null!=k||(k="&-"+m),m!==i&&x.data.push({name:k,subName:S,showAxisText:k!="&-"+m,value:""==g[m]||isNaN(parseFloat(g[m]))||null==g[m]||null==g[m]?0:g[m],tooltipValueShow:!isNaN(parseFloat(g[m]))})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var C=1;C<b[0];C++)if(C!==i){var O=u[C];""!=u[C]&&null!=u[C]&&null!=u[C]||(O="$-"+C);var F="";F=1==C?"rainfall":2==C?"volume":"",r[O+"-"+C]={name:O,showLegend:O!="$-"+C,type:F,data:[]}}for(var P=1;P<s;P++){var W=a[P],A=W[i];if(""!=A&&null!=A&&null!=A||(A="&-"+P),A)for(var z=0;z<b[0];z++){var L=u[z];""!=u[z]&&null!=u[z]&&null!=u[z]||(L="$-"+z),z!==i&&L&&r[L+"-"+z].data.push({name:A,showAxisText:A!="&-"+P,value:""==W[z]||isNaN(parseFloat(W[z]))||null==W[z]||null==W[z]?0:W[z],tooltipValueShow:!isNaN(parseFloat(W[z]))})}}for(var D in r)l.push(r[D])}return l.forEach(function(t,e){t.key=T(t.name)+"-"+e}),l}function P(t,e,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:12,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"sans-serif",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"50%",r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"middle",l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"...",s=t.append("text").style("text-anchor",r).style("font-size",n+"px").style("font-family",o).attr("dy","0.35em");return s.append("textPath").attr("startOffset",a).attr("xlink:href",function(){return"#"+e.attr("id")}).text(function(){var t=e.node().getTotalLength();return S(i,t,n,o,l)}),s}function w(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";if(null==t||null==t||""==t)return 0;var n=d3.select("defs");n.empty()&&(n=d3.select("svg").append("defs"));var o=n.append("text").style("font-size",e+"px").style("font-family",i).text(String(t)),a=o.node().getComputedTextLength();return o.remove(),a}function pt(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";return Math.ceil(d3.max(t,function(t){return w(t,e,i)}))}function S(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"sans-serif",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"...";if(w(t,i,n)<=e)return t;if(w(o,i,n)>=e)return"";for(var a=String(t).split(""),r=a.length,l="",s=0;s<r;s++)if(w((l+=a[s])+o,i,n)>e)return 0===s?"":l.slice(0,s)+o}var d="legend-group",f=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","legend"),e.group=e.elem.append("g"),e._data=[],e._shapeType="circle",e._shapeWidth=12,e._shapeHeight=12,e._shapeStroke="none",e._rowGap=6,e._colGap=20,e._innerGap=6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._limitedWidth=400,e._horizontalAlign="center",e._onClick=function(){},e._each=function(){},e._orient="horizontal",e}return u(i,o),r(i,[{key:"update",value:function(){var o=this,a=o.group,r=Math.max(o._shapeHeight,o._fontSize),l=o._limitedWidth-o._shapeWidth-o._innerGap,s=0,u=0;o.elem.selectAll("."+d).remove();var h=a.append("g").attr("class",d);o._data.forEach(function(t){var e=S(t.name?t.name:"",l,o._fontSize,o._fontFamily),i=o._shapeWidth+o._innerGap+w(e,o._fontSize,o._fontFamily);if("vertical"===o._orient)o._legendItem(t,h,0,u),u=u+r+o._rowGap;else{var n=s+i+o._colGap;n>o._limitedWidth&&(s=0,n=i+o._colGap,u+=r+o._rowGap,h=a.append("g").attr("class",d)),o._legendItem(t,h,s,u),s=n}});var t=dt(a).width;return"center"===o._horizontalAlign?a.call(z,o._limitedWidth/2-t/2,0):"left"===o._horizontalAlign?a.call(z,0,0):"right"===o._horizontalAlign&&a.call(z,o._limitedWidth-t,0),o}},{key:"_shapeElem",value:function(t){var e=void 0;return(e="rect"===this._shapeType?t.append("rect").attr("width",this._shapeWidth).attr("height",this._shapeHeight):t.append("circle").attr("cx",this._shapeWidth/2).attr("cy",this._shapeHeight/2).attr("r",Math.min(this._shapeWidth,this._shapeHeight)/2)).attr("class","legend-shape"),e}},{key:"_legendItem",value:function(t,e,i,n){var o=e.append("g").datum(t).attr("class","legend-item").call(z,i,n).on("click",this._onClick).each(this._each);return this._shapeElem(o).style("fill",t.color),o.append("text").attr("x",this._shapeWidth+this._innerGap).attr("y",this._shapeHeight/2).attr("dy","0.35em").style("text-anchor","start").style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("fill",this._fontColor).text(S(t.name?t.name:"",this._limitedWidth-this._shapeWidth-this._innerGap,this._fontSize,this._fontFamily)),o}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"shapeType",value:function(t){return arguments.length?(this._shapeType=t,this):this._shapeType}},{key:"shapeWidth",value:function(t){return arguments.length?(this._shapeWidth=t,this):this._shapeWidth}},{key:"shapeHeight",value:function(t){return arguments.length?(this._shapeHeight=t,this):this._shapeHeight}},{key:"rowGap",value:function(t){return arguments.length?(this._rowGap=t,this):this._rowGap}},{key:"colGap",value:function(t){return arguments.length?(this._colGap=t,this):this._colGap}},{key:"innerGap",value:function(t){return arguments.length?(this._innerGap=t,this):this._innerGap}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"onClick",value:function(t){return arguments.length?(this._onClick=t,this):this._onClick}},{key:"each",value:function(t){return arguments.length?(this._each=t,this):this._each}}]),i}(),p=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return u(i,o),r(i,[{key:"update",value:function(){var s=this;return s.elem.attr("dy","1em").style("fill",s._color).style("font-size",s._fontSize+"px").style("font-family",s._fontFamily).style("font-weight",s._fontWeight).style("text-anchor",s._textAnchor).each(function(){for(var t,e=d3.select(this),i=s._text.split("").reverse(),n=[],o=0,a=+e.attr("x"),r=+e.attr("y"),l=e.text(null).append("tspan").attr("x",a).attr("y",r);t=i.pop();)n.push(t),l.text(n.join("")),l.node().getComputedTextLength()>s._width&&(++o,n.pop(),l.text(n.join("")),n=[t],l=e.append("tspan").attr("x",a).attr("y",o*parseFloat(1.3*s._fontSize)+parseFloat(s._fontSize)+r).text(t))}),s}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),v=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","unit-group"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return u(i,o),r(i,[{key:"update",value:function(){var t=this;return t.elem.selectAll("text").remove(),t.elem.append("text").attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),g=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","source-group"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return u(i,o),r(i,[{key:"update",value:function(){var t=this;return t.elem.selectAll("text").remove(),t.elem.append("text").attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),i}(),m=function(t){function n(t){a(this,n);var e=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),i=t._groups?t:d3.select(t);return e.elem=i.append("div").attr("class","chart-tooltip").style("position","absolute").style("pointer-events","none").style("-moz-user-select","none").style("-webkit-user-select","none").style("-ms-user-select","none").style("user-select","none"),"static"!=i.style("position")&&"initial"!=i.style("position")||i.style("position","relative"),e._data=[],e._x=0,e._y=0,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#fff",e._backgroundColor="rgba(0,0,0,0.7)",e._borderRadius=5,e._padding={top:5,right:8,bottom:5,left:8},e._textAlign="left",e._locked=!1,e._scale=1,e._scaleValue=1,e}return u(n,o),r(n,[{key:"update",value:function(){var t=this,e=t._fontSize;if(t._locked)return t;t._scaleValue="function"==typeof t._scale?t._scale():t._scale,t.elem.style("background-color",t._backgroundColor).style("border-radius",t._borderRadius+"px").style("font-size",e+"px").style("font-family",t._fontFamily).style("color",t._fontColor).style("text-align",t._textAlign).style("padding",t._padding.top+"px "+t._padding.right+"px "+t._padding.bottom+"px "+t._padding.left+"px");var i=t.elem.selectAll("div").data(t._data);i.exit().remove();var n=i.enter().append("div").attr("class","tooltip-row").style("white-space","nowrap");n.append("span").attr("class","tooltip-color-circle"),n.append("span").attr("class","tooltip-text");var o=n.merge(i);return o.select(".tooltip-color-circle").style("width","0px").style("height","0px").style("border-radius","50%").style("display","inline-block").style("margin","0px").style("vertical-align","middle").filter(function(t){return t.color}).style("width",e+"px").style("height",e+"px").style("background-color",function(t){return t.color}).style("margin-right","3px"),o.select(".tooltip-text").text(function(t){return t.text}).style("vertical-align","middle"),this}},{key:"move",value:function(t){var e=this;if(e._locked||!e.isShow)return e;var i=e._scaleValue||1,n=0,o=0,a=e.elem,r=a.node().parentNode,l=a.node().getBoundingClientRect(),s=r.getBoundingClientRect(),u=t||d3.mouse(r);return o=u[0]+l.width+8>s.width?u[0]-a.node().offsetWidth-8:u[0]+8,n=u[1]+l.height+5>s.height?u[1]-a.node().offsetHeight-0:u[1]+0,a.transition().duration(10).style("top",n/i+"px").style("left",o/i+"px"),e}},{key:"show",value:function(){return this._locked||(e(this.elem),this._show=!0),this}},{key:"hide",value:function(){return this._locked||(i(this.elem),this._show=!1),this}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"lock",value:function(t){return arguments.length?(this._locked=t,this):this._locked}},{key:"scale",value:function(t){return arguments.length?(this._scale=t,this):this._scale}}]),n}();function k(t,e,i){return t.map(function(t){return function(t,e,i){var n=void 0;if("number"==typeof t){var o=e.theme&&e.theme.colors;n=o&&o[t%o.length]||i&&i.colors[t]||"#000"}else n=rt(t);return n}(t,e,i)})}function rt(t){if(t&&/#/.test(t)){if(String(t).length<8)return t;return function(t,e){for(var i="rgba(",n=[],o=1;o<t.length;o+=2)n.push(parseInt("0x"+t.slice(o,o+2)));return n.forEach(function(t){i+=t+", "}),i+=e+")"}(String(t).slice(0,7),(parseInt("0x"+String(t).slice(7,9))/255).toFixed(2))}return t}var b=function(){function i(t,e){a(this,i),this._blockData=t,this._projectTheme=e,this._dataSrc=t.dataSrc,this._blockTheme=t.theme,this._props=t.props,this._columnMap=this._props.map,this._legend=this._props.legend,this._font=this._props.font,this._axis=this._props.axis,this._paddings=this._props.paddings,this._title=this._props.titleDisplay,this._label=this._props.label,this._display=this._props.display,this._animation=this._props.animation,this._unitDisplay=this._props.unitDisplay,this._sourceDisplay=this._props.sourceDisplay,this._dataSolveFunc=c}return r(i,[{key:"dataSolveFunc",value:function(t){return arguments.length&&"function"==typeof t?(this._dataSolveFunc=t,this):this._dataSolveFunc}},{key:"generateColorList",value:function(t){var e=this._props.colors.type,i=k(this._props.colors.list,this._blockData,this._projectTheme);if(!t)return i;var n=i;switch(e){case"linear":var o=i.slice(0,2),a=d3.scaleLinear().domain([0,t-1]).range(o);n=d3.range(t).map(function(t,e){return a(e)});break;case"single":n=d3.range(t).map(function(){return i[0]});break;default:if(n=i.slice(0),i.length<t)for(var r=i.length;n.push(i[r%i.length]),++r<t;);}return n}},{key:"HexToRGBA",value:function(t){if(t&&/#/.test(t)){if(t.length<8)return t;return function(t,e){for(var i="rgba(",n=[],o=1;o<t.length;o+=2)n.push(parseInt("0x"+t.slice(o,o+2)));return n.forEach(function(t){i+=t+", "}),i+=e+")"}(t.slice(0,7),(parseInt("0x"+t.slice(7,9))/255).toFixed(2))}return t}},{key:"data",get:function(){var t,i,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),n=this.generateColorList(e.length);return i=n,(t=e).forEach(function(t,e){t.color=i[e],t.color_special=i[e+1]}),t}},{key:"dataType",get:function(){var t="2d";if("cross-table"===this._dataSrc.dataType)t="cross-table";else{var e=this._dataSrc.data;t=e[1]?"2sheet":e[0].length+"d"}return t}},{key:"width",get:function(){return parseFloat(this._props.size.width)-2}},{key:"height",get:function(){return parseFloat(this._props.size.height)-2}},{key:"font",get:function(){return{fontSize:this._font.fontSize||this._blockData.theme.fonts.fontSize||12,color:this.HexToRGBA(this._font.color)||this._blockData.theme.fonts.fontColor||"#000",fontFamily:this._font.fontFamily||this._blockData.theme.fonts.fontFamily||"sans-serif"}}},{key:"display",get:function(){return Object.assign({},this._props.display)}},{key:"animation",get:function(){return Object.assign({},this._props.animation)}},{key:"unitDisplay",get:function(){return Object.assign({},this._props.unitDisplay)}},{key:"sourceDisplay",get:function(){return Object.assign({},this._props.sourceDisplay)}},{key:"axisCopy",get:function(){return Object.assign({},this._props.axis)}},{key:"timerControl",get:function(){return Object.assign({},this._props.timerControl)}},{key:"pictures",get:function(){return Object.assign({},this._props.pictures)}},{key:"paddings",get:function(){return{top:this._paddings&&this._paddings.top||20,bottom:this._paddings&&this._paddings.bottom||23,left:this._paddings&&this._paddings.left||24,right:this._paddings&&this._paddings.right||24}}},{key:"legend",get:function(){return{show:!1!==this._legend.show,xPosition:this._legend.xPosition,yPosition:this._legend.yPosition,styleOptions:this._legend.styleOptions,style:this._legend.style,lineHeight:this._legend.lineHeight,color:this.HexToRGBA(this._legend.color),fontFamily:this._legend.fontFamily,fontSize:this._legend.fontSize}}},{key:"tooltipShow",get:function(){return this._props.tooltip}},{key:"axis",get:function(){return{color:this.HexToRGBA(this._axis.color)||this._blockTheme.axis.color,x:this._axis.x,y:this._axis.y,y1:this._axis.y1}}},{key:"label",get:function(){return Object.assign({},this._props.label)}},{key:"grid",get:function(){var t=this._axis.grid;return{showX:null==t?null:"all"===t.show||"x"===t.show,showY:null==t?null:"all"===t.show||"y"===t.show,color:null==t?null:this.HexToRGBA(t.color)||this._blockTheme.grid&&this._blockTheme.grid.color||"#ccc",gridLineWidth:null==t?null:0==t.gridLineWidth||t.gridLineWidth?t.gridLineWidth:1}}},{key:"backgroundColor",get:function(){return this._props.backgroundColor||"transparent"}},{key:"colors",get:function(){return this._props.colors}},{key:"title",get:function(){var t=this._title||{};return{show:!1!==t.show,text:t.text||"",xPosition:t.xPosition||"center",yPosition:t.yPosition||"top",fontSize:t.fontSize||24,color:this.HexToRGBA(t.color)||"#000",fontFamily:t.fontFamily||"noto",lineHeight:t.lineHeight||10,totalHeight:t.totalHeight||39}}}]),i}(),C=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t._groups?t.append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"):d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"),e.defs=e.elem.append("defs"),e.group=e.elem.append("g").attr("class","svg-group"),e.mainGroup=e.group.append("g").attr("class","main-group"),e.title=new p(e.group),e.unitText=new v(e.group),e.sourceText=new g(e.group),e.legend=new f(e.group),e.tooltip=new m(t),e.labelTextClass="chart-label-text",e._data=[],e._width=400,e._height=400,e._backgroundColor=null,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._transition=!1,e._duration=0,e._legendShow=!0,e._legendX="center",e._legendY="bottom",e._titleShow=!0,e._titleText="",e._titleX="center",e._titleY="top",e._titleFontSize=24,e._titleColor="#000",e._titleFontFamily="sans-serif",e._unitWord="",e._sourceWord="",e._marginTop=20,e._marginRight=24,e._marginBottom=23,e._marginLeft=24,e._gapPadding=15,e._titlePadding=10,e._unitPadding=15,e._sourcePadding=15,e._sortValue=0,e._sortedDataCopy=null,e._dataType="2d",e._tooltipShow=!0,e}return u(i,o),r(i,[{key:"_init",value:function(){var t=window.location.hostname,e="U2FsdGVkX1/u6EfnJcBwjl1lkrkHd1SLbqY/JBKMPPGUREtzJjAbYQ==";if(null==window.userId){e=t;var i=locked(t);"421aa90e079fa326b6494f812ad13e79"!=i&&"e5a748477660158b28c438af2cee80f6"!=i&&"31c49882abd53548158d8da55e154557"!=i&&"1c7d17e20b0caf276ddafea04a974399"!=i&&"68952600154b32fe212054caf039ee18"!=i&&"dycharts.com"!=t&&"dydata.io"!=t||this.update()}else{var n=locked(e);window.userId==n&&this.update()}return String.prototype.cestqui=function(){return e},this}},{key:"update",value:function(){return this._interrupt=!1,this._DynamicInterrupt=!0,this._titlePadding=this._unitWord&&this._unitShow?this._titlePadding:15,this.styleSvg(),this.sortData(),this.removeLabelText(),this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateLegend(),this.updateCore(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateTitle",value:function(){var t=this,e=t.title;if(!t._titleShow)return e.hide();var i="center"===t._titleX?"middle":"left"===t._titleX?"start":"end";e.text(t._titleText).color(t._titleColor).fontSize(t._titleFontSize).fontFamily(t._titleFontFamily).fontWeight("bold").textAnchor(i).dy("1em").width(t.widthOfNoMargin),e.update(),e.show();var n=this._titleText&&this._titleShow?Math.floor(this.title.height()-.25*this._titleFontSize+this._titlePadding):0,o=this._titleText&&this._titleShow?this._totalHeight+this._titlePadding:0,a=this._titleText&&this._titleShow?Math.floor(this.title.height()-.25*this._titleFontSize):0;(new RegExp("^方正[一-龥]+$").test(t._titleFontFamily)||"站酷高端黑"==t._titleFontFamily)&&(n=this._titleText&&this._titleShow?Math.floor(this.title.height()-.05*this._titleFontSize+this._titlePadding):0,a=this._titleText&&this._titleShow?Math.floor(this.title.height()-.05*this._titleFontSize):0);var r=this._height-o+n;this.hideHeight=n,this.elem.attr("width",this._width).attr("height",r),this.elem.attr("totalHeight",a)}},{key:"updateUnit",value:function(){var t=this,e=t.unitText;if(!t._unitShow)return e.hide();if(""==t._unitWord)return e.hide();var i="center"===t._unitX?"middle":"left"===t._unitX?"start":"end";e.text(t._unitWord).color(t._unitFontColor).fontSize(t._unitFontSize).fontFamily(t._unitFontFamily).textAnchor(i).dy("1em"),e.update(),e.show(),this.hideUnitHeight=this._unitWord&&this._unitShow?1.125*parseFloat(this._unitFontSize):0}},{key:"updateSource",value:function(){var t=this,e=t.sourceText;if(!t._sourceShow)return e.hide();if(""==t._sourceWord)return e.hide();var i="center"===t._sourceX?"middle":"left"===t._sourceX?"start":"end";e.text(t._sourceWord).color(t._sourceFontColor).fontSize(t._sourceFontSize).fontFamily(t._sourceFontFamily).textAnchor(i).dy("1em"),e.update(),e.show(),this.hideSourceHeight=this._sourceWord&&this._sourceShow?1.125*parseFloat(this._sourceFontSize):0}},{key:"updateLegend",value:function(){var t=this,e=t.legend,i=this._width-this._marginLeft-this._marginRight;if(!t._legendShow)return e.hide();e.show(),e.limitedWidth(i).fontSize(t._legendFontSize).fontFamily(t._legendFontFamily).fontColor(t._legendFontColor).horizontalAlign(t._legendX).each(function(t){var e=!1===t.active;d3.select(this).classed("clicked",e).style("opacity",e?.5:1)}),this.configLegend(),e.update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy;t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"updateCore",value:function(){}},{key:"onDataChange",value:function(){this._interrupt=!1,this.removeLabelText(),this.updateCore()}},{key:"onInterruptChange",value:function(){}},{key:"onClearTimer",value:function(){}},{key:"removeLabelText",value:function(){this.elem.selectAll("."+this.labelTextClass).remove()}},{key:"styleSvg",value:function(){this.elem.attr("width",this._width).attr("height",this._height).style("background-color",this._backgroundColor).style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("user-select","none"),this.group.call(z,this._marginLeft,this._marginTop)}},{key:"layout",value:function(){var t=this.title,e=this.unitText,i=this.sourceText,n=this.legend,o=this.mainGroup,a=this._titleText&&this._titleShow?this.title.height()-.25*this._titleFontSize:0;(new RegExp("^方正[一-龥]+$").test(this._titleFontFamily)||"站酷高端黑"==this._titleFontFamily)&&(a=this._titleText&&this._titleShow?this.title.height()-.05*this._titleFontSize:0);var r=this._unitWord&&this._unitShow?1.125*parseFloat(this._unitFontSize):0,l=this._sourceWord&&this._sourceShow?1.125*parseFloat(this._sourceFontSize):0,s=n.height(),u=this.heightOfMainGroup,h=this._titleText&&this._titleShow?this._titlePadding:0,c=this._unitWord&&this._unitShow?this._unitPadding:0,_=this._sourceWord&&this._sourceShow?this._sourcePadding:0,d=this._legendShow&&0!=s?this._gapPadding:0,y="top",f="bottom",p=this._titleY,v=this._legendY;p!==y&&p!==f&&(p=y),v!==y&&v!==f&&(v=f);var g=0,S=0,x=0,m=0,k=0,b=this._titleText&&this._titleShow?.15*this._titleFontSize:0,w=this._unitWord&&this._unitShow?.1*this._unitFontSize:0,C=this._sourceWord&&this._sourceShow?.15*this._sourceFontSize:0,O=this._legendShow&&0!=s?.25*this._legendFontSize+(1.125*this._legendFontSize/2-6):0;p===y&&v===y?(g=-b,x=(k=(m=(S=a+h-b-w)+r+c+w+(this._legendShow&&0!=s?1.125*this._legendFontSize/2-6:0))+s+d-O)+u+_-C):p===f&&v===f?(S=-w,g=(x=(m=(k=r+c+w)+u+d+(this._legendShow&&0!=s?1.125*this._legendFontSize/2-6:0))+s+_-O-C)+l+h-b):p===y&&v===f?(g=-b,x=(m=(k=(S=a+h-b-w)+r+c+w)+u+d+(this._legendShow&&0!=s?1.125*this._legendFontSize/2-6:0))+s+_-O-C):(m=this._legendShow&&0!=s?1.125*this._legendFontSize/2-6:0,g=(x=(k=(S=s+d-(this._legendShow&&0!=s?.25*this._legendFontSize:0)-w)+r+c+w)+u+_-C)+l+h-b);var F=this._width-this._marginLeft-this._marginRight,P="center"===this._titleX?F/2:"left"===this._titleX?0:F,W="center"===this._unitX?F/2:"left"===this._unitX?0:F,A="center"===this._sourceX?F/2:"left"===this._sourceX?0:F;t.translate(P,g),e.translate(W,S),i.translate(A,x),n.translate(0,m),o.call(z,0,k)}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"backgroundColor",value:function(t){return arguments.length?(this._backgroundColor=t,this):this._backgroundColor}},{key:"legendShow",value:function(t){return arguments.length?(this._legendShow=t,this):this._legendShow}},{key:"legendX",value:function(t){return arguments.length?(this._legendX=t,this):this._legendX}},{key:"legendY",value:function(t){return arguments.length?(this._legendY=t,this):this._legendY}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"gapPadding",value:function(t){return arguments.length?(this._gapPadding=parseFloat(t),this):this._gapPadding}},{key:"unitPadding",value:function(t){return arguments.length?(this._unitPadding=parseFloat(t),this):this._unitPadding}},{key:"sourcePadding",value:function(t){return arguments.length?(this._sourcePadding=parseFloat(t),this):this._sourcePadding}},{key:"marginTop",value:function(t){return arguments.length?(this._marginTop=parseFloat(t),this):this._marginTop}},{key:"marginRight",value:function(t){return arguments.length?(this._marginRight=parseFloat(t),this):this._marginRight}},{key:"marginBottom",value:function(t){return arguments.length?(this._marginBottom=parseFloat(t),this):this._marginBottom}},{key:"marginLeft",value:function(t){return arguments.length?(this._marginLeft=parseFloat(t),this):this._marginLeft}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"sortValue",value:function(t){return arguments.length?(this._sortValue=parseFloat(t),this):this._sortValue}},{key:"dataType",value:function(t){return arguments.length?(this._dataType=t,this):this._dataType}},{key:"tooltipShow",value:function(t){return arguments.length?(this._tooltipShow=t,this):this._tooltipShow}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"titleText",value:function(t){return arguments.length?(this._titleText=t,this):this._titleText}},{key:"titleColor",value:function(t){return arguments.length?(this._titleColor=t,this):this._titleColor}},{key:"titleFontSize",value:function(t){return arguments.length?(this._titleFontSize=t,this):this._titleFontSize}},{key:"titleFontFamily",value:function(t){return arguments.length?(this._titleFontFamily=t,this):this._titleFontFamily}},{key:"titleX",value:function(t){return arguments.length?(this._titleX=t,this):this._titleX}},{key:"titleY",value:function(t){return arguments.length?(this._titleY=t,this):this._titleY}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"colors",value:function(t){return arguments.length?(this._colors=t,this):this._colors}},{key:"titlePadding",value:function(t){return arguments.length?(this._titlePadding=t,this):this._titlePadding}},{key:"unitPadding",value:function(t){return arguments.length?(this._unitPadding=t,this):this._unitPadding}},{key:"sourcePadding",value:function(t){return arguments.length?(this._sourcePadding=t,this):this._sourcePadding}},{key:"legendFontFamily",value:function(t){return arguments.length?(this._legendFontFamily=t,this):this._legendFontFamily}},{key:"legendFontSize",value:function(t){return arguments.length?(this._legendFontSize=parseFloat(t),this):this._legendFontSize}},{key:"legendFontColor",value:function(t){return arguments.length?(this._legendFontColor=t,this):this._legendFontColor}},{key:"totalHeight",value:function(t){return arguments.length?(this._totalHeight=parseFloat(t),this):this._totalHeight}},{key:"countOfLabel",value:function(t){return arguments.length?(this._countOfLabel=parseFloat(t),this):this._countOfLabel}},{key:"sortData",value:function(){var t=this._data.slice(0),e=this._sortValue,i=this._dataType,n=t.map(function(t){return t.color}),o=void 0;"cross-table"===i?(t.forEach(function(t){t.sum=d3.sum(t.data,function(t){return t.value})}),o=1===e?function(t,e){return t.sum-e.sum}:-1===e?function(t,e){return e.sum-t.sum}:null):o=1===e?function(t,e){return t.value-e.value}:-1===e?function(t,e){return e.value-t.value}:null,this._sortedDataCopy=o?t.sort(o).map(function(t,e){return t.color=n[e],t}):t}},{key:"buildOption",value:function(t,e){var i=new b(t,e),n=c;switch(i.dataType){case"cross-table":n=_;break;default:n=c}return i.dataSolveFunc(n),i}},{key:"setPublicOption",value:function(t){this.data(t.data).backgroundColor(t.backgroundColor).width(t.width).height(t.height).colorList(t._blockTheme.colors).colors(t.colors),this.fontFamily(t.font.fontFamily).fontSize(t.font.fontSize).fontColor(t.font.color),this.titleShow(t.title.show).titleText(t.title.text).titleColor(t.title.color).titleFontFamily(t.title.fontFamily).titleFontSize(t.title.fontSize).titleX(t.title.xPosition).titleY(t.title.yPosition).titlePadding(parseFloat(t.title.lineHeight||10)).totalHeight(parseFloat(t.title.totalHeight||39)),this.legendShow(t.legend.show).legendX(t.legend.xPosition).legendY(t.legend.yPosition).gapPadding(parseFloat(t.legend.lineHeight||15)).legendFontFamily(t.legend.fontFamily||"Noto Sans").legendFontSize(parseFloat(t.legend.fontSize||14)).legendFontColor(t.legend.color||"#545454"),this.tooltipShow(t.tooltipShow),this.dataType(t.dataType),this.unitPadding(parseFloat(t.unitDisplay.bottomLineHeight||15)).sourcePadding(parseFloat(t.sourceDisplay.topLineHeight||15)).marginTop(t.paddings?parseFloat(t.paddings.top||20):20).marginBottom(t.paddings?parseFloat(t.paddings.bottom||23):23).marginLeft(t.paddings?parseFloat(t.paddings.left||24):24).marginRight(t.paddings?parseFloat(t.paddings.right||24):24)}},{key:"setSelfOption",value:function(t){}},{key:"setOption",value:function(t,e,i){var n=this.buildOption(t,e);this._interrupt=!1,this._DynamicInterrupt=!0,this.setPublicOption(n),this.setSelfOption(n),this.group.attr("opacity",1),this.update()}},{key:"setInsertOption",value:function(t,e,i){var n=this.buildOption(t,e);this._interrupt=!1,this._DynamicInterrupt=!0,this.setPublicOption(n),this.setSelfOption(n),this._transition=!1,this.group.attr("opacity",0),this.update()}},{key:"widthOfNoMargin",get:function(){var t=this._width-this._marginLeft-this._marginRight;return 0<t?t:0}},{key:"heightOfNoMargin",get:function(){var t=this._titleText&&this._titleShow?Math.floor(this.title.height()-.25*this._titleFontSize+this._titlePadding):0,e=this._titleText&&this._titleShow?this._totalHeight+this._titlePadding:0;(new RegExp("^方正[一-龥]+$").test(this._titleFontFamily)||"站酷高端黑"==this._titleFontFamily)&&(t=this._titleText&&this._titleShow?Math.floor(this.title.height()-.05*this._titleFontSize+this._titlePadding):0);var i=this._height-e+t-this._marginTop-this._marginBottom;return 0<i?i:0}},{key:"heightOfMainGroup",get:function(){var t=this._titleText&&this._titleShow?this.title.height()-.4*this._titleFontSize+this._titlePadding:0;(new RegExp("^方正[一-龥]+$").test(this._titleFontFamily)||"站酷高端黑"==this._titleFontFamily)&&(t=this._titleText&&this._titleShow?this.title.height()-.2*this._titleFontSize+this._titlePadding:0);var e=this._unitWord&&this._unitShow?1.125*parseFloat(this._unitFontSize)+this._unitPadding:0,i=this._sourceWord&&this._sourceShow?1.125*parseFloat(this._sourceFontSize)+this._sourcePadding:0,n=this._legendShow&&0!=this.legend.height()?this.legend.height()+(0==this.legend.height()?0:this._gapPadding)-.3*this._legendFontSize:0,o=this.heightOfNoMargin-n-t-e-i;return 0<o?o:0}},{key:"activeData",get:function(){return this.sortedDataCopy.filter(function(t){return!1!==t.active})}},{key:"sortedDataCopy",get:function(){return this._sortedDataCopy}}]),i}(),O=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","wave-circle"),e.group=e.elem.append("g"),e._outerDonut=e.group.append("path"),e._innerCircle=e.group.append("circle"),e._textElem=e.group.append("text"),e._clipTextElem=e.group.append("text"),e._waveClip=e.group.append("defs").append("clipPath"),e._waveClipPath=e._waveClip.append("path"),e._radius=50,e._value=60,e._clipId=n("wave-clip"),e._waveCount=3,e._waveColor="#178BCA",e._outerCircleColor=null,e._minValue=0,e._maxValue=100,e._circleThickness=.05,e._circleFillGap=.05,e._waveHeightRatio=.05,e._waveRiseTime=1500,e._waveAnimateTime=1500,e._waveRise=!0,e._textSize=.5,e._textSuffix="%",e._textColor="#045681",e._waveTextColor="#A4DBf8",e}return u(i,o),r(i,[{key:"update",value:function(){for(var n=this,t=n._radius,e=n._radius,i=n._circleThickness*n._radius,o=n._circleFillGap*n._radius,a=n._radius-i-o,r=n._textSize*n._radius,l=2*n._radius/n._waveCount,s=n._waveCount+1,u=l*s,h=n._waveHeightRatio*n._radius,c=Number(n.value)<n._minValue?n._minValue:Number(n.value)>n._maxValue?n._maxValue:Number(n.value),_=d3.scaleLinear().range([2*n._radius-2*i-2*o+2*h,h]).domain([0,1])(c/(n._maxValue-n._minValue)),d=[],y=0;y<100;y++){var f=y*(s*Math.PI*2)/100,p=Math.sin(f);d.push({x:f,y:p})}var v=d3.scaleLinear().domain([0,2*Math.PI*s]).range([0,u]),g=d3.scaleLinear().domain([-1,1]).range([0,h]),S=d3.area().x(function(t){return v(t.x)}).y0(function(t){return g(t.y)}).y1(function(t){return 2*n._radius-2*i-2*o+h});return n._waveClip.attr("id",n._clipId).call(z,0,_),n._waveClipPath.datum(d).attr("d",S),n._outerDonut.attr("d",d3.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(n._radius-i).outerRadius(n._radius)).style("fill",n._outerCircleColor||n._waveColor).call(z,t,e),n._innerCircle.attr("cx",t).attr("cy",e).attr("r",a).style("fill",n._waveColor).attr("clip-path","url("+x("#"+n._clipId)+")"),n._textElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",n._textColor).text(n.value+n._textSuffix),n._clipTextElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",n._waveTextColor).text(n.value+n._textSuffix).attr("clip-path","url("+x("#"+n._clipId)+")"),function(){if(n._interrupt)n._waveClip.call(z,0,_),n._textElem.text(n.value+n._textSuffix),n._clipTextElem.text(n.value+n._textSuffix);else{var t=d3.transition().duration(n._transition?n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear),e=function(){var e=this,i=d3.interpolate(n._minValue,n.value);return function(t){e.textContent=d3.format("d")(i(t))+n._textSuffix,1==t&&(e.textContent=i(t)+n._textSuffix)}};n._waveClip.call(z,0,2*n._radius).transition(t).call(z,0,_),n._textElem.text("0"+n._textSuffix).transition(t).tween("text",e),n._clipTextElem.text("0"+n._textSuffix).transition(t).tween("text",e)}}(),function t(){n._waveClipPath.attr("transform","translate("+(-u+2*n._radius)+",0)").transition().duration(n._waveAnimateTime).ease(d3.easeLinear).attr("transform","translate(0,0)").on("end",t)}(),n.elem.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"value",value:function(t){return arguments.length?(this.value=t,this):this.value}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"waveColor",value:function(t){return arguments.length?(this._waveColor=t,this):this._waveColor}},{key:"waveCount",value:function(t){return arguments.length?(this._waveCount=t,this):this._waveCount}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),W=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","wave-circle-chart"),e._circleMargin=2,e._labelMargin=2,e._maxCountOfOneLine=5,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e._interrupt=!1,e}return u(i,C),r(i,[{key:"updateCore",value:function(){var n=this,t=n.activeData,e=t.length,o=n.widthOfNoMargin,i=n.heightOfMainGroup,a=Math.min(n._maxCountOfOneLine,e),r=Math.ceil(e/a),l=o/a,s=i/r,u=1.2*n.fontSize()+2*n._labelMargin,h=s-u,c=(Math.min(l,h)-2*n._circleMargin)/2,_=n.defs;_.selectAll("filter").remove();var d=_.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_wave_circles").attr("filterUnits","objectBoundingBox");d.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blurredAlpha"),d.append("feOffset").attr("in","blurredAlpha").attr("dx",0).attr("dy",1).attr("result","offsetBlurredAlpha"),d.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),d.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),d.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var y=n.mainGroup.selectAll("g.wave-circle-item").data(t,function(t){return t.name});if(y.exit().remove(),t.length){var f=y.enter().append("g").attr("class","wave-circle-item");f.append("g"),f.append("text").attr("class",n.labelTextClass);var p=f.merge(y);p.select("g").call(z,n._circleMargin+l/2-c,n._circleMargin+h/2-c).each(function(t,e){d3.select(this).selectAll("*").remove();var i=new O(d3.select(this));i.radius(c).waveColor(t.color).value(-1==String(t.value).indexOf(".")?parseFloat(t.value):parseFloat(t.value).toFixed(2)).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).interrupt(n._interrupt).onMouseover(function(t,e){var i=[{text:t.name+": "+parseFloat(t.value)+"%",color:t.color}];n.tooltip.data(i).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){n.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){n.tooltip.hide()}),i.update()}),p.select("."+this.labelTextClass).call(z,l/2,2*n._circleMargin+h/2+c+n._labelMargin).attr("dy","0.85em").style("text-anchor","middle").style("fill",n._fontColor).text(function(t){return t.showLegend?S(t.name,l,n._fontSize,n._fontFamily):""});var v=e%a,g=(Math.ceil(e/a)-1)*a;p.attr("transform",function(t,e){var i=e%a*l,n=Math.floor(e/a)*s;return v&&g<=e&&(i=o/v*(e%a+.5)-c),"translate("+i+","+n+")"})}}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"removeLabelText",value:function(){}},{key:"maxCountOfOneLine",value:function(t){return arguments.length?(this._maxCountOfOneLine=t,this):this._maxCountOfOneLine}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.unitDisplay,n=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e?e.duration:this._duration,this._startDelay=e?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?rt(i.color):this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(n).length&&(this._sourceShow=n?n.show:this._sourceShow,this._sourceWord=n?n.text:this._sourceWord,this._sourceFontSize=n.fontSize?n.fontSize:this._sourceSize,this._sourceFontColor=n.color?rt(n.color):this._sourceColor,this._sourceFontFamily=n.fontFamily?n.fontFamily:this._sourceFamily,this._sourceX=n.xPosition?n.xPosition:this._sourceX,this._sourceY=n.yPosition?n.yPosition:this._sourceY)}}]),i}(),A=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g"),e.group=e.elem.append("g"),e._data=[],e._transition=!1,e._duration=0,e._onTransitionStart=function(){},e._onTransitionEnd=function(){},e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return u(i,o),r(i,[{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"onTransitionStart",value:function(t){return arguments.length?(this._onTransitionStart="function"==typeof t?t:function(){},this):this._onTransitionStart}},{key:"onTransitionEnd",value:function(t){return arguments.length?(this._onTransitionEnd="function"==typeof t?t:function(){},this):this._onTransitionEnd}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),L=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rose-pie"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return u(i,A),r(i,[{key:"update",value:function(){var o=this,n=o._data,t=o._startAngle,e=o._endAngle,i=d3.max(n,function(t){return Math.abs(t.value)}),a=o._radius,r=d3.scaleLinear().domain([0,i]).range([o._innerRadius,a]);o.group.selectAll("*").remove();var l=o.arcFunc.innerRadius(o._innerRadius).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(o._cornerRadius),s=o.pieFunc.value(1).startAngle(t).endAngle(e).sort(o._sortMethod);if(null==o._moveStyle||0==o._transition||-1==o._moveOptions.indexOf(o._moveStyle)){o.group.selectAll(".pie-path").remove(),o.group.selectAll("g.arc-group").remove();var u=o.group.selectAll("g.arc-group").data(s(n));u.exit().remove();var h=u.enter().append("g").attr("class","arc-group");h.append("path"),u.merge(h).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).select("path").style("stroke",o._stroke).style("stroke-width",o._strokeWidth).attr("d",function(t){return l(t)}).style("fill",function(t){return t.data.color}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)}else if(0==o._moveOptions.indexOf(o._moveStyle)){o.group.selectAll(".pie-path").remove(),o.group.selectAll("g.arc-group").remove();var c=o.group.selectAll("g.arc-group").data(s(n));c.exit().remove();var _=c.enter().append("g").attr("class","arc-group");_.append("path");var d=c.merge(_).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);o._interrupt?d.select("path").style("stroke",o._stroke).style("stroke-width",o._strokeWidth).transition().duration(0).delay(0).ease(d3.easeCubicOut).attr("d",function(t){return l(t)}).style("fill",function(t){return t.data.color}):d.select("path").style("stroke",o._stroke).style("stroke-width",o._strokeWidth).transition().duration(o._transition?.8*o._duration:0).delay(o._transition?o._startDelay+.1*o._duration:0).ease(d3.easeCubicOut).attrTween("d",function(i){var n=d3.interpolateNumber(o._innerRadius,r(Math.abs(i.data.value)));return function(t){var e=n(t);return l.outerRadius(e),l(i)}}).style("fill",function(t){return t.data.color})}else if(1==o._moveOptions.indexOf(o._moveStyle)){o.group.selectAll(".pie-path").remove(),o.group.selectAll("g.arc-group").remove();var y=o.group.selectAll("path").data(s(n));y.exit().remove();var f=y.merge(y.enter().append("path")).attr("class","pie-path").style("stroke",o._stroke).style("stroke-width",o._strokeWidth).style("fill",function(t){return t.data.color}).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);o._interrupt?f.transition().duration(0).ease(d3.easeLinear).delay(0).attr("d",function(t){return l(t)}):f.transition().duration(function(t,e){return o._transition?function(t){for(var e=0,i=0;i<t;i++)e=n[i].percent/100;return e*(o._transition?.8*o._duration:0)}(e+1):0}).ease(d3.easeLinear).delay(function(t,e){return o._transition?function(t){for(var e=0,i=0;i<t;i++)e+=n[i].percent/100;return e*(o._transition?.8*o._duration:0)}(e)+o._startDelay+.1*o._duration:0}).attrTween("d",function(e){var i=d3.interpolate(e.startAngle,e.endAngle);return function(t){return e.endAngle=i(t),l(e)}})}else if(2==o._moveOptions.indexOf(o._moveStyle)){o.group.selectAll(".pie-path").remove(),o.group.selectAll("g.arc-group").remove();var p=o.group.selectAll("path").data(s(n));p.exit().remove();var v=p.merge(p.enter().append("path")).attr("class","pie-path").style("stroke",o._stroke).style("stroke-width",o._strokeWidth).style("fill",function(t){return t.data.color}).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);o._interrupt?v.transition().duration(0).ease(d3.easeLinear).delay(0).attr("d",function(t){return l(t)}):v.transition().duration(function(t,e){return o._transition?function(t){for(var e=0,i=0;i<t;i++)e=n[i].percent/100;return e*(o._transition?.8*o._duration:0)}(e+1):0}).ease(d3.easeLinear).delay(function(t,e){return o._transition?function(t){for(var e=0,i=t;i<n.length;i++)e+=n[i].percent/100;return e*(o._transition?.8*o._duration:0)}(e+1)+o._startDelay+.1*o._duration:0}).attrTween("d",function(e){var i=d3.interpolate(e.endAngle,e.startAngle);return function(t){return e.startAngle=i(t),l(e)}})}if(o._interrupt?o.group.append("g").selectAll("g").data(s(n)).enter().append("g").transition().duration(0).delay(0).on("start",o._onTransitionStart).on("end",o._onTransitionEnd):o.group.append("g").selectAll("g").data(s(n)).enter().append("g").transition().duration(o._transition?.1*o._duration:0).delay(o._transition?o._startDelay+.1*o._duration:0).on("start",o._onTransitionStart).on("end",o._onTransitionEnd),o.group.selectAll(".pie-texts").remove(),o.group.selectAll(".pie-percents").remove(),o.group.selectAll(".pie-numbers").remove(),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||null==o._contentOption||null==o._contentChoice||0==o._positionOptions.indexOf(o._positionChoice)||2==o._positionOptions.indexOf(o._positionChoice)||-1==o._positionOptions.indexOf(o._positionChoice)||0==o._contentChoice.length)o.group.selectAll(".pie-texts text").style("display","none"),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none");else if(1==o._positionOptions.indexOf(o._positionChoice)){var g=o.group.append("g").selectAll("g").data(s(n));g.exit().remove(),g.enter().append("g").attr("class","pie-text-groups").merge(g).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]-1.3*o._fontSize}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]+1.3*o._fontSize})}),1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]}),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]}),o.group.selectAll(".pie-texts text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]}),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-texts text").style("display","none")):2==o._contentChoice.length&&(0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-percents text").style("display","none")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return D(t)[0]}).attr("y",function(t){return D(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-texts text").style("display","none")))}for(var S=o.group.selectAll(".pie-text-groups"),x=[],m=[],k=0;k<S._groups[0].length;k++){m.push(k);for(var b=k+1;b<S._groups[0].length;b++){ft(dt(d3.select(S._groups[0][k])),dt(d3.select(S._groups[0][b])))&&(x.push(k),d3.select(S._groups[0][k]).style("opacity","0"))}}for(var w=new Set(x),C=Array.from(w),O=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(C,m),F=0;F<C.length;F++){for(var P=[],W=0;W<O.length;W++){var A=dt(d3.select(S._groups[0][C[F]])),z=dt(d3.select(S._groups[0][O[W]]));if(P.push(ft(A,z)),ft(A,z)){if(C[F]==O[W])continue;d3.select(S._groups[0][C[F]]).style("opacity","0")}}0==P.filter(function(t){return 1==t}).length&&O.push(C[F])}for(var L=0;L<O.length;L++)d3.select(S._groups[0][O[L]]).style("opacity","1");function D(t){var e=.7*r(Math.abs(t.data.value)),i=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(i)*e,Math.sin(i)*e]}}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),D=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rose-text"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return u(i,A),r(i,[{key:"update",value:function(){var t=this,e=t._data,i=t._startAngle,n=t._endAngle,o=d3.max(e,function(t){return Math.abs(t.value)}),a=t._radius,r=d3.scaleLinear().domain([0,o]).range([t._innerRadius,a]);t.group.selectAll("*").remove();t.arcFunc.innerRadius(t._innerRadius).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(t._cornerRadius);var l=t.pieFunc.value(1).startAngle(i).endAngle(n).sort(t._sortMethod),s=t.group.selectAll("g.arc-text-group").data(l(e));s.exit().remove();var u=s.enter().append("g").attr("class","arc-text-group");u.append("g");var h=s.merge(u).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout);t._interrupt?h.select("g").transition().duration(0).delay(0).ease(d3.easeLinear).on("start",t._onTransitionStart).on("end",t._onTransitionEnd):h.select("g").transition().duration(t._transition?.9*t._duration:0).delay(t._transition?t._startDelay+.1*t._duration:0).ease(d3.easeLinear).on("start",t._onTransitionStart).on("end",t._onTransitionEnd)}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),N=function(t){function e(){a(this,e);var t=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._showX=!0,t._showY=!0,t._stroke="#ccc",t._strokeDasharray="2 2",t}return u(e,o),r(e,[{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"showX",value:function(t){return arguments.length?(this._showX=t,this):this._showX}},{key:"showY",value:function(t){return arguments.length?(this._showY=t,this):this._showY}}]),e}(),j="grid-arc-path",X="grid-line",G=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","polar-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=5,e}return u(i,N),r(i,[{key:"update",value:function(){var i=this,o=i._startAngle,a=i._endAngle,r=i._radius,l=i.group.style("fill","none").style("stroke",i._stroke).style("stroke-dasharray",i._strokeDasharray);!function(){if(!i._showX)return l.selectAll("."+j).remove();var n=i._donutCount,t=l.selectAll("."+j).data(d3.range(n));t.exit().remove(),t.enter().append("path").attr("class",j).merge(t).attr("d",function(t,e){var i=r/n*(e+1);return F(i,o,a)})}(),function(){if(!i._showY)return l.selectAll("."+X).remove();var t=i._sectorCount||1,n=(a-o)/t,e=l.selectAll("."+X).data(d3.range(t+1));e.exit().remove(),e.enter().append("line").attr("class",X).merge(e).attr("x1",0).attr("y1",0).attr("x2",function(t,e){var i=o+n*e;return Math.cos(i-Math.PI/2)*r}).attr("y2",function(t,e){var i=o+n*e;return Math.sin(i-Math.PI/2)*r})}()}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),i}(),B=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=null,e._gridStroke="#ccc",e._gridStrokeDasharray="3 3",e._gridShowX=!0,e._gridShowY=!0,e._gridLineWidth=1,e}return u(i,C),r(i,[{key:"gridStroke",value:function(t){return arguments.length?(this._gridStroke=t,this):this._gridStroke}},{key:"gridStrokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"gridShowX",value:function(t){return arguments.length?(this._gridShowX=t,this):this._gridShowX}},{key:"gridShowY",value:function(t){return arguments.length?(this._gridShowY=t,this):this._gridShowY}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"gridLineWidth",value:function(t){return arguments.length?(this._gridLineWidth=t,this):this._gridLineWidth}},{key:"setPublicOption",value:function(t){s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setPublicOption",this).call(this,t);var e=t.grid;this.gridStroke(e.color).gridShowX(e.showX).gridShowY(e.showY),this.gridLineWidth(0==parseFloat(e.gridLineWidth)?0:e.gridLineWidth||1)}}]),i}(),Y=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","rose-chart"),e.core=e.rose=new L(e.mainGroup),e.grid=new G(e.mainGroup),e.roseText=new D(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._labelRadiusRatio=.8,e._innerRadiusRatio=0,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["径向展开","顺时针展开","逆时针展开"],e._moveStyle="径向展开",e._endPause=0,e._interrupt=!1,e}return u(i,B),r(i,[{key:"updateCore",value:function(){var l=this;l._interrupt?l.group.selectAll(".polar-grid").interrupt().style("opacity",1):l.group.selectAll(".polar-grid").interrupt().style("opacity",0).transition().duration(l._transition?.1*l._duration*1e3:0).delay(l._transition?1e3*l._startDelay:0).style("opacity",1);for(var s=l.rose,t=l.grid,e=l.roseText,i=l._startAngle,n=l._endAngle,o=l.widthOfNoMargin,a=l.heightOfMainGroup,u=l._fontSize,r=.88*o,h=.88*a,c=function(t,e,i,n){var o=Math.min(t,e)/2,a=t/2,r=e/2,l=0;if(Math.abs(n-i)<=Math.PI/2){var s=Math.min(n,i),u=Math.max(n,i);o=Math.min(t,e),0<=s&&u<=Math.PI/2?(a=(t-o)/2,r=(e-o)/2+o,l=1):s>=Math.PI/2&&u<=Math.PI?(a=(t-o)/2,r=(e-o)/2,l=2):s>=Math.PI&&u<=3*Math.PI/2?(a=(t-o)/2+o,r=(e-o)/2,l=3):s>=3*Math.PI/2&&u<=2*Math.PI&&(a=(t-o)/2+o,r=(e-o)/2+o,l=4)}return{radius:o,cx:a,cy:r,quadrant:l}}(r,h,i,n),_=c.radius,d=c.cx,y=c.cy,f=_-.55*u-6,p=f-5,v=l._innerRadius||(l._innerRadiusRatio?l._innerRadiusRatio*p:0),g=0,S=0;S<l.activeData.length;S++)g+=l.activeData[S].value;for(var x=0;x<l.activeData.length;x++)l.activeData[x].percent=parseFloat(l.activeData[x].value/g*100).toFixed(1);t.donutCount(6).sectorCount(l.activeData.length).startAngle(i).endAngle(n).radius(f).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray).showX(l._gridShowX).showY(l._gridShowY),s.data(l.activeData).radius(p).innerRadius(v).startAngle(i).endAngle(n).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(1e3*parseFloat(l._startDelay)).moveOptions(l._moveOptions).moveStyle(l._moveStyle).endPause(l._endPause).interrupt(l._interrupt).onTransitionEnd(function(t,e){s.arcFunc.outerRadius()(t);var i=d3.select(this.parentNode),n=t.startAngle,o=t.endAngle,a="outer-arc-path-"+t.data.key+"-"+l.id,r=F(_,n+.015,o-.015);P(i,l.defs.select("#"+a).empty()?l.defs.append("path").attr("d",r).attr("id",a):l.defs.select("#"+a).attr("d",r),t.data.name=="$-"+e?"":t.data.name,u,l._fontFamily).attr("class",l.labelTextClass).style("pointer-events","none").style("fill",l._fontColor)}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var i=[{text:""+(t.data.name=="$-"+e?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];l.tooltip.data(i).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),l.tooltip.hide()});var m=l.defs;m.selectAll("filter").remove();var k=m.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_rose").attr("filterUnits","objectBoundingBox");k.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),k.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),k.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),k.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),k.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(l.activeData).radius(p).innerRadius(0).startAngle(i).endAngle(n).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(1e3*parseFloat(l._startDelay)).moveStyle(l._moveStyle).endPause(l._endPause).interrupt(l._interrupt).onTransitionEnd(l._onTransitionEnd());var b=(o-r)/2+d,w=(a-h)/2+y,C=c.quadrant,O=(_-p)/2;switch(C){case 4:b+=O,w+=O;break;case 1:b-=O,w+=O;break;case 2:b-=O,w-=O;break;case 3:b+=O,w-=spcae}t.translate(b,w).update(),s.translate(b,w).update(),e.translate(b,w).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"_onTransitionEnd",value:function(){var s=this;return function(t,e){var i=s.roseText.arcFunc.outerRadius()(t),n=d3.select(this.parentNode),o=t.startAngle,a=t.endAngle,r="arc-path-"+t.data.key+"-"+s.id,l=F(i-s._textLabel.fontSize/1.3*.5-6,o+.015,a-.015);P(n,s.defs.select("#"+r).empty()?s.defs.append("path").attr("d",l).attr("id",r):s.defs.select("#"+r).attr("d",l),t.data.value.toString(),s._textLabel.fontSize,s._textLabel.fontFamily).classed(s.labelTextClass,!0).style("pointer-events","none").style("fill",rt(s._textLabel.color)).style("font-size",s._textLabel.fontSize).style("font-family",s._textLabel.fontFamily),0==s._labelShow?n.selectAll("text").style("display","none"):n.selectAll("text").style("display","block")}}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),this.cornerRadius(l(0==e.cornerRadius||e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(rt(e.areaBorderColor)||this._stroke).strokeWidth(l(0==e.areaBorderWidth||e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),i}(),H=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e._startAngle=3*Math.PI/2,e._endAngle=2*Math.PI,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["径向展开","顺时针展开","逆时针展开"],e._moveStyle="径向展开",e._endPause=0,e._interrupt=!1,e}return u(i,Y),r(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._textLabel=i.textLabel?i.textLabel:this._textLabel),this.cornerRadius(l(0==e.cornerRadius||e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(rt(e.areaBorderColor)||this._stroke).strokeWidth(l(0==e.areaBorderWidth||e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),i}(),V=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bubble-plot"),e._radius=function(){},e._cx=function(){},e._cy=function(){},e._fill=null,e._stroke=null,e._strokeWidth=1,e}return u(i,A),r(i,[{key:"update",value:function(){var i=this,n=i._data,t=i.group;t.selectAll("*").remove();i._transition&&i._duration;var e=t.selectAll("circle").data(n,function(t){return t.key});e.exit().remove();var o=e.enter().append("circle").merge(e).attr("cx",i._cx).attr("cy",i._cy).style("fill",function(t){return i._fill||t.color}).style("fill-opacity",.9).attr("r",0).style("stroke",function(t){return i._bubbleBorderColor||t.color}).style("stroke-width",i._bubbleBorderWidth||0).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout);return i._interrupt?o.attr("r",i._radius):o.transition().duration(i._transition?i._duration/(0<n.length?n.length:0):0).delay(function(t,e){return i._transition?i._startDelay+i._duration/(0<n.length?n.length:0)*e:0}).attr("r",i._radius),i}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"cx",value:function(t){return arguments.length?(this._cx=t,this):this._cx}},{key:"cy",value:function(t){return arguments.length?(this._cy=t,this):this._cy}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}},{key:"bubbleBorderColor",value:function(t){return arguments.length?(this._bubbleBorderColor=t,this):this._bubbleBorderColor}},{key:"bubbleBorderWidth",value:function(t){return arguments.length?(this._bubbleBorderWidth=t,this):this._bubbleBorderWidth}}]),i}(),E=function(t){function i(t,e){return a(this,i),h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return u(i,b),r(i,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.categories,n=this.generateColorList(e.length),o={},a=[];return e.forEach(function(t,e){var i=n[e];o[t]=i,a.push({name:t,color:i})}),t.nodes.forEach(function(t){return t.color=o[t.category]}),0==e.length&&t.nodes.forEach(function(t){return t.color=n[0]}),t.legendData=a,t}}]),i}();function I(t,e){var s=0,u=1,h=2,c=3,_=4;e.forEach(function(t){"typeCol"===t.function?s=t.index:"objCol"===t.function?u=t.index:"X轴"===t.name?h=t.index:"Y轴"===t.name?c=t.index:"半径"===t.name&&(_=t.index)});var d=[],y=[],f={};t.slice(1).forEach(function(t,e){var i=t[s]||"",n=t[u]||"",o=t[h],a=t[c],r=t[_]||0,l=i+"-"+n+"-"+e;f[i]||""==i||(f[i]=i,d.push(i)),y.push({category:i,name:n,x:o,y:a,radius:r,key:l})});var i=t[0],n={category:i[s]||"",name:i[u]||"",x:i[h],y:i[c],radius:i[_]||0};return{categories:d,nodes:y,labels:n}}var $=function(t){function o(t){a(this,o);var e=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._xRange=null,e._yRange=null,e._xDomain=null,e._yDomain=null,e._clipShow=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e}return u(o,B),r(o,[{key:"update",value:function(){return this._interrupt=!1,this._DynamicInterrupt=!0,this._titlePadding=this._unitWord&&this._unitShow?this._titlePadding:15,this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"bottom"==this._legendY?8:this._gapPadding:this._gapPadding=0,this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain).range([0,h-i.width]),o.domain(t._yDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStrokeX).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration).xAxisLineWidth(t._xAxisLineWidth).axisLineShow(t._xAxisShow),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStrokeY).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration).yAxisLineWidth(t._yAxisLineWidth).axisLineShow(t._yAxisShow);i.titleHeight;var _=(c-e.allowedMaxTextHeight())/(3*u);e.compute(),i.tickCount(_),i.compute(),n.range([e._tickTextWidth>n.bandwidth()/2+i.width?e._tickTextWidth-n.bandwidth()/2-i.width:0,h-i.width]),e.compute(),o.range([c-e.height,0]);var d=i.width,y=c-e.height,f=i.width+(e._tickTextWidth>n.bandwidth()/2+i.width?e._tickTextWidth-n.bandwidth()/2-i.width:0);e.translate(d,y).update(),i.translate(f,0).update()}},{key:"onDataChange",value:function(){this._interrupt=!1,this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"updateScale",value:function(){}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=void 0;if(t.length){var o=d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),a=1.15*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})});n=o<0?a<=0?[o,0]:[o,a]:[0,a]}else n=[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"clipShow",value:function(t){return arguments.length?(this._clipShow=t,this):this._clipShow}},{key:"clipShowX",value:function(t){return arguments.length?(this._clipShowX=t,this):this._clipShowX}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"yLeftTickShow",value:function(t){return arguments.length?(this._yLeftTickShow=t,this):this._yLeftTickShow}},{key:"yRightTickShow",value:function(t){return arguments.length?(this._yRightTickShow=t,this):this._yRightTickShow}},{key:"yLeftName",value:function(t){return arguments.length?(this._yLeftName=t,this):this._yLeftName}},{key:"yLeftTitle",value:function(t){return arguments.length?(this._yLeftTitle=t,this):this._yLeftTitle}},{key:"yRightName",value:function(t){return arguments.length?(this._yRightName=t,this):this._yRightName}},{key:"yRightTitle",value:function(t){return arguments.length?(this._yRightTitle=t,this):this._yRightTitle}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"textTransX",value:function(t){return arguments.length?(this._textTransX=t,this):this._textTransX}},{key:"xAxisLineWidth",value:function(t){return arguments.length?(this._xAxisLineWidth=t,this):this._xAxisLineWidth}},{key:"yAxisLineWidth",value:function(t){return arguments.length?(this._yAxisLineWidth=t,this):this._yAxisLineWidth}},{key:"xAxisShow",value:function(t){return arguments.length?(this._xAxisShow=t,this):this._xAxisShow}},{key:"yAxisShow",value:function(t){return arguments.length?(this._yAxisShow=t,this):this._yAxisShow}},{key:"axisLineStrokeX",value:function(t){return arguments.length?(this._axisLineStrokeX=t,this):this._axisLineStrokeX}},{key:"axisLineStrokeY",value:function(t){return arguments.length?(this._axisLineStrokeY=t,this):this._axisLineStrokeY}},{key:"setPublicOption",value:function(t){s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(rt(e.color)).axisLineStrokeX(rt(i.axisColor)||rt(e.color)).axisLineStrokeY(rt(n.axisColor)||rt(e.color)).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xRange(i.range).yRange(n.range).clipShow(n.range).clipShowX(i.range).xAxisLineWidth(0==i.axisLineWidth||i.axisLineWidth?i.axisLineWidth:1).yAxisLineWidth(0==n.axisLineWidth||n.axisLineWidth?n.axisLineWidth:1).xAxisShow(0!=i.axisShow&&!i.axisShow||i.axisShow).yAxisShow(!(0!=n.axisShow&&!n.axisShow)&&n.axisShow)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.heightOfMainGroup-t;return 0<e?e:0}}]),o}(),U=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","axis"),e.group=e.elem.append("g"),e.axisFunc=null,e._orient="bottom",e._type="category",e._scaleFunc=null,e._tickSize=5,e._tickPadding=3,e._tickCount=null,e._tickFormat=null,e._minTickDistance=null,e._axisLineShow=!0,e._tickShow=!0,e._title="",e._titleShow=!0,e._titlePadding=5,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._lineStroke="#000",e._transition=!0,e._duration=500,e._tickValues=[],e._tickValueTexts=[],e}return u(i,o),r(i,[{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"scaleFunc",value:function(t){return arguments.length?(this._scaleFunc=t,this):this._scaleFunc}},{key:"tickSize",value:function(t){return arguments.length?(this._tickSize=t,this):this._tickSize}},{key:"tickPadding",value:function(t){return arguments.length?(this._tickPadding=t,this):this._tickPadding}},{key:"tickFormat",value:function(t){return arguments.length?(this._tickFormat=t,this):this._tickFormat}},{key:"tickCount",value:function(t){return arguments.length?(this._tickCount=t,this):this._tickValues.length||this._tickCount}},{key:"minTickDistance",value:function(t){return arguments.length?(this._minTickDistance=t,this):this._minTickDistance}},{key:"tickLineShow",value:function(t){return arguments.length?(this._tickLineShow=t,this):this._tickLineShow}},{key:"axisLineShow",value:function(t){return arguments.length?(this._axisLineShow=t,this):this._axisLineShow}},{key:"title",value:function(t){return arguments.length?(this._title=t,this):this._title}},{key:"titlePadding",value:function(t){return arguments.length?(this._titlePadding=t,this):this._titlePadding}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"lineStroke",value:function(t){return arguments.length?(this._lineStroke=t,this):this._lineStroke}},{key:"tickLabelShow",value:function(t){return arguments.length?(this._tickLabelShow=t,this):this._tickLabelShow}},{key:"tickShow",value:function(t){return arguments.length?(this._tickShow=t,this):this._tickShow}},{key:"textTransX",value:function(t){return arguments.length?(this._textTransX=t,this):this._textTransX}},{key:"xAxisLineWidth",value:function(t){return arguments.length?(this._xAxisLineWidth=t,this):this._xAxisLineWidth}},{key:"yAxisLineWidth",value:function(t){return arguments.length?(this._yAxisLineWidth=t,this):this._yAxisLineWidth}},{key:"titleHeight",get:function(){return this._title&&this._titleShow?1.25*this._fontSize+this._titlePadding:0}},{key:"tickLocations",get:function(){var e=this;return this._tickValues.map(function(t){return e._scaleFunc(t)})}}]),i}(),Z="axis-group",q="x-title",J=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-x-line"),e._orient="bottom",e._type="category",e._allowedMaxTextHeight=30,e._tickTextRotate=0,e._tickTextHeight=0,e}return u(i,U),r(i,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group;e.selectAll("*").remove();var o=i._fontSize,a=i._tickTextRotate,r=i._tickValueTexts,l=void 0;(l=i.axisFunc="top"===n?d3.axisTop(t):d3.axisBottom(t)).tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(.5).tickPadding(i._tickPadding).tickFormat(i._tickFormat);var s=e.select("."+Z).empty()?e.append("g").attr("class",Z):e.select("."+Z);s.style("font-size",o+"px").style("font-family",i._fontFamily).transition().duration(i._transition?i._duration:0).call(l).on("start",function(t,e){s.selectAll(".tick text").style("fill",i._fontColor).attr("dx",0).attr("dy","0.9em").attr("transform","translate("+(i._textTransX?i._textTransX:0)+",0) rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","translate("+(i._textTransX?i._textTransX:0)+",0) rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",i._lineStroke).style("stroke-width",i._xAxisLineWidth),s.select("path").style("stroke",i._lineStroke).style("stroke-width",i._xAxisLineWidth).style("display",i._axisLineShow?"block":"none")}),i._rotateFlag&&(s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",i._fontColor).attr("dx",0).attr("dy","0.71em").attr("transform","translate("+(i._textTransX?i._textTransX:0)+",0) rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","translate("+(i._textTransX?i._textTransX:0)+",0) rotate("+i._tickTextRotate+")").filter(function(){return"top"!==n}).attr("dy","0.5em"));var u=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)}),h=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)});d3.selectAll(u).remove(),d3.selectAll(h).remove();var c=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var _=e.select("."+q).empty()?e.append("g").attr("class",q):e.select("."+q),d=_.select("text").empty()?_.append("text"):_.select("text"),y=c/r.length,f=d3.max(r,function(t){return w(t,o,i._fontFamily)});_.call(z,c/2+Math.abs(t.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(f<.8*y?this._tickTextHeight:1.2*this._tickTextHeight):0),d.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dy",i._tickShow?1.325*o/2+6:1.325*o/2+12).text(i._title)}else e.select("."+q).remove()}},{key:"compute",value:function(){var e=this,i=[],n=[],o=0,a=0,r=0,t=!1;function l(){e._tickTextRotate=o,e._tickValues=i,e._tickValueTexts=n,e._tickTextHeight=a,e._tickTextWidth=r,e._rotateFlag=t}var s=e._scaleFunc,u=e._type,h=e._fontSize,c=(e._minTickDistance,e._allowedMaxTextHeight),_=Math.abs(s.range()[0]-s.range()[1]),d=void 0,y=void 0;if(i="category"===u?s.domain():s.ticks(e._tickCount),"number"===u&&0!=e._xRange.length&&null!=e._xRange[0]&&i.push(e._xRange[0]),function(){var t=!1;d=_/i.length,(y=d3.max(i.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,h,e._fontFamily)})||0)<.8*d&&(a=(o=0)==y?0:1.125*h,r=w((n=i)[0],h,e._fontFamily)/2||0,e._tickShow||(r=0),l(),t=!0);return t}())return e;o="top"===e._orient?45:-45;var f=Math.abs(Math.sin(Math.PI/4)),p=Math.abs(Math.cos(Math.PI/4));y*f<c?(a=y*f,r=w((n=i)[0],h,e._fontFamily)*p||0,e._tickShow||(r=0),t=!1):(a=c,n=i.map(function(t){return S(t,a/f,h,e._fontFamily)}),r=w(n[0],h,e._fontFamily)*p||0,e._tickShow||(r=0),t=!0);var v=_/i.length;if("category"===u&&v<2*h){var g=Math.ceil(2*h/v);i=i.filter(function(t,e){return e%g==0})}return l(),e}},{key:"allowedMaxTextHeight",value:function(t){return arguments.length?(this._allowedMaxTextHeight=t,this):this._allowedMaxTextHeight}},{key:"textTransX",value:function(t){return arguments.length?(this._textTransX=t,this):this._textTransX}},{key:"xAxisLineWidth",value:function(t){return arguments.length?(this._xAxisLineWidth=t,this):this._xAxisLineWidth}},{key:"height",get:function(){var e=this,t=this._scaleFunc,i=Math.abs(t.range()[0]-t.range()[1])/this._tickValueTexts.length,n=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,e._fontSize,e._fontFamily)}),o=0;return this.isShow&&(o=(this._tickShow?(n?this._tickSize+this._tickPadding:0)+(n<.8*i?this._tickTextHeight:1.2*this._tickTextHeight):0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),o}}]),i}(),Q="axis-group",K="y-title",tt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-horizontal"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=6,e}return u(i,U),r(i,[{key:"update",value:function(){var e=this,t=this,i=t._orient,n=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===i?d3.axisRight(n):d3.axisLeft(n);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickValues).tickSizeInner(t._tickSize).tickSizeOuter(-.5).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+Q).empty()?o.append("g").attr("class",Q):o.select("."+Q);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).style("display",t._tickShow?"block":"none").text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none").style("stroke-width",t._yAxisLineWidth),u.select("path").style("stroke",t._lineStroke).style("stroke-width",t._yAxisLineWidth).style("display",t._axisLineShow?"block":"none")});var h=t.group.selectAll(".axis-y-horizontal .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)||"&-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+K).empty()?o.append("g").attr("class",K):o.select("."+K),d=_.select("text").empty()?_.append("text"):_.select("text"),y=(w(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(null==t?"":t,e._fontSize,e._fontFamily)}));_.call(z,-(this._tickShow?(y?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0!=parseFloat(t._yAxisLineWidth)&&t._yAxisLineWidth&&t._axisLineShow?5:0),c/2),d.attr("y",-9).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+K).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&null!=e._yRange[0]&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(null==t?"":t,r,e._fontFamily)})||0;return s<=l?(i=t,n=s):(i=t.map(function(t){return S(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"yAxisLineWidth",value:function(t){return arguments.length?(this._yAxisLineWidth=t,this):this._yAxisLineWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(null==t?"":t,e._fontSize,e._fontFamily)}),i=0;return this.isShow&&(i=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._title?1.125*this._fontSize+3:0):this._titleShow&&this._title?1.125*this._fontSize+3+(0!=parseFloat(this._yAxisLineWidth)&&this._yAxisLineWidth&&this._axisLineShow?5:0):0!=parseFloat(this._yAxisLineWidth)&&this._yAxisLineWidth&&this._axisLineShow?5:0),i}}]),i}(),et="grid-x-line",it="grid-y-line",nt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("g").attr("class","plane-grid"),e.group=e.elem.append("g"),e._width=400,e._height=400,e._planeX=0,e._transHeight=0,e._transition=!1,e._duration=0,e._type="",e._xTickLocations=[],e._yTickLocations=[],e}return u(i,N),r(i,[{key:"update",value:function(){var e=this,i=e._width,n=e._height,o=e.group.attr("class",e._type).style("fill","none").style("stroke",e._stroke).style("stroke-width",e._gridLineWidth).style("stroke-dasharray",e._strokeDasharray).style("pointer-events","none");!function(){if(!e._showX)return o.selectAll("."+et).remove();var t=o.selectAll("."+et).data(e._yTickLocations);t.exit().remove(),t.enter().append("line").attr("class",et).merge(t).transition().duration(e._transition?e._duration:0).ease(d3.easeLinear).attr("x1",e._planeX).attr("y1",function(t){return t+.5}).attr("x2",i).attr("y2",function(t){return t+.5})}(),function(){if(!e._showY)return o.selectAll("."+it).remove();var t=o.selectAll("."+it).data(e._xTickLocations);t.exit().remove(),t.enter().append("line").attr("class",it).merge(t).transition().duration(e._transition?e._duration:0).ease(d3.easeLinear).attr("y1",0).attr("x1",function(t){return t}).attr("y2",n).attr("x2",function(t){return t})}()}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"planeX",value:function(t){return arguments.length?(this._planeX=parseFloat(t),this):this._planeX}},{key:"xTickLocations",value:function(t){return arguments.length?(this._xTickLocations=t,this):this._xTickLocations}},{key:"yTickLocations",value:function(t){return arguments.length?(this._yTickLocations=t,this):this._yTickLocations}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"gridLineWidth",value:function(t){return arguments.length?(this._gridLineWidth=t,this):this._gridLineWidth}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}}]),i}(),ot=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("clipPath").attr("id",e.id),e.rect=e.elem.append("rect"),e._width=100,e._height=100,e._transition=!1,e._duration=0,e._paddingVertical=[5,0],e._paddingHorizontal=[20,20],e}return u(i,o),r(i,[{key:"update",value:function(){var t=this,e=t.rect,i=t._width,n=t._paddingVertical,o=t._paddingHorizontal;return e.attr("x",-i-o[0]).attr("y",-n[0]).attr("width",i+o[0]+o[1]).attr("height",t._height+n[0]+n[1]),e.transition().duration(t._transition?t._duration:0).attr("x",-o[0]),t}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"paddingVertical",value:function(t){return arguments.length?(this._paddingVertical=t,this):this._paddingVertical}},{key:"paddingHorizontal",value:function(t){return arguments.length?(this._paddingHorizontal=t,this):this._paddingHorizontal}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}}]),i}(),at=function(t){function o(t){a(this,o);var e=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","grouping-bubble-chart"),e.clipArea=new ot(e.defs),e.grid=new nt(e.coreGroup),e.xAxis=new J(e.mainGroup).tickFormat(function(t){return t}),e.yAxis=new tt(e.mainGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleLinear(),e._xType="number",e._yType="number",e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.core=new V(e.coreGroup),e._sortValue=-1,e._bubbleSizeType="area",e._bubbleBorderColor="",e._bubbleBorderWidth=1,e._minRadius=0,e._maxRadius=32,e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="依次出现",e._endPause=0,e._interrupt=!1,e}return u(o,$),r(o,[{key:"updateCore",value:function(){var i=this,t=i.core,n=i.tooltip,e=i.grid,o=i.clipArea,a=i.activeData,r=a.nodes,l=a.labels,s=i.widthOfCore,u=i.heightOfCore,h=i.xScale,c=i.yScale,_=d3.max(r,function(t){return Math.abs(t.radius)}),d=d3.scaleSqrt().domain([0,_]).range([i._minRadius,i._maxRadius]);"diameter"==i._bubbleSizeType&&(d=d3.scaleLinear().domain([0,_]).range([i._minRadius,i._maxRadius])),t.data(r).cx(function(t){return h(isNaN(t.x)?0:t.x)}).cy(function(t){return c(isNaN(t.y)?0:t.y)}).radius(function(t){return d(isNaN(Math.abs(t.radius))?0:Math.abs(t.radius))}).stroke("#fff").transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).bubbleBorderColor(i._bubbleBorderColor).bubbleBorderWidth(i._bubbleBorderWidth).onMouseover(function(t){0==i._bubbleBorderWidth&&d3.select(this).style("stroke-width","1"),d3.select(this).style("stroke","#000");var e=[{color:t.color,text:l.category+"："+t.category},{text:l.name+"："+t.name},{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}];""==t.category&&(e=[{text:l.name+"："+t.name},{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}]),""==t.name&&(e=[{color:t.color,text:l.category+"："+t.category},{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}]),""==t.category&&""==t.name&&(e=[{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}]),n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t,e){0==i._bubbleBorderWidth&&d3.select(this).style("stroke-width","0"),d3.select(this).style("stroke",i._bubbleBorderColor||t.color),n.hide()}),e.width(s).height(u).xTickLocations(i.xAxis.tickLocations).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),i.coreGroup.call(z,i.yAxis.width+.5,0),0!=i._clipShow.length?(o.width(s).height(u).paddingVertical([0,0]).paddingHorizontal([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url("+x("#"+o.id)+")")):(o.width(i._width).height(i._height).paddingVertical([0,0]).paddingHorizontal([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),o.update(),(null==i._clipShow[0]&&null==i._clipShow[1]||""==i._clipShow[0]&&""==i._clipShow[1])&&(o.width(i._width).height(i._height).paddingVertical([0,0]).paddingHorizontal([0,0]).transition(i._transition).duration(i._duration),o.update(),i.coreGroup.attr("clip-path","")),t.update(),e.translate(i.yAxis.width+.5,0).update()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy,o=n.legendData;t.legend.data(o).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),o.forEach(function(t){t.name===e.name&&(t.active=!i)}),n.nodes.forEach(function(t){t.category===e.name&&(t.active=!i)}),t.onDataChange()})}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;n.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStrokeX).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration).xAxisLineWidth(t._xAxisLineWidth).axisLineShow(t._xAxisShow),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStrokeY).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration).yAxisLineWidth(t._yAxisLineWidth).axisLineShow(t._yAxisShow);i.titleHeight;var _=(c-e.allowedMaxTextHeight())/(3*u);i.tickCount(_),i.compute(),n.range([0,h-i.width]),e.compute(),o.range([c-e.height,0]);var d=i.width,y=c-e.height,f=i.width;e.translate(d,y).update(),i.translate(f,0).update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"computeDomain",value:function(){var t=this.activeData.nodes,e=this._xRange||[],i=this._yRange||[],n=d3.extent(t,function(t){return parseFloat(t.x)}),o=d3.extent(t,function(t){return parseFloat(t.y)}),a=isNaN(parseFloat(e[0]))?Math.min(0,n[0]||0):parseFloat(e[0]),r=isNaN(parseFloat(e[1]))?Math.max(1,n[1]||0):parseFloat(e[1]),l=isNaN(parseFloat(i[0]))?Math.min(0,o[0]||0):parseFloat(i[0]),s=isNaN(parseFloat(i[1]))?Math.max(1,o[1]||0):parseFloat(i[1]);this._xDomain=[a,r],this._yDomain=[l,s]}},{key:"sortData",value:function(){var t=this._data;-1===this._sortValue?t.nodes.sort(function(t,e){return e.radius-t.radius||t.index-e.index}):1===this._sortValue&&t.nodes.sort(function(t,e){return t.radius-e.radius||t.index-e.index}),this._sortedDataCopy=t}},{key:"buildOption",value:function(t,e){var i=new E(t,e);return i.dataSolveFunc(I),i}},{key:"setPublicOption",value:function(t){s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(rt(e.color)).axisLineStrokeX(rt(i.axisColor)||rt(e.color)).axisLineStrokeY(rt(n.axisColor)||rt(e.color)).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xRange(i.range).yRange(n.range).clipShow(n.range).clipShowX(i.range).xAxisLineWidth(0==i.axisLineWidth||i.axisLineWidth?i.axisLineWidth:1).yAxisLineWidth(0==n.axisLineWidth||n.axisLineWidth?n.axisLineWidth:1).xAxisShow(0!=i.axisShow&&!i.axisShow||i.axisShow).yAxisShow(0!=n.axisShow&&!n.axisShow||n.axisShow)}},{key:"setSelfOption",value:function(t){var e=t.animation,i=t.display,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._bubbleSizeType=i.bubbleSizeType?i.bubbleSizeType:this._bubbleSizeType,this._bubbleBorderColor=i.bubbleBorderColor?rt(i.bubbleBorderColor):"",this._bubbleBorderWidth=0==i.bubbleBorderWidth||i.bubbleBorderWidth?i.bubbleBorderWidth:this._bubbleBorderWidth,this._minRadius=0==i.minRadius||i.minRadius?i.minRadius:this._minRadius,this._maxRadius=0==i.maxRadius||i.maxRadius?i.maxRadius:this._maxRadius),0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e?e.duration:this._duration,this._startDelay=e?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?rt(n.color):this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?rt(o.color):this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY)}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"activeData",get:function(){var t=this.sortedDataCopy;return{nodes:t.nodes.filter(function(t){return!1!==t.active}),labels:t.labels}}}]),o}();function vt(t,e){t.on("mouseover",e._onMouseover).on("mousemove",e._onMousemove).on("mouseout",e._onMouseout)}var lt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-bar-plot"),e._xScale=null,e._yScale=null,e._fill=null,e._stroke="",e._strokeWidth=0,e._showZeroLine=!0,e._zeroLineStroke="#000",e._fontColor="#000",e._fontSize=13,e._cornerRadius=0,e}return u(i,A),r(i,[{key:"update",value:function(){for(var i=this,n=i._data,e=i._xScale,o=i._yScale.clamp(!0),a=e.bandwidth()/2,r=e.bandwidth()*i._barWidthPercent,t=o.domain(),l=t.every(function(t){return 0<=t})?"up":t.every(function(t){return t<=0})?"down":"both",s=o.range()[0],u=i._transition?i._duration:0,h=[],c=0;c<n.length;c++)h.push(n[c].value);var _=pt(h,i._fontSize,i._fontFamily),d=i.group;d.selectAll("*").remove();var y=i._defs;y.selectAll("filter").remove();var f=y.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_simplebar").attr("filterUnits","objectBoundingBox");if(f.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),f.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),f.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),f.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),f.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),"up"===l){var p=d.selectAll(".rect").data(n);if(p.exit().remove(),null==i._moveStyle||0==i._transition||-1==i._moveOptions.indexOf(i._moveStyle))p.enter().append("path").attr("class","rect").merge(p).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).call(vt,i).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})});else if(0==i._moveOptions.indexOf(i._moveStyle)||1==i._moveOptions.indexOf(i._moveStyle)){var v=p.enter().append("path").attr("class","rect").merge(p).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(0),width:r,height:0,cornerRadius:[0,0,0,0]})}).call(vt,i);0==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?v.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):v.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):1==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?v.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):v.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}))}else if(2==i._moveOptions.indexOf(i._moveStyle)||3==i._moveOptions.indexOf(i._moveStyle)){var g=p.enter().append("path").attr("class","rect").merge(p).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:0,height:Math.abs(s-o(t.value)),cornerRadius:[0,0,0,0]})}).call(vt,i);2==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?g.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):g.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):3==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?g.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}):g.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(t.value),width:r,height:Math.abs(s-o(t.value)),cornerRadius:i._cornerRadius})}))}var S=d.selectAll("text").data(n);S.exit().remove();var x=S.enter().append("text").attr("class","simple-bar-texts").merge(S).text(function(t){return t.value}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).style("display",i._labelShow?"block":"none");x.attr("x",function(t){return e(t.name)+a*(1-i._barWidthPercent)}).attr("y",function(t){return o(t.value)}).attr("dx",r/2).attr("dy",function(t){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?-6:1==i._positionOptions.indexOf(i._positionChoice)?Math.abs(s-o(t.value))-6:void 0}).attr("text-anchor","middle"),i._interrupt?x.style("opacity",1):x.style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1),null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?x.style("display","none"):r<_&&1==i._positionOptions.indexOf(i._positionChoice)?x.attr("transform",function(t){return"rotate(-90 "+(e(t.name)+a)+" "+(o(t.value)+Math.abs(s-o(t.value))-.5*i._fontSize-4)+" )"}).attr("text-anchor","start"):x.attr("transform","rotate(0)")}else if("down"===l){var m=d.selectAll(".rect").data(n);if(m.exit().remove(),null==i._moveStyle||0==i._transition||-1==i._moveOptions.indexOf(i._moveStyle))m.enter().append("path").attr("class","rect").merge(m).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).call(vt,i).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})});else if(0==i._moveOptions.indexOf(i._moveStyle)||1==i._moveOptions.indexOf(i._moveStyle)){var k=m.enter().append("path").attr("class","rect").merge(m).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:0,cornerRadius:[0,0,0,0]})}).call(vt,i);0==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?k.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):k.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):1==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?k.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):k.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}))}else if(2==i._moveOptions.indexOf(i._moveStyle)||3==i._moveOptions.indexOf(i._moveStyle)){var b=m.enter().append("path").attr("class","rect").merge(m).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:0,height:o(t.value),cornerRadius:[0,0,0,0]})}).call(vt,i);2==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?b.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):b.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):3==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?b.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}):b.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0,width:r,height:o(t.value),cornerRadius:i._cornerRadius})}))}var w=d.selectAll("text").data(n);w.exit().transition().duration(u).remove();var C=w.enter().append("text").attr("class","simple-bar-texts").merge(w).text(function(t){return t.value}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).style("display",i._labelShow?"block":"none");C.attr("x",function(t){return e(t.name)+a*(1-i._barWidthPercent)}).attr("y",0).attr("dx",r/2).attr("dy",function(t){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?-6:1==i._positionOptions.indexOf(i._positionChoice)?o(t.value)-6:void 0}).attr("text-anchor","middle"),i._interrupt?C.style("opacity",1):C.style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1),null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?C.style("display","none"):r<_&&1==i._positionOptions.indexOf(i._positionChoice)?C.attr("transform",function(t){return"rotate(-90 "+(e(t.name)+a||0)+" "+(o(t.value)-.5*i._fontSize-4)+" )"}).attr("text-anchor","start"):C.attr("transform","rotate(0)")}else{var O=Math.round(o(0)),F=d.selectAll(".rect").data(n);if(F.exit().remove(),null==i._moveStyle||0==i._transition||-1==i._moveOptions.indexOf(i._moveStyle))F.enter().append("path").attr("class","rect").merge(F).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).call(vt,i).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})});else if(0==i._moveOptions.indexOf(i._moveStyle)||1==i._moveOptions.indexOf(i._moveStyle)){var P=F.enter().append("path").attr("class","rect").merge(F).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:o(0),width:r,height:0,cornerRadius:[0,0,0,0]})}).call(vt,i);0==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?P.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):P.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):1==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?P.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):P.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}))}else if(2==i._moveOptions.indexOf(i._moveStyle)||3==i._moveOptions.indexOf(i._moveStyle)){var W=F.enter().append("path").attr("class","rect").merge(F).style("fill",function(t){return i._fill||t.color}).style("stroke-width",i._strokeWidth).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:0,height:Math.abs(O-o(t.value)),cornerRadius:[0,0,0,0]})}).call(vt,i);2==i._moveOptions.indexOf(i._moveStyle)?i._interrupt?W.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):W.transition().duration(i._transition?.9*i._duration:0).delay(i._transition?i._startDelay:0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):3==i._moveOptions.indexOf(i._moveStyle)&&(i._interrupt?W.style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}):W.transition().delay(function(t,e){return i._transition?i._startDelay+e*(.9*i._duration/(0<n.length?n.length:0)):0}).duration(i._transition?.9*i._duration/(0<n.length?n.length:0):0).style("stroke",function(t){return i._stroke||t.color}).attr("d",function(t){return yt({x:e(t.name)+a*(1-i._barWidthPercent),y:0<=t.value?o(t.value):O,width:r,height:Math.abs(O-o(t.value)),cornerRadius:i._cornerRadius})}))}var A=d.selectAll("text").data(n);A.exit().transition().duration(u).remove();var z=A.enter().append("text").attr("class","simple-bar-texts").merge(A).text(function(t){return t.value}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).style("display",i._labelShow?"block":"none");z.attr("x",function(t){return e(t.name)+a*(1-i._barWidthPercent)}).attr("y",function(t){return 0<=t.value?o(t.value):O}).attr("dx",r/2).attr("dy",function(t){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?-6:1==i._positionOptions.indexOf(i._positionChoice)?Math.abs(O-o(t.value))-6:void 0}).attr("text-anchor","middle"),i._interrupt?z.style("opacity",1):z.style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1),null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?z.style("display","none"):r<_&&1==i._positionOptions.indexOf(i._positionChoice)?z.attr("transform",function(t){return"rotate(-90 "+(e(t.name)+a||0)+" "+((0<=t.value?o(t.value):O)+Math.abs(O-o(t.value))-.5*i._fontSize-4)+" )"}).attr("text-anchor","start"):z.attr("transform","rotate(0)"),(d.select(".zero-line").empty()?d.append("line").attr("class","zero-line"):d.select(".zero-line")).attr("x1",e.range()[0]).attr("y1",O).attr("x2",e.range()[1]).attr("y2",O).style("stroke",i._showZeroLine?i._zeroLineStroke:"none")}if(null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice))d.selectAll(".simple-bar-texts").style("display","none");else if(r<_&&1==i._positionOptions.indexOf(i._positionChoice)){for(var L=d.selectAll(".simple-bar-texts"),D=[],T=[],M=0;M<L._groups[0].length;M++){T.push(M);for(var R=M+1;R<L._groups[0].length;R++){var N=dt(d3.select(L._groups[0][M])),j=dt(d3.select(L._groups[0][R])),X=N.width;N.width=N.height,N.height=X;var G=j.width;j.width=j.height,j.height=G,ft(N,j)&&(D.push(M),d3.select(L._groups[0][M]).style("visiblity","hidden"))}}for(var B=new Set(D),Y=Array.from(B),H=_t(Y,T),V=0;V<Y.length;V++){for(var E=[],I=0;I<H.length;I++){var $=dt(d3.select(L._groups[0][Y[V]])),U=dt(d3.select(L._groups[0][H[I]])),Z=$.width;$.width=$.height,$.height=Z;var q=U.width;if(U.width=U.height,U.height=q,E.push(ft($,U)),ft($,U)){if(Y[V]==H[I])continue;d3.select(L._groups[0][Y[V]]).style("visibility","hidden")}}0==E.filter(function(t){return 1==t}).length&&H.push(Y[V])}for(var J=0;J<H.length;J++)d3.select(L._groups[0][H[J]]).style("visibility","visible")}else{for(var Q=d.selectAll(".simple-bar-texts"),K=[],tt=[],et=0;et<Q._groups[0].length;et++){tt.push(et);for(var it=et+1;it<Q._groups[0].length;it++){ft(dt(d3.select(Q._groups[0][et])),dt(d3.select(Q._groups[0][it])))&&(K.push(et),d3.select(Q._groups[0][et]).style("visibility","hidden"))}}for(var nt=new Set(K),ot=Array.from(nt),at=_t(ot,tt),rt=0;rt<ot.length;rt++){for(var lt=[],st=0;st<at.length;st++){var ut=dt(d3.select(Q._groups[0][ot[rt]])),ht=dt(d3.select(Q._groups[0][at[st]]));if(lt.push(ft(ut,ht)),ft(ut,ht)){if(ot[rt]==at[st])continue;d3.select(Q._groups[0][ot[rt]]).style("visibility","hidden")}}0==lt.filter(function(t){return 1==t}).length&&at.push(ot[rt])}for(var ct=0;ct<at.length;ct++)d3.select(Q._groups[0][at[ct]]).style("visibility","visible")}function _t(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),st="axis-group",ut="y-title",ht=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-line"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=6,e}return u(i,U),r(i,[{key:"update",value:function(){var e=this,t=this,i=t._orient,n=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===i?d3.axisRight(n):d3.axisLeft(n);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickValues).tickSizeInner(t._tickSize).tickSizeOuter(-.5).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+st).empty()?o.append("g").attr("class",st):o.select("."+st);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).style("display",t._tickShow?"block":"none").text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke).style("stroke-width",t._yAxisLineWidth).style("display",t._axisLineShow?"block":"none"),u.select("path").style("stroke",t._lineStroke).style("stroke-width",t._yAxisLineWidth).style("display",t._axisLineShow?"block":"none")});var h=t.group.selectAll(".axis-y-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)||"$-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+ut).empty()?o.append("g").attr("class",ut):o.select("."+ut),d=_.select("text").empty()?_.append("text"):_.select("text"),y=(w(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,e._fontSize,e._fontFamily)}));_.call(z,-(this._tickShow?(y?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0!=parseFloat(t._yAxisLineWidth)&&t._yAxisLineWidth&&t._axisLineShow?5:0),c/2),d.attr("y",-9).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+ut).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&null!=e._yRange[0]&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,r,e._fontFamily)})||0;return s<=l?(i=t,n=s):(i=t.map(function(t){return S(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"yAxisLineWidth",value:function(t){return arguments.length?(this._yAxisLineWidth=t,this):this._yAxisLineWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,e._fontSize,e._fontFamily)}),i=0;return this.isShow&&(i=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._titleShow&&this._title?1.125*this._fontSize+3:0):this._titleShow&&this._title?1.125*this._fontSize+3+(0!=parseFloat(this._yAxisLineWidth)&&this._yAxisLineWidth&&this._axisLineShow?5:0):0!=parseFloat(this._yAxisLineWidth)&&this._yAxisLineWidth&&this._axisLineShow?5:0),i}}]),i}(),ct=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-bar-chart"),e.grid=new nt(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new ht(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.core=new lt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xTickShow=!0,e._yTickShow=!0,e._barWidthPercent=.5,e._cornerRadius=[0,0,0,0],e._stroke="",e._strokeWidth=0,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="内部居下",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveoptions=["纵向同步拉伸","纵向依次拉伸","横向同步展开","横向依次展开"],e._moveStyle="",e._endPause=0,e._interrupt=!1,e}return u(i,$),r(i,[{key:"updateCore",value:function(){var n=this,t=n.activeData,e=n.grid,i=n.core,o=n.tooltip,a=n.clipArea,r=n.widthOfCore,l=n.heightOfCore,s=n.xScale;n.yScale;e.width(r).height(l).planeX(s.range()[0]).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray).gridLineWidth(n._gridLineWidth),i.data(t).xScale(n.xScale).yScale(n.yScale).zeroLineStroke(n._axisLineStroke).cornerRadius(n._cornerRadius).stroke(n._stroke).barWidthPercent(n._barWidthPercent).strokeWidth(n._strokeWidth).fontSize(n._textLabel.fontSize).fontColor(rt(n._textLabel.color)).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).defs(n.defs).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveOptions(n._moveoptions).moveStyle(n._moveStyle).endPause(n._endPause).interrupt(n._interrupt).textObj({colorFunc:function(){return n._fontColor}}).onMouseover(function(t,e){0==n._strokeWidth&&d3.select(this).style("stroke-width",1),d3.select(this).style("stroke","#000");var i=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];o.data(i).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){o.hide(),0==n._strokeWidth&&d3.select(this).style("stroke-width",0),d3.select(this).style("stroke",n._stroke||t.color)}),n.coreGroup.call(z,n.yAxis.width+.5,0),0!=n._clipShow.length?(a.width(r).height(l).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url("+x("#"+a.id)+")")):(a.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),a.update();var u=n.group.selectAll(".simple-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="$-"+e});d3.selectAll(u).remove(),e.translate(n.yAxis.width+.5,0).update(),i.update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var n=this,i=n.sortedDataCopy.filter(function(t,e){return 1==t.showLegend}),t=i;if("single"==n._colors.type){if(0<i.length){var e={},o=[];e.name=i[0].valueLabel,e.color=i[0].color,o.push(e),t=""==e.name||null==e.name||null==e.name?[]:o}else t=[];n.legend.data(t).onClick(function(t){var e=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",e).style("opacity",e?.5:1),i.forEach(function(t){t.active=!e}),n.onDataChange()})}else n.legend.data(t).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),t.forEach(function(t){t.key===e.key&&(t.active=!i)}),n.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t.map(function(t){return t.name}):[0,1],n=void 0;if(t.length){var o=d3.min(t,function(t){return+t.value}),a=1.1*d3.max(t,function(t){return+t.value});n=o<0?a<=0?[o,0]:[o,a]:[0,a]}else n=[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&this.barWidthPercent(l(0==e.barWidthPercent||e.barWidthPercent?e.barWidthPercent:this._barWidthPercent)).cornerRadius(e.bar4CornerRadius?e.bar4CornerRadius:this._cornerRadius).stroke(rt(e.borderColor)||"").strokeWidth(l(0==e.borderWidth||e.borderWidth?e.borderWidth:this._strokeWidth)),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}}]),i}(),_t=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return u(i,A),r(i,[{key:"update",value:function(){var l=this,s=l._data,o=l.group;o.selectAll("*").remove(),o.selectAll(".stackBars").remove();var t=o.append("g").selectAll("g").data(s);t.exit().remove(),t.enter().append("g").merge(t).each(function(i,n){var t=d3.select(this).selectAll("rect").data(i.data);if(t.exit().remove(),null==l._moveStyle||0==l._transition||-1==l._moveOptions.indexOf(l._moveStyle))t.enter().append("rect").attr("class","stackBars").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0});else if(0==l._moveOptions.indexOf(l._moveStyle)||1==l._moveOptions.indexOf(l._moveStyle)||2==l._moveOptions.indexOf(l._moveStyle)){var e=t.enter().append("rect").attr("class","stackBars").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total-t.value):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",0);0==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?e.attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):e.transition().delay(function(t,e){return l._transition?n*(.9*l._duration/(0<s.length?s.length:1))+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):1==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?e.attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):e.transition().delay(function(t,e){return l._transition?l._startDelay+e*(.9*l._duration/(0<i.data.length?i.data.length:1)):0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):2==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?e.attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):e.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}))}else if(3==l._moveOptions.indexOf(l._moveStyle)){var o=t.enter().append("rect").attr("class","stackBars").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("x",function(t,e){return l._xScale.range()[0]+l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2).attr("y",function(t){return l._yScale(0)}).attr("height",0);l._interrupt?o.attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):o.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0})}else if(4==l._moveOptions.indexOf(l._moveStyle)||5==l._moveOptions.indexOf(l._moveStyle)){var a=t.enter().append("rect").attr("class","stackBars").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",0);4==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?a.attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2):a.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2):5==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?a.attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2):a.transition().delay(function(t,e){return l._transition?l._startDelay+e*(.9*l._duration/(0<i.data.length?i.data.length:1)):0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2))}else if(6==l._moveOptions.indexOf(l._moveStyle)){var r=t.enter().append("rect").attr("class","stackBars").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",0).attr("height",0).attr("x",function(t,e){return l._xScale.step()*e+.25*l._xScale.step()}).attr("width",l._xScale.step()/2).attr("y",function(t){return 0<t.value||0==t.value?l._yScale.range()[1]:t.value<0?l._yScale.range()[0]:void 0}).attr("height",0);l._interrupt?r.attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0}):r.transition().delay(function(t,e){return l._transition?n*(.9*l._duration/(0<s.length?s.length:1))+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).attr("y",function(t){return 0<t.value||0==t.value?l._yScale(t.total):t.value<0?l._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<l._yScale(0)-l._yScale(t.value)?l._yScale(0)-l._yScale(t.value):0:t.value<0?0<l._yScale(t.value)-l._yScale(0)?l._yScale(t.value)-l._yScale(0):0:void 0})}t.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackBarTexts").remove();var e=l._defs;e.selectAll("filter").remove();var i=e.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stackbar").attr("filterUnits","objectBoundingBox");i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),i.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),i.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),i.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),i.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var n=o.append("g").selectAll("g").data(s);n.exit().remove(),n.enter().append("g").merge(n).each(function(t,e){var i=d3.select(this).append("g").attr("class","stackBarTexts").selectAll("text").data(t.data);i.exit().remove();var n=i.enter().append("text").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("fill",l._textObj.colorFunc).attr("font-size",l._fontSize).style("font-family",l._fontFamily).attr("x",function(t,e){return l._xScale.range()[0]+(l._xScale.step()*e+.25*l._xScale.step())}).attr("y",function(t){if(null==l._positionOptions||null==l._positionChoice)return 0;if(0==l._positionOptions.indexOf(l._positionChoice)){if(0<t.value||0==t.value)return l._yScale(t.total)+(l._yScale(0)-l._yScale(t.value))/2+.4*l._fontSize;if(t.value<0)return l._yScale(t.downtotal-t.value)+(l._yScale(t.value)-l._yScale(0))/2+.4*l._fontSize}else if(1==l._positionOptions.indexOf(l._positionChoice)){if(0<t.value||0==t.value)return l._yScale(t.total)+(l._yScale(0)-l._yScale(t.value))-.2*l._fontSize;if(t.value<0)return l._yScale(t.downtotal-t.value)+(l._yScale(t.value)-l._yScale(0))-.2*l._fontSize}}).attr("text-anchor","middle").attr("dx",.25*l._xScale.step()).style("display",function(t){return l._labelShow&&t.textShow?"block":"none"});l._interrupt?n.style("opacity",1):n.style("opacity",0).transition().duration(l._transition?.1*l._duration:0).delay(l._transition?l._startDelay+.9*l._duration:0).style("opacity",1),0==l._labelShow||null==l._labelShow||null==l._positionOptions||null==l._positionChoice||-1==l._positionOptions.indexOf(l._positionChoice)?o.selectAll(".stackBarTexts").style("display","none"):o.selectAll(".stackBarTexts").style("display","block")});for(var a=o.selectAll(".stackBarTexts text"),r=[],u=[],h=0;h<a._groups[0].length;h++){u.push(h);for(var c=h+1;c<a._groups[0].length;c++){ft(dt(d3.select(a._groups[0][h])),dt(d3.select(a._groups[0][c])))&&(r.push(h),d3.select(a._groups[0][h]).style("visibility","hidden"))}}for(var _=new Set(r),d=Array.from(_),y=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(d,u),f=0;f<d.length;f++){for(var p=[],v=0;v<y.length;v++){var g=dt(d3.select(a._groups[0][d[f]])),S=dt(d3.select(a._groups[0][y[v]]));if(p.push(ft(g,S)),ft(g,S)){if(d[f]==y[v])continue;d3.select(a._groups[0][d[f]]).style("visibility","hidden")}}0==p.filter(function(t){return 1==t}).length&&y.push(d[f])}for(var x=0;x<y.length;x++)d3.select(a._groups[0][y[x]]).style("visibility","visible");return l}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),gt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem=t.append("g").attr("class","bands-overlay").style("opacity",0),e._data=[],e._bandHeight=100,e._bandWidth=50,e._bandX=0,e._type="",e._isScalePoint=!0,e._isDeformedBar=!1,e._isHorizontal=!1,e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return u(i,o),r(i,[{key:"update",value:function(){var i,n=this,t=n._data,e=n.elem,o=n._bandWidth,a=n._bandHeight,r=n._isScalePoint,l=n._isDeformedBar,s=n._isHorizontal;i=l?-o/2:r?o/2:0;var u=e.selectAll("rect").data(t);return u.exit().remove(),u.enter().append("rect").attr("class",function(t,e){return"band-"+e}).merge(u).attr("x",function(t,e){return s?0:o*e-i+n._bandX}).attr("y",function(t,e){return s?a*e-i:0}).attr("width",o).attr("height",a).style("fill","#000").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"bandWidth",value:function(t){return arguments.length?(this._bandWidth=t,this):this._bandWidth}},{key:"bandX",value:function(t){return arguments.length?(this._bandX=t,this):this._bandX}},{key:"bandHeight",value:function(t){return arguments.length?(this._bandHeight=t,this):this._bandHeight}},{key:"isScalePoint",value:function(t){return arguments.length?(this._isScalePoint=t,this):this._isScalePoint}},{key:"isDeformedBar",value:function(t){return arguments.length?(this._isDeformedBar=t,this):this._isDeformedBar}},{key:"isHorizontal",value:function(t){return arguments.length?(this._isHorizontal=t,this):this._isHorizontal}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),i}(),St=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("rect").attr("class","selectOverlay-rect"),e._width=0,e._height=0,e._shadowColor="#000",e}return u(i,o),r(i,[{key:"update",value:function(){return this.elem.attr("x",0).attr("y",0).attr("width",this._width<0?0:this._width).attr("height",this._height).style("fill",this._shadowColor).style("opacity",.15),this}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),i}(),xt=function(t){function i(t,e){return a(this,i),h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e))}return u(i,b),r(i,[{key:"data",get:function(){var t,i,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),n=this.generateColorList(e.length);return i=n,(t=e).forEach(function(e,t){e.color=i[t],e.color_special=i[t+1],e.data.forEach(function(t){t.color=e.color,t.color_special=e.color_special})}),t}}]),i}(),mt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-bar-chart"),e.grid=new nt(e.coreGroup),e.selectOverlay=new St(e.coreGroup),e.rectPlot=new _t(e.coreGroup),e.overlay=new gt(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new ht(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["内部居中","内部居下"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["纵向分类拉伸","纵向分组拉伸","纵向同步拉伸","纵向整体拉伸","横向整体展开","横向同步展开","俄罗斯方块"],e._moveStyle="纵向分类拉伸",e._endPause=0,e._interrupt=!1,e}return u(i,$),r(i,[{key:"updateCore",value:function(){for(var i=this,r=i.activeData,t=0;t<(0==r.length?0:r[0].data.length);t++)for(var e=0;e<r.length;e++)parseFloat(r[e].data[t].value);for(var n=0;n<r.length;n++)for(var o=0;o<r[n].data.length;o++)0==n?0<r[n].data[o].value||0==r[n].data[o].value?(r[n].data[o].total=parseFloat(r[n].data[o].value),r[n].data[o].downtotal=0):r[n].data[o].value<0&&(r[n].data[o].downtotal=parseFloat(r[n].data[o].value),r[n].data[o].total=0):0<r[n].data[o].value||0==r[n].data[o].value?(r[n].data[o].total=r[n-1].data[o].total+parseFloat(r[n].data[o].value),r[n].data[o].downtotal=r[n-1].data[o].downtotal):r[n].data[o].value<0&&(r[n].data[o].total=r[n-1].data[o].total,r[n].data[o].downtotal=r[n-1].data[o].downtotal+parseFloat(r[n].data[o].value)),0<r[n].data[o].value||0==r[n].data[o].value?i.yScale(0)-i.yScale(r[n].data[o].value)<i._textLabel.fontSize?r[n].data[o].textShow=!1:r[n].data[o].textShow=!0:r[n].data[o].value<0&&(i.yScale(r[n].data[o].value-i.yScale(0))<i._textLabel.fontSize?r[n].data[o].textShow=!1:r[n].data[o].textShow=!0);var a=r,l=i.grid,s=i.tooltip,u=i.rectPlot,h=i.overlay,c=i.selectOverlay,_=i.clipArea,d=i.xScale,y=i.yScale,f=i.widthOfCore,p=i.heightOfCore,v=1.1*Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);v<0?(i.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(y.range()[0]-y(0))+")"),i.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(y.range()[0]-y(0))+")")):(i.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),i.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),0!=i._clipShow.length&&(i.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),i.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),h.data(d.domain()).isScalePoint(!1).bandX(d.range()[0]).bandWidth(d.step()).bandHeight(p).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),s.data(o).update(),i.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+d(n)+",0)"),s.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY]),c.show()}).onMouseout(function(){s.hide(),c.hide()}),u.data(a).xScale(d).yScale(y).fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(i._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).textObj({colorFunc:function(){return rt(i._textLabel.color)}}).fillOpacity(1),l.width(f).height(p).planeX(d.range()[0]).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),c.width(d.step()).height(p).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)"),0!=i._clipShow.length?(_.width(f).height(p).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url("+x("#"+_.id)+")")):(_.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),_.update();var g=i.group.selectAll(".stack-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),u.update(),c.update(),h.update(),l.update(),v<0?(i.coreGroup.selectAll(".fake-x-line").remove(),i.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",d.range()[0]).attr("y1",y.range()[0]).attr("x2",d.range()[1]).attr("y2",y.range()[0]).attr("stroke","rgb(233, 233, 233)")):i.coreGroup.selectAll(".fake-x-line").remove()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new xt(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i?i.duration:this._duration,this._startDelay=i?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?rt(n.color):this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?rt(o.color):this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)0==e?0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=parseFloat(t[e].data[i].value),t[e].data[i].downtotal=0):t[e].data[i].value<0&&(t[e].data[i].downtotal=parseFloat(t[e].data[i].value),t[e].data[i].total=0):0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=t[e-1].data[i].total+parseFloat(t[e].data[i].value),t[e].data[i].downtotal=t[e-1].data[i].downtotal):t[e].data[i].value<0&&(t[e].data[i].total=t[e-1].data[i].total,t[e].data[i].downtotal=t[e-1].data[i].downtotal+parseFloat(t[e].data[i].value));var n=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),1.1*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])]}}]),i}(),kt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return u(i,A),r(i,[{key:"update",value:function(){var l=this,s=l._data,o=l.group;o.selectAll("*").remove(),o.selectAll(".stackHorizontalBar").remove();var t=o.append("g").selectAll("g").data(s);t.exit().remove(),t.enter().append("g").merge(t).each(function(i,n){var t=d3.select(this).selectAll("rect").data(i.data);if(t.exit().remove(),null==l._moveStyle||0==l._transition||-1==l._moveOptions.indexOf(l._moveStyle))t.enter().append("rect").attr("class","stackHorizontalBar").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0});else if(0==l._moveOptions.indexOf(l._moveStyle)||1==l._moveOptions.indexOf(l._moveStyle)||2==l._moveOptions.indexOf(l._moveStyle)){var e=t.enter().append("rect").attr("class","stackHorizontalBar").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal-t.value):void 0}).attr("width",0);0==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?e.attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):e.transition().delay(function(t,e){return l._transition?n*(.9*l._duration/(0<s.length?s.length:1))+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):1==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?e.attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):e.transition().delay(function(t,e){return l._transition?l._startDelay+e*(.9*l._duration/(0<i.data.length?i.data.length:1)):0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):2==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?e.attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):e.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}))}else if(3==l._moveOptions.indexOf(l._moveStyle)){var o=t.enter().append("rect").attr("class","stackHorizontalBar").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("x",function(t){return l._xScale(0)}).attr("height",l._yScale.step()*l._barWidthPercent).attr("width",0);l._interrupt?o.attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):o.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0})}else if(4==l._moveOptions.indexOf(l._moveStyle)||5==l._moveOptions.indexOf(l._moveStyle)){var a=t.enter().append("rect").attr("class","stackHorizontalBar").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0});4==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?a.attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent):a.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent):5==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?a.attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent):a.transition().delay(function(t,e){return l._transition?l._startDelay+e*(.9*l._duration/(0<i.data.length?i.data.length:1)):0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("height",l._yScale.step()*l._barWidthPercent))}else if(6==l._moveOptions.indexOf(l._moveStyle)){var r=t.enter().append("rect").attr("class","stackHorizontalBar").merge(t).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke",function(t){return l._strokeColor||t.color}).style("stroke-width",function(t){return l._strokeWidth||0}).attr("y",function(t,e){return l._yScale(t.name)+l._yScale.step()*(1-l._barWidthPercent)/2}).attr("x",function(t){return 0<t.value||0==t.value?l._xScale.range()[1]:t.value<0?l._xScale.range()[0]:void 0}).attr("height",l._yScale.step()*l._barWidthPercent).attr("width",0);l._interrupt?r.attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0}):r.transition().delay(function(t,e){return l._transition?n*(.9*l._duration/(0<s.length?s.length:1))+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).attr("x",function(t){return 0<t.value||0==t.value?l._xScale(t.total-t.value):t.value<0?l._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(l._xScale(0)-l._xScale(t.value)):t.value<0?Math.abs(l._xScale(t.value)-l._xScale(0)):void 0})}t.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackHorizontalBarTexts").remove();var e=o.append("g").selectAll("g").data(s);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var i=d3.select(this).append("g").attr("class","stackHorizontalBarTexts").selectAll("text").data(t.data);i.exit().remove();var n=i.enter().append("text").merge(i).text(function(t){return 0==t.value?"":t.value}).attr("fill",l._textObj.colorFunc).attr("font-size",l._fontSize).style("font-family",l._fontFamily).attr("text-anchor","start").attr("y",function(t,e){return l._yScale(t.name)+.75*l._yScale.step()}).attr("x",function(t,e){if(null==l._labelShow||null==l._positionOptions||null==l._positionChoice)return 0;if(1==l._positionOptions.indexOf(l._positionChoice)){if(0<t.value||0==t.value)return l._xScale(t.total-t.value)+.3*l._fontSize;if(t.value<0)return l._xScale(t.downtotal)+.3*l._fontSize}else if(0==l._positionOptions.indexOf(l._positionChoice)){if(d3.selectAll(".stackHorizontalBarTexts text").attr("text-anchor","middle"),0<t.value||0==t.value)return l._xScale(t.total-t.value)+Math.abs(l._xScale(0)-l._xScale(t.value))/2;if(t.value<0)return l._xScale(t.downtotal)+Math.abs(l._xScale(t.value)-l._xScale(0))/2}}).attr("dy",-(l._yScale.step()/4-l._fontSize/2.7)).style("display",l._labelShow?"block":"none");l._interrupt?n.style("opacity",1):n.style("opacity",0).transition().duration(l._transition?.1*l._duration:0).delay(l._transition?l._startDelay+l._duration:0).style("opacity",1),null!=l._labelShow&&null!=l._positionOptions&&null!=l._positionChoice&&-1!=l._positionOptions.indexOf(l._positionChoice)||o.selectAll(".stackHorizontalBarTexts").style("display","none")});for(var i=o.selectAll(".stackHorizontalBarTexts text"),n=[],a=[],r=0;r<i._groups[0].length;r++){a.push(r);for(var u=r+1;u<i._groups[0].length;u++){ft(dt(d3.select(i._groups[0][r])),dt(d3.select(i._groups[0][u])))&&(n.push(r),d3.select(i._groups[0][r]).style("visibility","hidden"))}}for(var h=new Set(n),c=Array.from(h),_=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(c,a),d=0;d<c.length;d++){for(var y=[],f=0;f<_.length;f++){var p=dt(d3.select(i._groups[0][c[d]])),v=dt(d3.select(i._groups[0][_[f]]));if(y.push(ft(p,v)),ft(p,v)){if(c[d]==_[f])continue;d3.select(i._groups[0][c[d]]).style("visibility","hidden")}}0==y.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var g=0;g<_.length;g++)d3.select(i._groups[0][_[g]]).style("visibility","visible");return l}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return ar}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),bt=function(t){function o(t){a(this,o);var e=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-chart"),e.grid=new nt(e.coreGroup),e.selectOverlay=new St(e.coreGroup),e.rectPlot=new kt(e.coreGroup),e.overlay=new gt(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new tt(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=1,e._yScaleHeight=1.05,e._labelShow=!1,e._barWidthPercent=.5,e._positionOptions=["内部居中","内部居左"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["横向分类拉伸","横向分组拉伸","横向同步拉伸","横向整体拉伸","百叶窗","机场翻牌","俄罗斯方块"],e._moveStyle="横向整体拉伸",e._endPause=0,e._interrupt=!1,e}return u(o,$),r(o,[{key:"updateCore",value:function(){for(var i=this,a=i.activeData,t=0;t<(0==a.length?0:a[0].data.length);t++)for(var e=0;e<a.length;e++)parseFloat(a[e].data[t].value);for(var n=0;n<a.length;n++)for(var o=0;o<a[n].data.length;o++)0==n?0<a[n].data[o].value||0==a[n].data[o].value?(a[n].data[o].total=parseFloat(a[n].data[o].value),a[n].data[o].downtotal=0):a[n].data[o].value<0&&(a[n].data[o].downtotal=parseFloat(a[n].data[o].value),a[n].data[o].total=0):0<a[n].data[o].value||0==a[n].data[o].value?(a[n].data[o].total=a[n-1].data[o].total+parseFloat(a[n].data[o].value),a[n].data[o].downtotal=a[n-1].data[o].downtotal):a[n].data[o].value<0&&(a[n].data[o].total=a[n-1].data[o].total,a[n].data[o].downtotal=a[n-1].data[o].downtotal+parseFloat(a[n].data[o].value));var r=i.defs;r.selectAll("filter").remove();var l=r.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stackHorizontalBar").attr("filterUnits","objectBoundingBox");l.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),l.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),l.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),l.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),l.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var s=a,u=i.grid,h=i.tooltip,c=i.rectPlot,_=i.overlay,d=i.selectOverlay,y=(i.clipArea,i.xScale),f=i.yScale,p=i.widthOfCore,v=i.heightOfCore,g=1.1*Math.min(d3.min(a,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);(g<0?(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+-(y.range()[0]-y(0))+",0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+-(y.range()[0]-y(0))+",0)")):(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,0)")),0!=i._clipShowX.length&&(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,0)")),_.data(f.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(p).bandHeight(f.step()).onMouseover(function(t,e){var n=f.domain()[f.domain().length-e-1==-1?1:f.domain().length-e-1==-2?0:f.domain().length-e-1],o=[{text:n=="&-"+(f.domain().length-e)?"":n}];n&&1!=n&&(a.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),i.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+f(n)+")")),h.data(o).update(),h.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){h.move([d3.event.offsetX,d3.event.offsetY]),d.show()}).onMouseout(function(){h.hide(),d.hide()}),c.data(s).xScale(y).yScale(f).fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).barWidthPercent(i._barWidthPercent).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(i._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).textObj({colorFunc:function(){return rt(i._textLabel.color)}}).fillOpacity(1),u.width(p).height(v).xTickLocations(i.xAxis.tickLocations).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),d.width(p).height(f.step()).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)"),0!=i._clipShowX.length)?(i.mainGroup.selectAll(".clip-defs").remove(),i.mainGroup.append("defs").attr("class","clip-defs").append("clipPath").attr("id","clip-overlay-"+i.id).append("rect").attr("height",v).attr("width",p),i.coreGroup.attr("clip-path","url("+x("#clip-overlay-"+i.id)+")")):i.coreGroup.attr("clip-path","");var S=i.group.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(S).remove(),c.update(),d.update(),_.update(),u.update(),g<0?(i.coreGroup.selectAll(".fake-y-line").remove(),this.coreGroup.append("g").attr("class","fake-y-line").append("line").attr("x1",y.range()[0]).attr("y1",f.range()[0]).attr("x2",y.range()[0]).attr("y2",f.range()[1]).attr("stroke","rgb(233, 233, 233)")):i.coreGroup.selectAll(".fake-y-line").remove()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStrokeX).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration).xAxisLineWidth(e._xAxisLineWidth).axisLineShow(e._xAxisShow),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStrokeY).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration).yAxisLineWidth(e._yAxisLineWidth).axisLineShow(e._yAxisShow);i&&i.titleHeight;var _=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(_).compute(),i.compute();var d=(h-i.width)/t._tickValues.length,y=d3.max(t._tickValues,function(t){return w(t,u,e._fontFamily)}),f=(t._tickShow?t._tickSize+t._tickPadding+(y<.8*d?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-f,0]),n.range([0,h-i.width]),t.compute();var p=i.width,v=c-f,g=i.width;t.translate(p,v).update(),i.translate(g,0).update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,i=t.animation,n=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i?i.duration:this._duration,this._startDelay=i?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?rt(n.color):this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?rt(o.color):this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"setPublicOption",value:function(t){s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(rt(e.color)).axisLineStrokeX(rt(i.axisColor)||rt(e.color)).axisLineStrokeY(rt(n.axisColor)||rt(e.color)).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xRange(i.range).yRange(n.range).clipShow(n.range).clipShowX(i.range).xAxisLineWidth(0==i.axisLineWidth||i.axisLineWidth?i.axisLineWidth:1).yAxisLineWidth(0==n.axisLineWidth||n.axisLineWidth?n.axisLineWidth:1).xAxisShow(0!=i.axisShow&&!i.axisShow||i.axisShow).yAxisShow(0!=n.axisShow&&!n.axisShow||n.axisShow)}},{key:"buildOption",value:function(t,e){var i=new xt(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var i=0;i<t[e].data.length;i++)0==e?0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=parseFloat(t[e].data[i].value),t[e].data[i].downtotal=0):t[e].data[i].value<0&&(t[e].data[i].downtotal=parseFloat(t[e].data[i].value),t[e].data[i].total=0):0<t[e].data[i].value||0==t[e].data[i].value?(t[e].data[i].total=t[e-1].data[i].total+parseFloat(t[e].data[i].value),t[e].data[i].downtotal=t[e-1].data[i].downtotal):t[e].data[i].value<0&&(t[e].data[i].total=t[e-1].data[i].total,t[e].data[i].downtotal=t[e-1].data[i].downtotal+parseFloat(t[e].data[i].value));var n=this._xRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),Math.max(1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)]:[0,1];this._xDomain=[isNaN(parseFloat(n[0]))?a[0]:parseFloat(n[0]),isNaN(parseFloat(n[1]))?isNaN(parseFloat(n[0]))?a[1]:a[1]<n[0]?1.5*n[0]:a[1]:parseFloat(n[1])],this._yDomain=o}}]),o}(),wt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._fillOpacity=1,e._barCornerRadius=0,e._borderColor="",e._borderWidth=0,e}return u(i,A),r(i,[{key:"update",value:function(){for(var l=this,s=l._data,u=l._barWidthPercent,t=[],e=0;e<s.length;e++)for(var i=0;i<s[e].data.length;i++)t.push(Number(s[e].data[i].value));var o=pt(t,l._fontSize,l._fontFamily),a=l.group;a.selectAll("*").remove(),a.selectAll(".group-bar-rects").remove(),a.selectAll(".group-bar-texts").remove();var n=a.append("g").selectAll("g").data(s,function(t){return t.name});n.exit().remove(),n.enter().append("g").merge(n).each(function(i,o){var t=l._xScale.step();s.length<4&&1<s.length&&(t=l._xScale.step()-s.length+1);var a=t*u,e=d3.select(this).selectAll("rect").data(i.data);if(e.exit().remove(),null==l._moveStyle||0==l._transition||-1==l._moveOptions.indexOf(l._moveStyle))e.enter().append("path").attr("class","group-bar-rects").merge(e).style("fill",function(t){return l._fillColor||t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke-width",function(t){return l._borderWidth||0}).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})});else if(0==l._moveOptions.indexOf(l._moveStyle)||1==l._moveOptions.indexOf(l._moveStyle)||2==l._moveOptions.indexOf(l._moveStyle)){var n=e.enter().append("path").attr("class","group-bar-rects").merge(e).style("fill",function(t){return l._fillColor||t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke-width",function(t){return l._borderWidth||0});n.attr("d",function(t,e){return yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:l._yScale(0),width:0<a/s.length?a/s.length:0,height:0,cornerRadius:[0,0,0,0]})}),0==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?n.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):n.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):1==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?n.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):n.transition().delay(function(t,e){return l._transition?.9*l._duration/(0<i.data.length?i.data.length:1)*e+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):2==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?n.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):n.transition().delay(function(t,e){return l._transition?.9*l._duration/(0<s.length?s.length:1)*o+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}))}else if(3==l._moveOptions.indexOf(l._moveStyle)||4==l._moveOptions.indexOf(l._moveStyle)||5==l._moveOptions.indexOf(l._moveStyle)){var r=e.enter().append("path").attr("class","group-bar-rects").merge(e).style("fill",function(t){return l._fillColor||t.color}).style("fill-opacity",function(t){return l._fillOpacity}).style("stroke-width",function(t){return l._borderWidth||0});r.attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0,height:n,cornerRadius:[0,0,0,0]})}),3==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?r.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):r.transition().delay(function(t,e){return l._transition?.9*l._duration/(0<i.data.length?i.data.length:1)*e+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<i.data.length?i.data.length:1):0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):4==l._moveOptions.indexOf(l._moveStyle)?l._interrupt?r.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):r.transition().duration(l._transition?.9*l._duration:0).delay(l._transition?l._startDelay:0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):5==l._moveOptions.indexOf(l._moveStyle)&&(l._interrupt?r.style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}):r.transition().delay(function(t,e){return l._transition?.9*l._duration/(0<s.length?s.length:1)*o+l._startDelay:0}).duration(l._transition?.9*l._duration/(0<s.length?s.length:1):0).style("stroke",function(t){return l._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=l._yScale(0),n=l._yScale(t.value)-l._yScale(0)<0?0:l._yScale(t.value)-l._yScale(0)):0<t.value&&(i=l._yScale(t.value),n=l._yScale(0)-l._yScale(t.value)<0?0:l._yScale(0)-l._yScale(t.value)),yt({x:l._xScale.range()[0]+(a/s.length+(3<s.length||1==s.length?0:1))*o+l._xScale.step()*(1-u)/2+l._xScale.step()*e,y:i,width:0<a/s.length?a/s.length:0,height:n,cornerRadius:l._barCornerRadius})}))}e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var r=l._xScale.step();s.length<4&&1<s.length&&(r=l._xScale.step()-s.length+1);var h=r*u,c=0<h/s.length?h/s.length:0,_=a.append("g").selectAll("g").data(s,function(t){return t.name});if(_.exit().remove(),_.enter().append("g").merge(_).each(function(t,i){var e=d3.select(this).attr("class","groupedBarTexts").selectAll("text").data(t.data);e.exit().remove();var n=e.enter().append("text").attr("class","group-bar-texts").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",l._textObj.colorFunc).style("font-size",l._fontSize).style("font-family",l._fontFamily).attr("x",function(t,e){return l._xScale.range()[0]+(h/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<h/s.length?h/s.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==l._positionOptions||null==l._positionChoice?l._yScale(t.value):0==l._positionOptions.indexOf(l._positionChoice)?t.value<0?l._yScale(t.value)+1.05*l._fontSize:l._yScale(t.value)-.3*l._fontSize:1==l._positionOptions.indexOf(l._positionChoice)?0<t.value?l._yScale(0)-.3*l._fontSize:l._yScale(t.value)-.3*l._fontSize:void 0}).style("display",l._labelShow?"block":"none");null==l._positionOptions||null==l._positionChoice||c<o&&1==l._positionOptions.indexOf(l._positionChoice)&&n.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+(l._xScale.range()[0]+(h/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<h/s.length?h/s.length:0)/2||0)+"\n                         "+(l._yScale(t.value)+l._yScale(0)-l._yScale(t.value)-.65*l._fontSize)+" )":"rotate(-90 "+(l._xScale.range()[0]+(h/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<h/s.length?h/s.length:0)/2||0)+"\n                         "+(l._yScale(t.value)-.65*l._fontSize)+" )"}).attr("text-anchor","start"),l._interrupt?n.style("opacity",1):n.style("opacity",0).transition().duration(l._transition?.1*l._duration:0).delay(l._transition?.9*l._duration+l._startDelay:0).style("opacity",1),0==l._labelShow||null==l._labelShow||null==l._positionOptions||null==l._positionChoice||-1==l._positionOptions.indexOf(l._positionChoice)?a.selectAll(".groupedBarTexts").style("display","none"):a.selectAll(".groupedBarTexts").style("display","block")}),null==l._positionOptions||null==l._positionChoice||-1==l._positionOptions.indexOf(l._positionChoice))a.selectAll(".groupedBarTexts").style("display","none");else if(c<o&&1==l._positionOptions.indexOf(l._positionChoice)){for(var d=a.selectAll(".group-bar-texts"),y=[],f=[],p=0;p<d._groups[0].length;p++){f.push(p);for(var v=p+1;v<d._groups[0].length;v++){var g=dt(d3.select(d._groups[0][p])),S=dt(d3.select(d._groups[0][v])),x=g.width;g.width=g.height,g.height=x;var m=S.width;S.width=S.height,S.height=m,ft(g,S)&&(y.push(p),d3.select(d._groups[0][p]).style("visibility","hidden"))}}for(var k=new Set(y),b=Array.from(k),w=$(b,f),C=0;C<b.length;C++){for(var O=[],F=0;F<w.length;F++){var P=dt(d3.select(d._groups[0][b[C]])),W=dt(d3.select(d._groups[0][w[F]])),A=P.width;P.width=P.height,P.height=A;var z=W.width;if(W.width=W.height,W.height=z,O.push(ft(P,W)),ft(P,W)){if(b[C]==w[F])continue;d3.select(d._groups[0][b[C]]).style("visibility","hidden")}}0==O.filter(function(t){return 1==t}).length&&w.push(b[C])}for(var L=0;L<w.length;L++)d3.select(d._groups[0][w[L]]).style("visibility","visible")}else{for(var D=a.selectAll(".group-bar-texts"),T=[],M=[],R=0;R<D._groups[0].length;R++){M.push(R);for(var N=R+1;N<D._groups[0].length;N++){ft(dt(d3.select(D._groups[0][R])),dt(d3.select(D._groups[0][N])))&&(T.push(R),d3.select(D._groups[0][R]).style("visibility","hidden"))}}for(var j=new Set(T),X=Array.from(j),G=$(X,M),B=0;B<X.length;B++){for(var Y=[],H=0;H<G.length;H++){var V=dt(d3.select(D._groups[0][X[B]])),E=dt(d3.select(D._groups[0][G[H]]));if(Y.push(ft(V,E)),ft(V,E)){if(X[B]==G[H])continue;d3.select(D._groups[0][X[B]]).style("visibility","hidden")}}0==Y.filter(function(t){return 1==t}).length&&G.push(X[B])}for(var I=0;I<G.length;I++)d3.select(D._groups[0][G[I]]).style("visibility","visible")}function $(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}return l}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=parseFloat(t),this):this._barWidthPercent}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=parseFloat(t),this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Ct=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-bar-chart"),e.grid=new nt(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new ht(e.mainGroup),e.xAxis.minTickDistance(5),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.rectPlot=new wt(e.coreGroup),e.selectOverlay=new St(e.coreGroup),e.overlay=new gt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._barWidthPercent=.7,e._barCornerRadius=[0,0,0,0],e._borderWidth=0,e._borderColor="",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["纵向整体拉伸","纵向分组拉伸","纵向分类拉伸","横向分组展开","横向同步展开","横向分类展开"],e._moveStyle="纵向整体拉伸",e._endPause=0,e._interrupt=!1,e}return u(i,$),r(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=r,e=i.grid,l=i.tooltip,n=i.rectPlot,o=i.overlay,a=i.selectOverlay,s=i.clipArea,u=i.xScale,h=i.yScale,c=i.widthOfCore,_=i.heightOfCore,d=1.1*Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);d<0?(i.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),i.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(i.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),i.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),0!=i._clipShow.length&&(i.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),i.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var y=i.defs;y.selectAll("filter").remove();var f=y.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupBar").attr("filterUnits","objectBoundingBox");f.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),f.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),f.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),f.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),f.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(u.domain()).isScalePoint(!1).bandX(u.range()[0]).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),l.data(o).update(),i.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+u(n)+",0)"),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),a.show()}).onMouseout(function(){l.hide(),a.hide()}),n.data(t).xScale(u).yScale(h).fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(i._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).barWidthPercent(i._barWidthPercent).barCornerRadius(i._barCornerRadius).borderWidth(i._borderWidth).borderColor(i._borderColor).fillOpacity(i._fillOpacity).textObj({colorFunc:function(){return rt(i._textLabel.color)}}).fillOpacity(1),e.width(c).height(_).planeX(u.range()[0]).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(i.yAxis.tickLocations.slice(1)).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),s.width(c).height(_).paddingVertical([0,0]).transition(i._transition).duration(i._duration),a.width(u.step()).height(_).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)"),0!=i._clipShow.length?(s.width(c).height(_).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url("+x("#"+s.id)+")")):(s.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),s.update();var p=i.group.selectAll(".grouped-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),n.update(),a.update(),o.update(),e.translate(i.yAxis.width,0).update(),d<0?(i.coreGroup.selectAll(".fake-x-line").remove(),i.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",u.range()[0]).attr("y1",h.range()[0]).attr("x2",u.range()[1]).attr("y2",h.range()[0]).attr("stroke","rgb(233, 233, 233)")):i.coreGroup.selectAll(".fake-x-line").remove()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var i=new xt(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,i=t.display,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._barWidthPercent=0==i.barWidthPercent||i.barWidthPercent?i.barWidthPercent:this._barWidthPercent,this._barCornerRadius=i.bar4CornerRadius?i.bar4CornerRadius:this._barCornerRadius,this._borderWidth=0==i.barborderWidth||i.barborderWidth?i.barborderWidth:this._borderWidth,this._borderColor=i.barborderColor?rt(i.barborderColor):""),0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=i,this._yDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])]}}]),i}(),Ot=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="",e._borderWidth=0,e}return u(i,A),r(i,[{key:"update",value:function(){var x=this,m=x._data,k=x._barWidthPercent,b=x.group;b.selectAll("*").remove(),b.selectAll(".groupedHoizontalBar").remove(),b.selectAll(".groupedHoizontalBarTexts").remove();var t=b.selectAll("g").data(m);t.exit().remove(),t.enter().append("g").merge(t).each(function(i,o){var t=x._yScale.step();m.length<4&&1<m.length&&(t=x._yScale.step()-m.length+1);var a=t*k,e=d3.select(this).selectAll("rect").data(i.data);if(e.exit().remove(),null==x._moveStyle||0==x._transition||-1==x._moveOptions.indexOf(x._moveStyle))e.enter().append("path").attr("class","groupedHoizontalBar").merge(e).style("fill",function(t){return x._fillColor||t.color}).style("fill-opacity",function(t){return x._fillOpacity}).style("stroke-width",function(t){return x._borderWidth||0}).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})});else if(0==x._moveOptions.indexOf(x._moveStyle)||1==x._moveOptions.indexOf(x._moveStyle)||2==x._moveOptions.indexOf(x._moveStyle)){var n=e.enter().append("path").attr("class","groupedHoizontalBar").merge(e).style("fill",function(t){return x._fillColor||t.color}).style("fill-opacity",function(t){return x._fillOpacity}).style("stroke-width",function(t){return x._borderWidth||0});n.attr("d",function(t,e){return yt({x:x._xScale(0),y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:0,height:0<a/m.length?a/m.length:0,cornerRadius:[0,0,0,0],roundCorners:[0,1,2,3],type:"horizontal"})}),0==x._moveOptions.indexOf(x._moveStyle)?x._interrupt?n.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):n.transition().duration(x._transition?.9*x._duration:0).delay(x._transition?x._startDelay:0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):1==x._moveOptions.indexOf(x._moveStyle)?x._interrupt?n.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):n.transition().delay(function(t,e){return x._transition?.9*x._duration/(0<i.data.length?i.data.length:1)*e+x._startDelay:0}).duration(x._transition?.9*x._duration/(0<i.data.length?i.data.length:1):0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):2==x._moveOptions.indexOf(x._moveStyle)&&(x._interrupt?n.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):n.transition().delay(function(t,e){return x._transition?.9*x._duration/(0<m.length?m.length:1)*o+x._startDelay:0}).duration(x._transition?.9*x._duration/(0<m.length?m.length:1):0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}))}else if(3==x._moveOptions.indexOf(x._moveStyle)||4==x._moveOptions.indexOf(x._moveStyle)||5==x._moveOptions.indexOf(x._moveStyle)){var r=e.enter().append("path").attr("class","groupedHoizontalBar").merge(e).style("fill",function(t){return x._fillColor||t.color}).style("fill-opacity",function(t){return x._fillOpacity}).style("stroke-width",function(t){return x._borderWidth||0});r.attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0,cornerRadius:[0,0,0,0],roundCorners:[0,1,2,3],type:"horizontal"})}),3==x._moveOptions.indexOf(x._moveStyle)?x._interrupt?r.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):r.transition().delay(function(t,e){return x._transition?.9*x._duration/(0<i.data.length?i.data.length:1)*e+x._startDelay:0}).duration(x._transition?.9*x._duration/(0<i.data.length?i.data.length:1):0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):4==x._moveOptions.indexOf(x._moveStyle)?x._interrupt?r.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):r.transition().duration(x._transition?.9*x._duration:0).delay(x._transition?x._startDelay:0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):5==x._moveOptions.indexOf(x._moveStyle)&&(x._interrupt?r.style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}):r.transition().delay(function(t,e){return x._transition?.9*x._duration/(0<m.length?m.length:1)*o+x._startDelay:0}).duration(x._transition?.9*x._duration/(0<m.length?m.length:1):0).style("stroke",function(t){return x._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=x._xScale(t.value),n=x._xScale(0)-x._xScale(t.value)<0?0:x._xScale(0)-x._xScale(t.value)):0<t.value&&(i=x._xScale(0),n=x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0)),yt({x:i,y:Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((a/m.length+(3<m.length||1==m.length?0:1))*o+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<a/m.length?a/m.length:0),width:n,height:0<a/m.length?a/m.length:0,cornerRadius:x._barCornerRadius,roundCorners:[0,1,2,3],type:"horizontal"})}))}e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var e=b.append("g").selectAll("g").data(m);return e.exit().remove(),e.enter().append("g").merge(e).each(function(t,i){var e=x._yScale.step();m.length<4&&1<m.length&&(e=x._yScale.step()-m.length+1);var n=e*k,o=d3.select(this).append("g").attr("class","groupedHoizontalBarTexts").selectAll("text").data(t.data);o.exit().remove();var a=o.enter().append("text").merge(o).text(function(t){return 0==t.value?"":t.value}).attr("fill",x._textObj.colorFunc).attr("font-size",x._fontSize).style("font-family",x._fontFamily).attr("text-anchor","start").attr("x",function(t){return 0<t.value?x._xScale(0):t.value<0?x._xScale(t.value):void 0}).attr("y",function(t,e){return Math.abs(x._yScale.range()[0]-x._yScale.range()[1])-((n/m.length+(3<m.length||1==m.length?0:1))*i+x._yScale.step()*(1-k)/2+x._yScale.step()*e)-(0<n/m.length?n/m.length:0)}).attr("dy",(0<n/m.length?n/m.length:0)/2+x._fontSize/3).attr("dx",function(t,e){if(null==x._positionOptions||null==x._positionChoice)return 0;if(0==x._positionOptions.indexOf(x._positionChoice)){if(0<t.value)return x._xScale(t.value)-x._xScale(0)+.3*x._fontSize;if(t.value<0)return.3*-x._fontSize}else if(1==x._positionOptions.indexOf(x._positionChoice)){if(0<t.value)return.3*x._fontSize;if(t.value<0)return x._xScale(0)-x._xScale(t.value)-.3*x._fontSize}else if(2==x._positionOptions.indexOf(x._positionChoice)){if(t.value<0)return.3*x._fontSize+w(t.value,x._fontSize,x._fontFamily);if(0<t.value)return(x._xScale(t.value)-x._xScale(0)<0?0:x._xScale(t.value)-x._xScale(0))-w(t.value,x._fontSize,x._fontFamily)-.3*x._fontSize}}).style("display",x._labelShow?"block":"none");x._interrupt?a.style("opacity",1):a.style("opacity",0).transition().duration(x._transition?.1*x._duration:0).delay(x._transition?.9*x._duration+x._startDelay:0).style("opacity",1),d3.selectAll(b.selectAll(".groupedHoizontalBarTexts text").nodes().filter(function(t){return t.__data__.value<0})).attr("text-anchor","end"),null!=x._labelShow&&0!=x._labelShow&&null!=x._positionOptions&&null!=x._positionChoice&&-1!=x._positionOptions.indexOf(x._positionChoice)||b.selectAll(".groupedHoizontalBarTexts").style("display","none");for(var r=b.selectAll(".groupedHoizontalBarTexts text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ft(dt(d3.select(r._groups[0][u])),dt(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),y=0;y<_.length;y++){for(var f=[],p=0;p<d.length;p++){var v=dt(d3.select(r._groups[0][_[y]])),g=dt(d3.select(r._groups[0][d[p]]));if(f.push(ft(v,g)),ft(v,g)){if(_[y]==d[p])continue;d3.select(r._groups[0][_[y]]).style("visibility","hidden")}}0==f.filter(function(t){return 1==t}).length&&d.push(_[y])}for(var S=0;S<d.length;S++)d3.select(r._groups[0][d[S]]).style("visibility","visible")}),x}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=parseFloat(t),this):this._barWidthPercent}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=parseFloat(t),this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Ft=function(t){function o(t){a(this,o);var e=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-chart"),e.grid=new nt(e.coreGroup),e.xAxis=new J(e.mainGroup),e.yAxis=new tt(e.mainGroup),e.yAxis.minTickDistance(1),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.rectPlot=new Ot(e.coreGroup),e.selectOverlay=new St(e.coreGroup),e.overlay=new gt(e.coreGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._barWidthPercent=.7,e._barCornerRadius=[0,0,0,0],e._borderWidth=0,e._borderColor="",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["右边","内部居左","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["横向同步拉伸","横向分组拉伸","横向分类拉伸","按分组的百叶窗","百叶窗","按分类的百叶窗"],e._moveStyle="横向同步拉伸",e._endPause=0,e._interrupt=!1,e}return u(o,$),r(o,[{key:"updateCore",value:function(){for(var i=this,a=i.activeData,t=a,e=i.grid,r=i.tooltip,n=i.rectPlot,o=i.overlay,l=i.selectOverlay,s=i.xScale,u=i.yScale,h=i.widthOfCore,c=i.heightOfCore,_=d3.min(a,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],y=[],f=0;f<i.activeData.length;f++)for(var p=0;p<i.activeData[f].data.length;p++)null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?(y.push(0),d.push(0)):1==i._labelShow&&0==i._positionOptions.indexOf(i._positionChoice)?0<parseFloat(i.activeData[f].data[p].value)||0==parseFloat(i.activeData[f].data[p].value)?d.push(w(i.activeData[f].data[p].value,i._textLabel.fontSize,i._textLabel.fontFamily)):parseFloat(i.activeData[f].data[p].value)<0&&y.push(w(i.activeData[f].data[p].value,i._textLabel.fontSize,i._textLabel.fontFamily)):(y.push(0),d.push(0));_<0?(i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==y.length?0:d3.max(y)))+",0)"),i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==y.length?0:d3.max(y)))+","+-u.step()/2+")")):(i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")")),0!=i._clipShowX.length&&(i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")"));var v=i.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupHorizontal").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==y.length?0:d3.max(y))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var n=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],o=[{text:n=="&-"+(u.domain().length-e)?"":n}];n&&1!=n&&(a.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),i.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+u(n)+")")),r.data(o).update(),r.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.move([d3.event.offsetX,d3.event.offsetY]),l.show()}).onMouseout(function(){r.hide(),l.hide()}),n.data(t).xScale(s).yScale(u).fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(this._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).barWidthPercent(i._barWidthPercent).barCornerRadius(i._barCornerRadius).borderWidth(i._borderWidth).borderColor(i._borderColor).fillOpacity(i._fillOpacity).textObj({colorFunc:function(){return rt(i._textLabel.color)}}).fillOpacity(1),e.width(h-(0==y.length?0:d3.max(y))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(i.xAxis.tickLocations).yTickLocations(i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),l.width(h-(0==y.length?0:d3.max(y))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),i.coreGroup.attr("transform","translate("+i.yAxis.width+",0)");var S=i.group.selectAll(".grouped-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});(d3.selectAll(S).remove(),n.update(),l.update(),o.update(),e.translate(i.yAxis.width,0).update(),i.group.selectAll(".selectOverlay-rect").attr("x",""+(0==y.length?0:d3.max(y))),i.group.selectAll(".bands-overlay").attr("transform","translate("+(0==y.length?0:d3.max(y))+",0 )"),i.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==y.length?0:d3.max(y))+",0 )"),0!=i._clipShowX.length)?(i.mainGroup.selectAll(".clip-defs").remove(),i.mainGroup.append("defs").attr("class","clip-defs").append("clipPath").attr("id","clip-overlay-"+i.id).append("rect").attr("x",0==y.length?0:d3.max(y)).attr("height",c).attr("width",h-(0==y.length?0:d3.max(y))-(0==d.length?0:d3.max(d))),i.coreGroup.attr("clip-path","url("+x("#clip-overlay-"+i.id)+")")):i.coreGroup.attr("clip-path","")}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,i=e.yAxis,n=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;n.domain(e._xDomain),t.scaleFunc(n).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStrokeX).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration).xAxisLineWidth(e._xAxisLineWidth).axisLineShow(e._xAxisShow),o.domain(e._yDomain),i.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStrokeY).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration).yAxisLineWidth(e._yAxisLineWidth).axisLineShow(e._yAxisShow);i&&i.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],y=0;y<e.activeData.length;y++)for(var f=0;f<e.activeData[y].data.length;f++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[y].data[f].value)||0==parseFloat(e.activeData[y].data[f].value)?_.push(w(e.activeData[y].data[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[y].data[f].value)<0&&d.push(w(e.activeData[y].data[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var p=e._tickCount?e._tickCount:(h-i.allowedMaxTextWidth())/(3*u);t.tickCount(p).compute(),i.compute();var v=Math.abs(0==d.length?0:d3.max(d)-(h-i.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,g=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return w(t,u,e._fontFamily)}),S=(t._tickShow?t._tickSize+t._tickPadding+(g<.8*v?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-S,0]),i.compute(),n.range([0==d.length?0:d3.max(d),h-i.width-(0==_.length?0:d3.max(_))]),t.compute();var x=i.width,m=c-S,k=i.width;t.translate(x,m).update(),i.translate(k,0).update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._barWidthPercent=0==e.barWidthPercent||e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.bar4CornerRadius?e.bar4CornerRadius:this._barCornerRadius,this._borderWidth=0==e.barborderWidth||e.barborderWidth?e.barborderWidth:this._borderWidth,this._borderColor=e.barborderColor?rt(e.barborderColor):""),0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"setPublicOption",value:function(t){s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(rt(e.color)).axisLineStrokeX(rt(i.axisColor)||rt(e.color)).axisLineStrokeY(rt(n.axisColor)||rt(e.color)).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xRange(i.range).yRange(n.range).clipShow(n.range).clipShowX(i.range).xAxisLineWidth(0==i.axisLineWidth||i.axisLineWidth?i.axisLineWidth:1).yAxisLineWidth(0==n.axisLineWidth||n.axisLineWidth?n.axisLineWidth:1).xAxisShow(0!=i.axisShow&&!i.axisShow||i.axisShow).yAxisShow(0!=n.axisShow&&!n.axisShow||n.axisShow)}},{key:"buildOption",value:function(t,e){var i=new xt(t,e),n=_;return i.dataSolveFunc(n),i}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._xRange||[],i=t.length?t[0].data.map(function(t){return t.name}):[0,1],n=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=[isNaN(parseFloat(e[0]))?n[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?n[1]:n[1]<e[0]?1.5*e[0]:n[1]:parseFloat(e[1])],this._yDomain=i}}]),o}(),Pt="axis-group",Wt="y-mix-title",At=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-y-mix"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return u(i,U),r(i,[{key:"update",value:function(){var i=this,n=i._orient,t=i._scaleFunc,e=i.group,o=i._fontSize,a=i._tickValueTexts,r=void 0;r=i.axisFunc="right"===n?d3.axisRight(t):d3.axisLeft(t);var l=null;"number"===i._type&&i._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(i._tickShow?i._tickValues:[]).tickSizeInner(i._tickShow?i._tickSize:0).tickSizeOuter(0).tickPadding(i._tickPadding).tickFormat(l),e.select(".axis-group").remove();var s=e.select("."+Pt).empty()?e.append("g").attr("class",Pt):e.select("."+Pt);s.transition().duration(i._transition?i._duration:0).call(r).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("dx",function(t,e){return"left"==n?.6*-o:"right"==n?.6*o:void 0}).attr("dy",.4*o).text(function(t,e){return a[e]+(i._unit?i._unit:"")}),s.selectAll(".tick line").style("stroke",i._lineStroke).style("display","none"),s.select("path").style("stroke",i._lineStroke).style("display","none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(i._titleShow&&i._title){var h=e.select("."+Wt).empty()?e.append("g").attr("class",Wt):e.select("."+Wt),c=h.select("text").empty()?h.append("text"):h.select("text");w(i._title,o,i._fontFamily);h.call(z,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(i._title),"second"==i._times&&(h.call(z,this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0,u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).attr("transform","rotate(90)").style("text-anchor","middle").text(i._title))}else e.select("."+Wt).remove()}},{key:"compute",value:function(){var e=this,t=[],i=[],n=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);for(var s=0;s<t.length;s++)t[s]=t[s]+(e._unit?e._unit:"");var u=d3.max(t,function(t){return w(t,r,e._fontFamily)});return t="category"===a?o.domain():o.ticks(e._tickCount),u<=l?(i=t,n=u):(i=t.map(function(t){return S(t,l,r,e._fontFamily)}),n=l),e._tickValues=t,e._tickValueTexts=i,e._tickTextWidth=n,e}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+3:0):this._titleShow&&this._title?1.125*this._fontSize+3:0),t}}]),i}(),zt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","mix-line-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._fillOpacity=1,e._barCornerRadius=0,e._borderColor="",e._borderWidth=0,e}return u(i,A),r(i,[{key:"update",value:function(){for(var r=this,l=r._data,s=r._barWidthPercent,t=[],e=0;e<l.length;e++)for(var i=0;i<l[e].data.length;i++)t.push(Number(l[e].data[i].value));pt(t,r._fontSize,r._fontFamily);var n=r.group;n.selectAll("*").remove(),n.selectAll("g").remove();var o=n.append("g").selectAll("g").data(l,function(t){return t.name});return o.exit().remove(),o.enter().append("g").attr("class","mix-line-bar-bar-rects").merge(o).each(function(t,o){var e=r._xScale.step();l.length<4&&1<l.length&&(e=r._xScale.step()-l.length+1);var a=e*s,i=d3.select(this).selectAll("rect").data(t.data);i.exit().remove();var n=i.enter().append("path").attr("class","mix-line-bar-rects").merge(i).style("fill",function(t){return r._fillColor||t.color}).style("fill-opacity",function(t){return r._fillOpacity}).style("stroke-width",function(t){return r._borderWidth||0});n.attr("d",function(t,e){return yt({x:r._xScale.range()[0]+(a/l.length+(3<l.length||1==l.length?0:1))*o+r._xScale.step()*(1-s)/2+r._xScale.step()*e,y:r._yScale(0),width:0<a/l.length?a/l.length:0,height:0,cornerRadius:[0,0,0,0]})}),r._interrupt?n.style("stroke",function(t){return r._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=r._yScale(0),n=r._yScale(t.value)-r._yScale(0)<0?0:r._yScale(t.value)-r._yScale(0)):0<t.value&&(i=r._yScale(t.value),n=r._yScale(0)-r._yScale(t.value)<0?0:r._yScale(0)-r._yScale(t.value)),yt({x:r._xScale.range()[0]+(a/l.length+(3<l.length||1==l.length?0:1))*o+r._xScale.step()*(1-s)/2+r._xScale.step()*e,y:i,width:0<a/l.length?a/l.length:0,height:n,cornerRadius:r._barCornerRadius})}):n.transition().duration(r._transition?.9*r._duration:0).delay(r._transition?r._startDelay:0).style("stroke",function(t){return r._borderColor||t.color}).attr("d",function(t,e){var i=0,n=0;return t.value<0?(i=r._yScale(0),n=r._yScale(t.value)-r._yScale(0)<0?0:r._yScale(t.value)-r._yScale(0)):0<t.value&&(i=r._yScale(t.value),n=r._yScale(0)-r._yScale(t.value)<0?0:r._yScale(0)-r._yScale(t.value)),yt({x:r._xScale.range()[0]+(a/l.length+(3<l.length||1==l.length?0:1))*o+r._xScale.step()*(1-s)/2+r._xScale.step()*e,y:i,width:0<a/l.length?a/l.length:0,height:n,cornerRadius:r._barCornerRadius})})}),r}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=parseFloat(t),this):this._barWidthPercent}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=parseFloat(t),this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Lt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","mix-line-bar-text"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e}return u(i,A),r(i,[{key:"update",value:function(){for(var l=this,s=l._data,u=l._barWidthPercent,t=[],e=0;e<s.length;e++)for(var i=0;i<s[e].data.length;i++)t.push(Number(s[e].data[i].value));var h=pt(t,l._fontSize,l._fontFamily),c=l.group;c.selectAll("*").remove(),c.selectAll("g").remove(),c.append("g").selectAll("g").data(s,function(t){return t.name}).exit().remove();var n=c.append("g").selectAll("g").data(s,function(t){return t.name});return n.exit().remove(),n.enter().append("g").merge(n).each(function(t,i){var e=l._xScale.step();s.length<4&&1<s.length&&(e=l._xScale.step()-s.length+1);var n=e*u,o=d3.select(this).attr("class","mixLineBarTexts").selectAll("text").data(t.data);o.exit().remove();var a=o.enter().append("text").attr("class","mix-line-bar-texts").merge(o).text(function(t){return 0==t.value?"":t.value}).attr("fill",l._textObj.colorFunc).style("font-size",l._fontSize).style("font-family",l._fontFamily).attr("x",function(t,e){return l._xScale.range()[0]+(n/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<n/s.length?n/s.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==l._positionOptions||null==l._positionChoice?l._yScale(t.value):0==l._positionOptions.indexOf(l._positionChoice)?t.value<0?l._yScale(0)-.3*l._fontSize:l._yScale(t.value)-.3*l._fontSize:1==l._positionOptions.indexOf(l._positionChoice)?(l._yScale(0)+l._yScale(t.value))/2+.35*l._fontSize:2==l._positionOptions.indexOf(l._positionChoice)?0<t.value?l._yScale(0)-.3*l._fontSize:l._yScale(t.value)-.3*l._fontSize:void 0}).style("display",l._labelShow?"block":"none");l._interrupt?a.style("opacity",1):a.style("opacity",0).transition().duration(l._transition?.1*l._duration:0).delay(l._transition?l._startDelay+.9*l._duration:0).style("opacity",1);var r=0<n/s.length?n/s.length:0;null==l._positionOptions||null==l._positionChoice||r<h&&2==l._positionOptions.indexOf(l._positionChoice)&&a.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+(l._xScale.range()[0]+(n/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<n/s.length?n/s.length:0)/2||0)+"\n                         "+(l._yScale(t.value)+l._yScale(0)-l._yScale(t.value)-.65*l._fontSize)+" )":"rotate(-90 "+(l._xScale.range()[0]+(n/s.length+(3<s.length||1==s.length?0:1))*i+l._xScale.step()*(1-u)/2+l._xScale.step()*e+(0<n/s.length?n/s.length:0)/2||0)+"\n                         "+(l._yScale(t.value)-.65*l._fontSize)+" )"}).attr("text-anchor","start"),0==l._labelShow||null==l._labelShow||null==l._positionOptions||null==l._positionChoice?c.selectAll(".mixLineBarTexts").style("display","none"):c.selectAll(".mixLineBarTexts").style("display","block")}),l}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=parseFloat(t),this):this._barWidthPercent}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=parseFloat(t),this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}}]),i}(),Dt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","mix-line-bar-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._fill=null,e._lineWidth=2,e._strokeWidth=1,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var n=this,t=n._data,o=n._xScale,a=n._yScale,e=n.group;e.selectAll("*").remove(),n._interrupt?e.style("opacity",1):e.style("opacity",0).transition().duration(0).delay(n._transition?n._startDelay:0).style("opacity",1);var i=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(n._curve);var r=e.selectAll("path").data(t,function(t){return t.key});r.exit().remove();var l=r.enter().append("path").merge(r).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return i(t.data)});n._interrupt?l.attr("stroke-dasharray",n._strokeDasharry):l.transition().duration(n._transition?.9*n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}});var s=e.append("g").selectAll("g").data(t,function(t){return t.name});s.exit().remove(),s.enter().append("g").merge(s).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var i=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("cx",function(t){return o(t.name)+o.bandwidth()/2||0}).attr("cy",function(t){return a(t.value)||0});n._interrupt?i.transition().duration(0).delay(0).ease(d3.easeLinear).attr("r",n._radius).on("start",n._onTransitionStart).on("end",n._onTransitionEnd):i.transition().duration(n._transition?.9*n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,n._radius);return function(t){return e(t)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var u=e.selectAll(".clip-scatter-plot").nodes(),h=0;h<u.length;h++)""==u[h].__data__.value||isNaN(u[h].__data__.value)?d3.select(u[h]).style("opacity","0"):d3.select(u[h]).style("opacity","1");return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Tt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","stack-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var n=this,t=n._data,e=n.group;e.selectAll("*").remove();var o=n._xScale,a=n._yScale,i=e.selectAll("g").data(t,function(t){return t.name});i.exit().remove(),i.enter().append("g").attr("class","ranking-text-group").merge(i).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove();var i=e.enter().append("text").attr("x",function(t){return o(t.name)+("mix"==n._type?o.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?a(t.total)||0:a(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t){return o(t.name)+("mix"==n._type?o.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?a(t.total)||0:a(t.value)||0}).attr("text-anchor","middle").style("display",n._labelShow?"block":"none");n._interrupt?i.style("opacity",1):i.style("opacity",0).interrupt().transition().duration(n._transition?.1*n._duration:0).delay(n._transition?n._startDelay+.9*n._duration:0).style("opacity",1)}),null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".ranking-text-group text").style("display","none"):0==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".ranking-text-group text").attr("dy",.4*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)&&e.selectAll(".ranking-text-group text").attr("dy",1.3*n._fontSize);for(var r=e.selectAll(".ranking-text-group text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ft(dt(d3.select(r._groups[0][u])),dt(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(_,s),y=0;y<_.length;y++){for(var f=[],p=0;p<d.length;p++){var v=dt(d3.select(r._groups[0][_[y]])),g=dt(d3.select(r._groups[0][d[p]]));if(f.push(ft(v,g)),ft(v,g)){if(_[y]==d[p])continue;d3.select(r._groups[0][_[y]]).style("visibility","hidden")}}0==f.filter(function(t){return 1==t}).length&&d.push(_[y])}for(var S=0;S<d.length;S++)d3.select(r._groups[0][d[S]]).style("visibility","visible");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=parseFloat(t),this):this._defs}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Mt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","axis-tooltip"),e._width=0,e._height=0,e._shadowColor="#000",e}return u(i,A),r(i,[{key:"update",value:function(){var t=this._data,e=this.group,i=this._defs;i.selectAll("#bg").remove();var n=i.append("filter").attr("x","-15%").attr("y","-25%").attr("width","135%").attr("height","150%").attr("id","bg");n.append("feFlood").attr("flood-color","black"),n.append("feComposite").attr("in","SourceGraphic");var o=e.selectAll("text").attr("class","axis-tooltip-text").data(t);o.exit().remove();o.enter().append("g").append("text").merge(o).text(function(t){return t.text}).attr("filter","url(#bg)").style("fill","white").style("fill-opacity",1).style("opacity",.8).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("dy","0.4em").attr("font-size",10).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);return this}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),i}(),Rt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var i=this,t=i.group,e=i._data,n=i._xScale,o=i._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",i._fill||t.color).style("stroke",i._stroke||t.color).style("stroke-width",i._strokeWidth).attr("r",i._radius).attr("cx",function(t){return n(t.name)||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return i}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),Nt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.elem=t.append("line").attr("class","guide-line"),e._x1=0,e._y1=0,e._x2=0,e._y2=100,e._stroke="#000",e._strokeDasharray="3 3",e}return u(i,o),r(i,[{key:"update",value:function(){return this.elem.attr("x1",this._x1).attr("y1",this._y1).attr("x2",this._x2).attr("y2",this._y2).style("stroke",this._stroke).style("stroke-dasharray",this._strokeDasharray).style("pointer-events","none"),this}},{key:"x1",value:function(t){return arguments.length?(this._x1=t,this):this._x1}},{key:"y1",value:function(t){return arguments.length?(this._y1=t,this):this._y1}},{key:"x2",value:function(t){return arguments.length?(this._x2=t,this):this._x2}},{key:"y2",value:function(t){return arguments.length?(this._y2=t,this):this._y2}},{key:"x",value:function(t){return arguments.length?(this._x1=this._x2=t,this):[this._x1,this._x2]}},{key:"y",value:function(t){return arguments.length?(this._y1=this._y2=t,this):[this._y1,this._y2]}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}}]),i}();function jt(t,e){var i=0,n=0;e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&"折线列"==t.name&&(n=t.index)});for(var o={},a=[],r=t.length,l=t[0],s=[],u=1;u<r;u++)s.push(t[u].length);s.sort(function(t,e){return e-t});for(var h=[],c=0;c<r;c++)for(var _=0;_<s[0];_++)h.push(isNaN(parseFloat(t[c][_])));if(0==h.filter(function(t,e){return 0==t}).length)return[];for(var d=1;d<s[0];d++)if(d!==i){var y=l[d];""!=y&&null!=y&&null!=y||(y="$-"+d),o[y]=d==n?{name:y,data:[],showLegend:y!="$-"+d,type:"折线列"}:{name:y,showLegend:y!="$-"+d,data:[]}}for(var f=1;f<r;f++){var p=t[f],v=p[i];if(""!=v&&null!=v&&null!=v||(v="&-"+f),v)for(var g=0;g<s[0];g++){var S=l[g];g!==i&&(""!=l[g]&&null!=l[g]&&null!=l[g]||(S="$-"+g),o[S].data.push({name:v,showAxisText:v!="&-"+f,value:g==n||""!=p[g]&&null!=p[g]&&null!=p[g]&&!isNaN(parseFloat(p[g]))?p[g]:0,tooltipValueShow:!isNaN(parseFloat(p[g]))}))}}for(var x in o)a.push(o[x]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Xt=function(t){function o(t){a(this,o);var e=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","mix-line-bar-chart"),e.grid=new nt(e.coreGroup),e.xAxis=new J(e.mainGroup),e.yAxis=new At(e.mainGroup),e.yAxisDoubleY=new At(e.mainGroup),e.xAxis.minTickDistance(5),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.selectOverlay=new St(e.coreGroup),e.rectPlot=new zt(e.coreGroup),e.linePlot=new Dt(e.coreGroup),e.scatterPlot=new Rt(e.coreGroup),e.guideLine=new Nt(e.coreGroup),e.textPlot=new Lt(e.coreGroup),e.stackText=new Tt(e.coreGroup),e.overlay=new gt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e.yScaleRight=d3.scaleLinear(),e.axisTooltip=new Mt(e.mainGroup),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._sortValue=0,e._curve=null,e._histogramWidth=.7,e._yScaleHeight=1.05,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._strokeColor="#fff",e._fillColor="",e._endPointRadius=3.5,e._barWidthPercent=.7,e._barCornerRadius=[0,0,0,0],e._borderWidth=0,e._borderColor="",e._fillOpacity=1,e._bardisplay=!1,e._barpositionOptions=["外部居上","内部居中","内部居下"],e._barpositionChoice="外部居上",e._linedisplay=!1,e._linepositionOptions=["上面","下面"],e._linepositionChoice="上面",e._lineWidth=2,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="横向展开",e._endPause=0,e._interrupt=!1,e}return u(o,$),r(o,[{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,i=t.yAxis,n=t.yAxisDoubleY,o=t.xScale,a=t.yScale,r=t.yScaleRight,l=t._xType,s=t._yType,u=t._xOrient,h=t._yOrient,c=t._yOrientRight,_=t._fontSize,d=t.widthOfNoMargin,y=t.heightOfMainGroup;o.domain(t._xDomain),a.domain(t._yDomain),r.domain(t._yDomain1),e.scaleFunc(o).allowedMaxTextHeight(.3*y).type(l).orient(u).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration).xAxisLineWidth(t._xAxisLineWidth).axisLineShow(t._xAxisShow),i.scaleFunc(a).allowedMaxTextWidth(.5*d).type(s).orient(h).title(t._yLeftName).unit(t._yLeftTitle?t._yLeftTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),n.scaleFunc(r).allowedMaxTextWidth(.5*d).type(s).orient(c).title(t._yRightName).times("second").unit(t._yRightTitle?t._yRightTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);i.titleHeight;var f=(y-e.allowedMaxTextHeight())/(3*_);i.tickCount(f),n.tickCount(f),i.compute(),n.compute();var p=t.activeData,v=i.width,g=n.width;0==p.filter(function(t){return"折线列"==t.type}).length&&(v=i.width,g=t._yRightName?24:0),0==p.filter(function(t){return"折线列"!=t.type}).length&&(v=t._yLeftName?24:0,g=n.width),0==p.length&&(v=t.yAxis.width,g=t.yAxisDoubleY.width),o.range([0,d-v-g]),e.compute(),o.range([e._tickTextWidth>o.bandwidth()/2+v?e._tickTextWidth-o.bandwidth()/2-v:0,d-v-g]),e.compute(),a.range([y-e.height,0]),r.range([y-e.height,0]);var S=v,x=y-e.height,m=v+(e._tickTextWidth>o.bandwidth()/2+v?e._tickTextWidth-o.bandwidth()/2-v:0);e.translate(S,x),i.translate(m,0);var k=d-g;n.translate(k,0),0==p.length&&(e.translate(S,x),i.translate(m,0),n.translate(k,0)),e.update(),i.update(),n.update()}},{key:"updateCore",value:function(){var r=this,l=r.activeData,t=l,e=r.grid,s=r.tooltip,i=(r.axisTooltip,r.rectPlot),n=r.textPlot,o=r.linePlot,a=r.overlay,u=(r.scatterPlot,r.selectOverlay),h=r.guideLine,c=r.stackText,_=r.xScale,d=r.yScale,y=r.yScaleRight,f=1.2*Math.min(d3.min(l.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0);f<0?(r.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(d.range()[0]-d(0))+")"),r.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(d.range()[0]-d(0))+")")):(r.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),r.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var p=r.yAxis.width,v=r.yAxisDoubleY.width;0==l.filter(function(t){return"折线列"==t.type}).length&&(p=r.yAxis.width,v=r._yRightName?24:0),0==l.filter(function(t){return"折线列"!=t.type}).length&&(p=r._yLeftName?24:0,v=r.yAxisDoubleY.width),0==l.length&&(p=r.yAxis.width,v=r.yAxisDoubleY.width);var g=r.widthOfNoMargin-p-v,S=r.heightOfCore,x=r.defs;x.selectAll("filter").remove();var m=x.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_line").attr("filterUnits","objectBoundingBox");m.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),m.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),m.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),m.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),m.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.width(g).height(S).planeX(_.range()[0]).xTickLocations(r.xAxis.tickLocations).yTickLocations(r.yAxis.tickLocations).showX(r._gridShowX).showY(r._gridShowY).stroke(r._gridStroke).strokeDasharray(r._gridStrokeDasharray).gridLineWidth(r._gridLineWidth),0==l.filter(function(t){return"折线列"!=t.type}).length&&e.width(g).height(S).xTickLocations(r.xAxis.tickLocations).yTickLocations(r.yAxisDoubleY.tickLocations).showX(r._gridShowX).showY(r._gridShowY).stroke(r._gridStroke).strokeDasharray(r._gridStrokeDasharray).gridLineWidth(r._gridLineWidth),a.data(_.domain()).isScalePoint(!1).bandX(_.range()[0]).bandWidth(_.step()).bandHeight(S).onMouseover(function(t,e){s.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show();var i=r.elem.node().parentNode,n=(d3.mouse(i),e);d3.select(r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").nodes()[n]).attr("r",1.5*r._endPointRadius),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").nodes().filter(function(t,e){return e!=n})).attr("r",r._endPointRadius)}).onMousemove(function(t,e){var i=r.elem.node().parentNode,n=(d3.mouse(i),d3.mouse(this)[0],d3.mouse(this)[1],_.step(),e),o=t,a=[{text:o=="&-"+(n+1)?"":o}];o&&(l.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===o});a.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(i[0].tooltipValueShow?i[0].value:""),color:t.color})}),r.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+_(o)+",0)")),s.data(a).update().move([d3.event.offsetX,d3.event.offsetY]),d3.select(r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").nodes()[n]).attr("r",1.5*r._endPointRadius),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").nodes().filter(function(t,e){return e!=n})).attr("r",r._endPointRadius)}).onMouseout(function(){s.hide(),u.hide(),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").nodes()).attr("r",r._endPointRadius)}),i.data(t.filter(function(t){return"折线列"!=t.type})).xScale(_).yScale(d).fontSize(r._textLabel.fontSize).fontColor(rt(r._textLabel.color)).fontFamily(r._textLabel.fontFamily).labelShow(r._bardisplay).positionOptions(r._barpositionOptions).positionChoice(r._barpositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).interrupt(r._interrupt).barWidthPercent(r._barWidthPercent).barCornerRadius(r._barCornerRadius).borderWidth(r._borderWidth).borderColor(r._borderColor).fillOpacity(r._fillOpacity).textObj({colorFunc:function(){return rt(r._textLabel.color)}}),o.data(l.filter(function(t){return"折线列"==t.type})).xScale(_).yScale(y).labelShow(r._linedisplay).positionOptions(r._linepositionOptions).positionChoice(r._linepositionChoice).lineWidth(r._lineWidth).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).interrupt(r._interrupt).curve(r._curve).radius(r._endPointRadius).stroke(r._strokeColor).fill(r._fillColor).lineWidth(r._lineWidth).strokeWidth(r._strokeWidth).lineFunc(d3.line().x(function(t){return _(t.name)}).y(function(t){return y(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))})),h.x1(0).x2(g).strokeDasharray(r._gridStrokeDasharray),n.data(t.filter(function(t){return"折线列"!=t.type})).xScale(_).yScale(d).fontSize(r._textLabel.fontSize).fontColor(rt(r._textLabel.color)).fontFamily(r._textLabel.fontFamily).labelShow(r._bardisplay).positionOptions(r._barpositionOptions).positionChoice(r._barpositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).interrupt(r._interrupt).barWidthPercent(r._barWidthPercent).barCornerRadius(r._barCornerRadius).borderWidth(r._borderWidth).borderColor(r._borderColor).textObj({colorFunc:function(){return rt(r._textLabel.color)}}).fillOpacity(1),c.data(l.filter(function(t){return"折线列"==t.type})).xScale(_).yScale(y).type("mix").fontSize(r._textLabel.fontSize).fontColor(rt(r._textLabel.color)).fontFamily(r._textLabel.fontFamily).labelShow(r._linedisplay).positionOptions(r._linepositionOptions).positionChoice(r._linepositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).interrupt(r._interrupt),u.width(_.step()).height(S).shadowColor("#ccc").hide(),r.coreGroup.attr("transform","translate("+p+",0)");var k=r.group.selectAll(".mix-line-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(k).remove(),i.update(),o.translate(_.step()/2,0).update(),r.group.selectAll(".mix-line-bar-chart .mix-line-bar-plot circle").attr("transform","translate("+-_.step()/2+", 0)"),n.update(),c.update(),u.update(),a.update(),e.translate(p,0).update(),f<0?(r.coreGroup.selectAll(".fake-x-line").remove(),r.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",_.range()[0]).attr("y1",d.range()[0]).attr("x2",_.range()[1]).attr("y2",d.range()[0]).attr("stroke","rgb(233, 233, 233)")):r.coreGroup.selectAll(".fake-x-line").remove();var b=r.group.selectAll(".mix-line-bar-texts").nodes(),w=r.group.selectAll(".ranking-text-group text").nodes(),C=b.concat(w),O=d3.selectAll(C);if(null==r._barpositionOptions||null==r._barpositionChoice||-1==r._barpositionOptions.indexOf(r._barpositionChoice))r.group.selectAll(".mixLineBarTexts").style("display","none");else if(0==r._barpositionOptions.indexOf(r._barpositionChoice)||1==r._barpositionOptions.indexOf(r._barpositionChoice)){for(var F=[],P=[],W=0;W<O._groups[0].length;W++){P.push(W);for(var A=W+1;A<O._groups[0].length;A++){ft(dt(d3.select(O._groups[0][W])),dt(d3.select(O._groups[0][A])))&&(F.push(W),d3.select(O._groups[0][W]).style("visibility","hidden"))}}for(var z=new Set(F),L=Array.from(z),D=at(L,P),T=0;T<L.length;T++){for(var M=[],R=0;R<D.length;R++){var N=dt(d3.select(O._groups[0][L[T]])),j=dt(d3.select(O._groups[0][D[R]]));if(M.push(ft(N,j)),ft(N,j)){if(L[T]==D[R])continue;d3.select(O._groups[0][L[T]]).style("visibility","hidden")}}0==M.filter(function(t){return 1==t}).length&&D.push(L[T])}for(var X=0;X<D.length;X++)d3.select(O._groups[0][D[X]]).style("visibility","visible")}else if(2==r._barpositionOptions.indexOf(r._barpositionChoice)){for(var G=[],B=[],Y=0;Y<O._groups[0].length;Y++){B.push(Y);for(var H=Y+1;H<O._groups[0].length;H++){var V=dt(d3.select(O._groups[0][Y])),E=dt(d3.select(O._groups[0][H]));if(Y<b.length){var I=V.width;V.width=V.height,V.height=I}if(H<b.length){var $=E.width;E.width=E.height,E.height=$}ft(V,E)&&(G.push(Y),d3.select(O._groups[0][Y]).style("visibility","hidden"))}}for(var U=new Set(G),Z=Array.from(U),q=at(Z,B),J=0;J<Z.length;J++){for(var Q=[],K=0;K<q.length;K++){var tt=dt(d3.select(O._groups[0][Z[J]])),et=dt(d3.select(O._groups[0][q[K]]));if(Z[J]<b.length){var it=tt.width;tt.width=tt.height,tt.height=it}if(q[K]<b.length){var nt=et.width;et.width=et.height,et.height=nt}if(Q.push(ft(tt,et)),ft(tt,et)){if(Z[J]==q[K])continue;d3.select(O._groups[0][Z[J]]).style("visibility","hidden")}}0==Q.filter(function(t){return 1==t}).length&&q.push(Z[J])}for(var ot=0;ot<q.length;ot++)d3.select(O._groups[0][q[ot]]).style("visibility","visible")}function at(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"onDataChange",value:function(){this._interrupt=!1,this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setPublicOption",value:function(t){s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,i=e.x||{},n=e.y||{};this.axisLineStroke(rt(e.color)).xTitle(i.name).yTitle(n.name).xTickShow(i.labelShow).yTickShow(n.labelShow).xDomain(i.range).yDomain(n.range).yLeftName(n.leftName).yLeftTitle(n.leftTitle).yRightName(n.rightName).yRightTitle(n.rightTitle).xAxisLineWidth(0==i.axisLineWidth||i.axisLineWidth?i.axisLineWidth:1).yAxisLineWidth(0==n.axisLineWidth||n.axisLineWidth?n.axisLineWidth:1).xAxisShow(0!=i.axisShow&&!i.axisShow||i.axisShow).yAxisShow(!(0!=n.axisShow&&!n.axisShow)&&n.axisShow)}},{key:"buildOption",value:function(t,e){var i=new xt(t,e),n=jt;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay,r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=0==e.lineWidth||e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear,this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._strokeWidth=0==e.endPointBorderWidth||e.endPointBorderWidth?e.endPointBorderWidth:this._strokeWidth,this._strokeColor=e.endPointBorderColor?rt(e.endPointBorderColor):null,this._fillColor=e.endPointFillColor?rt(e.endPointFillColor):null,this._barWidthPercent=0==e.barWidthPercent||e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.bar4CornerRadius?e.bar4CornerRadius:this._barCornerRadius,this._borderWidth=0==e.barborderWidth||e.barborderWidth?e.barborderWidth:this._borderWidth,this._borderColor=e.barborderColor?rt(e.barborderColor):null),0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._bardisplay=i?i.bardisplay:this._bardisplay,this._linedisplay=i?i.linedisplay:this._linedisplay,this._barpositionChoice=i.barpositionChoice?i.barpositionChoice:this._barpositionChoice,this._linepositionChoice=i.linepositionChoice?i.linepositionChoice:this._linepositionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]),i=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1],n=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=e,this._yDomain=i,this._yDomain1=n}}]),o}(),Gt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","animation-line-circle-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._fill=null,e._lineWidth=2,e._strokeWidth=1,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var o=this,a=o._data,r=o._xScale,l=o._yScale,t=o.group;if(t.selectAll("*").remove(),o._interrupt?t.style("opacity",1):t.style("opacity",0).transition().duration(0).delay(o._transition?o._startDelay:0).style("opacity",1),null==o._moveStyle||0==o._transition||-1==o._moveOptions.indexOf(o._moveStyle)){var e=o._lineFunc||d3.line().x(function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2}).y(function(t){return o._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});e.curve(o._curve),t.selectAll("path").remove();var i=t.selectAll("path").data(a,function(t){return t.key});i.exit().remove();i.enter().append("path").merge(i).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",o._lineWidth).style("stroke-dasharray",o._strokeDasharry).attr("d",function(t){return e(t.data)});var n=t.append("g").selectAll("g").data(a,function(t){return t.name});n.exit().remove(),n.enter().append("g").merge(n).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",o._fill||t.color).style("stroke",o._stroke||t.color).style("stroke-width",o._strokeWidth).attr("cx",function(t){return r(t.name)+r.bandwidth()/2||0}).attr("cy",function(t){return l(t.value)||0}).attr("r",o._radius).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)});for(var s=t.selectAll(".clip-scatter-plot").nodes(),u=0;u<s.length;u++)""==s[u].__data__.value||isNaN(s[u].__data__.value)?d3.select(s[u]).style("opacity","0"):d3.select(s[u]).style("opacity","1")}else if(2==o._moveOptions.indexOf(o._moveStyle)){var h=o._lineFunc||d3.line().x(function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2}).y(function(t){return o._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});h.curve(o._curve),t.selectAll("path").remove();var c=t.selectAll("path").data(a,function(t){return t.key});c.exit().remove();var _=c.enter().append("path").merge(c).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",o._lineWidth).style("stroke-dasharray",o._strokeDasharry).attr("d",function(t){return h(t.data)}).style("opacity",0);o._interrupt?_.style("opacity",1):_.transition().delay(function(t,e){return 0==e?o._transition?o._startDelay+.2*o._duration:0:e*(o._transition?.7*o._duration/a.length:0)+(o._transition?o._startDelay+.2*o._duration:0)}).duration(o._transition?.7*o._duration/a.length:0).style("opacity",1);var d=t.append("g").selectAll("g").data(a,function(t){return t.name});d.exit().remove(),d.enter().append("g").merge(d).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var i=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",o._fill||t.color).style("stroke",o._stroke||t.color).style("stroke-width",o._strokeWidth).attr("r",o._radius).attr("cx",function(t){return r(t.name)+r.bandwidth()/2||0}).attr("cy",function(t){return l.range()[0]});o._interrupt?i.attr("cy",function(t){return l(t.value)||0}):i.transition().duration(o._transition?.2*o._duration:0).delay(o._transition?o._startDelay:0).ease(d3.easeLinear).attr("cy",function(t){return l(t.value)||0}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)});for(var y=t.selectAll(".clip-scatter-plot").nodes(),f=0;f<y.length;f++)""==y[f].__data__.value||isNaN(y[f].__data__.value)?d3.select(y[f]).style("opacity","0"):d3.select(y[f]).style("opacity","1")}else if(1==o._moveOptions.indexOf(o._moveStyle)){t.selectAll("g").remove();var p=o._lineFunc||d3.line().x(function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2}).y(function(t){return o._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});p.curve(o._curve),t.selectAll("path").remove();var v=t.selectAll("path").data(a,function(t){return t.key});v.exit().remove();var g=v.enter().append("path").merge(v).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",o._lineWidth).style("stroke-dasharray",o._strokeDasharry).attr("d",function(t){return p(t.data)});o._interrupt?g.attr("stroke-dasharray",o._strokeDasharry):g.transition().duration(o._transition?.9*o._duration:0).delay(o._transition?o._startDelay:0).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}),t.selectAll("g").remove();var S=t.append("g").selectAll("g").data(a,function(t){return t.name});S.exit().remove(),S.enter().append("g").merge(S).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var i=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",o._fill||t.color).style("stroke",o._stroke||t.color).style("stroke-width",o._strokeWidth).attr("cx",function(t){return r(t.name)+r.bandwidth()/2||0}).attr("cy",function(t){return l(t.value)||0});o._interrupt?i.attr("r",o._radius):i.transition().duration(o._transition?.9*o._duration:0).delay(o._transition?o._startDelay:0).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,o._radius);return function(t){return e(t)}}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)});for(var x=t.selectAll(".clip-scatter-plot").nodes(),m=0;m<x.length;m++)""==x[m].__data__.value||isNaN(x[m].__data__.value)?d3.select(x[m]).style("opacity","0"):d3.select(x[m]).style("opacity","1")}else if(0==o._moveOptions.indexOf(o._moveStyle)){t.selectAll("g").remove();var k=o._lineFunc||d3.line().x(function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2}).y(function(t){return o._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});k.curve(o._curve),t.selectAll("path").remove();var b=t.selectAll("path").data(a,function(t){return t.key});b.exit().remove();var w=b.enter().append("path").merge(b).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",o._lineWidth).style("stroke-dasharray",o._strokeDasharry);o._interrupt?w.attr("d",function(t){return k(t.data)}).attr("stroke-dasharray",o._strokeDasharry):w.transition().delay(function(t,e){return o._transition?o._startDelay+e*(.9*o._duration/a.length):0}).duration(0).attr("d",function(t){return k(t.data)}).ease(d3.easeLinear).transition().duration(o._transition?.9*o._duration/a.length:0).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}),t.selectAll("g").remove();var C=t.append("g").selectAll("g").data(a,function(t){return t.name});C.exit().remove(),C.enter().append("g").merge(C).each(function(t,i){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var n=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",o._fill||t.color).style("stroke",o._stroke||t.color).style("stroke-width",o._strokeWidth).attr("cx",function(t){return r(t.name)+r.bandwidth()/2||0}).attr("cy",function(t){return l(t.value)||0});o._interrupt?n.attr("r",o._radius):n.transition().duration(o._transition?.9*o._duration/a.length:0).delay(function(t,e){return o._transition?o._startDelay+i*(.9*o._duration/a.length):0}).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,o._radius);return function(t){return e(t)}}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)});for(var O=t.selectAll(".clip-scatter-plot").nodes(),F=0;F<O.length;F++)""==O[F].__data__.value||isNaN(O[F].__data__.value)?d3.select(O[F]).style("opacity","0"):d3.select(O[F]).style("opacity","1")}return o}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),Bt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","line-scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var i=this,t=i.group,e=i._data,n=i._xScale,o=i._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return n(t.name)+n.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",i._fill||t.color).style("stroke",i._stroke||t.color).style("stroke-width",i._strokeWidth).attr("r",i._radius).attr("cx",function(t){return n(t.name)+n.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return i}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}();function Yt(t,e){var i=0,n=!1,o=[];if(e.forEach(function(t){"timeColUni"===t.function?(i=t.index,n=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),M(t,[i],2))return[];for(var a=R(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var y=0;y<c[0];y++)h.push(isNaN(parseFloat(a[d][y])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(n){for(var f=[],p=1;p<s;p++)f.push(a[p].length);f.sort(function(t,e){return e-t});for(var v=1;v<s;v++){var g=a[v],S=g[i];if(""!=S&&null!=S&&null!=S||(S="$-"+v),S){for(var x={name:S,showLegend:S!="$-"+v,data:[]},m=0;m<f[0];m++){var k=u[m];""!=k&&null!=k&&null!=k||(k="&-"+m),m!==i&&x.data.push({name:k,showAxisText:k!="&-"+m,value:g[m]})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var C=1;C<b[0];C++)if(C!==i){var O=u[C];""!=u[C]&&null!=u[C]&&null!=u[C]||(O="$-"+C),r[O+"-"+C]={name:O,showLegend:O!="$-"+C,data:[]}}for(var F=1;F<s;F++){var P=a[F],W=P[i];if(""!=W&&null!=W&&null!=W||(W="&-"+F),W)for(var A=0;A<b[0];A++){var z=u[A];""!=u[A]&&null!=u[A]&&null!=u[A]||(z="$-"+A),A!==i&&z&&r[z+"-"+A].data.push({name:W,showAxisText:W!="&-"+F,value:P[A]})}}for(var L in r)l.push(r[L])}return l.forEach(function(t,e){t.key=T(t.name)+"-"+e}),l}var Ht=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.grid=new nt(e.coreGroup),e.linePlot=new Gt(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new ht(e.mainGroup),e.overlay=new gt(e.coreGroup),e.guideLine=new Nt(e.coreGroup),e.guideScatter=new Bt(e.coreGroup),e.stackText=new Tt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveCardinal,e._lineWidth=2,e._strokeWidth=1,e._strokeColor="#FFFFFF",e._fillColor="",e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["依次绘制","同时绘制","穿针引线"],e._moveStyle="穿针引线",e._endPause=0,e._interrupt=!1,e}return u(i,$),r(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=i.grid,e=i.linePlot,n=(i.scatterPlot,i.clipArea),l=i.tooltip,o=i.overlay,s=i.guideLine,u=i.guideScatter,a=i.stackText,h=i.xScale,c=i.yScale,_=i.widthOfCore,d=i.heightOfCore,y=(Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0),i.defs);y.selectAll("filter").remove();var f=y.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_line").attr("filterUnits","objectBoundingBox");f.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),f.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),f.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),f.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),f.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.width(_).height(d).planeX(h.range()[0]).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(0==i._yDomain[0]?i.yAxis.tickLocations.slice(1):i.yAxis.tickLocations).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),e.data(r).xScale(h).yScale(c).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(i._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt).curve(i._curve).radius(i._endPointRadius).stroke(i._strokeColor).fill(i._fillColor).lineWidth(i._lineWidth).strokeWidth(i._strokeWidth),s.y1(0).y2(d).stroke("#c6c6c6").strokeDasharray("0 0"),u.xScale(h).yScale(c).radius(i._endPointRadius).fill(i._strokeColor).stroke(i._fillColor).strokeWidth(i._strokeWidth),o.data(h.domain()).isScalePoint(!1).bandX(h.range()[0]).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show(),s.x(0).update().show(),i.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(h(n)+h.bandwidth()/2)+",0)"),u.data(a).update().show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide(),u.hide()}),a.data(r).xScale(h).yScale(c).type("mix").fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt),i.coreGroup.call(z,i.yAxis.width+.5,0),0!=i._clipShow.length?(n.width(_).height(d).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url("+x("#"+n.id)+")")):(n.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),n.update(),u.elem.style("pointer-events","none");var p=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),o.update(),t.update(),e.update(),a.update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=0==e.lineWidth||e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear,this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._strokeWidth=0==e.endPointBorderWidth||e.endPointBorderWidth?e.endPointBorderWidth:this._strokeWidth,this._strokeColor=e.endPointBorderColor?rt(e.endPointBorderColor):null,this._fillColor=e.endPointFillColor?rt(e.endPointFillColor):null)}},{key:"buildOption",value:function(t,e){var i=new b(t,e),n=Yt;return i.dataSolveFunc(n),i}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),i}(),Vt=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","bee-line-chart"),e._showPoints=!1,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._strokeColor="#fff",e._fillColor="",e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["依次绘制","同时绘制","穿针引线"],e._moveStyle="同时绘制",e._endPause=0,e}return u(i,Ht),r(i,[{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=0==e.lineWidth||e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear,this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._strokeWidth=0==e.endPointBorderWidth||e.endPointBorderWidth?e.endPointBorderWidth:this._strokeWidth,this._strokeColor=e.endPointBorderColor?rt(e.endPointBorderColor):null,this._fillColor=e.endPointFillColor?rt(e.endPointFillColor):null)}}]),i}();var Et=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-line-circle-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._fill=null,e._lineWidth=2,e._strokeWidth=1,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var n=this,i=n._data,o=n._xScale,a=n._yScale,t=n.group;if(t.selectAll("*").remove(),n._interrupt?t.style("opacity",1):t.style("opacity",0).transition().duration(0).delay(n._transition?n._startDelay:0).style("opacity",1),null==n._moveStyle||0==n._transition||-1==n._moveOptions.indexOf(n._moveStyle)){t.selectAll("g").remove();var e=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});e.curve(n._curve),t.selectAll("path").remove();var r=t.selectAll("path").data(i,function(t){return t.key});r.exit().remove();r.enter().append("path").merge(r).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return e(t.data)});t.selectAll("g").remove();var l=t.append("g").selectAll("g").data(i,function(t){return t.name});l.exit().remove(),l.enter().append("g").merge(l).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("cx",function(t){return o(t.name)+o.bandwidth()/2||0}).attr("cy",function(t){return a(t.value)||0}).attr("r",n._radius).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var s=t.selectAll(".clip-scatter-plot").nodes(),u=0;u<s.length;u++)""==s[u].__data__.value||isNaN(s[u].__data__.value)?d3.select(s[u]).style("opacity","0"):d3.select(s[u]).style("opacity","1")}else if(0==n._moveOptions.indexOf(n._moveStyle)){t.selectAll("g").remove();var h=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});h.curve(n._curve),t.selectAll("path").remove();var c=t.selectAll("path").data(i,function(t){return t.key});c.exit().remove();var _=c.enter().append("path").merge(c).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return h(t.data)});n._interrupt?_.attr("stroke-dasharray",n._strokeDasharry):_.transition().duration(n._transition?.9*n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}),t.selectAll("g").remove();var d=t.append("g").selectAll("g").data(i,function(t){return t.name});d.exit().remove(),d.enter().append("g").merge(d).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var i=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("cx",function(t){return o(t.name)+o.bandwidth()/2||0}).attr("cy",function(t){return a(t.value)||0});n._interrupt?i.transition().duration(0).delay(0).ease(d3.easeLinear).attr("r",n._radius).on("start",n._onTransitionStart).on("end",n._onTransitionEnd):i.transition().duration(n._transition?.9*n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,n._radius);return function(t){return e(t)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var y=t.selectAll(".clip-scatter-plot").nodes(),f=0;f<y.length;f++)""==y[f].__data__.value||isNaN(y[f].__data__.value)?d3.select(y[f]).style("opacity","0"):d3.select(y[f]).style("opacity","1")}else if(1==n._moveOptions.indexOf(n._moveStyle)){var p=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});p.curve(n._curve),t.selectAll("path").remove();var v=t.selectAll("path").data(i,function(t){return t.key});v.exit().remove();var g=v.enter().append("path").merge(v).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return p(t.data)}).style("opacity",0);n._interrupt?g.style("opacity",1):g.transition().delay(function(t,e){return 0==e?n._transition?n._startDelay+.2*n._duration:0:e*(n._transition?.7*n._duration/i.length:0)+(n._transition?n._startDelay+.2*n._duration:0)}).duration(n._transition?.7*n._duration/i.length:0).style("opacity",1);var S=t.append("g").selectAll("g").data(i,function(t){return t.name});S.exit().remove(),S.enter().append("g").merge(S).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove();var i=e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("r",n._radius).attr("cx",function(t){return o(t.name)+o.bandwidth()/2||0}).attr("cy",function(t){return a.range()[0]});n._interrupt?i.transition().duration(0).delay(0).ease(d3.easeLinear).attr("cy",function(t){return a(t.value)||0}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd):i.transition().duration(n._transition?.2*n._duration:0).delay(n._transition?n._startDelay:0).ease(d3.easeLinear).attr("cy",function(t){return a(t.value)||0}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var x=t.selectAll(".clip-scatter-plot").nodes(),m=0;m<x.length;m++)""==x[m].__data__.value||isNaN(x[m].__data__.value)?d3.select(x[m]).style("opacity","0"):d3.select(x[m]).style("opacity","1")}return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=t,this):this._moveStyle}},{key:"moveOptions",value:function(t){return arguments.length?(this._moveOptions=t,this):this._moveOptions}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}(),It=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-line-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return u(i,A),r(i,[{key:"update",value:function(){var n=this,t=n._data,e=n.group,o=n._xScale,a=n._yScale;e.selectAll("*").remove(),e.selectAll("filter").remove();var i=n._defs.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_simpleLine").attr("filterUnits","objectBoundingBox");i.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),i.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),i.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),i.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),i.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var r=e.selectAll("g").data(t,function(t){return t.name});r.exit().remove(),r.enter().append("g").attr("class","simple-text-group").merge(r).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove();var i=e.enter().append("text").attr("x",function(t){return o(t.name)+("mix"==n._type?o.bandwidth()/2:0)||0}).attr("y",function(t){return a(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t){return o(t.name)+("mix"==n._type?o.bandwidth()/2:0)||0}).attr("y",function(t){return a(t.value)||0}).attr("text-anchor","middle").style("display",n._labelShow?"block":"none");n._interrupt?i.style("opacity",1):i.style("opacity",0).interrupt().transition().duration(n._transition?.1*n._duration:0).delay(n._transition?.9*n._duration+n._startDelay:0).style("opacity",1)}),null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".simple-text-group text").style("display","none"):0==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".simple-text-group text").attr("dy",.4*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)&&e.selectAll(".simple-text-group text").attr("dy",1.3*n._fontSize);for(var l=e.selectAll(".simple-text-group text"),s=[],u=[],h=0;h<l._groups[0].length;h++){u.push(h);for(var c=h+1;c<l._groups[0].length;c++){ft(dt(d3.select(l._groups[0][h])),dt(d3.select(l._groups[0][c])))&&(s.push(h),d3.select(l._groups[0][h]).style("visibility","hidden"))}}for(var _=new Set(s),d=Array.from(_),y=function(t,e){for(var i=e,n=[],o=t.concat(i),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&n.push(Number(l));return n}(d,u),f=0;f<d.length;f++){for(var p=[],v=0;v<y.length;v++){var g=dt(d3.select(l._groups[0][d[f]])),S=dt(d3.select(l._groups[0][y[v]]));if(p.push(ft(g,S)),ft(g,S)){if(d[f]==y[v])continue;d3.select(l._groups[0][d[f]]).style("visibility","hidden")}}0==p.filter(function(t){return 1==t}).length&&y.push(d[f])}for(var x=0;x<y.length;x++)d3.select(l._groups[0][y[x]]).style("visibility","visible");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"interrupt",value:function(t){return arguments.length?(this._interrupt=t,this):this._interrupt}}]),i}();function $t(t,e){var i=0,n=1;if(e.forEach(function(t){"objCol"===t.function?(i=t.index,t.isLegend):"vCol"===t.function&&(n=t.index)}),M(t,[i,n])||!y(t,n))return[];var o={},a=[],r=t.length,l=t[0][n];""!=l&&null!=l&&null!=l||(l="$-0"),o[l]={name:l,showLegend:"$-0"!=l,data:[]};for(var s=0,u=1;u<r;u++){var h=t[u],c=h[i];if(""!=c&&null!=c&&null!=c||(c="&-"+u),c){var _=l;1==u?s=isNaN(parseFloat(t[1][n]))?0:parseFloat(t[1][n]):s+=isNaN(parseFloat(h[n]))?0:parseFloat(h[n]),o[_].data.push({name:c,showAxisText:c!="&-"+u,value:""==h[n]||isNaN(parseFloat(h[n]))||null==h[n]||null==h[n]?0:h[n],total:s})}}for(var d in o)a.push(o[d]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Ut=function(t){function i(t){a(this,i);var e=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.elem.attr("class","simple-line-chart"),e.grid=new nt(e.coreGroup),e.linePlot=new Et(e.coreGroup),e.clipArea=new ot(e.defs),e.xAxis=new J(e.mainGroup),e.yAxis=new ht(e.mainGroup),e.overlay=new gt(e.coreGroup),e.guideLine=new Nt(e.coreGroup),e.guideScatter=new Bt(e.coreGroup),e.SimpleLineText=new It(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._strokeColor="#fff",e._fillColor="",e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveOptions=["同时绘制","穿针引线"],e._moveStyle="",e._endPause=0,e._interrupt=!1,e}return u(i,$),r(i,[{key:"updateCore",value:function(){var i=this,r=i.activeData,t=i.grid,e=i.linePlot,n=i.clipArea,l=i.tooltip,o=i.overlay,s=i.guideLine,u=i.guideScatter,a=i.SimpleLineText,h=i.xScale,c=i.yScale,_=i.widthOfCore,d=i.heightOfCore;Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);t.width(_).height(d).planeX(h.range()[0]).xTickLocations(i.xAxis.tickLocations.slice(1)).yTickLocations(i.yAxis.tickLocations.slice(1)).showX(i._gridShowX).showY(i._gridShowY).stroke(i._gridStroke).strokeDasharray(i._gridStrokeDasharray).gridLineWidth(i._gridLineWidth),e.data(r).xScale(h).yScale(c).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).curve(i._curve).radius(i._endPointRadius).stroke(i._strokeColor).fill(i._fillColor).lineWidth(i._lineWidth).strokeWidth(i._strokeWidth).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveOptions(i._moveOptions).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt),s.y1(0).y2(d).stroke("#c6c6c6").strokeDasharray("0 0"),u.xScale(h).yScale(c).radius(i._endPointRadius).fill(i._strokeColor).stroke(i._fillColor).strokeWidth(i._strokeWidth),o.data(h.domain()).isScalePoint(!1).bandX(h.range()[0]).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var n=t,o=[{text:n=="&-"+(e+1)?"":n}],a=[];r.forEach(function(t,e){var i=t.data.filter(function(t){return t.name===n});a.push({key:t.key,name:t.name,color:t.color,data:i}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(i[0].value))?"":i[0].value),color:t.color})}),l.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show(),s.x(0).update().show(),i.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(h(n)+h.bandwidth()/2)+",0)"),u.data(a).update().show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide(),u.hide()}),a.data(r).xScale(h).yScale(c).type("mix").defs(i.defs).fontSize(i._textLabel.fontSize).fontColor(rt(i._textLabel.color)).fontFamily(i._textLabel.fontFamily).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).interrupt(i._interrupt),i.coreGroup.call(z,i.yAxis.width+.5,0),0!=i._clipShow.length?(n.width(_).height(d).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","url("+x("#"+n.id)+")")):(n.width(i._width).height(i._height).paddingVertical([0,0]).transition(i._transition).duration(i._duration),i.coreGroup.attr("clip-path","")),n.update(),u.elem.style("pointer-events","none");var y=i.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(y).remove(),o.update(),t.update(),e.update(),a.update()}},{key:"onInterruptChange",value:function(t){this._interrupt=!0,this.updateCore()}},{key:"configLegend",value:function(){var t=this,n=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(n).onClick(function(e){var i=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",i).style("opacity",i?.5:1),n.forEach(function(t){t.key===e.key&&(t.active=!i)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var i=new b(t,e),n=$t;return i.dataSolveFunc(n),i}},{key:"setSelfOption",value:function(t){var e=t.display,i=t.label,n=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n?n.duration:this._duration,this._startDelay=n?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?rt(o.color):this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?rt(a.color):this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(i).length&&(this._labelShow=i?i.display:this._labelShow,this._positionChoice=i.positionChoice?i.positionChoice:this._positionChoice,this._textLabel=i.textLabel?i.textLabel:this._textLabel);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=0==e.lineWidth||e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear,this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._strokeWidth=0==e.endPointBorderWidth||e.endPointBorderWidth?e.endPointBorderWidth:this._strokeWidth,this._strokeColor=e.endPointBorderColor?rt(e.endPointBorderColor):null,this._fillColor=e.endPointFillColor?rt(e.endPointFillColor):null)}}]),i}(),Zt=new Date;Zt.toLocaleDateString(),console.log("【d3Chart】 update"+Zt),t.BeeLineChart=Vt,t.GroupedBarChart=Ct,t.GroupedHorizontalBarChart=Ft,t.GroupingBubbleChart=at,t.MixLineBarChart=Xt,t.QuarterRoseChart=H,t.SimpleBarChart=ct,t.SimpleLineChart=Ut,t.StackBarChart=mt,t.StackHorizontalBarChart=bt,t.WaveCircleChart=W,t.setUserMd=function(t){window.userId=t},Object.defineProperty(t,"__esModule",{value:!0})});
