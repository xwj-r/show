!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).d3Chart={})}(this,function(t){"use strict";function D(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2*Math.PI,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0,o=t,a=e,r=n;Math.abs(r-a-2*Math.PI)<=1e-5&&(r-=1e-5);var l=Math.cos(a-Math.PI/2)*o,s=Math.sin(a-Math.PI/2)*o,u=Math.cos(r-Math.PI/2)*o,h=Math.sin(r-Math.PI/2)*o,c=0,_=1;function d(){return o+" "+o+" 0 "+c+" "+_+" "}return Math.abs(r-a)>=Math.PI&&(c=1),void 0!==i?_=isNaN(Number(i))?1:Number(i):void 0===i&&(r+a)/2>Math.PI/2&&(r+a)/2<Math.PI/2*3&&(_=0),_?"M"+l+" "+s+"A"+d()+" "+u+" "+h:"M"+u+" "+h+"A"+d()+" "+l+" "+s}function st(t){return"none"!==t.style("display")?t.node().getBBox():{x:0,y:0,width:0,height:0}}function e(t){t.style("display","block")}function n(t){t.style("display","none")}function G(t,e,n){t.attr("transform","translate("+e+","+n+")")}function i(t){var e=t+Math.floor(1e9*Math.random()).toString(32)+Date.now().toString(32);return null==document.getElementById(e)?e:i(t)}function O(t){return t.filter(function(t){return!1!==t.active})}function L(t,e,n,i){var o=Math.min(t,e)/2,a=t/2,r=e/2,l=0;if(Math.abs(i-n)<=Math.PI/2){var s=Math.min(i,n),u=Math.max(i,n);o=Math.min(t,e),0<=s&&u<=Math.PI/2?(a=(t-o)/2,r=(e-o)/2+o,l=1):s>=Math.PI/2&&u<=Math.PI?(a=(t-o)/2,r=(e-o)/2,l=2):s>=Math.PI&&u<=3*Math.PI/2?(a=(t-o)/2+o,r=(e-o)/2,l=3):s>=3*Math.PI/2&&u<=2*Math.PI&&(a=(t-o)/2+o,r=(e-o)/2+o,l=4)}return{radius:o,cx:a,cy:r,quadrant:l}}function p(t){var e=t.split(/[\-\/]/);if(3!==e.length)return t;if(e[0].length<4){var n=d3.range(4-e[0].length).map(function(){return 0}).join("");e[0]=n+e[0]}return 1===e[1].length&&(e[1]="0"+e[1]),1===e[2].length&&(e[2]="0"+e[2]),e.join("-")}function S(t,e){var n=window.location.href;return void 0===e&&(e=!/\/#\//.test(n)),e?n+t:t}function M(t,e){var n=/[^\u4e00-\u9fa5\w-]/gi;return e=null==e||n.test(e)?"-":e,t.toString().replace(n,e)}function l(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.abs(parseFloat(t))||e}function lt(t){for(var e=t.x,n=void 0===e?0:e,i=t.y,o=void 0===i?0:i,a=t.width,r=void 0===a?100:a,l=t.height,s=void 0===l?100:l,u=t.cornerRadius,h=void 0===u?0:u,c=t.roundCorners,_=void 0===c?[0,1,2,3]:c,d=n,f=o,y=n+r,p=o+s,v=Math.min(Math.min(r,s)/2,h),g=v+" "+v+" 0 0 1",m=["L"+d+" "+f,"L"+y+" "+f,"L"+y+" "+p,"L"+d+" "+p],x=["A"+g+" "+(d+v)+" "+f,"A"+g+" "+y+" "+(f+v),"A"+g+" "+(y-v)+" "+p,"A"+g+" "+d+" "+(p-v)],S=[],k=0;k<=3;k++){var b=_.includes(k)?x[k]:m[k];S.push(b)}return"\n    M"+d+" "+(f+v)+"\n    "+S[0]+"\n    H"+(y-v)+"\n    "+S[1]+"\n    V"+(p-v)+"\n    "+S[2]+"\n    H"+(d+v)+"\n    "+S[3]+"\n    Z\n  "}function ut(t,e){var n=t.x,i=t.y,o=t.x+t.width,a=t.y+t.height,r=e.x,l=e.y,s=e.x+e.width,u=e.y+e.height;return!(s<n||o<r||u<i||a<l)}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,i)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(i):void 0},h=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},o=function(){function t(){r(this,t),this.elem=null,this._pos=[0,0],this._show=!0,this.id=i("")}return s(t,[{key:"update",value:function(){}},{key:"show",value:function(){return e(this.elem),this._show=!0,this}},{key:"hide",value:function(){return n(this.elem),this._show=!1,this}},{key:"width",value:function(){return st(this.elem).width}},{key:"height",value:function(){return st(this.elem).height}},{key:"translate",value:function(t,e){return arguments.length?(this.pos=[t,e],G(this.elem,t,e),this):this.pos}},{key:"isShow",get:function(){return this._show}}]),t}();function W(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];return!e.length||e[0].length<(n||2)||t.some(function(t){return void 0===e[0][t]})}function C(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return t.slice(1).some(function(t){return!isNaN(parseFloat(t[e]))})}function a(t,e){var o=0,a=1;if(e.forEach(function(t){"objCol"===t.function?o=t.index:"vCol"===t.function&&(a=t.index)}),W(t,[o,a])||!C(t,a))return[];var r=[],l=t[0][o],s=t[0][a];return t.slice(1).forEach(function(t,e){var n=parseFloat(t[a]);if(!isNaN(n)){var i=t[o];""!=t[o]&&null!=t[o]&&null!=t[o]||(i="$-"+e),r.push({name:i,showLegend:i!="$-"+e,value:+t[a],nameLabel:l,valueLabel:s})}}),r.forEach(function(t,e){t.key=M(t.name)+"-"+e}),r}function R(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(1===e.length)return t;var n=e.filter(function(t){return"objCol"===t.function||"vCol"===t.function&&t.configurable}).map(function(t){return t.index});return t.map(function(t){return t.filter(function(t,e){return 0<=n.indexOf(e)})})}function _(t,e){var n=0,i=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(n=t.index,i=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[n],2))return[];for(var a=R(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var f=0;f<c[0];f++)h.push(isNaN(parseFloat(a[d][f])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(i){for(var y=[],p=1;p<s;p++)y.push(a[p].length);y.sort(function(t,e){return e-t});for(var v=1;v<s;v++){var g=a[v],m=g[n];if(""!=m&&null!=m&&null!=m||(m="$-"+v),m){for(var x={name:m,showLegend:m!="$-"+v,data:[]},S=0;S<y[0];S++){var k=u[S];""!=k&&null!=k&&null!=k||(k="&-"+S),S!==n&&x.data.push({name:k,showAxisText:k!="&-"+S,value:""==g[S]||isNaN(parseFloat(g[S]))||null==g[S]||null==g[S]?0:g[S],tooltipValueShow:!isNaN(parseFloat(g[S]))})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var F=1;F<b[0];F++)if(F!==n){var O=u[F];""!=u[F]&&null!=u[F]&&null!=u[F]||(O="$-"+F),r[O+"-"+F]={name:O,showLegend:O!="$-"+F,data:[]}}for(var C=1;C<s;C++){var A=a[C],P=A[n];if(""!=P&&null!=P&&null!=P||(P="&-"+C),P)for(var z=0;z<b[0];z++){var D=u[z];""!=u[z]&&null!=u[z]&&null!=u[z]||(D="$-"+z),z!==n&&D&&r[D+"-"+z].data.push({name:P,showAxisText:P!="&-"+C,value:""==A[z]||isNaN(parseFloat(A[z]))||null==A[z]||null==A[z]?0:A[z],tooltipValueShow:!isNaN(parseFloat(A[z]))})}}for(var L in r)l.push(r[L])}return l.forEach(function(t,e){t.key=M(t.name)+"-"+e}),l}function N(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:12,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"sans-serif",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"50%",r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"middle",l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"...",s=t.append("text").style("text-anchor",r).style("font-size",i+"px").style("font-family",o).attr("dy","0.35em");return s.append("textPath").attr("startOffset",a).attr("xlink:href",function(){return"#"+e.attr("id")}).text(function(){var t=e.node().getTotalLength();return I(n,t,i,o,l)}),s}function E(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";if(!t.toString||!t)return 0;var i=d3.select("defs");i.empty()&&(i=d3.select("svg").append("defs"));var o=i.append("text").style("font-size",e+"px").style("font-family",n).text(t.toString()),a=o.node().getComputedTextLength();return o.remove(),a}function ht(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sans-serif";return Math.ceil(d3.max(t,function(t){return E(t,e,n)}))}function I(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"sans-serif",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"...";if(E(t,n,i)<=e)return t;if(E(o,n,i)>=e)return"";for(var a=t.toString().split(""),r=a.length,l="",s=0;s<r;s++)if(E((l+=a[s])+o,n,i)>e)return 0===s?"":l.slice(0,s)+o}var y="legend-group",v=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","legend"),e.group=e.elem.append("g"),e._data=[],e._shapeType="circle",e._shapeWidth=12,e._shapeHeight=12,e._shapeStroke="none",e._rowGap=6,e._colGap=20,e._innerGap=6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._limitedWidth=400,e._horizontalAlign="center",e._onClick=function(){},e._each=function(){},e._orient="horizontal",e}return h(n,o),s(n,[{key:"update",value:function(){var o=this,a=o.group,r=Math.max(o._shapeHeight,o._fontSize),l=o._limitedWidth-o._shapeWidth-o._innerGap,s=0,u=0;o.elem.selectAll("."+y).remove();var h=a.append("g").attr("class",y);o._data.forEach(function(t){var e=I(t.name?t.name:"",l,o._fontSize,o._fontFamily),n=o._shapeWidth+o._innerGap+E(e,o._fontSize,o._fontFamily);if("vertical"===o._orient)o._legendItem(t,h,0,u),u=u+r+o._rowGap;else{var i=s+n+o._colGap;i>o._limitedWidth&&(s=0,i=n+o._colGap,u+=r+o._rowGap,h=a.append("g").attr("class",y)),o._legendItem(t,h,s,u),s=i}});var t=st(a).width;return"center"===o._horizontalAlign?a.call(G,o._limitedWidth/2-t/2,0):"left"===o._horizontalAlign?a.call(G,0,0):"right"===o._horizontalAlign&&a.call(G,o._limitedWidth-t,0),o}},{key:"_shapeElem",value:function(t){var e=void 0;return(e="rect"===this._shapeType?t.append("rect").attr("width",this._shapeWidth).attr("height",this._shapeHeight):t.append("circle").attr("cx",this._shapeWidth/2).attr("cy",this._shapeHeight/2).attr("r",Math.min(this._shapeWidth,this._shapeHeight)/2)).attr("class","legend-shape"),e}},{key:"_legendItem",value:function(t,e,n,i){var o=e.append("g").datum(t).attr("class","legend-item").call(G,n,i).on("click",this._onClick).each(this._each);return this._shapeElem(o).style("fill",t.color),o.append("text").attr("x",this._shapeWidth+this._innerGap).attr("y",this._shapeHeight/2).attr("dy","0.35em").style("text-anchor","start").style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("fill",this._fontColor).text(I(t.name?t.name:"",this._limitedWidth-this._shapeWidth-this._innerGap,this._fontSize,this._fontFamily)),o}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"shapeType",value:function(t){return arguments.length?(this._shapeType=t,this):this._shapeType}},{key:"shapeWidth",value:function(t){return arguments.length?(this._shapeWidth=t,this):this._shapeWidth}},{key:"shapeHeight",value:function(t){return arguments.length?(this._shapeHeight=t,this):this._shapeHeight}},{key:"rowGap",value:function(t){return arguments.length?(this._rowGap=t,this):this._rowGap}},{key:"colGap",value:function(t){return arguments.length?(this._colGap=t,this):this._colGap}},{key:"innerGap",value:function(t){return arguments.length?(this._innerGap=t,this):this._innerGap}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"onClick",value:function(t){return arguments.length?(this._onClick=t,this):this._onClick}},{key:"each",value:function(t){return arguments.length?(this._each=t,this):this._each}}]),n}(),m=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(n,o),s(n,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),n}(),x=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(n,o),s(n,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),n}(),k=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("text"),e._text="",e._fontSize=24,e._fontFamily="noto",e._fontWeight="normal",e._color="#000",e._textAnchor="middle",e._dy="1em",e}return h(n,o),s(n,[{key:"update",value:function(){var t=this;return t.elem.attr("dy",t._dy).style("fill",t._color).style("font-size",t._fontSize+"px").style("font-family",t._fontFamily).style("font-weight",t._fontWeight).style("text-anchor",t._textAnchor).text(t._text),t}},{key:"text",value:function(t){return arguments.length?(this._text=t,this):this._text}},{key:"color",value:function(t){return arguments.length?(this._color=t,this):this._color}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontWeight",value:function(t){return arguments.length?(this._fontWeight=t,this):this._fontWeight}},{key:"textAnchor",value:function(t){return arguments.length?(this._textAnchor=t,this):this._textAnchor}},{key:"dy",value:function(t){return arguments.length?(this._dy=t,this):this._dy}}]),n}(),b=function(t){function i(t){r(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this)),n=t._groups?t:d3.select(t);return e.elem=n.append("div").attr("class","chart-tooltip").style("position","absolute").style("pointer-events","none").style("-moz-user-select","none").style("-webkit-user-select","none").style("-ms-user-select","none").style("user-select","none"),"static"!=n.style("position")&&"initial"!=n.style("position")||n.style("position","relative"),e._data=[],e._x=0,e._y=0,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#fff",e._backgroundColor="rgba(0,0,0,0.7)",e._borderRadius=5,e._padding={top:5,right:8,bottom:5,left:8},e._textAlign="left",e._locked=!1,e._scale=1,e._scaleValue=1,e}return h(i,o),s(i,[{key:"update",value:function(){var t=this,e=t._fontSize;if(t._locked)return t;t._scaleValue="function"==typeof t._scale?t._scale():t._scale,t.elem.style("background-color",t._backgroundColor).style("border-radius",t._borderRadius+"px").style("font-size",e+"px").style("font-family",t._fontFamily).style("color",t._fontColor).style("text-align",t._textAlign).style("padding",t._padding.top+"px "+t._padding.right+"px "+t._padding.bottom+"px "+t._padding.left+"px");var n=t.elem.selectAll("div").data(t._data);n.exit().remove();var i=n.enter().append("div").attr("class","tooltip-row").style("white-space","nowrap");i.append("span").attr("class","tooltip-color-circle"),i.append("span").attr("class","tooltip-text");var o=i.merge(n);return o.select(".tooltip-color-circle").style("width","0px").style("height","0px").style("border-radius","50%").style("display","inline-block").style("margin","0px").style("vertical-align","middle").filter(function(t){return t.color}).style("width",e+"px").style("height",e+"px").style("background-color",function(t){return t.color}).style("margin-right","3px"),o.select(".tooltip-text").text(function(t){return t.text}).style("vertical-align","middle"),this}},{key:"move",value:function(t){var e=this;if(e._locked||!e.isShow)return e;var n=e._scaleValue||1,i=0,o=0,a=e.elem,r=a.node().parentNode,l=a.node().getBoundingClientRect(),s=r.getBoundingClientRect(),u=t||d3.mouse(r);return o=u[0]+l.width+8>s.width?u[0]-a.node().offsetWidth-8:u[0]+8,i=u[1]+l.height+5>s.height?u[1]-a.node().offsetHeight-0:u[1]+0,a.transition().duration(10).style("top",i/n+"px").style("left",o/n+"px"),e}},{key:"show",value:function(){return this._locked||(e(this.elem),this._show=!0),this}},{key:"hide",value:function(){return this._locked||(n(this.elem),this._show=!1),this}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"lock",value:function(t){return arguments.length?(this._locked=t,this):this._locked}},{key:"scale",value:function(t){return arguments.length?(this._scale=t,this):this._scale}}]),i}();function w(t,n){return t.forEach(function(t,e){t.color=n[e],t.color_special=n[e+1]}),t}var F=function(){function n(t,e){r(this,n),this._blockData=t,this._projectTheme=e,this._dataSrc=t.dataSrc,this._blockTheme=t.theme,this._props=t.props,this._columnMap=this._props.map,this._legend=this._props.legend,this._font=this._props.font,this._axis=this._props.axis,this._title=this._props.titleDisplay,this._label=this._props.label,this._display=this._props.display,this._animation=this._props.animation,this._unitDisplay=this._props.unitDisplay,this._sourceDisplay=this._props.sourceDisplay,this._dataSolveFunc=a}return s(n,[{key:"dataSolveFunc",value:function(t){return arguments.length&&"function"==typeof t?(this._dataSolveFunc=t,this):this._dataSolveFunc}},{key:"generateColorList",value:function(t){var e,n,i,o=this._props.colors.type,a=(e=this._props.colors.list,n=this._blockData,i=this._projectTheme,e.map(function(t){return function(t,e,n){var i=void 0;if("number"==typeof t){var o=e.theme&&e.theme.colors;i=o&&o[t%o.length]||n&&n.colors[t]||"#000"}else i=t;return i}(t,n,i)}));if(!t)return a;var r=a;switch(o){case"linear":var l=a.slice(0,2),s=d3.scaleLinear().domain([0,t-1]).range(l);r=d3.range(t).map(function(t,e){return s(e)});break;case"single":r=d3.range(t).map(function(){return a[0]});break;default:if(r=a.slice(0),a.length<t)for(var u=a.length;r.push(a[u%a.length]),++u<t;);}return r}},{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]);return w(t,this.generateColorList(t.length))}},{key:"dataType",get:function(){var t="2d";if("cross-table"===this._dataSrc.dataType)t="cross-table";else{var e=this._dataSrc.data;t=e[1]?"2sheet":e[0].length+"d"}return t}},{key:"width",get:function(){return parseFloat(this._props.size.width)-2}},{key:"height",get:function(){return parseFloat(this._props.size.height)-2}},{key:"font",get:function(){return{fontSize:this._font.fontSize||this._blockData.theme.fonts.fontSize||12,color:this._font.color||this._blockData.theme.fonts.fontColor||"#000",fontFamily:this._font.fontFamily||this._blockData.theme.fonts.fontFamily||"sans-serif"}}},{key:"display",get:function(){return Object.assign({},this._props.display)}},{key:"animation",get:function(){return Object.assign({},this._props.animation)}},{key:"unitDisplay",get:function(){return Object.assign({},this._props.unitDisplay)}},{key:"sourceDisplay",get:function(){return Object.assign({},this._props.sourceDisplay)}},{key:"legend",get:function(){return{show:!1!==this._legend.show,xPosition:this._legend.xPosition,yPosition:this._legend.yPosition}}},{key:"tooltipShow",get:function(){return this._props.tooltip}},{key:"axis",get:function(){return{color:this._axis.color||this._blockTheme.axis.color,x:this._axis.x,y:this._axis.y,y1:this._axis.y1}}},{key:"label",get:function(){return Object.assign({},this._props.label)}},{key:"grid",get:function(){var t=this._axis.grid;return{showX:null==t?null:"all"===t.show||"x"===t.show,showY:null==t?null:"all"===t.show||"y"===t.show,color:null==t?null:t.color||this._blockTheme.grid&&this._blockTheme.grid.color||"#ccc"}}},{key:"backgroundColor",get:function(){return this._props.backgroundColor||"transparent"}},{key:"colors",get:function(){return this._props.colors}},{key:"title",get:function(){var t=this._title||{};return{show:!1!==t.show,text:t.text||"",xPosition:t.xPosition||"center",yPosition:t.yPosition||"top",fontSize:t.fontSize||24,color:t.color||"#000",fontFamily:t.fontFamily||"noto"}}}]),n}(),A=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t._groups?t.append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"):d3.select(t).append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("version","1.1"),e.defs=e.elem.append("defs"),e.group=e.elem.append("g").attr("class","svg-group"),e.mainGroup=e.group.append("g").attr("class","main-group"),e.title=new m(e.group),e.unitText=new x(e.group),e.sourceText=new k(e.group),e.legend=new v(e.group),e.tooltip=new b(t),e.labelTextClass="chart-label-text",e._data=[],e._width=400,e._height=400,e._backgroundColor=null,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._transition=!0,e._duration=500,e._legendShow=!0,e._legendX="center",e._legendY="bottom",e._titleShow=!0,e._titleText="",e._titleX="center",e._titleY="top",e._titleFontSize=24,e._titleColor="#000",e._titleFontFamily="sans-serif",e._marginTop=20,e._marginRight=24,e._marginBottom=18,e._marginLeft=24,e._gapPadding=10,e._titlePadding=10,e._unitPadding=15,e._sourcePadding=10,e._sortValue=0,e._sortedDataCopy=null,e._dataType="2d",e._tooltipShow=!0,e}return h(n,o),s(n,[{key:"_init",value:function(){var t=window.location.hostname,e="U2FsdGVkX1/u6EfnJcBwjl1lkrkHd1SLbqY/JBKMPPGUREtzJjAbYQ==";if(null==window.userId){e=t;var n=locked(t);"421aa90e079fa326b6494f812ad13e79"!=n&&"e5a748477660158b28c438af2cee80f6"!=n&&"31c49882abd53548158d8da55e154557"!=n||this.update()}else{var i=locked(e);window.userId==i&&this.update()}return String.prototype.cestqui=function(){return e},this}},{key:"update",value:function(){return this._marginBottom=this._sourceWord&&this._sourceShow?20:18,this.styleSvg(),this.sortData(),this.removeLabelText(),this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateLegend(),this.updateCore(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateTitle",value:function(){var t=this,e=t.title;if(!t._titleShow)return e.hide();var n="center"===t._titleX?"middle":"left"===t._titleX?"start":"end";t._titleText=I(null==t._titleText?"":t._titleText,t.widthOfNoMargin-t._titleFontSize,t._titleFontSize,t._titleFontFamily),e.text(t._titleText).color(t._titleColor).fontSize(t._titleFontSize).fontFamily(t._titleFontFamily).fontWeight("bold").textAnchor(n).dy("1em"),e.update(),e.show()}},{key:"updateUnit",value:function(){var t=this,e=t.unitText;if(!t._unitShow)return e.hide();var n="center"===t._unitX?"middle":"left"===t._unitX?"start":"end";e.text(t._unitWord).color(t._unitFontColor).fontSize(t._unitFontSize).fontFamily(t._unitFontFamily).textAnchor(n).dy("1em"),e.update(),e.show()}},{key:"updateSource",value:function(){var t=this,e=t.sourceText;if(!t._sourceShow)return e.hide();var n="center"===t._sourceX?"middle":"left"===t._sourceX?"start":"end";e.text(t._sourceWord).color(t._sourceFontColor).fontSize(t._sourceFontSize).fontFamily(t._sourceFontFamily).textAnchor(n).dy("1em"),e.update(),e.show()}},{key:"updateLegend",value:function(){var t=this,e=t.legend,n=this._width-this._marginLeft-this._marginRight;if(!t._legendShow)return e.hide();e.show(),e.limitedWidth(n).fontSize(t._fontSize).fontFamily(t._fontFamily).fontColor(t._fontColor).horizontalAlign(t._legendX).each(function(t){var e=!1===t.active;d3.select(this).classed("clicked",e).style("opacity",e?.5:1)}),this.configLegend(),e.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy;t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"updateCore",value:function(){}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateCore()}},{key:"removeLabelText",value:function(){this.elem.selectAll("."+this.labelTextClass).remove()}},{key:"styleSvg",value:function(){this.elem.attr("width",this._width).attr("height",this._height).style("background-color",this._backgroundColor).style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("user-select","none"),this.group.call(G,this._marginLeft,this._marginTop)}},{key:"layout",value:function(){var t=this.title,e=this.unitText,n=this.sourceText,i=this.legend,o=this.mainGroup,a=t.height(),r=e.height(),l=(n.height(),i.height()),s=this.heightOfMainGroup,u=this._titleText&&this._titleShow?this._titlePadding:0,h=this._unitWord&&this._unitShow?this._unitPadding:0,c=this._sourceWord&&this._sourceShow?this._sourcePadding:0,_=this._legendShow&&0!=l?this._gapPadding:0,d="top",f="bottom",y=this._titleY,p=this._legendY;y!==d&&y!==f&&(y=d),p!==d&&p!==f&&(p=f);var v=0,g=0,m=0,x=0,S=0;y===d&&p===d?(v=0,m=(S=(x=(g=a+u)+r+h)+l+_)+s+c):y===f&&p===f?(g=0,m=(v=(x=(S=r+h)+s+_)+l+u)+a+c):y===d&&p===f?(v=0,m=(x=(S=(g=a+u)+r+h)+s+_)+l+c):(x=0,m=(v=(S=(g=l+_)+r+h)+s+u)+a+c);var k=this._width-this._marginLeft-this._marginRight,b="center"===this._titleX?k/2:"left"===this._titleX?0:k,w="center"===this._unitX?k/2:"left"===this._unitX?0:k,F="center"===this._sourceX?k/2:"left"===this._sourceX?0:k;t.translate(b,v),e.translate(w,g),n.translate(F,m),i.translate(0,x),o.call(G,0,S),0==this._marginLeft&&(b="center"===this._titleX?(this._width-24-this._marginRight)/2+24:"left"===this._titleX?24:k,w="center"===this._unitX?(this._width-24-this._marginRight)/2+24:"left"===this._unitX?24:k,F="center"===this._sourceX?(this._width-24-this._marginRight)/2+24:"left"===this._sourceX?24:k,t.translate(b,v),e.translate(w,g),n.translate(F,m),"left"===this._legendX?i.translate(24,x):"center"===this._legendX&&i.translate(12,x))}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"backgroundColor",value:function(t){return arguments.length?(this._backgroundColor=t,this):this._backgroundColor}},{key:"legendShow",value:function(t){return arguments.length?(this._legendShow=t,this):this._legendShow}},{key:"legendX",value:function(t){return arguments.length?(this._legendX=t,this):this._legendX}},{key:"legendY",value:function(t){return arguments.length?(this._legendY=t,this):this._legendY}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"gapPadding",value:function(t){return arguments.length?(this._gapPadding=parseFloat(t),this):this._gapPadding}},{key:"unitPadding",value:function(t){return arguments.length?(this._unitPadding=parseFloat(t),this):this._unitPadding}},{key:"sourcePadding",value:function(t){return arguments.length?(this._sourcePadding=parseFloat(t),this):this._sourcePadding}},{key:"marginTop",value:function(t){return arguments.length?(this._marginTop=parseFloat(t),this):this._marginTop}},{key:"marginRight",value:function(t){return arguments.length?(this._marginRight=parseFloat(t),this):this._marginRight}},{key:"marginBottom",value:function(t){return arguments.length?(this._marginBottom=parseFloat(t),this):this._marginBottom}},{key:"marginLeft",value:function(t){return arguments.length?(this._marginLeft=parseFloat(t),this):this._marginLeft}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"sortValue",value:function(t){return arguments.length?(this._sortValue=parseFloat(t),this):this._sortValue}},{key:"dataType",value:function(t){return arguments.length?(this._dataType=t,this):this._dataType}},{key:"tooltipShow",value:function(t){return arguments.length?(this._tooltipShow=t,this):this._tooltipShow}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"titleText",value:function(t){return arguments.length?(this._titleText=t,this):this._titleText}},{key:"titleColor",value:function(t){return arguments.length?(this._titleColor=t,this):this._titleColor}},{key:"titleFontSize",value:function(t){return arguments.length?(this._titleFontSize=t,this):this._titleFontSize}},{key:"titleFontFamily",value:function(t){return arguments.length?(this._titleFontFamily=t,this):this._titleFontFamily}},{key:"titleX",value:function(t){return arguments.length?(this._titleX=t,this):this._titleX}},{key:"titleY",value:function(t){return arguments.length?(this._titleY=t,this):this._titleY}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"colors",value:function(t){return arguments.length?(this._colors=t,this):this._colors}},{key:"sortData",value:function(){var t=this._data.slice(0),e=this._sortValue,n=this._dataType,i=t.map(function(t){return t.color}),o=void 0;"cross-table"===n?(t.forEach(function(t){t.sum=d3.sum(t.data,function(t){return t.value})}),o=1===e?function(t,e){return t.sum-e.sum}:-1===e?function(t,e){return e.sum-t.sum}:null):o=1===e?function(t,e){return t.value-e.value}:-1===e?function(t,e){return e.value-t.value}:null,this._sortedDataCopy=o?t.sort(o).map(function(t,e){return t.color=i[e],t}):t}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=a;switch(n.dataType){case"cross-table":i=_;break;default:i=a}return n.dataSolveFunc(i),n}},{key:"setPublicOption",value:function(t){this.data(t.data).backgroundColor(t.backgroundColor).width(t.width).height(t.height).colorList(t._blockTheme.colors).colors(t.colors),this.fontFamily(t.font.fontFamily).fontSize(t.font.fontSize).fontColor(t.font.color),this.titleShow(t.title.show).titleText(t.title.text).titleColor(t.title.color).titleFontFamily(t.title.fontFamily).titleFontSize(t.title.fontSize).titleX(t.title.xPosition).titleY(t.title.yPosition),this.legendShow(t.legend.show).legendX(t.legend.xPosition).legendY(t.legend.yPosition),this.tooltipShow(t.tooltipShow),this.dataType(t.dataType)}},{key:"setSelfOption",value:function(t){}},{key:"setOption",value:function(t,e,n){var i=this.buildOption(t,e);this.setPublicOption(i),this.setSelfOption(i),this._init()}},{key:"widthOfNoMargin",get:function(){var t=this._width-this._marginLeft-this._marginRight;return 0<t?t:0}},{key:"heightOfNoMargin",get:function(){var t=this._height-this._marginTop-this._marginBottom;return 0<t?t:0}},{key:"heightOfMainGroup",get:function(){var t=this._titleText&&this._titleShow?this.title.height()+this._titlePadding:0,e=this._unitWord&&this._unitShow?this.unitText.height()+this._unitPadding:0,n=this._sourceWord&&this._sourceShow?this.sourceText.height()+this._sourcePadding:0,i=this._legendShow?this.legend.height()+(0==this.legend.height()?0:this._gapPadding):0,o=this.heightOfNoMargin-i-t-e-n;return 0<o?o:0}},{key:"activeData",get:function(){return O(this.sortedDataCopy)}},{key:"sortedDataCopy",get:function(){return this._sortedDataCopy}}]),n}(),P=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g"),e.group=e.elem.append("g"),e._data=[],e._transition=!0,e._duration=300,e._onTransitionStart=function(){},e._onTransitionEnd=function(){},e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(n,o),s(n,[{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"onTransitionStart",value:function(t){return arguments.length?(this._onTransitionStart="function"==typeof t?t:function(){},this):this._onTransitionStart}},{key:"onTransitionEnd",value:function(t){return arguments.length?(this._onTransitionEnd="function"==typeof t?t:function(){},this):this._onTransitionEnd}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),n}(),z=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","pie"),e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._innerRadius=0,e._outerRadius=0,e._startAngle=0,e._endAngle=2*Math.PI,e._cornerRadius=0,e._padAngle=.01,e._padRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._innerRadiusRatio=.75,e._sortMethod=null,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this;o._data;o.arcFunc.innerRadius(o._innerRadius).outerRadius(o._outerRadius).cornerRadius(o._cornerRadius).padAngle(o._padAngle).padRadius(o._padRadius),o.pieFunc.value(function(t){return Math.abs(t.value)}).startAngle(o._startAngle).endAngle(o._endAngle).sort(o._sortMethod);var t=o.pieFunc(o._data);o.group.selectAll(".pie-path").remove();var e=o.group.selectAll("path").data(t);if(e.exit().remove(),e.merge(e.enter().append("path")).attr("class","pie-path").style("stroke",o._areaBorderColor).style("stroke-width",o._areaBorderWidth).style("fill",function(t){return t.data.color}).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).transition().duration(o._transition?o._duration:0).ease(d3.easeLinear).attrTween("d",function(n){var i=d3.interpolateNumber(o._innerRadius,o._outerRadius);return function(t){var e=i(t);return o.arcFunc.outerRadius(e),o.arcFunc(n)}}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd),o.group.selectAll(".pie-texts").remove(),o.group.selectAll(".pie-percents").remove(),o.group.selectAll(".pie-numbers").remove(),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||null==o._contentOption||null==o._contentChoice||0==o._positionOptions.indexOf(o._positionChoice)||2==o._positionOptions.indexOf(o._positionChoice)||-1==o._positionOptions.indexOf(o._positionChoice)||0==o._contentChoice.length)o.group.selectAll(".pie-texts text").style("display","none"),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none");else if(1==o._positionOptions.indexOf(o._positionChoice)){var n=o.group.append("g").selectAll("g").data(t);n.exit().remove(),n.enter().append("g").attr("class","pie-text-groups").merge(n).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-1.3*o._fontSize}).style("opacity",function(){return"$-"==t.data.name.slice(0,2)?0:1}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",o._fontColor).attr("font-size",o._fontSize).attr("font-family",o._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+1.3*o._fontSize})}),1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),o.group.selectAll(".pie-texts text").style("display","none"),o.group.selectAll(".pie-numbers text").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),o.group.selectAll(".pie-percents text").style("display","none"),o.group.selectAll(".pie-texts text").style("display","none")):2==o._contentChoice.length&&(0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(o.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-percents text").style("display","none")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(o.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-o._fontSize/1.7}),o.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+o._fontSize/1.7}),o.group.selectAll(".pie-texts text").style("display","none")))}o.group.selectAll(".pie-text-groups").style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(function(t,e){return o._duration?o._startDelay+.9*o._duration:0}).style("opacity",1);for(var i=o.group.selectAll(".pie-text-groups"),a=[],r=[],l=0;l<i._groups[0].length;l++){r.push(l);for(var s=l+1;s<i._groups[0].length;s++){ut(st(d3.select(i._groups[0][l])),st(d3.select(i._groups[0][s])))&&(a.push(l),d3.select(i._groups[0][l]).style("visibility","hidden"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(i._groups[0][h[_]])),p=st(d3.select(i._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(i._groups[0][h[_]]).style("visibility","hidden")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(i._groups[0][c[v]]).style("visibility","visible");function g(t){var e=.7*o._outerRadius,n=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(n)*e,Math.sin(n)*e]}return o}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),T=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","outside-text-polygon"),e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._innerRadius=0,e._outerRadius=0,e._startAngle=0,e._endAngle=2*Math.PI,e._cornerRadius=0,e._padAngle=0,e._padRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._sortMethod=null,e._type="normal",e._areaType="normal",e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,t=d3.max(o._data,function(t){return Math.abs(t.value)}),e=o._outerRadius,i=d3.scaleLinear().domain([0,t]).range([0,e]),n=o.group;"normal"==o._type?o.pieFunc.value(function(t){return+t.value}).startAngle(o._startAngle).endAngle(o._endAngle).sort(o._sortMethod):o.pieFunc.value(1).startAngle(o._startAngle).endAngle(o._endAngle).sort(o._sortMethod);var a=o.pieFunc(o._data);function r(t){return t.startAngle+(t.endAngle-t.startAngle)/2}function l(t){var e="normal"==o._type?o._outerRadius:i(Math.abs(t.data.value)),n=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(n)*e,Math.sin(n)*e]}n.selectAll(".half-texts").remove(),n.selectAll(".half-percent").remove(),n.selectAll(".half-numbers").remove(),n.selectAll("g").remove();var s=n.append("g").selectAll("g").data(a);s.exit().remove(),s.enter().append("g").attr("class","pie-texts").merge(s).each(function(t,e){d3.select(this).append("g").attr("class","half-texts").append("text").text(t.data.name).attr("dy","-0.6em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).style("opacity",function(){return"$-"==t.data.name.slice(0,2)?0:1}).transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var e=n(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}}),d3.select(this).append("g").attr("class","half-percent").append("text").text(t.data.percent+"%").attr("dy","0.4em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var e=n(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}}),d3.select(this).append("g").attr("class","half-numbers").append("text").text(t.data.value).attr("dy","1.4em").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t){var e=l(t);return"normal"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1):"half"==o._areaType?1.2*e[0]+.1*o._outerRadius*(r(t)<0?-1:1):void 0}).attr("y",function(t){return 1.2*l(t)[1]}).transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).styleTween("text-anchor",function(t){this._current=this._current||t;var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){var e=n(t);return"normal"==o._areaType?r(e)<Math.PI||r(e)==Math.PI?"start":"end":"half"==o._areaType?0<r(e)||0==r(e)?"start":"end":void 0}})}).transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).attr("x",function(t){return 1.2*l(t)[0]+.1*o._outerRadius*(r(t)>Math.PI?-1:1)}).attr("y",function(t){return 1.2*l(t)[1]});var u=o.group.selectAll("polyline").data(a);u.exit().remove(),u.merge(u.enter().append("polyline")).style("stroke",function(t){return t.data.color}).style("fill","none").transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).attrTween("points",function(t){this._current=this._current||t;var i=d3.interpolate(this._current,t);return this._current=i(0),function(t){var e=i(t),n=l(e);return"normal"==o._areaType?[n,1.2*n[0],1.2*n[1],1.2*n[0]+.1*o._outerRadius*(r(e)>Math.PI?-1:1),1.2*n[1]]:"half"==o._areaType?[n,1.2*n[0],1.2*n[1],1.2*n[0]+.1*o._outerRadius*(r(e)<0?-1:1),1.2*n[1]]:void 0}});n.selectAll(".half-texts text").nodes(),n.selectAll(".half-percent text").nodes(),n.selectAll(".half-numbers text").nodes(),n.selectAll("polyline").nodes();0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length||-1==o._positionOptions.indexOf(o._positionChoice)?(n.selectAll(".half-texts text").style("display","none"),n.selectAll(".half-percent text").style("display","none"),n.selectAll(".half-numbers text").style("display","none"),n.selectAll("polyline").style("display","none")):0!=o._positionOptions.indexOf(o._positionChoice)&&2!=o._positionOptions.indexOf(o._positionChoice)||(1==o._contentChoice.length?0==o._contentOption.indexOf(o._contentChoice[0])?(n.selectAll(".half-texts text").style("display","block").attr("dy","0.3em"),n.selectAll(".half-percent text").style("display","none"),n.selectAll(".half-numbers text").style("display","none"),n.selectAll("polyline").style("display","block")):1==o._contentOption.indexOf(o._contentChoice[0])?(n.selectAll(".half-percent text").style("display","block").attr("dy","0.3em"),n.selectAll(".half-texts text").style("display","none"),n.selectAll(".half-numbers text").style("display","none"),n.selectAll("polyline").style("display","block")):2==o._contentOption.indexOf(o._contentChoice[0])&&(n.selectAll(".half-numbers text").style("display","block").attr("dy","0.3em"),n.selectAll(".half-percent text").style("display","none"),n.selectAll(".half-texts text").style("display","none"),n.selectAll("polyline").style("display","block")):2==o._contentChoice.length&&(0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(n.selectAll(".half-texts text").style("display","block").attr("dy","-0.1em"),n.selectAll(".half-percent text").style("display","block").attr("dy","0.9em"),n.selectAll(".half-numbers text").style("display","none"),n.selectAll("polyline").style("display","block")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(n.selectAll(".half-texts text").style("display","block").attr("dy","-0.1em"),n.selectAll(".half-numbers text").style("display","block").attr("dy","0.9em"),n.selectAll(".half-percent text").style("display","none"),n.selectAll("polyline").style("display","block")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(n.selectAll(".half-percent text").style("display","block").attr("dy","-0.1em"),n.selectAll(".half-numbers text").style("display","block").attr("dy","0.9em"),n.selectAll(".half-texts text").style("display","none"),n.selectAll("polyline").style("display","block")))),n.selectAll(".pie-texts").style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(function(t,e){return o._duration?o._startDelay+.9*o._duration:0}).style("opacity",1),n.selectAll("polyline").style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(function(t,e){return o._duration?o._startDelay+.9*o._duration:0}).style("opacity",1);for(var h=n.selectAll(".pie-texts"),c=n.selectAll("polyline"),_=[],d=[],f=0;f<h._groups[0].length;f++){d.push(f);for(var y=f+1;y<h._groups[0].length;y++){ut(st(d3.select(h._groups[0][f])),st(d3.select(h._groups[0][y])))&&(_.push(f),d3.select(h._groups[0][f]).style("visibility","hidden"),d3.select(c._groups[0][f]).style("visibility","hidden"))}}for(var p=new Set(_),v=Array.from(p),g=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(v,d),m=0;m<v.length;m++){for(var x=[],S=0;S<g.length;S++){var k=st(d3.select(h._groups[0][v[m]])),b=st(d3.select(h._groups[0][g[S]]));if(x.push(ut(k,b)),ut(k,b)){if(v[m]==g[S])continue;d3.select(h._groups[0][v[m]]).style("visibility","hidden"),d3.select(c._groups[0][v[m]]).style("visibility","hidden")}}0==x.filter(function(t){return 1==t}).length&&g.push(v[m])}for(var w=0;w<g.length;w++)d3.select(h._groups[0][g[w]]).style("visibility","visible"),d3.select(c._groups[0][g[w]]).style("visibility","visible");return o}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"values",value:function(t){return arguments.length?(this._values=t,this):this._values}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"areaType",value:function(t){return arguments.length?(this._areaType=t,this):this._areaType}},{key:"level",value:function(t){return arguments.length?(this._level=t,this):this._level}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),j=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","round-corner-donut-chart"),e.core=e.pie=new z(e.mainGroup),e.lineText=new T(e.mainGroup),e._innerRadius=0,e._padAngle=.01,e._startAngle=0,e._endAngle=2*Math.PI,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=10,e._areaBorderColor="#fff",e._areaBorderWidth=0,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var r=this,o=r.pie,t=r.lineText,e=r.widthOfNoMargin,n=(r.legend.height(),[]),i=0;i<r.activeData.length;i++)n.push(r.activeData[i].name);ht(n,r._fontSize,r._fontFamily);var a=.74*r.heightOfMainGroup,l=.74*r.widthOfNoMargin;null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._contentChoice.length?(a=.88*r.heightOfMainGroup,l=.88*r.widthOfNoMargin):0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(a=.88*r.heightOfMainGroup,l=.88*r.widthOfNoMargin);for(var s=r._startAngle,u=r._endAngle,h=L(l,a,s,u),c=h.radius,_=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*c:0),d=[],f=0;f<r.activeData.length;f++)d.push(r.activeData[f].value);for(var y=0,p=0;p<r.activeData.length;p++)y+=r.activeData[p].value;for(var v=0;v<r.activeData.length;v++)r.activeData[v].percent=(r.activeData[v].value/y*100).toFixed(1);var g=r.defs;g.selectAll("filter").remove();var m=g.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_roundDonut").attr("filterUnits","objectBoundingBox");m.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),m.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),m.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),m.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),m.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).startAngle(s).endAngle(u).padAngle(r._padAngle).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onTransitionEnd(function(t,e){var n=d3.select(this.parentNode),i="arc-path-"+t.data.key.replace(/\s*/g,"")+"-"+r.id,o=D((_+c)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+i).empty()?r.defs.append("path").attr("d",o).attr("id",i):r.defs.select("#"+i).attr("d",o);0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._positionOptions.indexOf(r._positionChoice)||0==r._contentChoice.length?r.group.selectAll(".chart-label-text").style("display","none"):1==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,t.data.name=="$-"+e?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):1==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentOption.indexOf(r._contentChoice[0])&&N(n,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&N(n,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve")),r.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(r._transition?1e3*r._duration*.1:0).style("opacity",1)}).onMouseover(function(i,t){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(c,1.05*c);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}});var e=[{text:""+(i.data.name=="$-"+t?"":i.data.name),color:i.data.color},{text:i.data.valueLabel+": "+i.data.value}];r.tooltip.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(i){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(1.05*c,c);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}}),r.tooltip.hide()});var x=h.cx+(e-l)/2,S=r.heightOfMainGroup/2;null!=r._labelShow&&(0!=r._labelShow&&0==r._positionOptions.indexOf(r._positionChoice)?(t.data(r.activeData).innerRadius(_).outerRadius(c).cornerRadius(r._cornerRadius).startAngle(s).endAngle(u).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(d).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause),r.lineText.translate(x||0,S).update(),r.group.select(".outside-text-polygon").attr("display","block")):0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||r.group.select(".outside-text-polygon").attr("display","none")),r.pie.translate(x||0,S).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}}]),n}(),Y=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","pie-chart"),e.core=e.pie=new z(e.mainGroup),e.lineText=new T(e.mainGroup),e._innerRadius=0,e._cornerRadius=null,e._padAngle=0,e._startAngle=0,e._endAngle=2*Math.PI,e._marginTop=20,e._marginRight=24,e._marginBottom=20,e._marginLeft=24,e._gapPadding=10,e._labelRadiusRatio=.8,e._innerRadiusRatio=null,e._areaBorderWidth=1,e._areaBorderColor="#fff",e._labelShow=!1,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部径向",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var r=this,o=r.pie,t=r.lineText,e=r.widthOfNoMargin,n=(r.legend.height(),[]),i=0;i<r.activeData.length;i++)n.push(r.activeData[i].name);var a=ht(n,r._fontSize,r._fontFamily),l=.74*r.heightOfMainGroup,s=.88*r.widthOfNoMargin-2*a;null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||0==r._contentChoice.length?(l=.88*r.heightOfMainGroup,s=.88*r.widthOfNoMargin):0!=r._labelShow&&0!=r._positionOptions.indexOf(r._positionChoice)&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(l=.88*r.heightOfMainGroup,s=.88*r.widthOfNoMargin);for(var u=r._startAngle,h=r._endAngle,c=L(s,l,u,h),_=c.radius,d=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*_:0),f=[],y=0;y<r.activeData.length;y++)f.push(r.activeData[y].value);for(var p=0,v=0;v<r.activeData.length;v++)p+=r.activeData[v].value;for(var g=0;g<r.activeData.length;g++)r.activeData[g].percent=(r.activeData[g].value/p*100).toFixed(1);var m=r.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});m.unshift(m[m.length-1]),m.pop(m[m.length-1]);var x=r.defs;x.selectAll("filter").remove();var S=x.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_pie").attr("filterUnits","objectBoundingBox");S.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),S.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),S.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),S.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),S.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(m).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).innerRadius(d).outerRadius(_).cornerRadius(r._cornerRadius).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).startAngle(u).endAngle(h).padAngle(r._padAngle).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onTransitionEnd(function(t,e){var n=d3.select(this.parentNode),i="arc-path-"+t.data.key.replace(/\s*/g,"")+"-"+r.id,o=D((d+_)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+i).empty()?r.defs.append("path").attr("d",o).attr("id",i):r.defs.select("#"+i).attr("d",o);0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice||1==r._positionOptions.indexOf(r._positionChoice)||2==r._positionOptions.indexOf(r._positionChoice)||0==r._contentChoice.length?r.group.selectAll(".chart-label-text").style("display","none"):0==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,"$-"==t.data.name.slice(0,2)?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):1==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentOption.indexOf(r._contentChoice[0])&&N(n,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&N(n,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&N(n,a,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily,"52%").attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve")),r.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(r._transition?1e3*r._duration*.1:0).style("opacity",1)}).onMouseover(function(i,t){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(_,1.05*_);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}});var e=[{text:""+("$-"==i.data.name.slice(0,2)?"":i.data.name),color:i.data.color},{text:i.data.valueLabel+": "+i.data.value}];r.tooltip.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(i){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(1.05*_,_);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}}),r.tooltip.hide()});var k=c.cx+(e-s)/2,b=r.heightOfMainGroup/2;if(null!=r._labelShow)if(0!=r._labelShow&&2==r._positionOptions.indexOf(r._positionChoice)){var w=r.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});w.unshift(w[w.length-1]),w.pop(w[w.length-1]),t.data(w).innerRadius(d).outerRadius(_).cornerRadius(r._cornerRadius).startAngle(u).endAngle(h).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(f).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause),r.lineText.translate(k||0,b).update(),r.group.selectAll(".outside-text-polygon").attr("display","block")}else 0!=r._labelShow&&0!=r._positionOptions.indexOf(r._positionChoice)&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||r.group.selectAll(".outside-text-polygon").attr("display","none");r.pie.translate(k||0,b).update()}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY)}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}}]),n}(),X=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._padAngle=.01,e._labelRadiusRatio=.8,e._labelRadiusRatio=.8,e._innerRadiusRatio=null,e._areaBorderWidth=1,e._areaBorderColor="#fff",e._cornerRadius=10,e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,Y),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}}]),n}(),B=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","wave-circle"),e.group=e.elem.append("g"),e._outerDonut=e.group.append("path"),e._innerCircle=e.group.append("circle"),e._textElem=e.group.append("text"),e._clipTextElem=e.group.append("text"),e._waveClip=e.group.append("defs").append("clipPath"),e._waveClipPath=e._waveClip.append("path"),e._radius=50,e._value=60,e._clipId=i("wave-clip"),e._waveCount=3,e._waveColor="#178BCA",e._outerCircleColor=null,e._minValue=0,e._maxValue=100,e._circleThickness=.05,e._circleFillGap=.05,e._waveHeightRatio=.05,e._waveRiseTime=1500,e._waveAnimateTime=1500,e._waveRise=!0,e._textSize=.5,e._textSuffix="%",e._textColor="#045681",e._waveTextColor="#A4DBf8",e}return h(n,o),s(n,[{key:"update",value:function(){for(var i=this,t=i._radius,e=i._radius,n=i._circleThickness*i._radius,o=i._circleFillGap*i._radius,a=i._radius-n-o,r=i._textSize*i._radius,l=2*i._radius/i._waveCount,s=i._waveCount+1,u=l*s,h=i._waveHeightRatio*i._radius,c=(1-(Number(i.value)<i._minValue?i._minValue:Number(i.value)>i._maxValue?i._maxValue:Number(i.value))/(i._maxValue-i._minValue))*i._radius*2,_=[],d=0;d<100;d++){var f=d*(s*Math.PI*2)/100,y=Math.sin(f);_.push({x:f,y:y})}var p,v,g=d3.scaleLinear().domain([0,2*Math.PI*s]).range([0,u]),m=d3.scaleLinear().domain([-1,1]).range([0,h]),x=d3.area().x(function(t){return g(t.x)}).y0(function(t){return m(t.y)}).y1(function(t){return 2*i._radius});return i._waveClip.attr("id",i._clipId).call(G,0,c),i._waveClipPath.datum(_).attr("d",x),i._outerDonut.attr("d",d3.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(i._radius-n).outerRadius(i._radius)).style("fill",i._outerCircleColor||i._waveColor).call(G,t,e),i._innerCircle.attr("cx",t).attr("cy",e).attr("r",a).style("fill",i._waveColor).attr("clip-path","url("+S("#"+i._clipId)+")"),i._textElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",i._textColor).text(i.value+i._textSuffix),i._clipTextElem.attr("x",t).attr("y",e).attr("text-anchor","middle").attr("font-size",r+"px").attr("dy","0.35em").style("fill",i._waveTextColor).text(i.value+i._textSuffix).attr("clip-path","url("+S("#"+i._clipId)+")"),p=d3.transition().duration(i._transition?i._duration:0).delay(i._transition?i._startDelay:0).ease(d3.easeLinear),v=function(){var e=this,n=d3.interpolate(i._minValue,i.value);return function(t){e.textContent=d3.format("d")(n(t))+i._textSuffix}},i._waveClip.call(G,0,2*i._radius).transition(p).call(G,0,c),i._textElem.text("0"+i._textSuffix).transition(p).tween("text",v),i._clipTextElem.text("0"+i._textSuffix).transition(p).tween("text",v),function t(){i._waveClipPath.attr("transform","translate("+(-u+2*i._radius)+",0)").transition().duration(i._waveAnimateTime).ease(d3.easeLinear).attr("transform","translate(0,0)").on("end",t)}(),i.elem.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),i}},{key:"value",value:function(t){return arguments.length?(this.value=t,this):this.value}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"waveColor",value:function(t){return arguments.length?(this._waveColor=t,this):this._waveColor}},{key:"waveCount",value:function(t){return arguments.length?(this._waveCount=t,this):this._waveCount}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),H=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","wave-circle-chart"),e._circleMargin=2,e._labelMargin=2,e._maxCountOfOneLine=5,e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=1.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var i=this,t=i.activeData,e=t.length,o=i.widthOfNoMargin,n=i.heightOfMainGroup,a=Math.min(i._maxCountOfOneLine,e),r=Math.ceil(e/a),l=o/a,s=n/r,u=1.2*i.fontSize()+2*i._labelMargin,h=s-u,c=(Math.min(l,h)-2*i._circleMargin)/2,_=i.defs;_.selectAll("filter").remove();var d=_.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_wave_circles").attr("filterUnits","objectBoundingBox");d.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blurredAlpha"),d.append("feOffset").attr("in","blurredAlpha").attr("dx",0).attr("dy",1).attr("result","offsetBlurredAlpha"),d.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),d.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),d.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var f=i.mainGroup.selectAll("g.wave-circle-item").data(t,function(t){return t.name});if(f.exit().remove(),t.length){var y=f.enter().append("g").attr("class","wave-circle-item");y.append("g"),y.append("text").attr("class",i.labelTextClass);var p=y.merge(f);p.select("g").call(G,i._circleMargin+l/2-c,i._circleMargin+h/2-c).each(function(t,e){d3.select(this).selectAll("*").remove();var n=new B(d3.select(this));n.radius(c).waveColor(t.color).value(t.value).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).onMouseover(function(t,e){var n=[{text:t.name+": "+t.value+"%",color:t.color}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){i.tooltip.hide()}),n.update()}),p.select("."+this.labelTextClass).call(G,l/2,2*i._circleMargin+h/2+c+i._labelMargin).attr("dy","0.85em").style("text-anchor","middle").style("fill",i._fontColor).text(function(t){return t.showLegend?I(t.name,l,i._fontSize,i._fontFamily):""});var v=e%a,g=(Math.ceil(e/a)-1)*a;p.attr("transform",function(t,e){var n=e%a*l,i=Math.floor(e/a)*s;return v&&g<=e&&(n=o/v*(e%a+.5)-c),"translate("+n+","+i+")"})}}},{key:"removeLabelText",value:function(){}},{key:"maxCountOfOneLine",value:function(t){return arguments.length?(this._maxCountOfOneLine=t,this):this._maxCountOfOneLine}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e.transition||0==e.transition?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}}]),n}(),V=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rose-pie"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n._startAngle,i=n._endAngle,o=d3.max(t,function(t){return Math.abs(t.value)}),a=n._radius,r=d3.scaleLinear().domain([0,o]).range([n._innerRadius,a]),l=n.arcFunc.innerRadius(n._innerRadius).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(n._cornerRadius),s=n.pieFunc.value(1).startAngle(e).endAngle(i).sort(n._sortMethod);n.group.selectAll("g.arc-group").remove();var u=n.group.selectAll("g.arc-group").data(s(t));u.exit().remove();var h=u.enter().append("g").attr("class","arc-group");if(h.append("path"),u.merge(h).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).select("path").style("stroke",n._stroke).style("stroke-width",n._strokeWidth).transition().duration(n._transition?.9*n._duration:0).delay(n._transition?n._startDelay+.1*n._duration:0).ease(d3.easeCubicOut).attrTween("d",function(n){var i=d3.interpolateNumber(0,r(Math.abs(n.data.value)));return function(t){var e=i(t);return l.outerRadius(e),l(n)}}).style("fill",function(t){return t.data.color}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd),n.group.selectAll(".pie-texts").remove(),n.group.selectAll(".pie-percents").remove(),n.group.selectAll(".pie-numbers").remove(),0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||null==n._contentOption||null==n._contentChoice||0==n._positionOptions.indexOf(n._positionChoice)||2==n._positionOptions.indexOf(n._positionChoice)||-1==n._positionOptions.indexOf(n._positionChoice)||0==n._contentChoice.length)n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none");else if(1==n._positionOptions.indexOf(n._positionChoice)){var c=n.group.append("g").selectAll("g").data(s(t));c.exit().remove(),c.enter().append("g").attr("class","pie-text-groups").merge(c).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-1.3*n._fontSize}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+1.3*n._fontSize})}),1==n._contentChoice.length?0==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-texts text").style("display","none")):2==n._contentChoice.length&&(0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","none")):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","none")):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-texts text").style("display","none")))}for(var _=n.group.selectAll(".pie-text-groups"),d=[],f=[],y=0;y<_._groups[0].length;y++){f.push(y);for(var p=y+1;p<_._groups[0].length;p++){ut(st(d3.select(_._groups[0][y])),st(d3.select(_._groups[0][p])))&&(d.push(y),d3.select(_._groups[0][y]).style("opacity","0"))}}for(var v=new Set(d),g=Array.from(v),m=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(g,f),x=0;x<g.length;x++){for(var S=[],k=0;k<m.length;k++){var b=st(d3.select(_._groups[0][g[x]])),w=st(d3.select(_._groups[0][m[k]]));if(S.push(ut(b,w)),ut(b,w)){if(g[x]==m[k])continue;d3.select(_._groups[0][g[x]]).style("opacity","0")}}0==S.filter(function(t){return 1==t}).length&&m.push(g[x])}for(var F=0;F<m.length;F++)d3.select(_._groups[0][m[F]]).style("opacity","1");function O(t){var e=.7*r(Math.abs(t.data.value)),n=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(n)*e,Math.sin(n)*e]}}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),U=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rose-text"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(n,P),s(n,[{key:"update",value:function(){var t=this,e=t._data,n=t._startAngle,i=t._endAngle,o=d3.max(e,function(t){return Math.abs(t.value)}),a=t._radius,r=d3.scaleLinear().domain([0,o]).range([t._innerRadius,a]),l=(t.arcFunc.innerRadius(t._innerRadius).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(t._cornerRadius),t.pieFunc.value(1).startAngle(n).endAngle(i).sort(t._sortMethod)),s=t.group.selectAll("g.arc-text-group").data(l(e));s.exit().remove();var u=s.enter().append("g").attr("class","arc-text-group");u.append("g"),s.merge(u).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout).select("g").transition().duration(t._transition?.9*t._duration:0).delay(t._transition?t._startDelay+.1*t._duration:0).ease(d3.easeLinear).on("start",t._onTransitionStart).on("end",t._onTransitionEnd)}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),q=function(t){function e(){r(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._showX=!0,t._showY=!0,t._stroke="#ccc",t._strokeDasharray="2 2",t}return h(e,o),s(e,[{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"showX",value:function(t){return arguments.length?(this._showX=t,this):this._showX}},{key:"showY",value:function(t){return arguments.length?(this._showY=t,this):this._showY}}]),e}(),Z="grid-arc-path",Q="grid-line",$=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","polar-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=5,e}return h(n,q),s(n,[{key:"update",value:function(){var n=this,o=n._startAngle,a=n._endAngle,r=n._radius,l=n.group.style("fill","none").style("stroke",n._stroke).style("stroke-dasharray",n._strokeDasharray);!function(){if(!n._showX)return l.selectAll("."+Z).remove();var i=n._donutCount,t=l.selectAll("."+Z).data(d3.range(i));t.exit().remove(),t.enter().append("path").attr("class",Z).merge(t).attr("d",function(t,e){var n=r/i*(e+1);return D(n,o,a)})}(),function(){if(!n._showY)return l.selectAll("."+Q).remove();var t=n._sectorCount||1,i=(a-o)/t,e=l.selectAll("."+Q).data(d3.range(t+1));e.exit().remove(),e.enter().append("line").attr("class",Q).merge(e).attr("x1",0).attr("y1",0).attr("x2",function(t,e){var n=o+i*e;return Math.cos(n-Math.PI/2)*r}).attr("y2",function(t,e){var n=o+i*e;return Math.sin(n-Math.PI/2)*r})}()}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),n}(),J=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.grid=null,e._gridStroke="#ccc",e._gridStrokeDasharray="3 3",e._gridShowX=!0,e._gridShowY=!0,e}return h(n,A),s(n,[{key:"gridStroke",value:function(t){return arguments.length?(this._gridStroke=t,this):this._gridStroke}},{key:"gridStrokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}},{key:"gridShowX",value:function(t){return arguments.length?(this._gridShowX=t,this):this._gridShowX}},{key:"gridShowY",value:function(t){return arguments.length?(this._gridShowY=t,this):this._gridShowY}},{key:"setPublicOption",value:function(t){u(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setPublicOption",this).call(this,t);var e=t.grid;this.gridStroke(e.color).gridShowX(e.showX).gridShowY(e.showY)}}]),n}(),K=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rose-chart"),e.core=e.rose=new V(e.mainGroup),e.grid=new $(e.mainGroup),e.roseText=new U(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._labelRadiusRatio=.8,e._innerRadiusRatio=0,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var l=this;l.group.selectAll(".polar-grid").style("opacity",0).transition().duration(l._transition?.1*l._duration*1e3:0).delay(l._duration?1e3*l._startDelay:0).style("opacity",1);for(var s=l.rose,t=l.grid,e=l.roseText,n=l._startAngle,i=l._endAngle,o=l.widthOfNoMargin,a=l.heightOfMainGroup,u=l._fontSize,r=.88*o,h=.88*a,c=L(r,h,n,i),_=c.radius,d=c.cx,f=c.cy,y=_-.55*u-6,p=y-5,v=l._innerRadius||(l._innerRadiusRatio?l._innerRadiusRatio*p:0),g=0,m=0;m<l.activeData.length;m++)g+=l.activeData[m].value;for(var x=0;x<l.activeData.length;x++)l.activeData[x].percent=parseFloat(l.activeData[x].value/g*100).toFixed(1);t.donutCount(6).sectorCount(l.activeData.length).startAngle(n).endAngle(i).radius(y).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray).showX(l._gridShowX).showY(l._gridShowY),s.data(l.activeData).radius(p).innerRadius(v).startAngle(n).endAngle(i).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionEnd(function(t,e){s.arcFunc.outerRadius()(t);var n=d3.select(this.parentNode),i=t.startAngle,o=t.endAngle,a="outer-arc-path-"+t.data.key+"-"+l.id,r=D(_,i+.015,o-.015);N(n,l.defs.select("#"+a).empty()?l.defs.append("path").attr("d",r).attr("id",a):l.defs.select("#"+a).attr("d",r),t.data.name=="$-"+e?"":t.data.name,u,l._fontFamily).attr("class",l.labelTextClass).style("pointer-events","none").style("fill",l._fontColor)}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var n=[{text:""+(t.data.name=="$-"+e?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];l.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),l.tooltip.hide()});var S=l.defs;S.selectAll("filter").remove();var k=S.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_rose").attr("filterUnits","objectBoundingBox");k.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),k.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),k.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),k.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),k.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(l.activeData).radius(p).innerRadius(0).startAngle(n).endAngle(i).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionEnd(l._onTransitionEnd());var b=(o-r)/2+d,w=(a-h)/2+f,F=c.quadrant,O=(_-p)/2;switch(F){case 4:b+=O,w+=O;break;case 1:b-=O,w+=O;break;case 2:b-=O,w-=O;break;case 3:b+=O,w-=spcae}t.translate(b,w).update(),s.translate(b,w).update(),e.translate(b,w).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"_onTransitionEnd",value:function(){var s=this;return function(t,e){var n=s.roseText.arcFunc.outerRadius()(t),i=d3.select(this.parentNode),o=t.startAngle,a=t.endAngle,r="arc-path-"+t.data.key+"-"+s.id,l=D(n-s._textLabel.fontSize/1.3*.5-6,o+.015,a-.015);N(i,s.defs.select("#"+r).empty()?s.defs.append("path").attr("d",l).attr("id",r):s.defs.select("#"+r).attr("d",l),t.data.value.toString(),s._textLabel.fontSize,s._textLabel.fontFamily).classed(s.labelTextClass,!0).style("pointer-events","none").style("fill",s._textLabel.color).style("font-size",s._textLabel.fontSize).style("font-family",s._textLabel.fontFamily),0==s._labelShow?i.selectAll("text").style("display","none"):i.selectAll("text").style("display","block")}}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),n}(),tt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._startAngle=3*Math.PI/2,e._endAngle=2*Math.PI,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,K),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),n}(),et="icon-bar-group",nt="icon-bar-clip-path",it=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","icon-bar"),e.defs=e.elem.append("defs"),e._width=400,e._height=400,e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._backFill="#ccc",e._countOfOneRow=20,e._padding=2,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n._width,i=n._height,o=n._icon,a=n._countOfOneRow,r=n._padding,l=t.length,s=d3.max(t,function(t){return t.value}),u=e/a,h=i/Math.max(1,l),c=Math.min((u-2*r)/o.width,(h-2*r)/o.height),_=(u-2*r)*c,d=o.height*c,f=function(t){return a<=s?a*t.value/s:t.value},y=n.defs,p="icon-"+n.id;y.select("#"+p).empty()&&y.append("path").attr("id",p).attr("d",o.path),y.selectAll("."+nt).remove();var v=y.selectAll("."+nt).data(t,function(t){return t.name});v.exit().remove();var g=v.enter().append("clipPath").attr("class",nt).attr("id",function(t,e){return"icon-clip-"+e+"-"+n.id});g.append("rect"),g.merge(v).select("rect").attr("x",0).attr("y",-1).attr("width",0).attr("height",h).transition().duration(n._transition?.7*n._duration:0).delay(n._transition?.2*n._duration:0).attr("width",function(t){return f(t)*u});var m=n.group.selectAll("."+et).data(t,function(t){return t.key});m.exit().remove(),m.selectAll("*").remove();var x=m.enter().append("g").attr("class",et).merge(m).attr("transform",function(t,e){return"translate(0, "+h*e+")"}).each(n._onTransitionStart).each(n._onTransitionEnd).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout),S=x.append("rect").attr("class","icon-bar-back-rect"),k=x.append("g").attr("class","icon-bar-back-group").call(G,0,(h-d)/2),b=x.append("g").attr("class","icon-bar-front-group").call(G,0,(h-d)/2).attr("clip-path",function(t,e){return"url(#icon-clip-"+e+"-"+n.id+")"});return S.attr("width",e).attr("height",h).style("opacity",0),k.selectAll("g").data(d3.range(a)).enter().append("g").attr("transform",function(t,e){return"translate("+(u*e+Math.max((u-_)/2,r))+",0)"}).append("path").attr("d",o.path).style("fill",n._backFill).attr("transform","scale("+c+")").style("opacity",0).transition().duration(n._transition?.2*n._duration:0).delay(0).style("opacity",1),b.each(function(t,e){d3.select(this).selectAll("g").data(function(t){return d3.range(Math.ceil(f(t)))}).enter().append("g").attr("transform",function(t,e){return"translate("+(u*e+Math.max((u-_)/2,r))+",0)"}).append("path").attr("d",o.path).style("fill",t.color).style("stroke-width",1/c).attr("transform","scale("+c+")")}),n}},{key:"backFill",value:function(t){return arguments.length?(this._backFill=t,this):this._backFill}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"padding",value:function(t){return arguments.length?(this._padding=t,this):this._padding}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),ot=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","icon-bar-chart"),e.core=e.iconBar=new it(e.mainGroup),e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._iconBackFill="#ccc",e._countOfOneRow=10,e._iconPadding=2,e._innerPadding=5,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var o=this,a=o.iconBar,i=o.tooltip,t=o.activeData,e=o.widthOfNoMargin,n=o.heightOfMainGroup,r=o._fontSize,l=.25*e,s=t.length?d3.max(t,function(t,e){return E(t.name=="$-"+e?"":t.name,r,o._fontFamily)}):0,u=Math.min(l,s),h=t.length?d3.max(t,function(t){return E(t.value,o._textLabel.fontSize,o._textLabel.fontFamily)}):0,c=o._labelShow?Math.min(l,h):0;a.data(o.activeData).width(o.widthOfNoMargin-u-c-2*o._innerPadding).height(n).backFill(o._iconBackFill).countOfOneRow(o._countOfOneRow).icon(o._icon).padding(o._iconPadding).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause),a.translate(u+o._innerPadding,0).onMouseover(function(t,e){var n=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];i.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show(),d3.select(this).select(".icon-bar-front-group").selectAll("path").style("stroke","#000")}).onMousemove(function(t,e){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t,e){i.hide(),d3.select(this).select(".icon-bar-front-group").selectAll("path").style("stroke","none")}).onTransitionStart(function(t,e){var n=d3.select(this),i=o.heightOfMainGroup/a.data().length;n.append("text").attr("class",o.labelTextClass).attr("x",-o._innerPadding).attr("y",i/2).attr("dy","0.35em").style("text-anchor","end").style("fill",o._fontColor).text(I(t.name=="$-"+e?"":t.name,u,r,o._fontFamily)),o._labelShow&&n.append("text").attr("class",o.labelTextClass).attr("x",o.widthOfNoMargin-u-c-o._innerPadding).attr("y",i/2).attr("dy","0.35em").style("text-anchor","start").style("fill",o._textLabel.color).style("font-size",o._textLabel.fontSize).style("font-family",o._textLabel.fontFamily).text(I(t.value,c,o._textLabel.fontSize,o._textLabel.fontFamily))}),a.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"iconBackFill",value:function(t){return arguments.length?(this._iconBackFill=t,this):this._iconBackFill}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"iconPadding",value:function(t){return arguments.length?(this._iconPadding=t,this):this._iconPadding}}]),n}(),at="radial-bar-group",rt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","radial-bar"),e.arcFunc=d3.arc(),e._innerRadius=0,e._outerRadius=100,e._lineRatio=.7,e._startAngle=0,e._endAngle=2*Math.PI*.75,e._cornerRadius=0,e._showMark=!1,e._markRadius=5,e._minLineWidth=2,e}return h(n,P),s(n,[{key:"update",value:function(){var t=this,e=t._data,n=t._outerRadius,i=t._innerRadius,o=t._startAngle,a=t._endAngle,r=t._lineRatio,l=t.group,s=t.arcFunc,u=e.length,h=d3.max(e,function(t){return Math.abs(t.value)}),c=(n-i)/u,_=Math.max(c*r,t._minLineWidth),d=function(t,e){return i+c*(e+1)-_/2},f=d3.scaleLinear().domain([0,h]).range([o,a]),y=function(t){return f(Math.abs(t))};s.innerRadius(function(t,e){return d(0,e)-_/2}).outerRadius(function(t,e){return d(0,e)+_/2}).startAngle(o).endAngle(function(t){return y(t.value)}).cornerRadius(t._cornerRadius);var p=l.selectAll("."+at).data(e,function(t){return t.key});p.exit().remove();var v=p.enter().append("g").attr("class",at);v.append("path").attr("class","arc-path"),t._showMark&&v.append("circle").attr("class","mark-circle");var g=v.merge(p).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout);t._showMark?g.select("circle").attr("cx",function(t,e){return d(0,e)*Math.cos(y(t.value)-Math.PI/2)}).attr("cy",function(t,e){return d(0,e)*Math.sin(y(t.value)-Math.PI/2)}).attr("r",t._markRadius).style("fill",function(t){return t.color}).style("opacity",0).transition().duration(t._transition?.1*t._duration:0).delay(t._transition?t._startDelay+t._duration:0).style("opacity",1):g.select("circle").style("opacity",0),g.select("path").style("fill",function(t){return t.color}).attr("d",function(t,e){return s({value:0},e)}).transition().duration(t._transition?t._duration:0).delay(t._transition?t._startDelay:0).ease(d3.easeCubicOut).attrTween("d",function(e,n){var i=d3.interpolate(o,y(e.value));return function(t){return s.endAngle(i(t)),s(e,n)}}).on("start",t._onTransitionStart).on("end",t._onTransitionEnd)}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"lineRatio",value:function(t){return arguments.length?(this._lineRatio=t,this):this._lineRatio}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"showMark",value:function(t){return arguments.length?(this._showMark=t,this):this._showMark}},{key:"markRadius",value:function(t){return arguments.length?(this._markRadius=t,this):this._markRadius}},{key:"minLineWidth",value:function(t){return arguments.length?(this._minLineWidth=t,this):this._minLineWidth}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),ct=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","radial-bar-chart"),e.core=e.radialBar=new rt(e.mainGroup),e._innerRadiusRatio=.1,e._startAngle=0,e._endAngle=2*Math.PI*.75,e._showMark=!1,e._markRadius=10,e._minLineWidth=2,e._lineRatio=.7,e._cornerRadius=0,e._labelShow=!0,e._positionOptions=["内部居右","外部","内部居左"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var t=this,i=t.tooltip,e=t.radialBar,n=t.widthOfNoMargin,o=t.heightOfMainGroup,a=Math.min(n,o)/2,r=a*t._innerRadiusRatio,l=[];if("linear"==t._colors.type){var s=[isNaN(parseFloat(t._colors.list[0]))?t._colors.list[0]:t._colorList[t._colors.list[0]],isNaN(parseFloat(t._colors.list[1]))?t._colors.list[1]:t._colorList[t._colors.list[1]]],u=d3.scaleLinear().domain([t.activeData.length-1,0]).range(s);l=function(t){for(var e,n,i=t.length,o=0;o<i-1;o++){for(var a=(e=o)+1;a<i;a++)t[a].value<t[e].value&&(e=a);n=t[o],t[o]=t[e],t[e]=n}return t}(t.activeData).map(function(t,e){return t.color=u(e),t})}else l=t.activeData.sort(function(t,e){return t.value-e.value});var h=t.defs;h.selectAll("filter").remove();var c=h.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_radialbar").attr("filterUnits","objectBoundingBox");c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),c.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),c.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),c.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),c.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(l).innerRadius(r).outerRadius(a).startAngle(t._startAngle).endAngle(t._endAngle).lineRatio(t._lineRatio).cornerRadius(t._cornerRadius).showMark(t._showMark).markRadius(t._markRadius).minLineWidth(t._minLineWidth).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(t,e){d3.select(this).style("opacity",.8);var n=[{text:""+(t.showLegend?t.name:""),color:t.color},{text:t.valueLabel+": "+t.value}];i.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this).style("opacity",1),i.hide()}).onTransitionStart(t._onTransitionStart()).onTransitionEnd(t._onTransitionEnd()),e.translate(n/2,o/2).update()}},{key:"configLegend",value:function(){var t=this,i=[];if("linear"==t._colors.type){var e=[isNaN(parseFloat(t._colors.list[0]))?t._colors.list[0]:t._colorList[t._colors.list[0]],isNaN(parseFloat(t._colors.list[1]))?t._colors.list[1]:t._colorList[t._colors.list[1]]],n=d3.scaleLinear().domain([t.activeData.length-1,0]).range(e);i=function(t){for(var e,n,i=t.length,o=0;o<i-1;o++){for(var a=(e=o)+1;a<i;a++)t[a].value<t[e].value&&(e=a);n=t[o],t[o]=t[e],t[e]=n}return t}(t.activeData).map(function(t,e){return t.color=n(e),t}).filter(function(t,e){return 1==t.showLegend})}else i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"lineRatio",value:function(t){return arguments.length?(this._lineRatio=t,this):this._lineRatio}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"showMark",value:function(t){return arguments.length?(this._showMark=t,this):this._showMark}},{key:"markRadius",value:function(t){return arguments.length?(this._markRadius=t,this):this._markRadius}},{key:"minLineWidth",value:function(t){return arguments.length?(this._minLineWidth=t,this):this._minLineWidth}},{key:"_onTransitionStart",value:function(){var a=this;return function(t,e){var n=d3.select(this.parentNode),i=a.radialBar.arcFunc,o=(i.innerRadius()(t,e)+i.outerRadius()(t,e))/2;n.append("text").attr("class",a.labelTextClass).attr("x","-5px").attr("y",-o).attr("dy","0.35em").style("text-anchor","end").style("fill",a._fontColor).text(t.showLegend?t.name:"")}}},{key:"_onTransitionEnd",value:function(){var _=this;return _.group.selectAll(".radial-bar-texts").remove(),function(t,e){var n=d3.select(this.parentNode),i=_.radialBar.arcFunc,o=(i.innerRadius()(t,e)+i.outerRadius()(t,e))/2,a=i.startAngle()(t,e),r=i.endAngle()(t,e),l=r>Math.PI/2&&r<=3*Math.PI/2,s="arc-path-"+t.key+"-"+_.id;if(0==_._labelShow||null==_._labelShow||null==_._positionOptions||null==_._positionChoice)_.group.selectAll(".radial-bar-texts").style("display","none");else if(0==_._positionOptions.indexOf(_._positionChoice)){var u=D(o,a,r-.05,!l);N(n,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",u).attr("id",s):_.defs.select("#"+s).attr("d",u),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,l?"0%":"100%").attr("class","radial-bar-texts").style("text-anchor",l?"start":"end").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}else if(1==_._positionOptions.indexOf(_._positionChoice)){var h=D(o,r,2*Math.PI,!l);N(n,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",h).attr("id",s):_.defs.select("#"+s).attr("d",h),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,l?"95%":"5%").attr("class","radial-bar-texts").style("text-anchor",l?"end":"start").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}else if(2==_._positionOptions.indexOf(_._positionChoice)){var c=D(o,a,a+Math.PI);N(n,_.defs.select("#"+s).empty()?_.defs.append("path").attr("d",c).attr("id",s):_.defs.select("#"+s).attr("d",c),t.value,_._textLabel.fontSize,_._textLabel.fontFamily,"0%").attr("class","radial-bar-texts").attr("dx",_._fontSize/2).style("text-anchor","start").style("pointer-events","none").style("fill",_._textLabel.color).style("font-size",_._textLabel.fontSize).style("font-family",_._textLabel.fontFamily).style("display",_._labelShow?"block":"none")}}}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.lineRatio(l(e.barWidthPercent?e.barWidthPercent:this._lineRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius))}}]),n}(),_t=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","radial-line-chart"),e._lineRatio=0,e._innerRadiusRatio=.2,e._showMark=!0,e._markRadius=5,e._minLineWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,ct),s(n,[{key:"_onTransitionEnd",value:function(){var u=this;return function(t,e){var n=d3.select(this.parentNode),i=u.radialBar.arcFunc,o=(i.innerRadius()(t,e)+i.outerRadius()(t,e))/2,a=(i.startAngle()(t,e),i.endAngle()(t,e)),r=a>Math.PI/2&&a<=3*Math.PI/2,l="arc-path-"+t.key+"-"+u.id,s=D(o,a,2*Math.PI,!r);N(n,u.defs.select("#"+l).empty()?u.defs.append("path").attr("d",s).attr("id",l):u.defs.select("#"+l).attr("d",s),t.value,u._textLabel.fontSize,u._textLabel.fontFamily,r?"95%":"5%").attr("class",u.labelTextClass).style("text-anchor",r?"end":"start").style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).style("display",u._labelShow?"block":"none")}}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.markRadius(l(e.endPointRadius?e.endPointRadius:this._markRadius)).minLineWidth(l(e.lineWidth?e.lineWidth:this._minLineWidth)).lineRatio(0)}}]),n}(),dt=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._marginTop=20,e._marginRight=24,e._marginBottom=15,e._marginLeft=24,e._gapPadding=15,e._titlePadding=20,e._unitPadding=15,e._sourcePadding=10,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._xRange=null,e._yRange=null,e._xDomain=null,e._yDomain=null,e._clipShow=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e}return h(o,J),s(o,[{key:"update",value:function(){return this._marginLeft=this._yTitle?0:24,this._titlePadding=this._unitWord&&this._unitShow?10:20,this._marginBottom=this._sourceWord&&this._sourceShow?20:18,(this._yLeftName||this._yRightName)&&(this._marginLeft=this._yLeftName?0:24,this._marginRight=this._yRightName?0:24),this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"bottom"==this._legendY?8:15:this._gapPadding=0,this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.yAxis,i=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;i.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration);n.titleHeight;var _=(c-e.allowedMaxTextHeight())/(3*u);n.tickCount(_),n.compute(),i.range([0,h-n.width]),e.compute(),o.range([c-e.height,0]);var d=n.width,f=c-e.height,y=n.width;e.translate(d,f).update(),n.translate(y,0).update()}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"updateScale",value:function(){}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=t.length?t[0].data.map(function(t){return t.name}):[0,1],i=void 0;if(t.length){var o=d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),a=1.15*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})});i=o<0?a<=0?[o,0]:[o,a]:[0,a]}else i=[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"clipShow",value:function(t){return arguments.length?(this._clipShow=t,this):this._clipShow}},{key:"clipShowX",value:function(t){return arguments.length?(this._clipShowX=t,this):this._clipShowX}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"yLeftName",value:function(t){return arguments.length?(this._yLeftName=t,this):this._yLeftName}},{key:"yLeftTitle",value:function(t){return arguments.length?(this._yLeftTitle=t,this):this._yLeftTitle}},{key:"yRightName",value:function(t){return arguments.length?(this._yRightName=t,this):this._yRightName}},{key:"yRightTitle",value:function(t){return arguments.length?(this._yRightTitle=t,this):this._yRightTitle}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,n=e.x||{},i=e.y||{};this.axisLineStroke(e.color).xTitle(n.name).yTitle(i.name).xTickShow(n.labelShow).yTickShow(i.labelShow).xRange(n.range).yRange(i.range).clipShow(i.range).clipShowX(n.range)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.heightOfMainGroup-t;return 0<e?e:0}}]),o}(),ft=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","axis"),e.group=e.elem.append("g"),e.axisFunc=null,e._orient="bottom",e._type="category",e._scaleFunc=null,e._tickSize=5,e._tickPadding=3,e._tickCount=null,e._tickFormat=null,e._minTickDistance=null,e._axisLineShow=!0,e._tickShow=!0,e._title="",e._titleShow=!0,e._titlePadding=5,e._fontSize=12,e._fontColor="#000",e._fontFamily="sans-serif",e._lineStroke="#000",e._transition=!0,e._duration=500,e._tickValues=[],e._tickValueTexts=[],e}return h(n,o),s(n,[{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"scaleFunc",value:function(t){return arguments.length?(this._scaleFunc=t,this):this._scaleFunc}},{key:"tickSize",value:function(t){return arguments.length?(this._tickSize=t,this):this._tickSize}},{key:"tickPadding",value:function(t){return arguments.length?(this._tickPadding=t,this):this._tickPadding}},{key:"tickFormat",value:function(t){return arguments.length?(this._tickFormat=t,this):this._tickFormat}},{key:"tickCount",value:function(t){return arguments.length?(this._tickCount=t,this):this._tickValues.length||this._tickCount}},{key:"minTickDistance",value:function(t){return arguments.length?(this._minTickDistance=t,this):this._minTickDistance}},{key:"tickLineShow",value:function(t){return arguments.length?(this._tickLineShow=t,this):this._tickLineShow}},{key:"axisLineShow",value:function(t){return arguments.length?(this._axisLineShow=t,this):this._axisLineShow}},{key:"title",value:function(t){return arguments.length?(this._title=t,this):this._title}},{key:"titlePadding",value:function(t){return arguments.length?(this._titlePadding=t,this):this._titlePadding}},{key:"titleShow",value:function(t){return arguments.length?(this._titleShow=t,this):this._titleShow}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"xRange",value:function(t){return arguments.length?(this._xRange=t,this):this._xRange}},{key:"yRange",value:function(t){return arguments.length?(this._yRange=t,this):this._yRange}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}},{key:"lineStroke",value:function(t){return arguments.length?(this._lineStroke=t,this):this._lineStroke}},{key:"tickLabelShow",value:function(t){return arguments.length?(this._tickLabelShow=t,this):this._tickLabelShow}},{key:"tickShow",value:function(t){return arguments.length?(this._tickShow=t,this):this._tickShow}},{key:"titleHeight",get:function(){return this._title&&this._titleShow?1.25*this._fontSize+this._titlePadding:0}},{key:"tickLocations",get:function(){var e=this;return this._tickValues.map(function(t){return e._scaleFunc(t)})}}]),n}(),yt="axis-group",pt="x-title",vt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-x-line"),e._orient="bottom",e._type="category",e._allowedMaxTextHeight=30,e._tickTextRotate=0,e._tickTextHeight=0,e}return h(n,ft),s(n,[{key:"update",value:function(){var n=this,i=n._orient,t=n._scaleFunc,e=n.group,o=n._fontSize,a=n._tickTextRotate,r=n._tickValueTexts,l=void 0;(l=n.axisFunc="top"===i?d3.axisTop(t):d3.axisBottom(t)).tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding);var s=e.select("."+yt).empty()?e.append("g").attr("class",yt):e.select("."+yt);s.style("font-size",o+"px").style("font-family",n._fontFamily).transition().duration(n._transition?n._duration:0).call(l).on("start",function(t,e){s.selectAll(".tick text").style("fill",n._fontColor).attr("dx",0).attr("dy","0.9em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"top"!==i}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",n._lineStroke),s.select("path").style("stroke",n._lineStroke).style("display",n._axisLineShow?"block":"none")}),n._rotateFlag&&(s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",n._fontColor).attr("dx",0).attr("dy","0.71em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"top"!==i}).attr("dy","0.5em"));var u=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)}),h=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)});d3.selectAll(u).remove(),d3.selectAll(h).remove();var c=Math.abs(t.range()[0]-t.range()[1]);if(n._titleShow&&n._title){var _=e.select("."+pt).empty()?e.append("g").attr("class",pt):e.select("."+pt),d=_.select("text").empty()?_.append("text"):_.select("text"),f=c/r.length,y=d3.max(r,function(t){return E(t,o,n._fontFamily)});_.call(G,c/2+Math.abs(t.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(y<.8*f?this._tickTextHeight:1.2*this._tickTextHeight):0),d.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dy",n._tickShow?1.325*o/2+6:1.325*o/2+12).text(n._title)}else e.select("."+pt).remove()}},{key:"compute",value:function(){var e=this,n=[],i=[],o=0,a=0,t=!1;function r(){e._tickTextRotate=o,e._tickValues=n,e._tickValueTexts=i,e._tickTextHeight=a,e._rotateFlag=t}var l=e._scaleFunc,s=e._type,u=e._fontSize,h=(e._minTickDistance,e._allowedMaxTextHeight),c=Math.abs(l.range()[0]-l.range()[1]),_=void 0,d=void 0;if(n="category"===s?l.domain():l.ticks(e._tickCount),"number"===s&&0!=e._xRange.length&&n.push(e._xRange[0]),function(){var t=!1;_=c/n.length,(d=d3.max(n.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)})||0)<.8*_&&(i=n,a=(o=0)==d?0:1.125*u,r(),t=!0);return t}())return e;o="top"===e._orient?45:-45;var f=Math.abs(Math.sin(Math.PI/4));d*f<h?(a=d*f,i=n,t=!1):(a=h,i=n.map(function(t){return I(t,a/f,u,e._fontFamily)}),t=!0);var y=c/n.length;if("category"===s&&y<2*u){var p=Math.ceil(2*u/y);n=n.filter(function(t,e){return e%p==0})}return r(),e}},{key:"allowedMaxTextHeight",value:function(t){return arguments.length?(this._allowedMaxTextHeight=t,this):this._allowedMaxTextHeight}},{key:"height",get:function(){var e=this,t=this._scaleFunc,n=Math.abs(t.range()[0]-t.range()[1])/this._tickValueTexts.length,i=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),o=0;return this.isShow&&(o=(this._tickShow?(i?this._tickSize+this._tickPadding:0)+(i<.8*n?this._tickTextHeight:1.2*this._tickTextHeight):0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),o}}]),n}(),gt="axis-group",mt="y-title",xt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-line"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(n,ft),s(n,[{key:"update",value:function(){var e=this,t=this,n=t._orient,i=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===n?d3.axisRight(i):d3.axisLeft(i);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+gt).empty()?o.append("g").attr("class",gt):o.select("."+gt);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),u.select("path").style("stroke",t._lineStroke).style("display","none")});var h=t.group.selectAll(".axis-y-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)||"$-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(i.range()[0]-i.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+mt).empty()?o.append("g").attr("class",mt):o.select("."+mt),d=_.select("text").empty()?_.append("text"):_.select("text"),f=(E(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}));_.call(G,-(this._tickShow?(f?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0),c/2),d.attr("y",-9).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+mt).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,r,e._fontFamily)})||0;return s<=l?(n=t,i=s):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),n=0;return this.isShow&&(n=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._titleShow&&this._title?1.125*this._fontSize+24+3:0):this._titleShow&&this._title?1.125*this._fontSize+24+3:0),n}}]),n}(),St=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("line").attr("class","guide-line"),e._x1=0,e._y1=0,e._x2=0,e._y2=100,e._stroke="#000",e._strokeDasharray="3 3",e}return h(n,o),s(n,[{key:"update",value:function(){var t=this;return t.elem.attr("x1",t._x1).attr("y1",t._y1).attr("x2",t._x2).attr("y2",t._y2).style("stroke",t._stroke).style("stroke-dasharray",t._strokeDasharray).style("pointer-events","none"),t}},{key:"x1",value:function(t){return arguments.length?(this._x1=t,this):this._x1}},{key:"y1",value:function(t){return arguments.length?(this._y1=t,this):this._y1}},{key:"x2",value:function(t){return arguments.length?(this._x2=t,this):this._x2}},{key:"y2",value:function(t){return arguments.length?(this._y2=t,this):this._y2}},{key:"x",value:function(t){return arguments.length?(this._x1=this._x2=t,this):[this._x1,this._x2]}},{key:"y",value:function(t){return arguments.length?(this._y1=this._y2=t,this):[this._y1,this._y2]}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeDasharray",value:function(t){return arguments.length?(this._strokeDasharray=t,this):this._strokeDasharray}}]),n}(),kt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n.group,e=n._data,i=n._xScale,o=n._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return i(t.name)||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("r",n._radius).attr("cx",function(t){return i(t.name)||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),n}(),bt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","overlap-area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._fillOpacity=.7,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,i=n._areaFunc||d3.area().x(function(t){return n._xScale(t.name)}).y0(n._yScale.range()[0]).y1(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});i.curve(n._curve);var o=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});o.curve(n._curve);var e=n.group;e.selectAll(".overlap-area").remove(),e.selectAll(".overlap").remove(),e.selectAll(".overlap-line").remove();var a=e.append("g").attr("class","overlap-area").selectAll("g").data(t,function(t){return t.name});return a.exit().remove(),a.enter().append("g").merge(a).each(function(t,e){d3.select(this).append("g").append("path").attr("class","overlap").style("fill",t.color).style("fill-opacity",n._fillOpacity).transition().duration(n._transition?n._duration:0).attr("d",i(t.data)),d3.select(this).append("g").append("path").attr("class","overlap-line").style("fill","none").style("stroke",n._stroke||t.color||"#000").style("stroke-width",n._lineWidth).style("stroke-opacity",1).style("stroke-dasharray",n._strokeDasharry).transition().duration(n._transition?n._duration:0).attr("d",o(t.data))}),n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}}]),n}(),wt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","area-stack-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n.group,i=n._xScale,o=n._yScale,a=e.selectAll("g").data(t,function(t){return t.name});a.exit().remove(),a.enter().append("g").attr("class","area-stack-text-group").merge(a).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).attr("text-anchor","middle").style("display",n._labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?n._startDelay+.9*n._duration:0).style("opacity",1)}),null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".area-stack-text-group text").style("display","none"):0==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".area-stack-text-group text").attr("dy",.4*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)&&e.selectAll(".area-stack-text-group text").attr("dy",1.3*n._fontSize);for(var r=e.selectAll(".area-stack-text-group text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("visibility","hidden")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("visibility","visible");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ft=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("clipPath").attr("id",e.id),e.rect=e.elem.append("rect"),e._width=100,e._height=100,e._transition=!0,e._duration=500,e._paddingVertical=[5,0],e._paddingHorizontal=[20,20],e}return h(n,o),s(n,[{key:"update",value:function(){var t=this,e=t.rect,n=t._width,i=t._paddingVertical,o=t._paddingHorizontal;return e.attr("x",-n-o[0]).attr("y",-i[0]).attr("width",n+o[0]+o[1]).attr("height",t._height+i[0]+i[1]),e.transition().duration(t._transition?t._duration:0).attr("x",-o[0]),t}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"paddingVertical",value:function(t){return arguments.length?(this._paddingVertical=t,this):this._paddingVertical}},{key:"paddingHorizontal",value:function(t){return arguments.length?(this._paddingHorizontal=t,this):this._paddingHorizontal}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}}]),n}(),Ot=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("clipPath").attr("id",e.id),e.rect=e.elem.append("rect").attr("class","x"+e.id),e._width=100,e._height=100,e._transition=!0,e._duration=500,e._paddingVertical=[0,0],e._paddingHorizontal=[0,0],e}return h(n,o),s(n,[{key:"update",value:function(){var t=this,e=t.rect,n=t._width,i=t._paddingVertical,o=t._paddingHorizontal;return e.attr("x",0).attr("y",0).attr("width",n+o[0]+o[1]).attr("height",t._height+i[0]+i[1]),e.transition().duration(t._transition?t._duration:0).attr("x",-o[0]),t}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"paddingVertical",value:function(t){return arguments.length?(this._paddingVertical=t,this):this._paddingVertical}},{key:"paddingHorizontal",value:function(t){return arguments.length?(this._paddingHorizontal=t,this):this._paddingHorizontal}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=t,this):this._duration}}]),n}(),Ct="grid-x-line",At="grid-y-line",Pt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","plane-grid"),e.group=e.elem.append("g"),e._width=400,e._height=400,e._xTickLocations=[],e._yTickLocations=[],e}return h(n,q),s(n,[{key:"update",value:function(){var e=this,n=e._width,i=e._height,o=e.group.style("fill","none").style("stroke",e._stroke).style("stroke-dasharray",e._strokeDasharray).style("pointer-events","none");!function(){if(!e._showX)return o.selectAll("."+Ct).remove();var t=o.selectAll("."+Ct).data(e._yTickLocations);t.exit().remove(),t.enter().append("line").attr("class",Ct).merge(t).attr("x1",0).attr("y1",function(t){return t+.5}).attr("x2",n).attr("y2",function(t){return t+.5})}(),function(){if(!e._showY)return o.selectAll("."+At).remove();var t=o.selectAll("."+At).data(e._xTickLocations);t.exit().remove(),t.enter().append("line").attr("class",At).merge(t).attr("y1",0).attr("x1",function(t){return t}).attr("y2",i).attr("x2",function(t){return t})}()}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"xTickLocations",value:function(t){return arguments.length?(this._xTickLocations=t,this):this._xTickLocations}},{key:"yTickLocations",value:function(t){return arguments.length?(this._yTickLocations=t,this):this._yTickLocations}}]),n}(),zt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem=t.append("g").attr("class","bands-overlay").style("opacity",0),e._data=[],e._bandHeight=100,e._bandWidth=50,e._isScalePoint=!0,e._isHorizontal=!1,e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(n,o),s(n,[{key:"update",value:function(){var t=this,e=t._data,n=t.elem,i=t._bandWidth,o=t._bandHeight,a=t._isScalePoint,r=t._isHorizontal,l=a?i/2:0,s=n.selectAll("rect").data(e);return s.exit().remove(),s.enter().append("rect").merge(s).attr("x",function(t,e){return r?0:i*e-l}).attr("y",function(t,e){return r?o*e-l:0}).attr("width",i).attr("height",o).style("fill","#000").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),t}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"bandWidth",value:function(t){return arguments.length?(this._bandWidth=t,this):this._bandWidth}},{key:"bandHeight",value:function(t){return arguments.length?(this._bandHeight=t,this):this._bandHeight}},{key:"isScalePoint",value:function(t){return arguments.length?(this._isScalePoint=t,this):this._isScalePoint}},{key:"isHorizontal",value:function(t){return arguments.length?(this._isHorizontal=t,this):this._isHorizontal}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),n}();function Dt(t,e){var n=0,i=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(n=t.index,i=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[n],2))return[];for(var a=R(t,e),r={},l=[],s=a.length,u=a[0],h=[],c=[],_=1;_<s;_++)c.push(a[_].length);c.sort(function(t,e){return e-t});for(var d=0;d<s;d++)for(var f=0;f<c[0];f++)h.push(isNaN(parseFloat(a[d][f])));if(0==h.filter(function(t,e){return 0==t}).length)return[];if(i){for(var y=[],p=1;p<s;p++)y.push(a[p].length);y.sort(function(t,e){return e-t});for(var v=1;v<s;v++){var g=a[v],m=g[n];if(""!=m&&null!=m&&null!=m||(m="$-"+v),m){for(var x={name:m,showLegend:m!="$-"+v,data:[]},S=0;S<y[0];S++){var k=u[S];""!=k&&null!=k&&null!=k||(k="&-"+S),S!==n&&x.data.push({name:k,showAxisText:k!="&-"+S,value:g[S]})}l.push(x)}}}else{for(var b=[],w=1;w<s;w++)b.push(a[w].length);b.sort(function(t,e){return e-t});for(var F=1;F<b[0];F++)if(F!==n){var O=u[F];""!=u[F]&&null!=u[F]&&null!=u[F]||(O="$-"+F),r[O+"-"+F]={name:O,showLegend:O!="$-"+F,data:[]}}for(var C=1;C<s;C++){var A=a[C],P=A[n];if(""!=P&&null!=P&&null!=P||(P="&-"+C),P)for(var z=0;z<b[0];z++){var D=u[z];""!=u[z]&&null!=u[z]&&null!=u[z]||(D="$-"+z),z!==n&&D&&r[D+"-"+z].data.push({name:P,showAxisText:P!="&-"+C,value:A[z]})}}for(var L in r)l.push(r[L])}return l.forEach(function(t,e){t.key=M(t.name)+"-"+e}),l}var Lt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","overlap-area-chart"),e.grid=new Pt(e.coreGroup),e.areaPlot=new bt(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new kt(e.coreGroup),e.areaStackText=new wt(e.coreGroup),e.clipArea=new Ft(e.defs),e.AnimationArea=new Ot(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yLabel="",e._xLabel="",e._sortValue=null,e._curve=d3.curveCardinal,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.grid,e=n.areaPlot,l=n.guideScatter,i=n.areaStackText,s=n.tooltip,o=n.overlay,u=n.guideLine,a=n.clipArea,h=n.AnimationArea,c=n.xScale,_=n.yScale,d=n.widthOfCore,f=n.heightOfCore,y=(Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0),n.defs);y.selectAll("filter").remove();var p=y.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stacklinear").attr("filterUnits","objectBoundingBox");p.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),p.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),p.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),p.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),p.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.width(d).height(f).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(c).yScale(_).curve(n._curve),l.data(r).xScale(c).yScale(_).radius(3.5).stroke("#fff").strokeWidth(2),u.y1(0).y2(f).stroke("#c6c6c6").strokeDasharray("0 0"),o.data(c.domain()).isScalePoint(!0).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),s.data(o).update(),u.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+c(i)+",0)"),l.data(a).update(),s.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show(),l.show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){s.hide(),u.hide(),l.hide()}),i.data(r).xScale(c).yScale(_).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?(a.width(d).height(f).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+a.id+")")):(a.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),a.update(),l.elem.style("pointer-events","none");var v=n.group.selectAll(".overlap-area-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(v).remove(),t.update(),o.update(),e.update(),i.update(),h.width(0).height(n._height),h.update(),n.coreGroup.select(".overlap-area-plot").attr("clip-path","url(#"+h.id+")"),n.defs.select(".x"+h.id).transition().duration(n._transition?1e3*n._duration*.9:0).delay(n._transition?1e3*n._startDelay:0).attr("width",d)}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}}]),n}(),Mt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","animation-line-circle-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeWidth=1,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,i=n._xScale,o=n._yScale,e=n.group;e.selectAll("g").remove();var a=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});a.curve(n._curve),e.selectAll("path").remove();var r=e.selectAll("path").data(t,function(t){return t.key});r.exit().remove(),r.enter().append("path").merge(r).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return a(t.data)}).transition().duration(n._transition?.9*n._duration:0).delay(n._startDelay).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}),e.selectAll("g").remove();var l=e.append("g").selectAll("g").data(t,function(t){return t.name});l.exit().remove(),l.enter().append("g").merge(l).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("cx",function(t){return i(t.name)+i.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0}).transition().duration(n._transition?.9*n._duration:0).delay(n._startDelay).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,n._radius);return function(t){return e(t)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var s=e.selectAll(".clip-scatter-plot").nodes(),u=0;u<s.length;u++)""==s[u].__data__.value||isNaN(s[u].__data__.value)?d3.select(s[u]).style("opacity","0"):d3.select(s[u]).style("opacity","1");return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Wt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n.group,i=n._xScale,o=n._yScale,a=e.selectAll("g").data(t,function(t){return t.name});a.exit().remove(),a.enter().append("g").attr("class","ranking-text-group").merge(a).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return t.total?o(t.total)||0:o(t.value)||0}).attr("text-anchor","middle").style("display",n._labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?n._startDelay+.9*n._duration:0).style("opacity",1)}),null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".ranking-text-group text").style("display","none"):0==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".ranking-text-group text").attr("dy",.4*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)&&e.selectAll(".ranking-text-group text").attr("dy",1.3*n._fontSize);for(var r=e.selectAll(".ranking-text-group text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("visibility","hidden")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("visibility","visible");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=parseFloat(t),this):this._defs}}]),n}(),Rt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","line-scatter-plot"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=2,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n.group,e=n._data,i=n._xScale,o=n._yScale;t.selectAll(".scatter-plot").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","scatter-plot").attr("cx",function(t){return i(t.name)+i.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0}).merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("r",n._radius).attr("cx",function(t){return i(t.name)+i.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0})});for(var r=t.selectAll(".scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),n}(),Nt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.grid=new Pt(e.coreGroup),e.linePlot=new Mt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new Rt(e.coreGroup),e.stackText=new Wt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveCardinal,e._lineWidth=2,e._strokeWidth=1,e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.grid,e=n.linePlot,i=(n.scatterPlot,n.clipArea),l=n.tooltip,o=n.overlay,s=n.guideLine,u=n.guideScatter,a=n.stackText,h=n.xScale,c=n.yScale,_=n.widthOfCore,d=n.heightOfCore,f=(Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0),n.defs);f.selectAll("filter").remove();var y=f.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_line").attr("filterUnits","objectBoundingBox");y.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),y.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),y.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),y.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),y.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.width(_).height(d).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(0==n._yDomain[0]?n.yAxis.tickLocations.slice(1):n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(h).yScale(c).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(0).moveStyle(n._moveStyle).endPause(n._endPause).curve(n._curve).radius(n._endPointRadius).stroke("#fff").lineWidth(n._lineWidth).strokeWidth(n._strokeWidth),s.y1(0).y2(d).stroke("#c6c6c6").strokeDasharray("0 0"),u.xScale(h).yScale(c).fill("#fff"),o.data(h.domain()).isScalePoint(!1).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show(),s.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(h(i)+h.bandwidth()/2)+",0)"),u.data(a).update().show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide(),u.hide()}),a.data(r).xScale(h).yScale(c).type("mix").fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(0).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?(i.width(_).height(d).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+i.id+")")):(i.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),i.update(),u.elem.style("pointer-events","none");var p=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),o.update(),t.update(),e.update(),a.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}}]),n}(),Tt=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","step-line-chart"),e._showPoints=!1,e._curve=d3.curveStepAfter,e._strokeWidth=2,e._labelShow=!1,e._endPointRadius=0,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,Nt),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveStepAfter)}}]),n}();function jt(t,e){return t.sourceLinks.length?t.depth:e-1}function Yt(t){return function(){return t}}function Xt(t,e){return Gt(t.source,e.source)||t.index-e.index}function Bt(t,e){return Gt(t.target,e.target)||t.index-e.index}function Gt(t,e){return t.y0-e.y0}function Et(t){return t.value}function It(t){return(t.y0+t.y1)/2}function Ht(t){return It(t.source)*t.value}function Vt(t){return It(t.target)*t.value}function Ut(t){return t.index}function qt(t){return t.nodes}function Zt(t){return t.links}function Qt(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}function $t(){var a=0,s=0,r=1,u=1,l=24,h=8,e=Ut,c=jt,n=qt,i=Zt,_=32;function o(){var t={nodes:n.apply(null,arguments),links:i.apply(null,arguments)};return function(t){t.nodes.forEach(function(t,e){t.index=e,t.sourceLinks=[],t.targetLinks=[]});var o=d3.map(t.nodes,e);t.links.forEach(function(t,e){t.index=e;var n=t.source,i=t.target;"object"!==(void 0===n?"undefined":f(n))&&(n=t.source=Qt(o,n)),"object"!==(void 0===i?"undefined":f(i))&&(i=t.target=Qt(o,i)),n.sourceLinks.push(t),i.targetLinks.push(t)})}(t),t.nodes.forEach(function(t){t.value=Math.max(d3.sum(t.sourceLinks,Et),d3.sum(t.targetLinks,Et))}),function(t){var e,n,i;for(e=t.nodes,n=[],i=0;e.length;++i,e=n,n=[])e.forEach(function(t){t.depth=i,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&n.push(t.target)})});for(e=t.nodes,n=[],i=0;e.length;++i,e=n,n=[])e.forEach(function(t){t.height=i,t.targetLinks.forEach(function(t){n.indexOf(t.source)<0&&n.push(t.source)})});var o=(r-a-l)/(i-1);t.nodes.forEach(function(t){t.x1=(t.x0=a+Math.max(0,Math.min(i-1,Math.floor(c.call(null,t,i))))*o)+l})}(t),function(t){var e=d3.nest().key(function(t){return t.x0}).sortKeys(d3.ascending).entries(t.nodes).map(function(t){return t.values});n=d3.min(e,function(t){return(u-s-(t.length-1)*h)/d3.sum(t,Et)}),e.forEach(function(t){t.forEach(function(t,e){t.y1=(t.y0=e)+t.value*n})}),t.links.forEach(function(t){t.width=t.value*n}),l();var n;for(var i=1,o=_;0<o;--o)r(i*=.99),l(),a(i),l();function a(n){e.forEach(function(t){t.forEach(function(t){if(t.targetLinks.length){var e=(d3.sum(t.targetLinks,Ht)/d3.sum(t.targetLinks,Et)-It(t))*n;t.y0+=e,t.y1+=e}})})}function r(n){e.slice().reverse().forEach(function(t){t.forEach(function(t){if(t.sourceLinks.length){var e=(d3.sum(t.sourceLinks,Vt)/d3.sum(t.sourceLinks,Et)-It(t))*n;t.y0+=e,t.y1+=e}})})}function l(){e.forEach(function(t){var e,n,i,o=s,a=t.length;for(t.sort(Gt),i=0;i<a;++i)e=t[i],0<(n=o-e.y0)&&(e.y0+=n,e.y1+=n),o=e.y1+h;if(0<(n=o-h-u))for(o=e.y0-=n,e.y1-=n,i=a-2;0<=i;--i)e=t[i],0<(n=e.y1+h-o)&&(e.y0-=n,e.y1-=n),o=e.y0})}}(t),d(t),t}function d(t){t.nodes.forEach(function(t){t.sourceLinks.sort(Bt),t.targetLinks.sort(Xt)}),t.nodes.forEach(function(t){var e=t.y0,n=e;t.sourceLinks.forEach(function(t){t.y0=e+t.width/2,e+=t.width}),t.targetLinks.forEach(function(t){t.y1=n+t.width/2,n+=t.width})})}return o.update=function(t){return d(t),t},o.nodeId=function(t){return arguments.length?(e="function"==typeof t?t:Yt(t),o):e},o.nodeAlign=function(t){return arguments.length?(c="function"==typeof t?t:Yt(t),o):c},o.nodeWidth=function(t){return arguments.length?(l=+t,o):l},o.nodePadding=function(t){return arguments.length?(h=+t,o):h},o.nodes=function(t){return arguments.length?(n="function"==typeof t?t:Yt(t),o):n},o.links=function(t){return arguments.length?(i="function"==typeof t?t:Yt(t),o):i},o.size=function(t){return arguments.length?(a=s=0,r=+t[0],u=+t[1],o):[r-a,u-s]},o.extent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],s=+t[0][1],u=+t[1][1],o):[[a,s],[r,u]]},o.iterations=function(t){return arguments.length?(_=+t,o):_},o}function Jt(t){return[t.source.x1,t.y0]}function Kt(t){return[t.target.x0,t.y1]}function te(){return d3.linkHorizontal().source(Jt).target(Kt)}function ee(){return d3.linkVertical().source(function(t){return[t.y0,t.source.x1]}).target(function(t){return[t.y1,t.target.x0]})}var ne=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","sankey-plot"),e.sankeyFunc=$t(),e._width=400,e._height=400,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._strokeOpacity=.3,e._sortByIndex=!0,e._onMouseoverLink=function(){},e._onMousemoveLink=function(){},e._onMouseoutLink=function(){},e._eventOnDrag=function(){},e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,e=i._width,o=i._height,t=i._data,a=i.sankeyFunc,n=i.group;a.nodeId(function(t){return t.key}).size([e,o]);var r=a.nodePadding(),l=a(t),s=l.nodes.filter(function(t){return t.sourceLinks.length||t.targetLinks.length}),u=(n.select(".links-group").empty()?n.append("g").attr("class","links-group").style("fill","none"):n.select(".links-group")).selectAll(".link").data(l.links);u.exit().remove();var h=u.enter().append("path").attr("class","link").merge(u).attr("d",te()).style("stroke",function(t){return t.source.color}).style("stroke-width",function(t){return Math.max(1,t.width)}).style("stroke-opacity",i._strokeOpacity).on("mouseover",i._onMouseoverLink).on("mousemove",i._onMousemoveLink).on("mouseout",i._onMouseoutLink),c=(n.select(".nodes-group").empty()?n.append("g").attr("class","nodes-group"):n.select(".nodes-group")).selectAll(".node-group").data(s);c.exit().remove();var _=c.enter().append("g").attr("class","node-group");_.append("rect"),_.append("text");var d=_.merge(c).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout);d.select("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("width",function(t){return Math.max(0,t.x1-t.x0)}).attr("height",function(t){return Math.max(0,t.y1-t.y0)}).style("fill",function(t){return t.color}).style("stroke","#333"),d.select("text").attr("x",function(t){return t.x1<=e/2?t.x1+6:t.x0-6}).attr("y",function(t){return(t.y0+t.y1)/2}).attr("dy","0.35em").style("text-anchor",function(t){return t.x1<=e/2?"start":"end"}).style("font-size",i._fontSize+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).text(function(t){return t.y1-t.y0+r<i._fontSize?"":t.name}).style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1);var f=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(t){var e=d3.event.dy,n=t.y1-t.y0;t.y0=Math.max(0,Math.min(t.y0+e,o-n)),t.y1=t.y0+n,d3.select(this).select("rect").attr("y",t.y0),d3.select(this).select("text").attr("y",function(t){return(t.y0+t.y1)/2}),a.update(l),h.attr("d",te()),i._eventOnDrag()});return d.style("cursor","move").call(f),i}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"strokeOpacity",value:function(t){return arguments.length?(this._strokeOpacity=t,this):this._strokeOpacity}},{key:"onMouseoverLink",value:function(t){return arguments.length?(this._onMouseoverLink="function"==typeof t?t:function(){},this):this._onMouseoverLink}},{key:"onMousemoveLink",value:function(t){return arguments.length?(this._onMousemoveLink="function"==typeof t?t:function(){},this):this._onMousemoveLink}},{key:"onMouseoutLink",value:function(t){return arguments.length?(this._onMouseoutLink="function"==typeof t?t:function(){},this):this._onMouseoutLink}},{key:"eventOnDrag",value:function(t){return arguments.length?(this._eventOnDrag="function"==typeof t?t:function(){},this):this._eventOnDrag}},{key:"sortByIndex",value:function(t){return arguments.length?(this._sortByIndex=t,this):this._sortByIndex}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}();function ie(t,e){var r=0,l=1,s=2;if(e.forEach(function(t){"objCol"===t.function?r=t.index:"targetCol"===t.function?l=t.index:"vCol"===t.function&&(s=t.index)}),W(t,[r,l,s])||!C(t,s))return{names:[],nodes:[],links:[],valueLabel:""};var u=[],h=[],c=[],_={},d={};return t.slice(1).forEach(function(t){var e=t[r],n=t[l],i=+t[s],o=e+"-s",a=n+"-t";d[e]||(c.push(e),d[e]=!0),d[n]||(c.push(n),d[n]=!0),_[o]||(u.push({name:e,key:o}),_[o]=!0),_[a]||(u.push({name:n,key:a}),_[a]=!0),i&&h.push({source:o,target:a,value:i})}),{names:c,nodes:u,links:h,valueLabel:t[0][s]}}function oe(h,t){var c=0,_=1,d=2;if(t.forEach(function(t){"objCol"===t.function?c=t.index:"targetCol"===t.function?_=t.index:"vCol"===t.function&&(d=t.index)}),W(h,[c,_,d])||c===_||!C(h,d))return{names:[],nodes:[],links:[],valueLabel:""};for(var f=[],y=[],p=[],v={},e=function(t,e){var n=h[t],i=n[c],o=n[_],a=+n[d],r=i,l=o;if(!r||!l||!a||function(t,e,n){if(e===n)return!0;if(t[e]&&0<=t[e].ancestors.indexOf(t[n]))return!0;return!1}(v,r,l))return"continue";v[r]||(f.push({name:i,key:r}),p.push(i),v[r]={ancestors:[],decendents:[]}),v[l]||(f.push({name:o,key:l}),p.push(o),v[l]={ancestors:[],decendents:[]});var s=v[r],u=v[l];[s].concat(g(s.ancestors)).forEach(function(t){var e;(e=t.decendents).push.apply(e,[u].concat(g(u.decendents)))}),[u].concat(g(u.decendents)).forEach(function(t){var e;(e=t.ancestors).push.apply(e,[s].concat(g(s.ancestors)))}),y.push({source:r,target:l,value:a})},n=1,i=h.length;n<i;n++)e(n);return{names:p,nodes:f,links:y,valueLabel:h[0][d]}}var ae=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=this.generateColorList(t.names.length),n=d3.scaleOrdinal().domain(t.names).range(e);return t.nodes.forEach(function(t){return t.color=n(t.name)}),t.legendData=t.names.map(function(t){return{name:t,color:n(t)}}),t}}]),n}(),re=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","sankey-chart"),e.sankey=new ne(e.mainGroup),e.AnimationArea=new Ot(e.defs),e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var t=this,n=t.sankey,i=t.tooltip,e=t.AnimationArea,o=t._data.valueLabel,a=t.defs;a.selectAll("filter").remove();var r=a.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_sankey").attr("filterUnits","objectBoundingBox");r.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),r.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),r.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),r.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),r.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),n.data(t.activeData).width(t.widthOfNoMargin).height(.96*t.heightOfMainGroup).fontSize(t._fontSize).fontFamily(t._fontFamily).fontColor(t._fontColor).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(e){var t=[{color:e.color,text:e.name},{text:o+"："+Math.max(d3.sum(e.sourceLinks,function(t){return t.value}),d3.sum(e.targetLinks,function(t){return t.value}))}];n.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",.9),i.data(t).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(t){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(e){i.hide(),n.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",n.strokeOpacity())}).onMouseoverLink(function(t){var e=[{text:t.source.name+" → "+t.target.name+"："+t.value}];d3.select(this).style("stroke-opacity",.9),i.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemoveLink(function(t){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseoutLink(function(t){d3.select(this).style("stroke-opacity",n.strokeOpacity()),i.hide()}).eventOnDrag(function(){i.move([d3.event.offsetX,d3.event.offsetY])}),n.update(),e.width(0).height(t.heightOfMainGroup),e.update(),t.mainGroup.attr("clip-path","url(#"+e.id+")"),t.defs.select(".x"+e.id).transition().duration(t._transition?1e3*t._duration*.9:0).delay(t._transition?1e3*t._startDelay:0).attr("width",t.widthOfNoMargin)}},{key:"configLegend",value:function(){var t=this,i=t._data;t.legend.data(i.legendData).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.legendData.forEach(function(t){t.name===e.name&&(t.active=!n)}),i.nodes.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new ae(t,e);return n.dataSolveFunc(oe),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e.transition||0==e.transition?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this._data.nodes,n=this._data.links.filter(function(e){return t.some(function(t){return!1!==t.active&&t.key===e.source})&&t.some(function(t){return!1!==t.active&&t.key===e.target})}).map(function(t){return Object.assign({},t)});return{nodes:t.filter(function(e){return!1!==e.active&&(n.some(function(t){return e.key===t.source})||n.some(function(t){return e.key===t.target}))}).map(function(t){return Object.assign({},t)}),links:n}}}]),n}(),le=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,re),s(n,[{key:"buildOption",value:function(t,e){var n=new ae(t,e);return n.dataSolveFunc(ie),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}}]),n}(),se=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,ne),s(e,[{key:"update",value:function(){var i=this,o=i._width,e=i._height,t=i._data,a=i.sankeyFunc,n=i._fontSize,r=i.group.call(G,0,n);a.nodeId(function(t){return t.key}).size([e-2*n,o]);var l=a.nodePadding(),s=a(t),u=s.nodes.filter(function(t){return t.sourceLinks.length||t.targetLinks.length}),h=(r.select(".links-group").empty()?r.append("g").attr("class","links-group").style("fill","none"):r.select(".links-group")).selectAll(".link").data(s.links);h.exit().remove();var c=h.enter().append("path").attr("class","link").merge(h).attr("d",ee()).style("stroke",function(t){return t.source.color}).style("stroke-width",function(t){return Math.max(1,t.width)}).style("stroke-opacity",i._strokeOpacity).on("mouseover",i._onMouseoverLink).on("mousemove",i._onMousemoveLink).on("mouseout",i._onMouseoutLink),_=(r.select(".nodes-group").empty()?r.append("g").attr("class","nodes-group"):r.select(".nodes-group")).selectAll(".node-group").data(u);_.exit().remove();var d=_.enter().append("g").attr("class","node-group");d.append("rect"),d.append("text");var f=d.merge(_).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout);f.select("rect").attr("x",function(t){return t.y0}).attr("y",function(t){return t.x0}).attr("width",function(t){return Math.max(0,t.y1-t.y0)}).attr("height",function(t){return Math.max(0,t.x1-t.x0)}).style("fill",function(t){return t.color}).style("stroke","#333"),f.select("text").attr("y",function(t){return t.x0<=e/2?t.x0-6:t.x1+6}).attr("x",function(t){return(t.y0+t.y1)/2}).attr("dy",function(t){return t.x0<=e/2?"0":"0.66em"}).style("text-anchor","middle").style("font-size",n+"px").style("font-family",i._fontFamily).style("fill",i._fontColor).text(function(t){return I(t.name,t.y1-t.y0+l,n,i._fontFamily)});var y=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(t){var e=d3.event.dx,n=t.y1-t.y0;t.y0=Math.max(0,Math.min(t.y0+e,o-n)),t.y1=t.y0+n,d3.select(this).select("rect").attr("x",t.y0),d3.select(this).select("text").attr("x",function(t){return(t.y0+t.y1)/2}),a.update(s),c.attr("d",ee()),i._eventOnDrag()});return f.style("cursor","move").call(y),i}}]),e}(),ue=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","vertical-sankey-chart"),e.sankey=new se(e.mainGroup),e.AnimationArea=new Ot(e.defs),e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var t=this,n=t.sankey,i=t.tooltip,e=t.AnimationArea,o=t._data.valueLabel,a=t.defs;a.selectAll("filter").remove();var r=a.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_sankey").attr("filterUnits","objectBoundingBox");r.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),r.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),r.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),r.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),r.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),n.data(t.activeData).width(t.widthOfNoMargin).height(.96*t.heightOfMainGroup).fontSize(t._fontSize).fontFamily(t._fontFamily).fontColor(t._fontColor).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(e){var t=[{color:e.color,text:e.name},{text:o+"："+Math.max(d3.sum(e.sourceLinks,function(t){return t.value}),d3.sum(e.targetLinks,function(t){return t.value}))}];n.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",.9),i.data(t).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(t){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(e){i.hide(),n.elem.selectAll(".link").filter(function(t){return t.source===e||t.target===e}).style("stroke-opacity",n.strokeOpacity())}).onMouseoverLink(function(t){var e=[{text:t.source.name+" → "+t.target.name+"："+t.value}];d3.select(this).style("stroke-opacity",.9),i.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemoveLink(function(t){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseoutLink(function(t){d3.select(this).style("stroke-opacity",n.strokeOpacity()),i.hide()}).eventOnDrag(function(){i.move([d3.event.offsetX,d3.event.offsetY])}),n.update(),e.width(t._width).height(0),e.update(),t.mainGroup.attr("clip-path","url(#"+e.id+")"),t.defs.select(".x"+e.id).attr("y",-t._fontSize/2).transition().duration(t._transition?1e3*t._duration*.9:0).delay(t._transition?1e3*t._startDelay:0).attr("x",-t._fontSize/2).attr("height",t._height)}},{key:"configLegend",value:function(){var t=this,i=t._data;t.legend.data(i.legendData).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.legendData.forEach(function(t){t.name===e.name&&(t.active=!n)}),i.nodes.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new ae(t,e);return n.dataSolveFunc(oe),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e.transition||0==e.transition?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this._data.nodes,n=this._data.links.filter(function(e){return t.some(function(t){return!1!==t.active&&t.key===e.source})&&t.some(function(t){return!1!==t.active&&t.key===e.target})}).map(function(t){return Object.assign({},t)});return{nodes:t.filter(function(e){return!1!==e.active&&(n.some(function(t){return e.key===t.source})||n.some(function(t){return e.key===t.target}))}).map(function(t){return Object.assign({},t)}),links:n}}}]),n}(),he=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.keyArr,n=this.generateColorList(e.length);return t.legendData=e.map(function(t,e){return{name:t,color:n[e]}}),t}}]),n}();function ce(t,e){var r=0,l=1,s=2;if(e.forEach(function(t){"objCol"===t.function?r=t.index:"targetCol"===t.function?l=t.index:"vCol"===t.function&&(s=t.index)}),W(t,[r,l,s])||!C(t,s))return{keyArr:[],matrix:[],valueLabel:""};var i=[],u={},o=0;t.slice(1).forEach(function(t){var e=t[r],n=t[l];void 0===u[e]&&(u[e]=o,i.push(e),o++),void 0===u[n]&&(u[n]=o,i.push(n),o++)});var h=d3.range(o).map(function(t){return d3.range(o).map(function(t){return 0})});return t.slice(1).forEach(function(t){var e=t[r],n=t[l],i=t[s],o=u[e],a=u[n];h[o][a]=Math.abs(i)||0}),{keyArr:i,matrix:h,valueLabel:t[0][s]}}var _e=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","chord"),e.chordFunc=d3.chord(),e._innerRadius=100,e._outerRadius=120,e._padAngle=.02,e._onMouseoverChord=function(){},e._onMousemoveChord=function(){},e._onMouseoutChord=function(){},e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,i=n._data.matrix,o=n._data.nodes,t=n.group;if(!(o.length<=1)){var e=n._innerRadius,a=n._outerRadius,r=n._padAngle,l=n.chordFunc.padAngle(r),s=d3.arc().innerRadius(e).outerRadius(a),u=d3.ribbon().radius(e);t.datum(l(i)).call(G,a,a);var h=t.selectAll(".arc-group").data(function(t){return t.groups});h.exit().remove();var c=h.enter().append("g").attr("class","arc-group");c.append("path").attr("class","arc-path"),c.merge(h).each(n._onTransitionEnd).select("path").attr("d",s).style("fill",function(t){return o[t.index].color}).style("stroke",function(t){return o[t.index].color}).style("opacity","0").on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).transition().duration(n._transition?.1*n._duration:0).style("opacity","1");var _=t.selectAll(".ribbon-path").data(function(t){return t});return _.exit().remove(),_.enter().append("path").attr("class","ribbon-path").merge(_).attr("d",u).style("fill",function(t,e){return o[t.source.index].color}).style("stroke",function(t){return d3.rgb(o[t.source.index].color).darker()}).style("fill-opacity",.8).style("stroke-opacity",.8).style("opacity","0").on("mouseover",n._onMouseoverChord).on("mousemove",n._onMousemoveChord).on("mouseout",n._onMouseoutChord).transition().duration(n._transition?.8*n._duration/l(i).length:0).delay(function(t,e){return n._transition?e*(.8*n._duration/l(i).length)+.1*n._duration:0}).style("opacity","1"),n}t.selectAll("*").remove()}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"onMouseoverChord",value:function(t){return arguments.length?(this._onMouseoverChord="function"==typeof t?t:function(){},this):this._onMouseoverChord}},{key:"onMousemoveChord",value:function(t){return arguments.length?(this._onMousemoveChord="function"==typeof t?t:function(){},this):this._onMousemoveChord}},{key:"onMouseoutChord",value:function(t){return arguments.length?(this._onMouseoutChord="function"==typeof t?t:function(){},this):this._onMouseoutChord}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),de=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","chord-chart"),e.chord=new _e(e.mainGroup),e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=1,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var o=this,t=o.activeData,a=t.nodes,n=o.chord,i=o.tooltip,e=o.widthOfNoMargin,r=o.heightOfMainGroup,l=o._fontSize,s=o._data.valueLabel,u=Math.min(e,r)/2-l,h=.9*u;function c(t,e){"number"==typeof e?n.group.selectAll(".ribbon-path").filter(function(t){return t.source.index!==e&&t.target.index!==e}).transition().style("opacity",t):n.group.selectAll(".ribbon-path").filter(function(t){return this!==e}).transition().style("opacity",t)}n.data(t).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause).innerRadius(h).outerRadius(u).translate(e/2-u,r/2-u).onMouseover(function(t){var e=t.index,n=[{color:a[e].color,text:a[e].name},{text:s+"："+t.value}];i.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show(),c(0,e)}).onMousemove(function(){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){i.hide(),c(1,t.index)}).onMouseoverChord(function(t){var e=[];e=t.source.value===t.target.value?[{text:a[t.source.index].name+" ↔ "+a[t.target.index].name+"："+t.source.value}]:[{text:a[t.source.index].name+" → "+a[t.target.index].name+"："+t.source.value},{text:a[t.target.index].name+" → "+a[t.source.index].name+"："+t.target.value}],i.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show(),c(.1,this)}).onMousemoveChord(function(){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseoutChord(function(t){i.hide(),c(1,this)}).onTransitionEnd(function(t){var e=d3.select(this),n="arc-path-"+t.index+"-"+o.id,i=D(u+l-2,t.startAngle,t.endAngle);N(e,o.defs.select("#"+n).empty()?o.defs.append("path").attr("d",i).attr("id",n):o.defs.select("#"+n).attr("d",i),a[t.index].name,l,o._fontFamily).attr("class",o.labelTextClass).style("pointer-events","none").style("fill",o._fontColor),o.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(o._transition?1e3*o._duration*.1:0).delay(function(t,e){return o._duration?1e3*o._duration*.9:0}).style("opacity",1)}),n.update()}},{key:"configLegend",value:function(){var t=this,e=t.legend,i=t._data.legendData;e.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new he(t,e);return n.dataSolveFunc(ce),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this._data,e=t.matrix,n=t.legendData,i=[];n.forEach(function(t,e){!1===t.active&&i.push(e)});var o=n.filter(function(t){return!1!==t.active}),a=[];return e.forEach(function(t,e){if(i.indexOf(e)<0){var n=[];t.forEach(function(t,e){i.indexOf(e)<0&&n.push(t)}),a.push(n)}}),{nodes:o,matrix:a}}}]),n}(),fe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","icon-pie"),e.defs=e.elem.append("defs"),e._width=400,e._height=400,e._icon={name:"male",width:14.57,height:25,path:"m14.57,9.54l0,5.91q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5l-0.91,0l0,12.95q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-6.59l-0.91,0l0,6.59q0,0.65,-0.47,1.12t-1.12,0.47t-1.12,-0.47t-0.47,-1.12l0,-12.95l-0.91,0l0,5q0,0.57,-0.4,0.97t-0.97,0.4t-0.97,-0.4t-0.4,-0.97l0,-5.91q0,-1.14,0.8,-1.93t1.93,-0.8l9.09,0q1.14,0,1.93,0.8t0.8,1.93Zm-4.09,-6.36q0,1.32,-0.93,2.25t-2.25,0.93t-2.25,-0.93t-0.93,-2.25t0.93,-2.25t2.25,-0.93t2.25,0.93t0.93,2.25Z"},e._countOfOneRow=20,e._rowCount=5,e._padding=2,e}return h(n,P),s(n,[{key:"update",value:function(){var y=this,p=y._data,v=y._width,t=y._height,e=y._padding,g=y._icon,m=y._countOfOneRow,l=y._rowCount,s=d3.sum(p,function(t){return t.value}),i=p.length,u=0,x=p.map(function(t){var e=s<=m*l?t.value:t.value/s*(m*l),n=u+e,i=u;u=n;var o=Math.floor(e),a=!1,r=!1;return i%1!=0&&(a=!0,o++),n%1!=0&&(r=!0,o++),{percent:e,count:o,startPercent:i,endPercent:n,hasHead:a,hasTail:r}});s<m*l&&(l=Math.ceil(s/m)),s<m&&(m=Math.ceil(s));var S=v/m,k=t/l,b=S-2*e,w=k-2*e,F=Math.min(b/g.width,w/g.height);b=g.width*F,w=g.height*F,function(){var _=y.group,d=y.defs,f=y.id;_.selectAll("*").remove(),d.selectAll("*").remove();var t=f+"-icon";d.append("path").attr("id",t).attr("d",g.path);for(var e=function(e){var n=x[e];if(!n.percent)return"continue";var t=Math.floor(n.startPercent),i=n.startPercent%m*S,o=Math.floor(t/m)*k,a=Math.ceil(n.endPercent),r=n.endPercent%m==0?(n.endPercent-1)%m*S+S:n.endPercent%m*S,l=(Math.ceil(a/m)-1)*k,s=d.append("clipPath").attr("id","clip-path-"+f+"-"+e);s.append("path").attr("id","icon-overlay-"+f+"-"+e).attr("d",function(){var t=Math.floor(n.startPercent/m)<Math.floor(n.endPercent/m),e="M"+i+","+(o+k)+"V"+o+"H"+(t?v:r)+"V"+(t?l:l+k);return t&&(e+="H"+r+"v"+k+"H0V"+(o+k)),e+="Z"}).style("fill","transparent").style("opacity",0);for(var u=_.append("g").attr("clip-path","url(#clip-path-"+f+"-"+e+")"),h=function(n){var t=u.append("g").attr("transform",function(){var t=n%m*S,e=Math.floor(n/m)*k;return"translate("+t+","+e+")"});t.append("path").attr("class","icon-path-"+e).attr("d",g.path).style("fill",p[e].color).style("stroke-width",1/F).attr("transform","translate("+(S-b)/2+", "+(k-w)/2+")scale("+F+")")},c=t;c<a;c++)h(c);u.append("use").datum({index:e,data:p[e]}).attr("xlink:href","#icon-overlay-"+f+"-"+e).on("mouseover",y._onMouseover).on("mousemove",y._onMousemove).on("mouseout",y._onMouseout)},n=0;n<i;n++)e(n)}();var n=y.group.selectAll("path"),o=n.nodes().length,a=0;return n.style("opacity",0).transition().duration(y._transition?y._duration/o:0).delay(function(){return a<o&&y._transition?y._duration/o*a++:0}).style("opacity",1),y}},{key:"icon",value:function(t){return arguments.length?(this._icon=t,this):this._icon}},{key:"countOfOneRow",value:function(t){return arguments.length?(this._countOfOneRow=t,this):this._countOfOneRow}},{key:"padding",value:function(t){return arguments.length?(this._padding=t,this):this._padding}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),ye=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","icon-pie-chart"),e.iconPie=new fe(e.mainGroup),e.AnimationArea=new Ot(e.defs),e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var t=this,e=t.iconPie,i=t.tooltip,o=(t.AnimationArea,e.elem);e.data(t.activeData).width(t.widthOfNoMargin).height(t.heightOfMainGroup).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(t,e){o.selectAll(".icon-path-"+t.index).style("fill-opacity",.4);var n=[{color:t.data.color,text:t.data.name=="$-"+t.index?"":t.data.name},{text:t.data.valueLabel+": "+t.data.value}];i.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){o.selectAll(".icon-path-"+t.index).style("stroke","none").style("fill-opacity",1),i.hide()}),e.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}}]),n}(),pe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","two-level-pie"),e.overlayCircle=e.elem.append("defs").append("clipPath").attr("id","overlay-"+e.id).append("circle"),e._radius=0,e._cornerRadius=4,e._padAngle=.01,e._stroke="#fff",e._strokeWidth=1,e._each=function(){},e}return h(n,z),s(n,[{key:"update",value:function(){var t=this,e=t._data,n=t._radius,i=d3.partition().size([2*Math.PI,n])(d3.hierarchy(e).sum(function(t){return t.value})),o=i.descendants(),a=Math.min(d3.min(o,function(t){return t.value})/i.value*Math.PI,t._padAngle),r=d3.arc().startAngle(function(t){return t.x0}).endAngle(function(t){return t.x1}).innerRadius(function(t){return 1===t.depth?t.y0-3:t.y0}).outerRadius(function(t){return 1===t.depth?t.y1-3:t.y1}).padAngle(a).cornerRadius(t._cornerRadius);t.overlayCircle.attr("r",0).transition().duration(t._transition?.9*t._duration:0).ease(d3.easeLinear).attr("r",n);var l=t.group.call(G,n,n).attr("clip-path","url(#overlay-"+t.id+")").selectAll("g").data(o.filter(function(t){return 0!==t.depth}),function(t){return t.data.key});l.exit().remove();var s=l.enter().append("g");return s.append("path"),s.merge(l).select("path").attr("class","arc-path").attr("d",r).style("fill",function(t){if(t.data.color)return t.data.color;var e=t.parent,n=d3.scaleLinear().clamp(!1).domain([0,1]),i=d3.hsl(e.data.color),o=e.children.length;if(1===o)i.l+=.08;else{n.range([i.l+Math.min(.4,.08*o)/2,i.l-Math.min(.4,.08*o)/2]);var a=e.children.indexOf(t)/(o-1);console.log(a),i.l=n(a)}return i}).style("stroke",t._stroke).style("stroke-width",t._strokeWidth).on("mouseover",t._onMouseover).on("mousemove",t._onMousemove).on("mouseout",t._onMouseout).each(t._each),t}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"each",value:function(t){return arguments.length?(this._each="function"==typeof t?t:function(){},this):this._each}}]),n}(),ve=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.nodes,i=this.generateColorList(e.length);return e.forEach(function(t,e){var n=i[e];t.color=n}),t}}]),n}();function ge(t,e){var a=0,r=1,l=2;if(e.forEach(function(t){"objCol"===t.function?a=t.index:"typeCol"===t.function?r=t.index:"vCol"===t.function&&(l=t.index)}),W(t,[a,r,l])||!C(t,l))return{nodes:[],valueLabel:""};var s={};t.slice(1).forEach(function(t,e){var n=t[a],i=t[r],o=t[l];s[n]?s[n].children.push({name:null==i?"":i,key:i+"-t-"+e,index:e,value:""==o||isNaN(parseFloat(o))||null==o||null==o?0:o}):s[n]={name:n,key:n+"-s-"+e,index:e,children:[{name:null==i?"":i,key:i+"-t-"+e,index:e,value:""==o||isNaN(parseFloat(o))||null==o||null==o?0:o}]}});var n=[];for(var i in s)n.push(s[i]);return n.forEach(function(t){return t.sum=d3.sum(t.children,function(t){return t.value})}),{nodes:n,valueLabel:t[0][l]}}var me=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,A),s(e,[{key:"updateCore",value:function(){}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.nodes,o=i.map(function(t,e){return{name:t.name,color:t.color,key:t.name+"-"+e}});t.legend.data(o).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),o.forEach(function(t){t.key===e.key&&(t.active=!n)}),i.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new ve(t,e);return n.dataSolveFunc(ge),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),e}(),xe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","two-level-donut-chart"),e.core=new pe(e.mainGroup),e.lineText=new T(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,me),s(n,[{key:"updateCore",value:function(){for(var a=this,t=a.core,n=a.tooltip,e=a.lineText,i=a.activeData,o=[],r=[],l=0;l<i.children.length;l++)for(var s=0;s<i.children[l].children.length;s++){i.children[l].children[s].percent=(i.children[l].children[s].value/i.children[l].sum*100).toFixed(1);var u=d3.scaleLinear().clamp(!1).domain([0,1]),h=d3.hsl(i.children[l].color),c=i.children[l].children.length;if(1===c)h.l+=.08;else{u.range([h.l+Math.min(.4,.08*c)/2,h.l-Math.min(.4,.08*c)/2]);var _=i.children[l].children.indexOf(i.children[l].children[s])/(c-1);h.l=u(_)}i.children[l].children[s].color=h,o.push(i.children[l].children[s]),r.push(i.children[l].children[s].name)}var d=a._data.valueLabel,f=(ht(r,a._fontSize,a._fontFamily),.74*a.widthOfNoMargin),y=.74*a.heightOfMainGroup;null==a._labelShow||null==a._positionOptions||null==a._positionChoice||null==a._contentOption||null==a._contentChoice||0==a._contentChoice.length?(f=.88*a.widthOfNoMargin,y=.88*a.heightOfMainGroup):0!=a._labelShow&&1!=a._positionOptions.indexOf(a._positionChoice)&&-1!=a._positionOptions.indexOf(a._positionChoice)||(f=.88*a.widthOfNoMargin,y=.88*a.heightOfMainGroup);var p=Math.min(f,y)/2,v=a.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_twoLevelPie").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.data(a.activeData).radius(p).translate(a.widthOfNoMargin/2-p,a.heightOfMainGroup/2-p).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).onMouseover(function(t){var e=[{color:t.data.color||t.parent.data.color,text:t.data.name},{text:d+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(1))}];n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show(),d3.select(this).transition().duration(20).style("fill-opacity",.7)}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){n.hide(),d3.select(this).transition().duration(20).style("fill-opacity",1)}).each(function(t){var e=d3.select(this.parentNode),n="arc-path-"+t.data.key+"-"+t.depth+"-"+a.id,i=D(.5*(t.y0+t.y1),t.x0,t.x1),o=a.defs.select("#"+n).empty()?a.defs.append("path").attr("d",i).attr("id",n):a.defs.select("#"+n).attr("d",i);0==a._labelShow||null==a._labelShow||null==a._positionOptions||null==a._positionChoice||null==a._contentOption||null==a._contentChoice||0==a._contentChoice.length?a.group.selectAll(".chart-label-text").style("display","none"):0!=a._positionOptions.indexOf(a._positionChoice)&&1!=a._positionOptions.indexOf(a._positionChoice)||!t.children?1!=a._positionOptions.indexOf(a._positionChoice)||t.children||(1==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])?N(e,o,t.data.name,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):1==a._contentOption.indexOf(a._contentChoice[0])?N(e,o,t.data.percent+"%",a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):2==a._contentOption.indexOf(a._contentChoice[0])&&N(e,o,t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily):2==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1])||1==a._contentOption.indexOf(a._contentChoice[0])&&0==a._contentOption.indexOf(a._contentChoice[1])?N(e,o,t.data.name+"  "+t.data.percent+"%",a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])||2==a._contentOption.indexOf(a._contentChoice[0])&&0==a._contentOption.indexOf(a._contentChoice[1])?N(e,o,t.data.name+"  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])||2==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1]))&&N(e,o,t.data.percent+"%  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==a._contentChoice.length&&N(e,o,t.data.name+"  "+t.data.percent+"%  "+t.data.value,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve")):N(e,o,t.data.name,a._textLabel.fontSize,a._textLabel.fontFamily,"52%").attr("class",a.labelTextClass).style("pointer-events","none").style("fill",a._textLabel.color).style("font-size",a._textLabel.fontSize).style("font-family",a._textLabel.fontFamily),a.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(a._transition?1e3*a._duration*.1:0).delay(function(t,e){return a._duration?1e3*a._duration*.9:0}).style("opacity",1)}),null!=a._labelShow&&(0!=a._labelShow&&0==a._positionOptions.indexOf(a._positionChoice)?(e.data(o).outerRadius(p).cornerRadius(a._cornerRadius).startAngle(a._startAngle).endAngle(a._endAngle).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).labelShow(a._labelShow).positionOptions(a._positionOptions).positionChoice(a._positionChoice).contentOption(a._contentOption).contentChoice(a._contentChoice).values(o).level("two").transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause),a.lineText.translate(a.widthOfNoMargin/2,a.heightOfMainGroup/2).update(),a.group.select(".outside-text-polygon").attr("display","block")):0!=a._labelShow&&1!=a._positionOptions.indexOf(a._positionChoice)&&-1!=a._positionOptions.indexOf(a._positionChoice)||a.group.select(".outside-text-polygon").attr("display","none")),t.update()}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}}]),n}(),Se=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.nodes,n=this.generateColorList(e.length);return e.forEach(function(t,e){return t.color=n[e]}),t}}]),n}();function ke(t,e){var n=0,i=1;return e.forEach(function(t){"objCol"===t.function?n=t.index:"vCol"===t.function&&(i=t.index)}),W(t,[n,i])||!C(t,i)?{nodes:[],valueLabel:""}:{nodes:t.slice(1).map(function(t,e){return{name:t[n],key:t[n]+"-"+e,value:t[i]}}),valueLabel:t[0][i]}}var be=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","treemap"),e._width=400,e._height=400,e._paddingInner=1,e}return h(n,P),s(n,[{key:"update",value:function(){var a=this,t=a._data,e=a.group,r=a._fontSize,l=a._fontFamily;if(t.children.length<1)return e.selectAll("*").remove(),a;var n=d3.treemap().size([a._width,a._height]).paddingInner(a._paddingInner).round(!0),i=d3.hierarchy(t).sum(function(t){return t.value});n(i),e.selectAll(".node").remove();var o=e.selectAll(".node").data(i.leaves(),function(t){return t.data.key});o.exit().remove();var s=o.enter().append("g").attr("class","node");s.append("rect"),s.merge(o).on("mouseover",a._onMouseover).on("mousemove",a._onMousemove).on("mouseout",a._onMouseout).transition().duration(a._transition?.9*a._duration:0).delay(a._transition?a._startDelay:0).on("end",a._onTransitionEnd).select("rect").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).style("fill",function(t){return t.data.color}),a.group.selectAll(".one-level-treemap-group").remove();var u=e.append("g").selectAll("g").data(i.leaves(),function(t){return t.data.key});return u.exit().remove(),u.enter().append("g").attr("class","one-level-treemap-group").merge(u).each(function(t,e){var n=t.y1-t.y0,i=t.x1-t.x0,o=d3.select(this).append("g").attr("class","one-level-treemap-texts").attr("transform",function(){return null==a._positionOptions||null==a._positionChoice?0:0==a._positionOptions.indexOf(a._positionChoice)?"translate("+(t.x0+6)+","+(t.y0+6)+")":1==a._positionOptions.indexOf(a._positionChoice)?"translate("+((t.x1-t.x0)/2+t.x0)+","+((t.y1-t.y0)/2+t.y0)+")":void 0}).attr("font-size",r+"px").attr("font-family",l).attr("text-anchor",function(){return null==a._positionOptions||null==a._positionChoice?0:0==a._positionOptions.indexOf(a._positionChoice)?"start":1==a._positionOptions.indexOf(a._positionChoice)?"middle":void 0}).style("fill",a._fontColor);r+10<n&&(o.append("text").attr("class","one-level-treemap-name").attr("dy","0.75em").text(I(null==t.data.name?"":t.data.name,i-10,r,l)),2*r+10<n&&o.append("text").attr("class","one-level-treemap-percent").attr("dy","2em").text(I(isNaN(parseFloat(t.data.value))?"":t.data.percent,i-10,r,l)),3*r+10<n&&o.append("text").attr("class","one-level-treemap-value").attr("dy","3.25em").text(I(isNaN(parseFloat(t.data.value))?"":t.data.value,i-10,r,l)))}),a.group.selectAll(".one-level-treemap-group").style("opacity",0).transition().duration(a._transition?.1*a._duration:0).delay(function(t,e){return a._duration?a._startDelay+.9*a._duration:0}).style("opacity",1),0==a._labelShow||null==a._labelShow||null==a._positionOptions||null==a._positionChoice||null==a._contentOption||null==a._contentChoice||0==a._contentChoice.length?a.group.selectAll(".one-level-treemap-group").style("display","none"):0==a._positionOptions.indexOf(a._positionChoice)?1==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])?(a.group.selectAll(".one-level-treemap-name").style("display","block"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","none")):1==a._contentOption.indexOf(a._contentChoice[0])?(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.75em"),a.group.selectAll(".one-level-treemap-value").style("display","none")):2==a._contentOption.indexOf(a._contentChoice[0])&&(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","0.75em")):2==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1])?(a.group.selectAll(".one-level-treemap-name").style("display","block"),a.group.selectAll(".one-level-treemap-percent").style("display","block"),a.group.selectAll(".one-level-treemap-value").style("display","none")):0==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])?(a.group.selectAll(".one-level-treemap-name").style("display","block"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","2em")):1==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])&&(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.75em"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","2em")):3==a._contentChoice.length&&(a.group.selectAll(".one-level-treemap-name").style("display","block"),a.group.selectAll(".one-level-treemap-percent").style("display","block"),a.group.selectAll(".one-level-treemap-value").style("display","block")):1==a._positionOptions.indexOf(a._positionChoice)&&(1==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])?(a.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","0.5em"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","none")):1==a._contentOption.indexOf(a._contentChoice[0])?(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.5em"),a.group.selectAll(".one-level-treemap-value").style("display","none")):2==a._contentOption.indexOf(a._contentChoice[0])&&(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","0.5em")):2==a._contentChoice.length?0==a._contentOption.indexOf(a._contentChoice[0])&&1==a._contentOption.indexOf(a._contentChoice[1])?(a.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.125em"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","1.125em"),a.group.selectAll(".one-level-treemap-value").style("display","none")):0==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])?(a.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.125em"),a.group.selectAll(".one-level-treemap-percent").style("display","none"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.125em")):1==a._contentOption.indexOf(a._contentChoice[0])&&2==a._contentOption.indexOf(a._contentChoice[1])&&(a.group.selectAll(".one-level-treemap-name").style("display","none"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","-0.125em"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.125em")):3==a._contentChoice.length&&(a.group.selectAll(".one-level-treemap-name").style("display","block").attr("dy","-0.75em"),a.group.selectAll(".one-level-treemap-percent").style("display","block").attr("dy","0.5em"),a.group.selectAll(".one-level-treemap-value").style("display","block").attr("dy","1.75em"))),a}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),we=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","one-level-treemap-chart"),e.treemap=new be(e.mainGroup),e._sortValue=-1,e._marginLeft=24,e._marginRight=24,e._labelShow=!0,e._positionOptions=["内部左上","内部居中"],e._positionChoice="内部左上",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称","数值"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var t=this,e=t.treemap,n=t.tooltip,i=t.widthOfNoMargin,o=.96*t.heightOfMainGroup,a=t._data.valueLabel,r=(t._fontSize,t._fontFamily,t.activeData),l=0,s=0;s<(0==r.length?0:r.children.length);s++)l+=isNaN(parseFloat(r.children[s].value))?0:parseFloat(r.children[s].value);for(var u=0;u<r.children.length;u++)r.children[u].percent=((isNaN(parseFloat(r.children[u].value))?0:parseFloat(r.children[u].value))/l*100).toFixed(2)+"%";var h=t.defs;h.selectAll("filter").remove();var c=h.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_one_treemap").attr("filterUnits","objectBoundingBox");c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),c.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),c.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),c.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),c.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(t.activeData).width(i).height(o).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).contentOption(t._contentOption).contentChoice(t._contentChoice).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(0).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(t){var e=[{color:t.data.color,text:t.data.name},{text:a+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2))}];n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show(),d3.select(this).style("fill-opacity",.7)}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){n.hide(),d3.select(this).style("fill-opacity",1)}).onTransitionEnd(function(t){}),e.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.nodes;t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){-1===this._sortValue&&this._data.nodes.sort(function(t,e){return e.value-t.value}),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new Se(t,e);return n.dataSolveFunc(ke),n}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),n}(),Fe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","two-level-treemap"),e._clipId="clip-overlay-"+e.id,e.overlayRect=e.elem.append("defs").append("clipPath").attr("id",e._clipId).append("rect"),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleLinear(),e._width=400,e._height=400,e._paddingInner=1,e._paddingOuter=2,e._stroke="#fff",e._parentFillOpacity=.7,e._transition=!0,e._duration=500,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this;o.group.attr("clip-path","url("+S("#"+o._clipId)+")");var t=o._data,a=o.group;if(t.children.length<1)return a.selectAll("*").remove(),o;var r=!1,l=!1,e=o._width,n=o._height,s=o.xScale.domain([0,1]).range([0,e]),u=o.yScale.domain([0,1]).range([0,n]),h=d3.hierarchy(t).sum(function(t){return t.value});function i(){var t=(a.select(".children-group").empty()?a.append("g").attr("class","children-group"):a.select(".children-group")).selectAll(".child-node").data(h.leaves(),function(t){return t.data.key});t.exit().remove();var e=t.enter().append("g").attr("class","child-node");e.append("rect"),e.merge(t).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).on("click",function(){l=!0,_(h)}).transition().duration(o._transition||l?o._duration:0).on("start",r?o._onTransitionStart:null).on("end.a",r?o._onTransitionEnd:null).on("end.b",function(){l=!1}).select("rect").attr("x",function(t){return s(t.x0)}).attr("y",function(t){return u(t.y0)}).attr("width",function(t){return s(t.x1)-s(t.x0)}).attr("height",function(t){return u(t.y1)-u(t.y0)}).style("fill",function(t){return t.parent.data.color}).style("stroke",o._stroke).style("stroke-width",o._paddingInner).style("opacity",1)}function c(){var t=a.select(".parent-group").empty()?a.append("g").attr("class","parent-group"):a.select(".parent-group"),e=h.descendants().filter(function(t){return 1===t.depth}),n=t.selectAll(".parent-node").data(e,function(t){return t.data.key});n.exit().remove();var i=n.enter().append("g").attr("class","parent-node");i.append("rect"),i.merge(n).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout).on("click",function(t){l=!0,_(t)}).transition().duration(o._transition||l?o._duration:0).on("start.a",r?null:o._onTransitionStart).on("start.b",function(){t.style("display",r?"none":"block")}).on("end",r?null:o._onTransitionEnd).select("rect").attr("x",function(t){return s(t.x0)}).attr("y",function(t){return u(t.y0)}).attr("width",function(t){return s(t.x1)-s(t.x0)}).attr("height",function(t){return u(t.y1)-u(t.y0)}).style("fill",function(t){return t.data.color}).style("fill-opacity",o._parentFillOpacity).style("stroke",o._stroke).style("stroke-width",o._paddingOuter).style("opacity",1)}function _(t){var e=t.depth;s.domain([t.x0,t.x1]),u.domain([t.y0,t.y1]),r=1===e,i(),c()}return d3.treemap().size([1,1]).round(!1)(h),o.overlayRect.attr("width",e).attr("height",n),_(h),o}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Oe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","two-level-treemap-chart"),e.treemap=new Fe(e.mainGroup),e._sortValue=-1,e._labelShow=!0,e._positionOptions=["内部左上","内部居中"],e._positionChoice="内部左上",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称","数值"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,me),s(n,[{key:"updateCore",value:function(){for(var l=this,s=l.treemap,n=l.tooltip,t=l.widthOfNoMargin,e=.96*l.heightOfMainGroup,i=l._data.valueLabel,u=(l._fontSize,l._fontFamily),o=l.activeData,a=0,r=0;r<o.children.length;r++)a+=o.children[r].sum;for(var h=0;h<o.children.length;h++){o.children[h].percent=(o.children[h].sum/a*100).toFixed(2)+"%";for(var c=0;c<o.children[h].children.length;c++)o.children[h].children[c].percent=(parseFloat(o.children[h].children[c].value)/o.children[h].sum*100).toFixed(2)+"%"}s.data(l.activeData).width(t).height(e).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(1e3*parseFloat(l._startDelay)).moveStyle(l._moveStyle).endPause(l._endPause).onMouseover(function(t){var e=[{color:t.data.color||t.parent.data.color,text:t.data.name},{text:i+"："+(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2))}];n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show(),d3.select(this).select("rect").style("opacity",.5)}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){n.hide(),d3.select(this).select("rect").style("opacity",1)}).onTransitionStart(function(){s.elem.selectAll(".two-level-treemap-texts").remove()}).onTransitionEnd(function(t){var e=s.xScale,n=s.yScale,i=n(t.y1)-n(t.y0),o=e(t.x1)-e(t.x0),a=d3.select(this).append("g").attr("class","two-level-treemap-texts").attr("transform",function(){return null==l._positionOptions||null==l._positionChoice?"translate(0)":0==l._positionOptions.indexOf(l._positionChoice)?"translate("+(e(t.x0)+6)+","+(n(t.y0)+6)+")":1==l._positionOptions.indexOf(l._positionChoice)?"translate("+((e(t.x1)-e(t.x0))/2+e(t.x0))+","+((n(t.y1)-n(t.y0))/2+n(t.y0))+")":void 0}).style("font-size",l._textLabel.fontSize+"px").style("font-family",l._textLabel.fontFamily).style("fill",l._textLabel.color).attr("text-anchor",function(){return null==l._positionOptions||null==l._positionChoice?0:0==l._positionOptions.indexOf(l._positionChoice)?"start":1==l._positionOptions.indexOf(l._positionChoice)?"middle":void 0}),r="";i>l._textLabel.fontSize+10&&(r=I(t.data.name,o-10,l._textLabel.fontSize,u),a.append("text").attr("class","two-level-treemap-name").attr("dy","0.75em").text(r),a.append("text").attr("class","two-level-treemap-percent").attr("dy","2em").text(I(t.data.percent,o-10,l._textLabel.fontSize,u)),a.append("text").attr("class","two-level-treemap-value").attr("dy","3.25em").text(I(-1==String(t.value).indexOf(".")?t.value:t.value.toFixed(2),o-10,l._textLabel.fontSize,u))),0==l._labelShow||null==l._labelShow||null==l._positionOptions||null==l._positionChoice||null==l._contentOption||null==l._contentChoice||0==l._contentChoice.length?l.group.selectAll(".two-level-treemap-texts").style("display","none"):0==l._positionOptions.indexOf(l._positionChoice)?1==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","none")):1==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.75em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):2==l._contentOption.indexOf(l._contentChoice[0])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","0.75em")):2==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])&&1==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","block"),l.group.selectAll(".two-level-treemap-value").style("display","none")):0==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","2em")):1==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.75em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","2em")):3==l._contentChoice.length&&(l.group.selectAll(".two-level-treemap-name").style("display","block"),l.group.selectAll(".two-level-treemap-percent").style("display","block"),l.group.selectAll(".two-level-treemap-value").style("display","block")):1==l._positionOptions.indexOf(l._positionChoice)&&(1==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","none")):1==l._contentOption.indexOf(l._contentChoice[0])?(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):2==l._contentOption.indexOf(l._contentChoice[0])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","0.5em")):2==l._contentChoice.length?0==l._contentOption.indexOf(l._contentChoice[0])&&1==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","1.125em"),l.group.selectAll(".two-level-treemap-value").style("display","none")):0==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])?(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-percent").style("display","none"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.125em")):1==l._contentOption.indexOf(l._contentChoice[0])&&2==l._contentOption.indexOf(l._contentChoice[1])&&(l.group.selectAll(".two-level-treemap-name").style("display","none"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","-0.125em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.125em")):3==l._contentChoice.length&&(l.group.selectAll(".two-level-treemap-name").style("display","block").attr("dy","-0.75em"),l.group.selectAll(".two-level-treemap-percent").style("display","block").attr("dy","0.5em"),l.group.selectAll(".two-level-treemap-value").style("display","block").attr("dy","1.75em"))),l.group.selectAll(".two-level-treemap-texts").style("opacity",0).transition().duration(l._transition?1e3*l._duration*.1:0).style("opacity",1)}),s.update()}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}).forEach(function(t){t.children.sort(function(t,e){return e.sum-t.sum||t.index-e.index})}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}).forEach(function(t){t.children.sort(function(t,e){return t.sum-e.sum||t.index-e.index})}),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}}]),n}();function Ce(t,e){var n=0,i=0;if(e.forEach(function(t){"sourceCol"===t.function?n=t.index:"targetCol"===t.function&&(i=t.index)}),W(t,[n,i]))return{nodesObj:{},nodesArr:[],root:{}};for(var o=[],a={},r=0,l=t.length,s=1;s<l;s++){var u=t[s],h=u[n],c=u[i];if(h&&c&&h!==c){if(!a[h]){var _={name:h,index:r};a[h]=_,o.push(_),r++}if(!a[c]){var d={name:c,index:r};a[c]=d,o.push(d),r++}var f=a[h],y=a[c];y.parent||((y.parent=f).children?f.children.push(y):f.children=[y])}}var p=null,v=o.filter(function(t){return!t.parent});return function e(t){var n=t.depth?t.depth:t.depth=0;t.children&&t.children.forEach(function(t){t.depth=n+1,e(t)})}(p=1===v.length?v[0]:1<v.length?{name:"",children:v}:{name:"",children:[]}),{nodesObj:a,nodesArr:o,root:p}}function Ae(t,e){var n=Ce(t[0],e[0]),i=ke(t[1],e[1]);return n.nodesArr.forEach(function(e){i.nodes.forEach(function(t){e.name===t.name&&(e.value=t.value)})}),{root:n.root,valueLabel:i.valueLabel}}var Pe=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data,this._columnMap),e=t.root;if(e&&e.children){var n=e.children.slice(0);e.name&&n.unshift(e),w(n,this.generateColorList(n.length))}return{root:t.root,valueLabel:t.valueLabel}}}]),n}(),ze=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","sunburst"),e.arcFunc=d3.arc(),e._radius=200,e._stroke="#fff",e._duration=750,e}return h(n,P),s(n,[{key:"update",value:function(){var u,h,a=this,t=a._data,e=a._radius,i=d3.hierarchy(t).sum(function(t){return t.value}),r=2*Math.PI,o=d3.partition().size([r,e]);o(i),h=u=.075,function n(t,e){if(1<t.depth){var i=t.parent,o=i.children.length-1,a=Math.pow(-1,t.depth),r=d3.hsl(i.data.color),l=r.l;h=a<0&&l<u*o?l/(o+2):0<a&&1-l<u*o?(1-l)/(o+2):u,r.l+=h*e*a,t.data.color=r.toString()}var s=t.children;s&&s.forEach(function(t,e){n(t,e)})}(i);var n=a.arcFunc.innerRadius(function(t){return Math.max(0,t.y0)}).outerRadius(function(t){return Math.max(0,t.y1)}).startAngle(function(t){return t.x0}).endAngle(function(t){return t.x1}),l=a.group,s=!1,c={oldState:f(i),newState:f(i),currentRootNode:i,currentClickedNode:i};function _(t){var e=t.data.name?t.descendants():t.descendants().slice(1),n=l.selectAll(".arc-group").data(e,function(t){return t.data.name});n.select("text").remove(),n.exit().transition().duration(a._transition||s?a._duration:0).on("start",a._onTransitionStart).remove().select("path").attrTween("d",function(t){return y.call(this,function(t){if(!s)return{x0:t.x0,x1:t.x1,y0:0,y1:0};if(t.depth<c.currentClickedNode.depth)return{x0:t.x0,x1:t.x1,y0:0,y1:0};return{x0:t.x0>=c.oldState.x1?r:0,x1:t.x0>=c.oldState.x1?r:0,y0:0,y1:0}}(t))});var i=n.enter().append("g").attr("class","arc-group");i.append("path").style("fill",function(t){return t.data.color}).style("stroke",a._stroke).each(function(t){this._currentArc=function(t){if(!s)return{x0:t.x0,x1:t.x1,y0:0,y1:0};return{x0:t.x0>=c.newState.x1?r:0,x1:t===c.currentRootNode||t.x0>=c.newState.x1?r:0,y0:0,y1:0}}(t)});var o=i.merge(n).on("click",d).on("mouseover",a._onMouseover).on("mousemove",a._onMousemove).on("mouseout",a._onMouseout);o.select("path").style("fill",function(t){return t.data.color}).style("stroke",a._stroke),o.transition().duration(a._transition||s?a._duration:0).on("start",a._onTransitionStart).on("end.a",a._onTransitionEnd).on("end.b",function(){s=!1}).select("path").attrTween("d",function(t){return y.call(this,f(t))})}function d(e){if(!s&&e.data.name!==i.data.name){s=!0;var t=(c.currentClickedNode=e)===c.currentRootNode?e.data.parent:e.data;c.oldState=f(e),c.currentRootNode=d3.hierarchy(t).sum(function(t){return t.value}),o(c.currentRootNode);var n=c.currentRootNode.descendants().filter(function(t){return t.data.name===e.data.name})[0];c.newState=f(n),_(c.currentRootNode)}}function f(t){return{x0:t.x0,x1:t.x1,y0:t.y0,y1:t.y1}}function y(t){var e=d3.interpolate(this._currentArc,t);return this._currentArc=e(0),function(t){return n(e(t))}}return _(i),a}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}}]),n}();var De=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","sunburst-chart"),e.sunburst=new ze(e.mainGroup),e._sortValue=-1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=800,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var n=this,i=n.sunburst,o=n.tooltip,a=n.activeData,t=n.widthOfNoMargin,e=n.heightOfMainGroup,r=Math.min(t,e)/2,l=n._fontSize,s=n._fontFamily;i.data(a.root).radius(r).translate(t/2,e/2).transition(n._transition).duration(n._duration).onMouseover(function(t){var e=[{color:t.data.color,text:t.data.name},{text:a.valueLabel+"："+t.value}];o.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){o.hide()}).onTransitionStart(function(){d3.select(this).select("text").style("opacity",0).remove()}).onTransitionEnd(function(t){var a=i.arcFunc,e="";(e=0===t.depth?I(t.data.name,2*(t.y1-t.y0),l,s):t.y0*(t.x1-t.x0)<1.25*l?"":I(t.data.name,t.y1-t.y0,l,s))&&(d3.select(this).append("text").attr("class",n.labelTextClass).style("pointer-events","none").style("font-size",n._textLabel.fontSize+"px").style("font-family",n._textLabel.fontFamily).style("fill",n._textLabel.color).attr("transform",function(t){var e,n,i=90<(n=(((e=t).x0+e.x1)/2-Math.PI/2)/Math.PI*180)?n-180:n,o=a.centroid(t);return 0===t.depth&&(o=[i=0,0]),"translate("+o+")rotate("+i+")"}).append("tspan").attr("class","sunburst-texts").attr("x",0).attr("y",0).attr("dy","0.35em").style("text-anchor","middle").style("fill",n._textLabel.color).text(e),0==n._labelShow?d3.selectAll(".sunburst-texts").style("display","none"):d3.selectAll(".sunburst-texts").style("display","block"))}),i.update()}},{key:"configLegend",value:function(){var t=this,e=t.sortedDataCopy.root,i=e.children?e.children.map(function(t){return t}):[];e.name&&i.unshift(e),t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data,e=t.root;!function e(t){var n=Math.abs(t.value)||0;t.children&&t.children.forEach(function(t){n+=e(t)});t.sum=n;return n}(e),-1===this._sortValue&&function e(t){t.children&&t.children.sort(function(t,e){return e.sum-t.sum||t.index-e.index}).forEach(function(t){e(t)})}(e),this._sortedDataCopy=t}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new Pe(t,e);return n.dataSolveFunc(Ae),n}},{key:"activeData",get:function(){var t=this.sortedDataCopy,e=t.root,n={name:e.name,color:e.color,value:e.value,sum:e.sum,children:e.children&&e.children.filter(function(t){return!1!==t.active})};return!1===e.active&&(n.children=[]),{root:n,valueLabel:t.valueLabel}}}]),n}();var Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAI6SURBVHjafJLLTlNhFIX7GlBaUJwABYlODIWWJoAil0QBQZyQoPGpIFigpVJNeAkSSCRATI2A1BZs6WnOIcSe/3Iu+ZxoC0njYI3WWoNv7xWwrOtDIYRRq9l12bYwtHaMXO67obU2bPuuL4QwLMs6CEipfyulkFLWBZDJfOZB52PW1zMAKNXwlVIoJW8CQkhTSokQAiEEnueSze4QDvURDvXSFoyQSmXxPLee+Zuv3in7vkelYrAwv0xieJpIzwCJ4WnmZpcolcr4vt+87PsehlGlVqshhSSfLxAbmuDk5AwpFbZtU6kY+L7XKEupTIDt7R0W5pfrzOXyFfHYJMXiBQCO4/Bm8T2bm9sASCmrAcdxzHT6E+FQL4nhafL5AuXSFQcHxwxGx9nf+0K5fEWxeMnTsRmCrT0kkxm01tXAt9yJ2Xn/EeFQL5GeKLHYJPHYFIPR53R3PWEwOk48PkU8NkkkEqU9/JCO9n6Ojr5WA1prM5ncoi0YITE8zenpD4rFS/b3D4gOPGN3d4+Li0vOz38yNjpDa0sXKyvrKKUazKlUlrnZpVvMlTvMruvweuEta2vpBvPta5dLV9i2jdaaQuGC2NAEZ2fnOI6DbduUSmU8z0Mp1ezPPpWKweLiO0ZHXhLpiTI68oL5V8uUfv3nz//W47ou6VSWtmCE9nAfrS3dfPiwhes2WZiUqum2NzY+cq+jn9XVzabbllLeBCzr+kgIadq2qEsIaWrHMY+Pc6bW2mzmW5Z1+GcAWWbj+pgdyZ8AAAAASUVORK5CYII=",Me=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","tree"),e._width=400,e._height=400,e._visibleDepth=5,e._maxRadius=20,e._textPadding=4,e._linkStrokeOpacity=.35,e._nodeFillOpacity=.45,e._nodeStrokeOpacity=.6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._hasValue=!0,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,t=o._data,e=o._width,n=o._height,i=n/2,a=Math.min(o._maxRadius,Math.floor(.0375*n)),r=o._fontSize,l=o._fontFamily,s=o._textPadding,u=8*r,h=o._labelShow?5*r:10,c=Math.min(E(t.name,r,l),u),_=o._labelShow?c+s+a:10,d=d3.hierarchy(t).sum(function(t){return t.value||0}),f=d.descendants(),y=d.leaves().length,p=d3.max(f,function(t){return t.depth})||1,v=d3.max(f,function(t){return t.value}),g=(e-_-h)/Math.min(o._visibleDepth,p),m=Math.max(n/y,r+4),x=g-2*s,S=d3.tree().nodeSize([m,g]).separation(function(t,e){return t.parent==e.parent?1:1.25}),k=d3.linkHorizontal().x(function(t){return t.y}).y(function(t){return t.x}),b=d3.zoom().scaleExtent([.1,3]);S(d);var w=d3.max(f,function(t){return t.x}),F=d3.min(f,function(t){return t.x}),O=n/2;(i<-F&&w<i||-F<i&&i<w)&&(O-=(w+F)/2);var C=d3.scaleSqrt().domain([0,v]).range([0,a]),A=o._hasValue,P=function(t){var e=t.depth?C(t.value):a/2;return A?e:a},z=function(t){return A?t.data.color:t._children?t.data.color:"#fff"},D=function(t){var e=A&&0===t.depth?a:P(t);return(t.children||t._children?-1:1)*(e+s)},L=!1,M=function(){return o._transition||L?o._duration:0},W=o.group;W.transition().duration(M).call(G,_,O),W.select(".bg-rect").empty()?W.append("rect").attr("class","bg-rect").attr("width",e).attr("height",n).style("opacity",0).call(G,-_,-O):W.select(".bg-rect");var R=W.select(".zoom-group").empty()?W.append("g").attr("class","zoom-group"):W.select(".zoom-group"),N=R.select(".links-group").empty()?R.append("g").attr("class","links-group"):R.select(".links-group"),T=R.select(".nodes-group").empty()?R.append("g").attr("class","nodes-group"):R.select(".nodes-group"),j=!1,Y=W.select(".zoom-controller");function X(t){var n,e;S(d),n=t,(e=N.selectAll("path").data(d.links(),function(t){return t.target.data.name})).enter().append("path").attr("d",function(t){var e={x:n.x0,y:n.y0};return k({source:e,target:e})}).merge(e).style("fill","none").style("stroke-width",function(t){return 2*P(t.target)}).style("stroke",function(t){return t.target.data.color}).style("stroke-linecap","round").style("stroke-opacity",o._linkStrokeOpacity).transition().duration(M).attr("d",function(t){return k(t)}),e.exit().transition().duration(M).attr("d",function(t){var e={x:n.x,y:n.y};return k({source:e,target:e})}).remove(),function(e){var t=T.selectAll(".node-group").data(d.descendants(),function(t){return t.data.name}),n=t.enter().append("g").attr("class","node-group").style("cursor","pointer").attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}).on("mouseover",o._onMouseover).on("mousemove",o._onMousemove).on("mouseout",o._onMouseout);n.append("circle").attr("r",P).style("fill",z).style("fill-opacity",o._nodeFillOpacity).style("stroke",function(t){return t.data.color}).style("stroke-opacity",o._nodeStrokeOpacity),t.select("circle").style("fill",z).style("stroke",function(t){return t.data.color}),n.append("text").attr("class","tree-texts").attr("x",D).attr("y",0).attr("dy","0.35em").style("text-anchor",function(t){return t.children||t._children?"end":"start"}).style("font-size",o._fontSize).style("font-family",o._fontFamily).style("fill",o._fontColor).text(function(t){return t.depth?I(t.data.name,x,o._fontSize,l):I(t.data.name,u,r,l)}),n.merge(t).on("click",B).transition().duration(M).style("font-size",o._fontSize).style("font-family",o._fontFamily).style("fill",o._fontColor).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).on("end",function(){L=!1}).select("text").style("font-size",o._fontSize).style("font-family",o._fontFamily).style("fill",o._fontColor).style("fill-opacity",o._labelShow?1:0);var i=t.exit().transition().duration(M).attr("transform",function(){return"translate("+e.y+","+e.x+")"}).remove();i.select("circle").attr("r",0),i.select("text").style("fill-opacity",0)}(t),f.forEach(function(t){t.x0=t.x,t.y0=t.y})}function B(t){var e;L=!0,(e=t).children?(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null),X(t=e)}Y.empty()?(Y=W.append("image").attr("class","zoom-controller").attr("x",-_).attr("y",-O).attr("xlink:href",Le).on("click",function(){j=!j,W.on(".zoom",null),j?(Y.attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGpSURBVHjafJLNruIwDIV5/zdBQqAKKHXzJxXYQlrgFdreRWgCG9rb5MyCuR0KM7OwFOXks3NsT+I4Pi+XS/MeURQZIjJRFH1oq9XKTKfT00QIceec4zWSJIHWObquQ1EUSJJkpCulsFgs7hPOuWGM4SeICIfDAd4HhAB4H6C1BhENb4QQmM/nZgSnaQrOOaqqhrUObdvBWoe6/oIQYkjwARMROBdDEiklrHVQSoEoBWMMnD8TjOA4jnE4HFFVNdI0BRG9wQQiQlmW0HkOInrCaZqa41Gj73tY6yClhJQS2+0Wzt2w3e4gpYQQAtdrg957nE5nzGYzM8myzHTdN0LA4NFaB+duaNsOzt2Gu8ejRQgB3ges1+tn5TzP0fd++KZSCrvdDs7dsN/voZSClBLXawPvAy6Xy7Pyj2etNer665+ek4RQlhWKovjj+bXbQgi8np+wHI3oo9vjOQuUZYWmsXg8WjSNRVXV/5/z64ZprYcNCwHI8wJEyV837P4KM8YQb2JonaNtOxTFCZvNZqT/hu8TzvmZMWbeg4hMlmWGiD40IYSJouj0awAemusiRGff+AAAAABJRU5ErkJggg==").select("title").text("点击关闭缩放功能"),W.call(b)):Y.attr("xlink:href",Le).select("title").text("点击开启缩放功能")})).append("title").text("点击开启缩放功能"):Y.attr("x",-_).attr("y",-O),d.x0=d.x,d.y0=d.y,b.on("zoom",function(){var t=d3.event.transform;R.attr("transform",t)}),X(d)}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"linkStrokeOpacity",value:function(t){return arguments.length?(this._linkStrokeOpacity=t,this):this._linkStrokeOpacity}},{key:"nodeStrokeOpacity",value:function(t){return arguments.length?(this._nodeStrokeOpacity=t,this):this._nodeStrokeOpacity}},{key:"nodeFillOpacity",value:function(t){return arguments.length?(this._nodeFillOpacity=t,this):this._nodeFillOpacity}},{key:"visibleDepth",value:function(t){return arguments.length?(this._visibleDepth=t,this):this._visibleDepth}},{key:"textPadding",value:function(t){return arguments.length?(this._textPadding=t,this):this._textPadding}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"hasValue",value:function(t){return arguments.length?(this._hasValue=t,this):this._hasValue}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),We=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.root;if(e&&e.children){var n=e.children;w(n,this.generateColorList(n.length))}return{root:t.root||{children:[]},valueLabel:t.valueLabel}}}]),n}(),Re=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","tree-chart"),e.tree=new Me(e.mainGroup),e._maxRadius=4,e._hasValue=!1,e._nodeFillOpacity=1,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var n=this,i=n.tree,o=n.tooltip,a=n.activeData;if(!a.root||!a.root.children)return n;var t=n.widthOfNoMargin,e=n.heightOfMainGroup,r=n.defs;r.selectAll("filter").remove();var l=r.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_tree").attr("filterUnits","objectBoundingBox");l.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),l.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),l.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),l.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),l.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(a.root).width(t).height(e).maxRadius(n._maxRadius).hasValue(n._hasValue).nodeFillOpacity(n._nodeFillOpacity).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).fontSize(n._fontSize).fontColor(n._fontColor).fontFamily(n._fontFamily).labelShow(n._labelShow).onMouseover(function(e){d3.select(this).select("circle").style("fill-opacity",1).style("stroke-opacity",1),i.elem.select(".links-group").selectAll("path").filter(function(t){return t.target===e}).style("stroke-opacity",.7);var t=[{color:e.data.color,text:e.data.name}];n._hasValue&&t.push({text:a.valueLabel+"："+(-1==String(e.value).indexOf(".")?e.value:e.value.toFixed(2))}),o.data(t).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(e){o.hide(),d3.select(this).select("circle").style("fill-opacity",i.nodeFillOpacity()).style("stroke-opacity",i.nodeStrokeOpacity()),i.elem.select(".links-group").selectAll("path").filter(function(t){return t.target===e}).style("stroke-opacity",i.linkStrokeOpacity())}),i.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.root.children||[];t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){var t,e=this._data.root;e&&e.children&&e.children.length&&((t=e).color=t.children[0].color,function e(t){1<t.depth&&(t.color=t.parent.color),t.children&&t.children.forEach(function(t){e(t)})}(t)),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new We(t,e);return n.dataSolveFunc(Ce),n}},{key:"activeData",get:function(){var t=this.sortedDataCopy,e=t.root;return{root:{name:e.name,color:e.color,value:e.value||0,children:e.children&&e.children.filter(function(t){return!1!==t.active})},valueLabel:t.valueLabel}}}]),n}();var Ne=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data,this._columnMap),e=t.root;if(e&&e.children){var n=e.children;w(n,this.generateColorList(n.length))}return{root:t.root||{children:[]},valueLabel:t.valueLabel}}}]),n}(),Te=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._hasValue=!0,e._maxRadius=20,e._nodeFillOpacity=.45,e._labelShow=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.8,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,Re),s(n,[{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new Ne(t,e);return n.dataSolveFunc(Ae),n}}]),n}(),je=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.keys,n=this.generateColorList(e.length),i={};return e.forEach(function(t,e){return i[t]=n[e]}),t.colorMap=i,t}}]),n}();function Ye(t,e){var i=0;if(e.forEach(function(t){"objCol"===t.function&&(i=+t.index)}),W(t,[i],2))return{keys:[],dataForStack:[]};var n=R(t,e),o=n[0];return{keys:o.filter(function(t,e){return e!==i}),dataForStack:n.slice(1).map(function(t){var n={};return t.forEach(function(t,e){e===i?n.name=t:n[o[e]]=t}),n})}}var Xe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e._areaFunc||d3.area().x(function(t){return e._xScale(t.name)}).y0(e._yScale.range()[0]).y1(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(e._curve);var i=e.group.selectAll("path").data(t,function(t){return t.key});return i.exit().remove(),i.enter().append("path").merge(i).style("fill",function(t){return t.color}).style("fill-opacity",e._fillOpacity).transition().duration(e._transition?e._duration:0).attr("d",function(t){return n(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}}]),n}(),Be=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stream-graph"),e}return h(n,Xe),s(n,[{key:"update",value:function(){for(var n=this,i=n._data,t=[],o=[],e=0;e<i.keys.length;e++){for(var a=[],r=0;r<i.dataForStack.length;r++)a.push(i.dataForStack[r][i.keys[e]]);t.push(d3.max(a))}for(var l=0;l<i.keys.length;l++)for(var s=0;s<i.stackData[l].length;s++)i.stackData[l][s].data[i.keys[l]]==t[l]&&o.push([i.stackData[l][s][0],i.stackData[l][s][1],i.stackData[l][s].data.name]);var u=n.group,h=i.stackData,c=n._areaFunc||d3.area().x(function(t){return n._xScale(t.data.name)}).y0(function(t){return n._yScale(t[0])}).y1(function(t){return n._yScale(t[1])});u.select(".stream-graph-group").remove();var _=u.append("g").attr("class","stream-graph-group"),d=_.selectAll("path").data(h,function(t){return t.key});d.exit().remove(),d.enter().append("path").merge(d).style("fill",function(t){return i.colorMap[t.key]}).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).transition().duration(n._transition?n._duration:0).attr("d",c);var f=_.selectAll("text").data(i.keys);f.exit().remove(),f.enter().append("text").attr("class","stream-graph-texts").merge(d).text(function(t,e){return i.keys[e]}).attr("x",function(t,e){return n._xScale(o[e][2])}).attr("y",function(t,e){return(n._yScale(o[e][1])-n._yScale(o[e][0]))/2+n._yScale(o[e][0])}).attr("text-anchor","middle").attr("fill",n._fontColor).attr("font-size",n._fontSize).style("font-family",n._fontFamily),0==n._labelShow?u.selectAll(".stream-graph-texts").style("display","none"):u.selectAll(".stream-graph-texts").style("display","block");for(var y=u.selectAll(".stream-graph-texts"),p=[],v=[],g=0;g<y._groups[0].length;g++){v.push(g);for(var m=g+1;m<y._groups[0].length;m++){ut(st(d3.select(y._groups[0][g])),st(d3.select(y._groups[0][m])))&&(p.push(g),d3.select(y._groups[0][g]).style("opacity","0"))}}for(var x=new Set(p),S=Array.from(x),k=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(S,v),b=0;b<S.length;b++){for(var w=[],F=0;F<k.length;F++){var O=st(d3.select(y._groups[0][S[b]])),C=st(d3.select(y._groups[0][k[F]]));if(w.push(ut(O,C)),ut(O,C)){if(S[b]==k[F])continue;d3.select(y._groups[0][S[b]]).style("opacity","0")}}0==w.filter(function(t){return 1==t}).length&&k.push(S[b])}for(var A=0;A<k.length;A++)d3.select(y._groups[0][k[A]]).style("opacity","1");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ge=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.grid=new Pt(e.coreGroup),e.streamgraph=new Be(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var r=this,l=r.activeData,t=r.streamgraph,e=r.grid,s=r.tooltip,n=r.overlay,u=r.guideLine,i=r.clipArea,h=r.xScale,o=r.yScale,a=(r.widthOfNoMargin,r.heightOfMainGroup,r._fontSize),c=(d3.max(l.keys,function(t){return E(t,a,r._fontFamily)}),r.widthOfCore),_=r.heightOfCore,d=l.stackData,f=l.colorMap,y=d3.max(d,function(t){return d3.max(t,function(t){return Math.max(t[0],t[1])})}),p=d3.min(d,function(t){return d3.min(t,function(t){return Math.min(t[0],t[1])})}),v=r.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_streamgraph").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.domain([p,y]).range([0,_]);var m=d3.area().x(function(t){return h(t.data.name)}).y0(function(t){return o(t[0])}).y1(function(t){return o(t[1])}).curve(d3.curveBasis);t.data(l).areaFunc(m).xScale(h).yScale(o).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onMouseover(function(e){var t=e.key,n=[{text:t,color:f[t]}];s.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show(),d3.select(this).style("stroke","#000"),d3.select(this.parentNode).selectAll("path").filter(function(t){return t!=e}).style("fill-opacity",.3)}).onMousemove(function(t){s.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this).style("stroke","none"),d3.select(this.parentNode).selectAll("path").style("fill-opacity",1),s.hide()}),e.width(c).height(_).xTickLocations(r.xAxis.tickLocations).showX(!1).showY(r._gridShowY).stroke(r._gridStroke).strokeDasharray(r._gridStrokeDasharray),u.y1(0).y2(_).stroke("#c6c6c6").strokeDasharray("0 0"),n.data(h.domain()).bandWidth(h.step()).bandHeight(_).onMouseover(function(t,e){var n=t,i=[{text:n}],o=l.dataForStack[e];for(var a in o)"name"!==a&&!1!==l.states[a]&&i.push({color:l.colorMap[a],text:a+"："+o[a]});s.data(i).update().move([d3.event.offsetX,d3.event.offsetY]),u.x(0).update().show(),r.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+h(n)+",0)"),s.show(),u.show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){s.hide(),u.hide()}),i.width(c).height(_).transition(r._transition).duration(r._duration),r.coreGroup.attr("clip-path","url(#"+i.id+")"),e.update(),n.update(),i.update(),t.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy,e=i.colorMap,o=[];for(var n in e)o.push({name:n,color:e[n]});t.legend.data(o).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),o.forEach(function(t){t.name===e.name&&(t.active=!n)}),i.states[e.name]=!n,t.onDataChange()})}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.xScale,i=t.widthOfNoMargin,o=t.heightOfMainGroup;n.domain(t._xDomain).range([0,i]),e.scaleFunc(n).allowedMaxTextHeight(.3*o).type(t._xType).orient(t._xOrient).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(t._fontSize).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),e.compute(),e.translate(0,o-e.height).update()}},{key:"computeDomain",value:function(){this.xDomain(this.activeData.dataForStack.map(function(t){return t.name}))}},{key:"sortData",value:function(){var t=this._data,e={};t.keys.forEach(function(t){return e[t]=!0}),t.states||(t.states=e),this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new je(t,e);return n.dataSolveFunc(Ye),n}},{key:"activeData",get:function(){var e=this.sortedDataCopy,t=e.keys.filter(function(t){return!1!==e.states[t]}),n=d3.stack().keys(t).order(d3.stackOrderNone).offset(d3.stackOffsetWiggle)(e.dataForStack);return{states:e.states,keys:t,stackData:n,colorMap:e.colorMap,dataForStack:e.dataForStack}}}]),n}(),Ee=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","radar"),e._radius=200,e._donutCount=5,e._fillOpacity=.35,e._borderWidth=2,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._endPointRadius=3.5,e._tickTextColor="#333",e._tickTextSize=10,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,i=o._data,t=o.group;if(i.length){var a=o._radius,n=o._donutCount,e=(o._fontSize,i[0].data.map(function(t){return t.name})),r=e.length,l=d3.max(i,function(t){return 1.05*d3.max(t.data,function(t){return parseFloat(t.value)})});if(l<=1)l=1;else{var s=.5*Math.pow(10,Math.floor(Math.log10(l)));l=Math.ceil(l/s)*s}for(var u=d3.range(n+1).map(function(t){return l/n*t}),h=[],c=0;c<r;c++){for(var _=[],d=0;d<i.length;d++)_.push(i[d].data[c].value);h.push(d3.max(_))}var f=d3.scaleLinear().domain([0,l]).range([0,a]),y=d3.scaleLinear().domain([0,r]).range([0,2*Math.PI]),p=d3.areaRadial().angle(function(t,e){return 0}).outerRadius(function(t){return 0}).curve(d3.curveCardinalClosed),v=d3.areaRadial().angle(function(t,e){return y(e)}).outerRadius(function(t){return f(t.value)}).curve(d3.curveCardinalClosed),g=t.selectAll(".tick-text").data(u);g.exit().remove(),g.enter().append("text").attr("class","tick-text").merge(g).attr("y",function(t,e){return-a/n*e}).attr("dy","0.35em").style("font-size",o._tickTextSize).style("text-anchor","middle").style("fill",o._tickTextColor).text(function(t){return-1==String(t).indexOf(".")?t:t.toFixed(1)}).style("text-anchor","middle").style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(o._duration?o._startDelay:0).style("opacity",1),t.selectAll(".radar-area-point").remove(),t.selectAll(".radar-area").remove(),t.selectAll(".radar-points").remove();var m=t.append("g").selectAll("g").attr("class","radar-area-point").data(i);m.exit().remove(),m.enter().append("g").merge(m).each(function(t,e){d3.select(this).append("path").attr("class","radar-area").attr("d",function(t){return p(t.data)}).style("fill",function(t){return t.color}).style("fill-opacity",o._fillOpacity).style("stroke",function(t){return t.color}).style("stroke-width",o._borderWidth).transition().duration(o._transition?.8*o._duration/i.length*2:0).delay(o._duration?o._startDelay+.8*o._duration/i.length/2*e+.1*o._duration:0).attr("d",function(t){return v(t.data)});var n=d3.select(this).selectAll("circle").data(function(e){return e.data.map(function(t){return t.color=e.color,t})});n.exit().remove(),n.enter().append("circle").attr("class","radar-points").merge(n).attr("r",0).attr("cx",0).attr("cy",0).style("fill",function(t){return t.color}).transition().duration(o._transition?.8*o._duration/i.length*2:0).delay(o._duration?o._startDelay+.8*o._duration/i.length/2*e+.1*o._duration:0).attr("r",o._endPointRadius).attr("cx",function(t,e){return f(t.value)*Math.cos(y(e)-Math.PI/2)}).attr("cy",function(t,e){return f(t.value)*Math.sin(y(e)-Math.PI/2)})}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),t.selectAll(".radar-area-texts").remove();var x=o._defs;x.selectAll("filter").remove();var S=x.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_radar").attr("filterUnits","objectBoundingBox");S.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),S.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),S.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),S.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),S.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var k=t.append("g").selectAll("g").attr("class","radar-area-groups").data(i);k.exit().remove(),k.enter().append("g").merge(k).each(function(t,e){var n=d3.select(this).selectAll("text").data(function(t){return t.data.map(function(t){return t})});n.exit().remove(),n.enter().append("text").attr("class","radar-area-texts").merge(n).text(function(t){return t.value}).attr("x",function(t,e){return t.value==h[e]?(f(t.value)+.05*a)*Math.cos(y(e)-Math.PI/2):(f(t.value)-.05*a)*Math.cos(y(e)-Math.PI/2)}).attr("y",function(t,e){return t.value==h[e]?(f(t.value)+.05*a)*Math.sin(y(e)-Math.PI/2):(f(t.value)-.05*a)*Math.sin(y(e)-Math.PI/2)}).attr("text-anchor",function(t,e){return 0==y(e)||y(e)==Math.PI?"middle":y(e)>Math.PI&&t.value!=h[e]?"start":y(e)>Math.PI&&t.value==h[e]||0<y(e)&&y(e)<Math.PI&&t.value!=h[e]?"end":void 0}).attr("dy",function(t,e){if(t.value==h[e])if(t.value==d3.max(h)){if(y(e)<Math.PI/2||y(e)>1.5*Math.PI)return"1.3em";if(y(e)>Math.PI/2&&y(e)<1.5*Math.PI)return"-1.3em";if(y(e)==Math.PI/2||y(e)==1.5*Math.PI)return"1.1em"}else{if(0==y(e))return"0.3em";if(y(e)==Math.PI)return"-0.3em";if(y(e)<Math.PI/2||y(e)>1.5*Math.PI)return"1.3em";if(y(e)>Math.PI/2&&y(e)<1.5*Math.PI)return"-1.3em";if(y(e)==Math.PI/2||y(e)==1.5*Math.PI)return"1.1em"}else if(t.value!=h[e])return 0==y(e)||y(e)>Math.PI&&y(e)<1.5*Math.PI?0:"0.4em"}).style("font-size",o._fontSize).style("font-family",o._fontFamily).style("fill",o._fontColor).style("display",o._labelShow?"block":"none").style("opacity","0").transition().delay(o._transition?o._startDelay+.9*o._duration:0).duration(.1*o._duration).style("opacity","1")});var b=t.selectAll(".radar-text").data(e);b.exit().remove(),b.enter().append("text").attr("class","radar-text").merge(b).attr("dy",function(t,e){return y(e)==Math.PI?10:"0.1em"}).each(function(t,e){var n=y(e),i=a+parseFloat(o._themeFontSize)/2+8;d3.select(this).attr("x",function(){return i*Math.cos(n-Math.PI/2)}).attr("y",function(){return i*Math.sin(n-Math.PI/2)}).style("text-anchor",function(){return n%Math.PI?n<Math.PI?"start":"end":"middle"})}).style("font-size",o._themeFontSize).style("font-family",o._themeFontFamily).style("fill",o._themeFontColor).text(function(t,e){return t=="&-"+(e+1)?"":t}).style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(o._duration?o._startDelay:0).style("opacity",1);for(var w=t.selectAll(".radar-area-texts"),F=[],O=[],C=0;C<w._groups[0].length;C++){O.push(C);for(var A=C+1;A<w._groups[0].length;A++){ut(st(d3.select(w._groups[0][C])),st(d3.select(w._groups[0][A])))&&(F.push(C),d3.select(w._groups[0][C]).style("visibility","hidden"))}}for(var P=new Set(F),z=Array.from(P),D=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(z,O),L=0;L<z.length;L++){for(var M=[],W=0;W<D.length;W++){var R=st(d3.select(w._groups[0][z[L]])),N=st(d3.select(w._groups[0][D[W]]));if(M.push(ut(R,N)),ut(R,N)){if(z[L]==D[W])continue;d3.select(w._groups[0][z[L]]).style("visibility","hidden")}}0==M.filter(function(t){return 1==t}).length&&D.push(z[L])}for(var T=0;T<D.length;T++)d3.select(w._groups[0][D[T]]).style("visibility","visible");return o}t.selectAll("*").remove()}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"themeFontColor",value:function(t){return arguments.length?(this._themeFontColor=t,this):this._themeFontColor}},{key:"themeFontSize",value:function(t){return arguments.length?(this._themeFontSize=t,this):this._themeFontSize}},{key:"themeFontFamily",value:function(t){return arguments.length?(this._themeFontFamily=t,this):this._themeFontFamily}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=t,this):this._donutCount}},{key:"tickTextColor",value:function(t){return arguments.length?(this._tickTextColor=t,this):this._tickTextColor}},{key:"tickTextSize",value:function(t){return arguments.length?(this._tickTextSize=t,this):this._tickTextSize}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),Ie=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","radar-chart"),e.grid=new $(e.mainGroup),e.radar=new Ee(e.mainGroup),e._sortValue=null,e._donutCount=5,e._fillOpacity=0,e._endPointRadius=3.5,e._borderWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var t=this;t.group.selectAll(".polar-grid").style("opacity",0).transition().duration(t._transition?.1*t._duration*1e3:0).delay(t._transition?1e3*t._startDelay:0).style("opacity",1);var e=t.activeData,n=t.radar,i=t.grid,o=t.tooltip,a=(t._fontSize,t.widthOfNoMargin),r=t.heightOfMainGroup,l=Math.min(.82*a,.82*r)/2;n.data(e).radius(l).borderWidth(t._borderWidth).endPointRadius(t._endPointRadius).labelShow(t._labelShow).donutCount(t._donutCount).fillOpacity(.6).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).themeFontSize(t._fontSize).themeFontColor(t._fontColor).themeFontFamily(t._fontFamily).tickTextColor(t._fontColor).translate(a/2,r/2).defs(t.defs).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(t,e){d3.select(this.parentNode).selectAll(".radar-area").transition().style("fill-opacity",.5),d3.select(this).select(".radar-area").transition().style("fill-opacity",.75);var n=[{color:t.color,text:t.name=="$-"+(e+1)?"":t.name}];t.data.forEach(function(t,e){n.push({text:(t.name=="&-"+(e+1)?"":t.name)+"："+t.value})}),o.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this.parentNode).transition().selectAll(".radar-area").style("fill-opacity",.6),o.hide()}),i.radius(l).donutCount(t._donutCount).sectorCount(e[0]?e[0].data.length:1).translate(a/2,r/2).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray).showX(t._gridShowX).showY(t._gridShowY),n.update(),i.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.fillOpacity(e.fillOpacity).endPointRadius(e.endPointRadius).borderWidth(e.borderWidth)}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}}]),n}(),He=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=function(t){var e=[],n={};t.forEach(function(t){t.children.forEach(function(t){var e=t.name;n[e]?n[e]++:n[e]=0})});var i=0;for(var o in n)e.push({name:o,count:n[o],index:i}),i++;return e.sort(function(t,e){return e.count-t.count||t.index-e.index}),e.slice(0,2).map(function(t){return t.name})}(t.nodes),n=this.generateColorList(e.length),i={};return e.forEach(function(t,e){return i[t]=n[e]}),t.colorMap=i,t.keys=e,t}}]),n}();var Ve=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","pyramid"),e._xScale=null,e._yScale=null,e._stroke="#fff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var i=this,o=i.group,t=i._data,a=[],r=[],e=0;e<t.nodes.length;e++)null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?(r.push(0),a.push(0)):1==i._labelShow&&0==i._positionOptions.indexOf(i._positionChoice)?(a.push(E(t.nodes[e].children[0].value,i._fontSize,i._fontFamily)),r.push(E(t.nodes[e].children[1].value,i._fontSize,i._fontFamily))):(r.push(0),a.push(0));var n,l=t.nodes,s=t.colorMap,u=t.keys,h=i._xScale,c=i._yScale,_=Math.abs(h.range()[1]-h.range()[0]),d=_/2,f=c.bandwidth(),y=u[0],p=s[y],v=u[1],g=s[v],m=[],x=[];l.forEach(function(t){var e=t.children.filter(function(t){return t.name===y})[0],n=t.children.filter(function(t){return t.name===v})[0];m.push({name:t.name,key:t.key,color:p,value:e&&Math.abs(e.value)||0}),x.push({name:t.name,key:t.key,color:g,value:n&&Math.abs(n.value)||0})}),function(){var t=o.select(".left-group").empty()?o.append("g").attr("class","left-group"):o.select(".left-group");t.selectAll("text").remove();var e=t.selectAll("rect").data(m,function(t){return t.key});e.exit().remove(),e.enter().append("rect").merge(e).attr("x",function(t){return h(0)-(0==r.length?0:d3.max(r))}).attr("y",function(t){return c(t.name)}).attr("width",0).attr("height",f).style("fill",p).style("stroke",i._stroke).transition().duration(i._transition?.9*i._duration:0).attr("x",function(t){return h(-t.value)-(0==r.length?0:d3.max(r))}).attr("width",function(t){return d-h(-t.value)+(0==r.length?0:d3.max(r))});var n=t.selectAll("text").data(m,function(t){return t.key});n.exit().remove(),n.enter().append("text").attr("class","pyramid-left-texts").merge(n).text(function(t){return 0==t.value?"":t.value}).attr("x",function(t){return h(-t.value)-(0==r.length?0:d3.max(r))}).attr("y",function(t){return c(t.name)}).attr("dy",f/2+i._fontSize/3).attr("dx",function(t,e){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?(d3.selectAll(".pyramid-left-texts").attr("text-anchor","end"),.3*-i._fontSize):1==i._positionOptions.indexOf(i._positionChoice)?(d3.selectAll(".pyramid-left-texts").attr("text-anchor","end"),d-h(-t.value)-.3*i._fontSize):void 0}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).style("display",i._labelShow?"block":"none").style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1)}(),function(){var t=o.select(".right-group").empty()?o.append("g").attr("class","right-group"):o.select(".right-group");t.selectAll("text").remove();var e=t.selectAll("rect").data(x,function(t){return t.key});e.exit().remove(),e.enter().append("rect").merge(e).attr("x",d).attr("y",function(t){return c(t.name)}).attr("width",0).attr("height",f).style("fill",g).style("stroke",i._stroke).transition().duration(i._transition?.9*i._duration:0).attr("x",d).attr("width",function(t){return h(t.value)-d-(0==a.length?0:d3.max(a))});var n=t.selectAll("text").data(x,function(t){return t.key});n.exit().remove(),n.enter().append("text").attr("class","pyramid-right-texts").merge(n).text(function(t){return 0==t.value?"":t.value}).attr("x",d-(0==a.length?0:d3.max(a))).attr("y",function(t){return c(t.name)}).attr("dy",f/2+i._fontSize/3).attr("dx",function(t,e){return null==i._positionOptions||null==i._positionChoice?0:0==i._positionOptions.indexOf(i._positionChoice)?h(t.value)-d+.3*i._fontSize:1==i._positionOptions.indexOf(i._positionChoice)?.3*i._fontSize:void 0}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).style("display",i._labelShow?"block":"none").style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1)}(),(n=(o.select(".overlay-group").empty()?o.append("g").attr("class","overlay-group"):o.select(".overlay-group")).selectAll("rect").data(l,function(t){return t.key})).exit().remove(),n.enter().append("rect").merge(n).attr("x",0).attr("y",function(t){return c(t.name)}).attr("width",_).attr("height",f).style("fill","#fff").style("stroke","none").style("fill-opacity",0).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout);for(var S=o.selectAll(".pyramid text"),k=[],b=[],w=0;w<S._groups[0].length;w++){b.push(w);for(var F=w+1;F<S._groups[0].length;F++){ut(st(d3.select(S._groups[0][w])),st(d3.select(S._groups[0][F])))&&(k.push(w),d3.select(S._groups[0][w]).style("visibility","hidden"))}}for(var O=new Set(k),C=Array.from(O),A=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(C,b),P=0;P<C.length;P++){for(var z=[],D=0;D<A.length;D++){var L=st(d3.select(S._groups[0][C[P]])),M=st(d3.select(S._groups[0][A[D]]));if(z.push(ut(L,M)),ut(L,M)){if(C[P]==A[D])continue;d3.select(S._groups[0][C[P]]).style("visibility","hidden")}}0==z.filter(function(t){return 1==t}).length&&A.push(C[P])}for(var W=0;W<A.length;W++)d3.select(S._groups[0][A[W]]).style("visibility","visible");return i}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ue=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","pyramid-chart"),e.grid=new Pt(e.coreGroup),e.core=new Ve(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._marginLeft=15,e._marginRight=20,e._xType="number",e._yType="category",e._yTitle="y",e._xTitle="x",e._labelShow=!1,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var e=this,t=e.core,n=e.tooltip,i=e.grid,o=e.activeData,a=o.colorMap,r=e.widthOfCore,l=e.heightOfCore,s=[],u=[],h=0;h<e.activeData.nodes.length;h++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(u.push(0),s.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?(s.push(E(e.activeData.nodes[h].children[0].value,e._textLabel.fontSize,e._textLabel.fontFamily)),u.push(E(e.activeData.nodes[h].children[1].value,e._textLabel.fontSize,e._textLabel.fontFamily))):(u.push(0),s.push(0));var c=e.defs;c.selectAll("filter").remove();var _=c.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_pyramid").attr("filterUnits","objectBoundingBox");_.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),_.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),_.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),_.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),_.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.data(o).xScale(e.xScale).yScale(e.yScale).fontSize(e._textLabel.fontSize).fontColor(e._textLabel.color).fontFamily(e._textLabel.fontFamily).labelShow(e._labelShow).positionOptions(e._positionOptions).positionChoice(e._positionChoice).transition(e._transition).duration(1e3*e._duration).easeStyle(e._easeStyle).startDelay(1e3*parseFloat(e._startDelay)).moveStyle(e._moveStyle).endPause(e._endPause).onMouseover(function(t){d3.select(this).style("fill-opacity",.8);var e=[{text:t.name}];t.children.forEach(function(t){t.name in a&&e.push({color:a[t.name],text:t.name+"："+t.value})}),n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this).style("fill-opacity",0),n.hide()}),i.width(r-(0==u.length?0:d3.max(u))-(0==s.length?0:d3.max(s))).height(l).xTickLocations(e.xAxis.tickLocations.slice().map(function(t){return t-(0==u.length?0:d3.max(u))})).yTickLocations(e.yAxis.tickLocations.slice().map(function(t){return t+e.yScale.bandwidth()/2})).showX(e._gridShowX).showY(e._gridShowY).stroke(e._gridStroke).strokeDasharray(e._gridStrokeDasharray),e.coreGroup.call(G,e.yAxis.width+.5+(0==u.length?0:d3.max(u)),0),i.update(),t.update()}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.yAxis,i=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;i.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).xRange(t._xRange).transition(t._transition).duration(t._duration),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).yRange(t._yRange).transition(t._transition).duration(t._duration);n.titleHeight;var _=(c-e.allowedMaxTextHeight())/u;e.tickCount(_);for(var d=[],f=[],y=0;y<t.activeData.nodes.length;y++)null==t._labelShow||null==t._positionOptions||null==t._positionChoice||-1==t._positionOptions.indexOf(t._positionChoice)?(f.push(0),d.push(0)):1==t._labelShow&&0==t._positionOptions.indexOf(t._positionChoice)?(d.push(E(t.activeData.nodes[y].children[0].value,t._textLabel.fontSize,t._textLabel.fontFamily)),f.push(E(t.activeData.nodes[y].children[1].value,t._textLabel.fontSize,t._textLabel.fontFamily))):(f.push(0),d.push(0));n.compute(),i.nice().range([0==f.length?0:d3.max(f),h-n.width-(0==d.length?0:d3.max(d))]),e.compute(),o.range([c-e.height,0]);var p=n.width,v=c-e.height,g=n.width;e.translate(p,v).update(),n.translate(g,0).update()}},{key:"configLegend",value:function(){var t=this._sortedDataCopy,e=[];for(var n in t.colorMap)e.push({name:n,color:t.colorMap[n]});this.legend.data(e)}},{key:"computeDomain",value:function(){var t=this._data.nodes,e=0<t.length?d3.max(t,function(t){return d3.max(t.children,function(t){return Math.abs(t.value)})}).toFixed(0):1;this._xDomain=[-e,e],this._yDomain=t.length?t.map(function(t){return t.name}):[0,1],this.xAxis.tickFormat(function(t){return Math.abs(t)})}},{key:"sortData",value:function(){this._sortedDataCopy=this._data}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new He(t,e);return n.dataSolveFunc(ge),n}},{key:"activeData",get:function(){return this._sortedDataCopy}}]),n}();function qe(t,e){t.on("mouseover",e._onMouseover).on("mousemove",e._onMousemove).on("mouseout",e._onMouseout)}var Ze=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","bar-plot"),e._xScale=null,e._yScale=null,e._fill=null,e._stroke="#fff",e._strokeWidth=1,e._showZeroLine=!0,e._zeroLineStroke="#000",e._fontColor="#000",e._fontSize=13,e._cornerRadius=0,e}return h(n,P),s(n,[{key:"update",value:function(){for(var e=this,t=e._data,n=e._xScale,i=e._yScale.clamp(!0),o=n.bandwidth(),a=i.domain(),r=a.every(function(t){return 0<=t})?"up":a.every(function(t){return t<=0})?"down":"both",l=i.range()[0],s=e._transition?e._duration:0,u=[],h=0;h<t.length;h++)u.push(t[h].value);var c=ht(u,e._fontSize,e._fontFamily),_=e.group,d=_.selectAll(".rect").data(t);d.exit().transition().duration(s).remove();var f=d.enter().append("path").attr("class","rect").merge(d).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke).call(qe,e),y=_.selectAll("text").data(t);y.exit().transition().duration(s).remove();var p=y.enter().append("text").attr("class","simple-bar-texts").merge(y).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("display",e._labelShow?"block":"none");if("up"===r)f.attr("d",function(t){return lt({x:n(t.name),y:i(t.value),width:o,height:Math.abs(l-i(t.value)),cornerRadius:e._cornerRadius})}),p.attr("x",function(t){return n(t.name)}).attr("y",function(t){return i(t.value)}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(l-i(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?p.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?p.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o/2||0)+" "+(i(t.value)+Math.abs(l-i(t.value))-.7*e._fontSize)+" )"}).attr("text-anchor","start"):p.attr("transform","rotate(0)");else if("down"===r)f.attr("d",function(t){return lt({x:n(t.name),y:0,width:o,height:i(t.value),cornerRadius:e._cornerRadius})}),p.attr("x",function(t){return n(t.name)}).attr("y",0).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?i(t.value)-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?p.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?p.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o/2||0)+" "+(i(t.value)-.7*e._fontSize)+" )"}).attr("text-anchor","start"):p.attr("transform","rotate(0)");else{var v=Math.round(i(0));f.attr("d",function(t){return lt({x:n(t.name),y:0<=t.value?i(t.value):v,width:o,height:Math.abs(v-i(t.value)),cornerRadius:e._cornerRadius})}),p.attr("x",function(t){return n(t.name)}).attr("y",function(t){return 0<=t.value?i(t.value):v}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(v-i(t.value))-6:void 0}).attr("text-anchor","middle"),null==e._positionOptions||null==e._positionChoice?p.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?p.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o/2||0)+" "+((0<=t.value?i(t.value):v)+Math.abs(v-i(t.value))-.7*e._fontSize)+" )"}).attr("text-anchor","start"):p.attr("transform","rotate(0)"),(_.select(".zero-line").empty()?_.append("line").attr("class","zero-line"):_.select(".zero-line")).attr("x1",n.range()[0]).attr("y1",v).attr("x2",n.range()[1]).attr("y2",v).style("stroke",e._showZeroLine?e._zeroLineStroke:"none")}if(null==e._positionOptions||null==e._positionChoice)p.style("display","none");else if(0==e._positionOptions.indexOf(e._positionChoice)){for(var g=_.selectAll(".simple-bar-texts"),m=[],x=[],S=0;S<g._groups[0].length;S++){x.push(S);for(var k=S+1;k<g._groups[0].length;k++){ut(st(d3.select(g._groups[0][S])),st(d3.select(g._groups[0][k])))&&(m.push(S),d3.select(g._groups[0][S]).style("opacity","0"))}}for(var b=new Set(m),w=Array.from(b),F=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(w,x),O=0;O<w.length;O++){for(var C=[],A=0;A<F.length;A++){var P=st(d3.select(g._groups[0][w[O]])),z=st(d3.select(g._groups[0][F[A]]));if(C.push(ut(P,z)),ut(P,z)){if(w[O]==F[A])continue;d3.select(g._groups[0][w[O]]).style("opacity","0")}}0==C.filter(function(t){return 1==t}).length&&F.push(w[O])}for(var D=0;D<F.length;D++)d3.select(g._groups[0][F[D]]).style("opacity","1")}return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}}]),n}(),Qe=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("rect").attr("class","overlay-rect"),e._width=0,e._height=0,e._onMouseover=function(){},e._onMousemove=function(){},e._onMouseout=function(){},e}return h(n,o),s(n,[{key:"update",value:function(){return this.elem.attr("x",0).attr("y",0).attr("width",this._width<0?0:this._width).attr("height",this._height).style("fill","#000").style("opacity",0).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),this}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}}]),n}(),$e=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","multiple-bar"),e.overlay=new Qe(e.group),e._width=400,e._height=400,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._zeroLineStroke="#000",e._gapPadding=5,e._allowedMaxTextWidth=100,e._xScale=d3.scaleBand(),e._yScale=d3.scaleLinear(),e._mainLeft=0,e._mainWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var t,a=this,e=a._data,n=a._width,i=a._height,r=a._fontSize,l=a._fontFamily,s=a._gapPadding,u=i/e.length,o=d3.max(e,function(t){return d3.max(t.data,function(t){return Math.abs(t.value)})}),h=d3.max(e,function(t){return E(t.name,r,l)}),c=h>a._allowedMaxTextWidth,_=0<e.length?Math.min(h,a._allowedMaxTextWidth):0+a._gapPadding,d=1.25*r+a._gapPadding,f=n-_-d,y=a._xScale.domain(0<e.length?e[0].data.map(function(t){return t.name}):[]).range([0,f]),p=a._yScale.domain([-o,o]).range([u,0]);return(t=a.group.selectAll(".bar-plot-group").data(e,function(t){return t.key})).exit().remove(),t.enter().append("g").attr("class","bar-plot-group").merge(t).style("font-size",r+"px").style("font-family",l).each(function(t){var e=d3.select(this),n=e.property("bar-plot")||new Ze(e);e.property("bar-plot",n);var i=e.select(".left-text").empty()?e.append("text").attr("class","left-text"):e.select(".left-text"),o=e.select(".right-text").empty()?e.append("text").attr("class","right-text"):e.select(".right-text");i.attr("x",-s).attr("y",u/2).attr("dy","0.35em").style("text-anchor","end").style("fill",a._fontColor).text(function(t){return c?I(t.name,_,r,l):t.name}).attr("font-size",a._fontSize).attr("font-family",a._fontFamily),o.attr("x",f+s).attr("y",u/2).attr("dy","0.35em").style("text-anchor","start").style("fill",a._fontColor).text("0").attr("font-size",a._fontSize).attr("font-family",a._fontFamily),n.data(t.data).xScale(y).yScale(p).fill(t.color).showZeroLine(a._showZeroLine).zeroLineStroke(a._zeroLineStroke).transition(a._transition).duration(a._duration),n.update()}).attr("transform",function(t,e){return"translate("+_+", "+u*e+")"}).style("opacity",0).transition().duration(a._transition?a._duration/a._data.length:0).delay(function(t,e){return e*(a._transition?a._duration/a._data.length:0)}).style("opacity",1),a.overlay.elem.raise(),a.overlay.width(f).height(i).translate(_,0).onMouseover(a._onMouseover).onMousemove(a._onMousemove).onMouseout(a._onMouseout).update(),a._mainLeft=_,a._mainWidth=f,a}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"xScale",get:function(){return this._xScale}},{key:"yScale",get:function(){return this._yScale}},{key:"mainLeft",get:function(){return this._mainLeft}},{key:"mainWidth",get:function(){return this._mainWidth}}]),n}(),Je="axis-group",Ke="x-title",tn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-x"),e._orient="bottom",e._type="category",e._allowedMaxTextHeight=30,e._tickTextRotate=0,e._tickTextHeight=0,e}return h(n,ft),s(n,[{key:"update",value:function(){var n=this,i=n._orient,t=n._scaleFunc,e=n.group,o=n._fontSize,a=n._tickTextRotate,r=n._tickValueTexts,l=void 0;(l=n.axisFunc="top"===i?d3.axisTop(t):d3.axisBottom(t)).tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding);var s=e.select("."+Je).empty()?e.append("g").attr("class",Je):e.select("."+Je);s.style("font-size",o+"px").style("font-family",n._fontFamily).transition().duration(n._transition?n._duration:0).call(l).on("start",function(t,e){s.selectAll(".tick text").style("fill",n._fontColor).attr("dx",0).attr("dy","0.71em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t,e){return r[e]}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"top"!==i}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",n._lineStroke),s.select("path").style("stroke",n._lineStroke).style("display",n._axisLineShow?"block":"none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(n._titleShow&&n._title){var h=e.select("."+Ke).empty()?e.append("g").attr("class",Ke):e.select("."+Ke),c=h.select("text").empty()?h.append("text"):h.select("text");h.call(G,u/2,n.height),c.attr("dy","0.5em").attr("text-anchor","middle").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dy","-0.5em").text(n._title)}else e.select("."+Ke).remove()}},{key:"compute",value:function(){var e=this,n=[],i=[],o=0,a=0;function r(){e._tickTextRotate=o,e._tickValues=n,e._tickValueTexts=i,e._tickTextHeight=a}var t=e._scaleFunc,l=e._type,s=e._fontSize,u=(e._minTickDistance,e._allowedMaxTextHeight),h=Math.abs(t.range()[0]-t.range()[1]),c=void 0,_=void 0;if(n="category"===l?t.domain():t.ticks(e._tickCount),"number"===l&&0!=t.domain()[0]&&n.push(t.domain()[0]),function(){var t=!1;c=h/n.length,(_=d3.max(n,function(t){return E(t,s,e._fontFamily)}))<c&&(o=0,i=n,a=1.125*s,r(),t=!0);return t}())return e;o="top"===e._orient?45:-45;var d=Math.abs(Math.sin(Math.PI/4));_*d<u?(a=_*d,i=n):(a=u,i=n.map(function(t){return I(t,a/d,s,e._fontFamily)}));var f=h/n.length;if("category"===l&&f<2*s){var y=Math.ceil(2*s/f);n=n.filter(function(t,e){return e%y==0})}return r(),e}},{key:"allowedMaxTextHeight",value:function(t){return arguments.length?(this._allowedMaxTextHeight=t,this):this._allowedMaxTextHeight}},{key:"height",get:function(){var t=0;return this.isShow&&(t=(this._tickShow?this._tickSize+this._tickPadding+1.2*this._tickTextHeight:0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),t}}]),n}(),en=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","multiple-bar-chart"),e.core=new $e(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.xAxis=new tn(e.mainGroup),e.AnimationArea=new Ot(e.defs),e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var a=this,r=a.activeData,l=a.core,s=a.tooltip,t=a.overlay,u=a.guideLine,e=a.widthOfCore,n=a.heightOfCore,h=(a.AnimationArea,l.xScale);u.y1(0).y2(n).stroke("#c6c6c6").strokeDasharray("0 0"),l.data(r).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).width(e).height(n).fontSize(a._fontSize).fontColor(a._fontColor).fontFamily(a._fontFamily).zeroLineStroke(a._axisLineStroke).showZeroLine(a._xTickShow).allowedMaxTextWidth(e/5).update(),t.data(h.domain()).bandWidth(h.step()).bandHeight(n).isScalePoint(!1).translate(l.mainLeft,0).onMouseover(function(t,e){var i=t,n=h.step(),o=[{text:i}];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});o.push({text:t.name+": "+n[0].value,color:t.color})}),s.data(o).update(),u.x(0).update().show(),a.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(h(i)+l.mainLeft+n/2)+",0)"),s.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){s.hide(),u.hide()}),t.update()}},{key:"updateAxis",value:function(){var t=this.xAxis;t.scaleFunc(d3.scaleLinear().range([0,this.widthOfNoMargin])).title(this._xTitle).fontSize(this._fontSize).fontColor(this._fontColor).fontFamily(this._fontFamily).transition(!1).axisLineShow(!1).tickShow(!1),t.translate(0,this.heightOfMainGroup-t.height).update()}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}}]),n}(),nn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","bubble-plot"),e._radius=function(){},e._cx=function(){},e._cy=function(){},e._fill=null,e._stroke=null,e._strokeWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,i=n._data,t=n.group,e=(n._transition&&n._duration,t.selectAll("circle").data(i,function(t){return t.key}));return e.exit().remove(),e.enter().append("circle").merge(e).attr("cx",n._cx).attr("cy",n._cy).style("fill",function(t){return n._fill||t.color}).style("fill-opacity",.4).attr("r",0).style("stroke",function(t){return t.color}).style("stroke-width",n._strokeWidth).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).transition().duration(n._transition?n._duration/i.length:0).delay(function(t,e){return n._transition?n._startDelay+n._duration/i.length*e:0}).attr("r",n._radius),n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"cx",value:function(t){return arguments.length?(this._cx=t,this):this._cx}},{key:"cy",value:function(t){return arguments.length?(this._cy=t,this):this._cy}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),on=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.categories,i=this.generateColorList(e.length),o={},a=[];return e.forEach(function(t,e){var n=i[e];o[t]=n,a.push({name:t,color:n})}),t.nodes.forEach(function(t){return t.color=o[t.category]}),t.legendData=a,t}}]),n}();function an(t,e){var s=0,u=1,h=2,c=3,_=4;if(e.forEach(function(t){"typeCol"===t.function?s=t.index:"objCol"===t.function?u=t.index:"X轴"===t.name?h=t.index:"Y轴"===t.name?c=t.index:"半径"===t.name&&(_=t.index)}),W(t,[s,u,h,c,_])||!C(t,h)||!C(t,c)||!C(t,_))return{categories:[],nodes:[],labels:[]};var d=[],f=[],y={};t.slice(1).forEach(function(t,e){var n=t[s],i=t[u],o=t[h],a=t[c],r=t[_],l=n+"-"+i+"-"+e;y[n]||(y[n]=n,d.push(n)),f.push({category:n,name:i,x:o,y:a,radius:r,key:l})});var n=t[0],i={category:n[s],name:n[u],x:n[h],y:n[c],radius:n[_]};return{categories:d,nodes:f,labels:i}}var rn="axis-group",ln="y-title",sn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-horizontal"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=6,e}return h(n,ft),s(n,[{key:"update",value:function(){var e=this,t=this,n=t._orient,i=t._scaleFunc,o=t.group,a=t._fontSize,r=t._tickValueTexts,l=void 0;l=t.axisFunc="right"===n?d3.axisRight(i):d3.axisLeft(i);var s=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(s=d3.format("d")),l.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(s);var u=o.select("."+rn).empty()?o.append("g").attr("class",rn):o.select("."+rn);u.transition().duration(t._transition?t._duration:0).call(l).on("start",function(){u.selectAll(".tick text").style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return r[e]}),u.selectAll(".tick line").style("stroke",t._lineStroke),u.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none")});var h=t.group.selectAll(".axis-y-horizontal .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)||"&-"==String(t.__data__).slice(0,2)});d3.selectAll(h).remove();var c=Math.abs(i.range()[0]-i.range()[1]);if(t._titleShow&&t._title){var _=o.select("."+ln).empty()?o.append("g").attr("class",ln):o.select("."+ln),d=_.select("text").empty()?_.append("text"):_.select("text"),f=(E(t._title,a,t._fontFamily),d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,e._fontSize,e._fontFamily)}));_.call(G,-(this._tickShow?(f?this._tickSize+this._tickPadding:5)+this._tickTextWidth:0),c/2),d.attr("y",-9).style("font-size",a+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else o.select("."+ln).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount),"number"===a&&0!=e._yRange.length&&t.push(-1==String(e._yRange[0]).indexOf(".")?e._yRange[0]:e._yRange[0].toFixed(0));var s=d3.max(t.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,r,e._fontFamily)})||0;return s<=l?(n=t,i=s):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var e=this,t=d3.max(this._tickValueTexts.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(null==t?"":t,e._fontSize,e._fontFamily)}),n=0;return this.isShow&&(n=this._tickShow?(t?this._tickSize+this._tickPadding:0)+this._tickTextWidth+(this._title?1.125*this._fontSize+24+3:0):this._titleShow&&this._title?1.125*this._fontSize+24+3:0),n}}]),n}(),un=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","grouping-bubble-chart"),e.clipArea=new Ft(e.defs),e.grid=new Pt(e.coreGroup),e.core=new nn(e.coreGroup),e.xAxis=new vt(e.mainGroup).tickFormat(function(t){return t}),e.yAxis=new sn(e.mainGroup),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleLinear(),e._xType="number",e._yType="number",e._sortValue=-1,e._maxRadius=15,e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var t=this,e=t.core,n=t.tooltip,i=t.grid,o=t.clipArea,a=t.activeData,r=a.nodes,l=a.labels,s=t.widthOfCore,u=t.heightOfCore,h=t.xScale,c=t.yScale,_=t._maxRadius,d=d3.max(r,function(t){return Math.abs(t.radius)}),f=d3.scaleSqrt().domain([0,d]).range([0,_]);e.data(r).cx(function(t){return h(t.x)}).cy(function(t){return c(t.y)}).radius(function(t){return f(Math.abs(t.radius))}).stroke("#fff").transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).onMouseover(function(t){d3.select(this).style("stroke","#000");var e=[{color:t.color,text:l.category+"："+t.category},{text:l.name+"："+t.name},{text:l.x+"："+t.x},{text:l.y+"："+t.y},{text:l.radius+"："+t.radius}];n.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){n.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this).style("stroke","#fff"),n.hide()}),i.width(s).height(u).xTickLocations(t.xAxis.tickLocations).yTickLocations(t.yAxis.tickLocations).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),t.coreGroup.call(G,t.yAxis.width+.5,0),0!=t._clipShow.length?(o.width(s).height(u).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+o.id+")")):(o.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","")),o.update(),e.update(),i.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy,o=i.legendData;t.legend.data(o).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),o.forEach(function(t){t.name===e.name&&(t.active=!n)}),i.nodes.forEach(function(t){t.category===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData.nodes,e=this._xDomain||[],n=this._yDomain||[],i=d3.extent(t,function(t){return t.x}),o=d3.extent(t,function(t){return t.y}),a=isNaN(parseFloat(e[0]))?Math.min(0,i[0]||0):parseFloat(e[0]),r=isNaN(parseFloat(e[1]))?Math.max(1,i[1]||0):parseFloat(e[1]),l=isNaN(parseFloat(n[0]))?Math.min(0,o[0]||0):parseFloat(n[0]),s=isNaN(parseFloat(n[1]))?Math.max(1,o[1]||0):parseFloat(n[1]);this._xDomain=[a,r],this._yDomain=[l,s]}},{key:"sortData",value:function(){var t=this._data;-1===this._sortValue?t.nodes.sort(function(t,e){return e.radius-t.radius||t.index-e.index}):1===this._sortValue&&t.nodes.sort(function(t,e){return t.radius-e.radius||t.index-e.index}),this._sortedDataCopy=t}},{key:"buildOption",value:function(t,e){var n=new on(t,e);return n.dataSolveFunc(an),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e.transition||0==e.transition?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"activeData",get:function(){var t=this.sortedDataCopy;return{nodes:t.nodes.filter(function(t){return!1!==t.active}),labels:t.labels}}}]),n}(),hn=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),e=t.minValue,n=t.maxValue,i=t.data,o=this.generateColorList(),a=o.length,r=(n-e)/(a-1),l=d3.range(a).map(function(t){return e+r*t}),s=d3.scaleLinear().domain(l).range(o);return i.forEach(function(t){t.nodes.forEach(function(t){return t.color=s(t.value)})}),t.colorScale=s,t}}]),n}();function cn(t,e){var n=0,i=1;if(e.forEach(function(t){"objCol"===t.function?n=t.index:"vCol"===t.function&&(i=t.index)}),W(t,[n,i])||!C(t,i))return{data:[],minValue:0,maxValue:0,dateLabel:"",valueLabel:""};for(var o={},a=/^\d{1,4}(\-|\/)\d{1,2}(\-|\/)\d{1,2}$/,r=1,l=t.length;r<l;r++){var s=t[r],u=s[n],h=parseFloat(s[i]);if(a.test(u)&&!isNaN(h)&&"Invalid Date"!==new Date(u)){u=p(u);var c=new Date(u),_=c.getFullYear();o[_]||(o[_]=[]),o[_].push({date:c,dateString:u,value:h})}}var d=[];for(var f in o)d.push({year:parseInt(f),nodes:o[f]});var y=d3.max(d,function(t){return d3.max(t.nodes,function(t){return t.value})});return{data:d,minValue:d3.min(d,function(t){return d3.min(t.nodes,function(t){return t.value})}),maxValue:y,dateLabel:t[0][n],valueLabel:t[0][i]}}var _n=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","calendar-heatmap"),e._cellSize=20,e._cellFill="#fff",e._cellStroke="#ccc",e._monthStroke="#000",e}return h(n,P),s(n,[{key:"update",value:function(){var t,e,n,i=this,o=i._data,a=parseInt(o.year),r=o.nodes,l=i._cellSize,s=i.group;function u(t){var e=new Date(t.getFullYear(),t.getMonth()+1,0),n=t.getDay(),i=d3.timeWeek.count(d3.timeYear(t),t),o=e.getDay(),a=d3.timeWeek.count(d3.timeYear(e),e);return"M"+(i+1)*l+","+n*l+"H"+i*l+"V"+7*l+"H"+a*l+"V"+(o+1)*l+"H"+(a+1)*l+"V0H"+(i+1)*l+"Z"}(t=(s.select(".bottom-group").empty()?s.append("g").attr("class","bottom-group"):s.select(".bottom-group")).selectAll(".bottom-rect").data(function(){return d3.timeDays(new Date(a,0,1),new Date(a+1,0,1))})).exit().remove(),t.enter().append("rect").attr("class","bottom-rect").merge(t).attr("x",function(t){return d3.timeWeek.count(d3.timeYear(t),t)*l}).attr("y",function(t){return t.getDay()*l}).attr("width",l).attr("height",l).style("fill",i._cellFill).style("stroke",i._cellStroke).style("stroke-dasharray",function(){return i._gridShowX&&i._gridShowY?0:i._gridShowX?l+" "+l:i._gridShowY?"0 "+l+" 0":void 0}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout).style("opacity",0).transition().duration(i._transition?.4*i._duration:0).style("opacity",1),(e=(s.select(".active-group").empty()?s.append("g").attr("class","active-group"):s.select(".active-group")).selectAll(".color-rect").data(r,function(t){return t.date})).exit().remove(),e.enter().append("rect").attr("class","color-rect").merge(e).attr("x",function(t){return d3.timeWeek.count(d3.timeYear(t.date),t.date)*l}).attr("y",function(t){return t.date.getDay()*l}).attr("width",l).attr("height",l).style("fill",function(t){return t.color}).style("stroke",i._cellStroke).style("stroke-dasharray",function(){return i._gridShowX&&i._gridShowY?0:i._gridShowX?l+" "+l:i._gridShowY?"0 "+l+" 0":void 0}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout).style("opacity",0).transition().duration(i._transition?.6*i._duration:0).delay(i._transition?.4*i._duration:0).style("opacity",1),(n=(s.select(".month-group").empty()?s.append("g").attr("class","month-group"):s.select(".month-group")).selectAll(".month-path").data(function(){return d3.timeMonths(new Date(a,0,1),new Date(a+1,0,1))})).exit().remove(),n.enter().append("path").attr("class","month-path").merge(n).style("fill","none").style("stroke",i._monthStroke).attr("d",u).style("opacity",0).transition().duration(i._transition?.4*i._duration:0).style("opacity",1)}},{key:"cellSize",value:function(t){return arguments.length?(this._cellSize=t,this):this._cellSize}},{key:"cellFill",value:function(t){return arguments.length?(this._cellFill=t,this):this._cellFill}},{key:"cellStroke",value:function(t){return arguments.length?(this._cellStroke=t,this):this._cellStroke}},{key:"monthStroke",value:function(t){return arguments.length?(this._monthStroke=t,this):this._monthStroke}},{key:"gridShowX",value:function(t){return arguments.length?(this._gridShowX=t,this):this._gridShowX}},{key:"gridShowY",value:function(t){return arguments.length?(this._gridShowY=t,this):this._gridShowY}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),dn=function(){function e(t){r(this,e),this.id=i(""),this.elem=t.append("linearGradient").attr("id",this.id),this._colorList=[],this._offsetList=[]}return s(e,[{key:"update",value:function(){var t=this.elem,e=this._colorList,n=this._offsetList||[],i=e.length;if(n.length!==i){var o=1/(i-1);n=d3.range(i).map(function(t){return o*t})}var a=t.selectAll("stop").data(e);return a.exit().remove(),a.enter().append("stop").merge(a).attr("offset",function(t,e){return n[e]}).attr("stop-color",function(t){return t}),this}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"offsetList",value:function(t){return arguments.length?(this._offsetList=t,this):this._offsetList}}]),e}(),fn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","gradient-legend"),e.group=e.elem.append("g"),e.defs=e.elem.append("defs"),e.gradient=new dn(e.defs),e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._rectWidth=100,e._rectHeight=30,e._colorList=[],e._startText=0,e._endText=1,e._paddingHor=3,e._paddingVer=5,e._limitedWidth=400,e._horizontalAlign="center",e._title="title",e}return h(n,o),s(n,[{key:"update",value:function(){var t=this,e=t.gradient,n=t._rectWidth,i=t._rectHeight,o=t.group.style("font-size",t._fontSize+"px").style("font-family",t._fontFamily),a=o.select("rect").empty()?o.append("rect"):o.select("rect"),r=o.select(".start-text").empty()?o.append("text").attr("class","start-text"):o.select(".start-text"),l=o.select(".end-text").empty()?o.append("text").attr("class","end-text"):o.select(".end-text"),s=o.select(".legend-title").empty()?o.append("text").attr("class","legend-title"):o.select(".legend-title");e.colorList(t._colorList).update(),a.attr("x",0).attr("y",0).attr("width",n).attr("height",i).style("fill","url(#"+t.gradient.id+")"),s.attr("x",n/2).attr("y",i+t._paddingVer).attr("dy","1em").style("text-anchor","middle").text(t._title),r.attr("x",-t._paddingHor).attr("y",i/2).attr("dy","0.35em").style("text-anchor","end").style("fill",t._fontColor).text(t._startText),l.attr("x",n+t._paddingHor).attr("y",i/2).attr("dy","0.35em").style("text-anchor","start").style("fill",t._fontColor).text(t._endText);var u=t._horizontalAlign;return"left"===u?o.call(G,E(this._startText,t._fontSize,t._fontFamily),0):"right"===u?o.call(G,t._limitedWidth-n-E(this._endText,t._fontSize,t._fontFamily),0):o.call(G,t._limitedWidth/2-n/2,0),t}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"rectWidth",value:function(t){return arguments.length?(this._rectWidth=t,this):this._rectWidth}},{key:"rectHeight",value:function(t){return arguments.length?(this._rectHeight=t,this):this._rectHeight}},{key:"paddingHor",value:function(t){return arguments.length?(this._paddingHor=t,this):this._paddingHor}},{key:"paddingVer",value:function(t){return arguments.length?(this._paddingVer=t,this):this._paddingVer}},{key:"colorList",value:function(t){return arguments.length?(this._colorList=t,this):this._colorList}},{key:"startText",value:function(t){return arguments.length?(this._startText=t,this):this._startText}},{key:"endText",value:function(t){return arguments.length?(this._endText=t,this):this._endText}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"title",value:function(t){return arguments.length?(this._title=t,this):this._title}}]),n}(),yn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","calendar-heatmap-chart"),e.legend=new fn(e.group),e.xAxis=new tn(e.mainGroup),e._sortValue=1,e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var i=this,t=i.activeData,e=t.data,o=t.valueLabel,a=i.tooltip,n=i.widthOfCore,r=i.heightOfCore/e.length,l=Math.min(r/7,n/56),s=i._gridShowX||i._gridShowY?i._gridStroke:"none",u=i._xTickShow?i._axisLineStroke:"none",h=53*l,c=7*l,_=d3.timeFormat("%Y-%m-%d"),d=i.coreGroup.selectAll(".year-group").data(e,function(t){return t.year});d.exit().remove(),d.enter().append("g").attr("class","year-group").merge(d).attr("transform",function(t,e){return"translate("+(n-h)/2+", "+(r*e+(r-c)/2)+")"}).each(function(t){var e=d3.select(this),n=e.property("calendar")||new _n(e);e.property("calendar",n),n.data(t).cellSize(l).cellStroke(s).monthStroke(u).gridShowX(i._gridShowX).gridShowY(i._gridShowY).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).onMouseover(function(t){var e=[];e=t instanceof Date?[{text:_(t)}]:[{text:t.dateString,color:t.color},{text:o+"："+t.value}],d3.select(this).raise().style("stroke","#000"),a.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){a.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){d3.select(this).style("stroke",s),a.hide()}),n.update(),(e.select("text").empty()?e.append("text"):e.select("text")).attr("transform","translate(-6, "+c/2+")rotate(-90)").style("font-size",i._fontSize).style("font-family",i._fontFamily).style("fill",i._fontColor).style("text-anchor","middle").text(t.year)})}},{key:"updateLegend",value:function(){var t=this.legend,e=this.widthOfNoMargin;if(!this._legendShow)return t.hide();t.show(),t.limitedWidth(e).horizontalAlign(this._legendX).rectWidth(e/5).rectHeight(e/5/10).fontSize(this._fontSize).fontFamily(this._fontFamily).fontColor(this._fontColor),this.configLegend(),t.update()}},{key:"configLegend",value:function(){var t=this.sortedDataCopy;this.legend.colorList(t.colorScale.range()).startText(t.minValue).endText(t.maxValue).title(t.valueLabel)}},{key:"updateAxis",value:function(){var t=this.xAxis;t.scaleFunc(d3.scaleLinear().range([0,this.widthOfNoMargin])).title(this._xTitle).fontSize(this._fontSize).fontColor(this._fontColor).fontFamily(this._fontFamily).transition(!1).axisLineShow(!1).tickShow(!1),t.translate(0,this.heightOfMainGroup-t.height).update()}},{key:"computeDomain",value:function(){}},{key:"sortData",value:function(){var t=this._data.data;1===this._sortValue?t.sort(function(t,e){return t.year-e.year}):-1===this._sortValue&&t.sort(function(t,e){return e.year-t.year}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new hn(t,e);return n.dataSolveFunc(cn),n}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}},{key:"activeData",get:function(){var t=this.sortedDataCopy;return{data:t.data,valueLabel:t.valueLabel}}}]),n}(),pn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","hollow-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="",e._borderWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,i=n.group;i.select(".hollow-bar-rects").remove();var e=i.append("g").attr("class","hollow-bar-rects").selectAll("rect").data(t,function(t){return t.key});e.exit().remove();var o=e.enter().append("rect").merge(e).style("fill",function(t){return n._fillColor||t.color}).style("fill-opacity",function(t){return n._fillOpacity}).style("stroke",function(t){return n._borderColor||t.color}).style("stroke-width",function(t){return n._borderWidth||n._strokeWidth||0}).style("fill-opacity",function(t){return n._fillOpacity}).style("rx",n._barCornerRadius).style("ry",n._barCornerRadius);if(this._rectObj?(o.attr("x",n._xScale(0)),o.attr("y",this._rectObj.yFunc),o.attr("width",0),o.attr("height",this._rectObj.heightFunc),o.transition().duration(n._transition?.9*n._duration:0).attr("x",this._rectObj.xFunc).attr("width",this._rectObj.widthFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){i.select(".hollow-bar-texts").remove();var a=i.append("g").attr("class","hollow-bar-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").attr("class","hollow-bar-text").merge(e).text(this._textObj.textFunc).attr("fill",n._textObj.colorFunc).attr("font-size",n._textObj.fontSize).attr("font-family",n._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dy",this._textObj.dyFunc).attr("dx",function(t,e){return null==n._labelShow||0==n._labelShow||null==n._positionOptions||null==n._positionChoice?0:0==n._positionOptions.indexOf(n._positionChoice)?0<t.value?.3*n._textObj.fontSize:-st(d3.select(i.selectAll(".hollow-bar-texts text").nodes()[e])).width-.3*n._textObj.fontSize:1==n._positionOptions.indexOf(n._positionChoice)?0<t.value?-(n._xScale(t.value)-n._xScale(0))+.3*n._textObj.fontSize:-(n._xScale(t.value)-n._xScale(0))-st(d3.select(i.selectAll(".hollow-bar-texts text").nodes()[e])).width-.3*n._textObj.fontSize:2==n._positionOptions.indexOf(n._positionChoice)?0<t.value?.3*-n._textObj.fontSize-st(d3.select(i.selectAll(".hollow-bar-texts text").nodes()[e])).width:.3*n._textObj.fontSize:void 0}).style("display",this._textObj.labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?.9*n._duration:0).style("opacity",1);null!=n._labelShow&&0!=n._labelShow&&null!=n._positionOptions&&null!=n._positionChoice&&-1!=n._positionOptions.indexOf(n._positionChoice)||i.selectAll(".hollow-bar-texts text").style("display","none")}for(var r=i.selectAll(".hollow-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("visibility","hidden")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("visibility","visible");return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),vn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("rect").attr("class","selectOverlay-rect"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(n,o),s(n,[{key:"update",value:function(){return this.elem.attr("x",0).attr("y",0).attr("width",this._width<0?0:this._width).attr("height",this._height).style("fill",this._shadowColor).style("opacity",.15),this}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),n}(),gn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","hollow-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new pn(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._strokeWidth=2,e._rectHeight=.5,e._labelShow=!1,e._positionOptions=["右边","内部居左","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var s=this,u=s.activeData,h=[],t=[],e=[];u.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,h.push(t)})}),h.sort(function(t,e){return t.index-e.index});for(var n=0;n<h.length;n++)null==s._labelShow||null==s._positionOptions||null==s._positionChoice||-1==s._positionOptions.indexOf(s._positionChoice)?(t.push(0),e.push(0)):1==s._labelShow&&0==s._positionOptions.indexOf(s._positionChoice)?0<h[n].value||0==h[n].value?e.push(E(h[n].value,s._textLabel.fontSize,s._textLabel.fontFamily)):h[n].value<0&&t.push(E(h[n].value,s._textLabel.fontSize,s._textLabel.fontFamily)):(t.push(0),e.push(0));var i=s.grid,o=s.rectPlot,c=s.tooltip,a=s.overlay,r=s.selectOverlay,l=s.xScale,_=s.yScale,d=s.widthOfCore,f=s.heightOfCore,y=_.step();i.width(d-(0==t.length?0:d3.max(t))-(0==e.length?0:d3.max(e))).height(f).xTickLocations(s.xAxis.tickLocations).yTickLocations(s.yAxis.tickLocations).showX(s._gridShowX).showY(s._gridShowY).stroke(s._gridStroke).strokeDasharray(s._gridStrokeDasharray),a.data(_.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(d-(0==t.length?0:d3.max(t))-(0==e.length?0:d3.max(e))).bandHeight(_.step()).onMouseover(function(t,e){for(var n=_.domain()[h.length-e-1==-1?1:h.length-e-1==-2?0:h.length-e-1],i=h.filter(function(t){return t.name===n}),o=[],a="",r=0;r<u.children.length;r++)for(var l=0;l<u.children[r].children.length;l++)u.children[r].children[l].name==n&&(a=u.children[r].name);n&&1!=n&&((o=[{text:a}]).push({text:i[0].name+": "+i[0].value,color:i[0].color}),s.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+_(n)+")")),c.data(o).update(),c.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){c.move([d3.event.offsetX,d3.event.offsetY]),r.show()}).onMouseout(function(){c.hide(),r.hide()}),r.width(d-(0==t.length?0:d3.max(t))-(0==e.length?0:d3.max(e))).height(_.step()).shadowColor("#ccc").hide(),o.data(h).xScale(l).yScale(_).labelShow(s._labelShow).positionOptions(s._positionOptions).positionChoice(s._positionChoice).fillColor("none").strokeWidth(s._strokeWidth).transition(s._transition).duration(1e3*s._duration).easeStyle(s._easeStyle).startDelay(1e3*parseFloat(s._startDelay)).moveStyle(s._moveStyle).endPause(s._endPause).rectObj({xFunc:function(t){return 0<t.value||0==t.value?s.xScale(0):t.value<0?s.xScale(t.value):void 0},yFunc:function(t,e){return s.yScale.range()[0]-(e*y+(y-y*s._rectHeight)/2+y*s._rectHeight)},widthFunc:function(t){return 0<t.value||0==t.value?0<s.xScale(t.value)-s.xScale(0)?s.xScale(t.value)-s.xScale(0):0:t.value<0?0<s.xScale(0)-s.xScale(t.value)?s.xScale(0)-s.xScale(t.value):0:void 0},heightFunc:function(t){return y*s._rectHeight}}).textObj({xFunc:function(t,e){return s.xScale(t.value)},yFunc:function(t,e){return s.yScale.range()[0]-(e*y+(y-.9*y*s._rectHeight)/2+.7*y*s._rectHeight)},dyFunc:.5*y*s._rectHeight/2+s._textLabel.fontSize/3,colorFunc:function(){return s._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:s._textLabel.fontSize,fontFamily:s._textLabel.fontFamily,labelShow:s._labelShow}),s.coreGroup.call(G,s.yAxis.width+.5,0),i.update(),r.update(),o.update(),a.update(),s.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==t.length?0:d3.max(t))+",0 )"),s.group.selectAll(".bands-overlay").attr("transform","translate("+(0==t.length?0:d3.max(t))+",0 )"),s.group.selectAll(".selectOverlay-rect").attr("x",""+(0==t.length?0:d3.max(t)))}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e.widthOfNoMargin,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);var _=e.activeData,d=[];_.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,d.push(t)})}),d.sort(function(t,e){return t.index-e.index});for(var f=[],y=[],p=0;p<d.length;p++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(f.push(0),y.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<d[p].value||0==d[p].value?y.push(E(d[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):d[p].value<0&&f.push(E(d[p].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(f.push(0),y.push(0));n&&n.titleHeight;var v=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(v).compute(),n.compute();var g=(h-n.width-(0==f.length?0:d3.max(f))-(0==y.length?0:d3.max(y)))/t._tickValues.length,m=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),x=(t._tickShow?t._tickSize+t._tickPadding+(m<g?1.125*t._fontSize:t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-x,0]),n.compute(),i.range([0==f.length?0:d3.max(f),h-n.width-(0==y.length?0:d3.max(y))]),t.compute();var S=n.width,k=c-x,b=n.width;t.translate(S,k).update(),n.translate(b,0).update()}},{key:"computeDomain",value:function(){var t=this.activeData,n=[];t.children.forEach(function(e){e.children.forEach(function(t){t.color=e.color,n.push(t)})}),n.sort(function(t,e){return t.index-e.index});this._xDomain;var e=n.length?n.map(function(t){return t.name}):[0,1],i=n.length?[1.1*Math.min(d3.min(n,function(t){return+t.value}),0),Math.max(1.1*d3.max(n,function(t){return+t.value}),0)]:[0,1];this._xDomain=i,this._yDomain=e}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"configLegend",value:function(){var t=this,i=t.activeData,o=i.children.map(function(t,e){return{name:t.name,color:t.color,key:t.name+"-"+e,index:t.index}});o.sort(function(t,e){return t.index-e.index}),t.legend.data(o).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),o.forEach(function(t){t.key===e.key&&(t.active=!n)}),i.children.forEach(function(t){t.name===e.name&&(t.active=!n)}),t.onDataChange()})}},{key:"sortData",value:function(){var t=this._data.nodes;-1===this._sortValue?t.sort(function(t,e){return e.sum-t.sum||t.index-e.index}):1===this._sortValue&&t.sort(function(t,e){return t.sum-e.sum||t.index-e.index}),this._sortedDataCopy=this._data}},{key:"buildOption",value:function(t,e){var n=new ve(t,e);return n.dataSolveFunc(ge),n}},{key:"activeData",get:function(){return{children:this.sortedDataCopy.nodes.filter(function(t){return!1!==t.active})}}}]),n}(),mn=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,kt),s(e,[{key:"update",value:function(){var n=this,t=n.group,e=n._data,i=n._xScale,o=n._yScale;t.selectAll(".stacked-scatter-circle").remove();var a=t.selectAll("g").data(e,function(t){return t.name});a.exit().remove(),a.enter().append("g").merge(a).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","stacked-scatter-circle").attr("cx",function(t){return i(t.name)||0}).attr("cy",function(t){return o(t.total)||0}).merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("r",n._radius).attr("cx",function(t){return i(t.name)||0}).attr("cy",function(t){return o(t.total)||0})});for(var r=t.selectAll(".stacked-scatter-circle").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return n}}]),e}(),xn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","ranking-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e._lineFunc||d3.line().x(function(t){return e._xScale(t.name)}).y(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(e._curve);var i=e.group.selectAll("path").data(t,function(t){return t.key});return i.exit().remove(),i.enter().append("path").merge(i).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._lineWidth).style("stroke-dasharray",e._strokeDasharry).transition().duration(e._transition?e._duration:0).attr("d",function(t){return n(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Sn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stacked-chart"),e.grid=new Pt(e.coreGroup),e.areaPlot=new Xe(e.coreGroup),e.linePlot=new xn(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new mn(e.coreGroup),e.areaStackText=new wt(e.coreGroup),e.clipArea=new Ft(e.defs),e.AnimationArea=new Ot(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=n.grid,e=n.areaPlot,i=n.linePlot,l=n.guideScatter,s=n.tooltip,o=n.areaStackText,a=n.overlay,u=n.guideLine,h=n.clipArea,c=n.AnimationArea,_=n.xScale,d=n.yScale,f=n.widthOfCore,y=n.heightOfCore,p=0;p<r.length;p++)for(var v=0;v<r[p].data.length;v++)r[p].data[v].value=parseFloat(r[p].data[v].value),r[p].data[v].total=0==p?isNaN(parseFloat(r[p].data[v].value))?0:parseFloat(r[p].data[v].value):r[p-1].data[v].total+(isNaN(parseFloat(r[p].data[v].value))?0:parseFloat(r[p].data[v].value));Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total})}),0);var g=n.defs;g.selectAll("filter").remove();var m=g.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stacklinear").attr("filterUnits","objectBoundingBox");m.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),m.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),m.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),m.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),m.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.width(f).height(y).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(_).yScale(d).fillOpacity(.7).curve(n._curve).areaFunc(d3.area().x(function(t){return _(t.name)}).y0(function(t){return d(t.total-t.value)}).y1(function(t){return d(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),i.data(r).xScale(_).yScale(d).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).mainGroup(n.mainGroup).curve(n._curve).lineFunc(d3.line().x(function(t){return _(t.name)}).y(function(t){return d(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),l.data(r).xScale(_).yScale(d).radius(3.5).stroke("#fff").strokeWidth(2),u.y1(0).y2(y).stroke("#c6c6c6").strokeDasharray("0 0"),a.data(_.domain()).bandWidth(_.step()).bandHeight(y).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),s.data(o).update(),u.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+_(i)+",0)"),l.data(a).update(),s.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show(),l.show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){s.hide(),u.hide(),l.hide()}),o.data(r).xScale(_).yScale(d).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?h.width(f).height(y).paddingVertical([0,0]).transition(n._transition).duration(n._duration):h.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+h.id+")"),h.update(),l.elem.style("pointer-events","none");var x=n.group.selectAll(".stacked-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(x).remove(),t.update(),a.update(),e.update(),i.update(),o.update(),c.width(0).height(n._height),c.update(),n.coreGroup.select(".area-plot").attr("clip-path","url(#"+c.id+")"),n.coreGroup.select(".ranking-line-plot").attr("clip-path","url(#"+c.id+")"),n.defs.select(".x"+c.id).transition().duration(n._transition?1e3*n._duration*.9:0).delay(n._transition?1e3*n._startDelay:0).attr("width",f)}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var n=0;n<t[e].data.length;n++)t[e].data[n].value=parseFloat(t[e].data[n].value),t[e].data[n].total=0==e?isNaN(parseFloat(t[e].data[n].value))?0:parseFloat(t[e].data[n].value):t[e-1].data[n].total+(isNaN(parseFloat(t[e].data[n].value))?0:parseFloat(t[e].data[n].value));var i=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})})]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(i[0]))?a[0]:parseFloat(i[0]),isNaN(parseFloat(i[1]))?isNaN(parseFloat(i[0]))?a[1]:a[1]<i[0]?1.5*i[0]:a[1]:parseFloat(i[1])]}}]),n}(),kn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rect-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="#000",e._borderWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e.group,i=n.selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var o=i.enter().append("g").append("rect").merge(i).style("fill",function(t){return e._fillColor||t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});if(this._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",this._rectObj.yFunc),o.attr("width",this._rectObj.widthFunc),o.attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){n.selectAll(".symmetric-texts").remove();var a=n.append("g").attr("class","symmetric-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("g").append("text").merge(a).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).style("display",this._textObj.labelShow?"block":"none")}o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var r=n.selectAll(".symmetric-texts text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return e}},{key:"updateChangeWaterfall",value:function(){var e=this,t=e._data,n=e.group;n.select(".change-rects").remove();var i=n.append("g").attr("class","change-rects").selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var o=i.enter().append("rect").merge(i).style("fill",function(t){return 0<t.value?e._fillColor||t.color:e._fillColor||t.color_special}).style("fill-opacity",function(t){return e._fillOpacity}).style("rx",e._barCornerRadius).style("ry",e._barCornerRadius).style("stroke",function(t){return 0<t.value?e._borderColor||t.color:e._borderColor||t.color_special}).style("stroke-width",function(t){return e._borderWidth||0});if(this._rectObj?(o.attr("x",this._rectObj.xFunc),o.attr("y",function(t){return e._yScale(t.total-t.value)}),o.attr("width",this._rectObj.widthFunc),o.attr("height",0),o.transition().duration(e._transition?.9*e._duration:0).attr("y",this._rectObj.yFunc).attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){n.select(".change-texts").remove();var a=n.append("g").attr("class","change-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").merge(a).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",this._textObj.labelShow?"block":"none").style("opacity",0).transition().duration(e._transition?.1*e._duration:0).delay(e._transition?.9*e._duration:0).style("opacity",1);null!=e._labelShow&&null!=e._positionOptions&&null!=e._positionChoice&&-1!=e._positionOptions.indexOf(e._positionChoice)||n.selectAll(".change-texts text").style("display","none")}return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"updateFormWaterfall",value:function(){var n=this,t=n._data,e=n.group;e.select(".form-rects").remove();var i=e.append("g").attr("class","form-rects").selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var o=i.enter().append("rect").merge(i).style("fill",function(t){return 0<t.value?n._fillColor||t.color:n._fillColor||t.color_special}).style("fill-opacity",function(t){return n._fillOpacity}).style("rx",n._barCornerRadius).style("ry",n._barCornerRadius).style("stroke",function(t){return 0<t.value?n._borderColor||t.color:n._borderColor||t.color_special}).style("stroke-width",function(t){return n._borderWidth||0});if(this._rectObj?(o.attr("x",this._rectObj.xFunc),o.attr("y",function(t,e){return 0==e?n._yScale(t.total-t.value):n._yScale(t.total)}),o.attr("width",this._rectObj.widthFunc),o.attr("height",0),o.transition().duration(n._transition?.9*n._duration:0).attr("y",this._rectObj.yFunc).attr("height",this._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){e.select(".form-texts").remove();var a=e.append("g").attr("class","form-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").merge(a).text(this._textObj.textFunc).attr("fill",n._textObj.colorFunc).attr("font-size",n._textObj.fontSize).attr("font-family",n._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",this._textObj.labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?.9*n._duration:0).style("opacity",1);null!=n._labelShow&&null!=n._positionOptions&&null!=n._positionChoice&&-1!=n._positionOptions.indexOf(n._positionChoice)||e.selectAll(".form-texts text").style("display","none")}return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"updateHorizontalBar",value:function(){var n=this,t=n._data,e=n.group;e.select(".horizontal-bar-rects").remove();var i=e.append("g").attr("class","horizontal-bar-rects").selectAll("rect").data(t,function(t){return t.key});i.exit().remove();var o=i.enter().append("rect").merge(i).style("fill",function(t){return n._fillColor||t.color}).style("fill-opacity",function(t){return n._fillOpacity}).style("stroke",function(t){return n._borderColor||n._strokeColor||t.color}).style("stroke-width",function(t){return n._borderWidth||n._strokeWidth||0}).style("fill-opacity",function(t){return n._fillOpacity}).style("rx",n._barCornerRadius).style("ry",n._barCornerRadius);if(this._rectObj?(o.attr("x",n._xScale(0)),o.attr("y",this._rectObj.yFunc),o.attr("width",0),o.attr("height",this._rectObj.heightFunc),o.transition().duration(n._transition?.9*n._duration:0).attr("x",this._rectObj.xFunc).attr("width",this._rectObj.widthFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){e.select(".horizontal-bar-texts").remove();var a=e.append("g").attr("class","horizontal-bar-texts").selectAll("text").data(t,function(t){return t.key});a.exit().remove();a.enter().append("text").attr("class","horizontal-bar-text").merge(i).text(this._textObj.textFunc).attr("fill",n._textObj.colorFunc).attr("font-size",n._textObj.fontSize).attr("font-family",n._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dy",this._textObj.dyFunc).attr("dx",function(t,e){if(null==n._labelShow||0==n._labelShow||null==n._positionOptions||null==n._positionChoice)return 0;if(0==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return.3*n._textObj.fontSize;if(t.value<0)return-E(t.value,n._textObj.fontSize,n._textObj.fontFamily)-.3*n._textObj.fontSize}else if(1==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return-(n._xScale(t.value)-n._xScale(0))+.3*n._textObj.fontSize;if(t.value<0)return n._xScale(0)-n._xScale(t.value)-.3*n._textObj.fontSize-E(t.value,n._textObj.fontSize,n._textObj.fontFamily)}else if(2==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return-(n._xScale(t.value)-n._xScale(0))/2-E(t.value,n._textObj.fontSize,n._textObj.fontFamily)/2;if(t.value<0)return(n._xScale(0)-n._xScale(t.value))/2-E(t.value,n._textObj.fontSize,n._textObj.fontFamily)/2}else if(3==n._positionOptions.indexOf(n._positionChoice)){if(0<t.value||0==t.value)return.3*-n._textObj.fontSize-E(t.value,n._textObj.fontSize,n._textObj.fontFamily);if(t.value<0)return.3*n._textObj.fontSize}}).style("display",this._textObj.labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?.9*n._duration:0).style("opacity",1);null!=n._labelShow&&0!=n._labelShow&&null!=n._positionOptions&&null!=n._positionChoice||e.selectAll(".horizontal-bar-texts text").style("display","none")}for(var r=e.selectAll(".horizontal-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("visibility","hidden"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("visibility","hidden")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("visibility","visible");return o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),n}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),bn=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t,n,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),i=this.generateColorList(e.length);return n=i,(t=e).forEach(function(e,t){e.color=n[t],e.color_special=n[t+1],e.data.forEach(function(t){t.color=e.color,t.color_special=e.color_special})}),t}}]),n}(),wn="legend-group",Fn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","waterfalllegend"),e.group=e.elem.append("g"),e._data=[],e._shapeType="circle",e._shapeWidth=12,e._shapeHeight=12,e._shapeStroke="none",e._rowGap=6,e._colGap=20,e._innerGap=6,e._fontSize=12,e._fontFamily="sans-serif",e._fontColor="#000",e._limitedWidth=400,e._horizontalAlign="center",e._onClick=function(){},e._each=function(){},e._orient="horizontal",e}return h(n,o),s(n,[{key:"update",value:function(){var a=this,r=a.group,l=Math.max(a._shapeHeight,a._fontSize),s=a._limitedWidth-a._shapeWidth-a._innerGap,u=0,h=0;a.elem.selectAll("."+wn).remove();var c=r.append("g").attr("class",wn);if(0<a._data.length){var t={name:a._data[0].name,data:a._data[0].data,color:a._data[0].color,color_special:a._data[0].color_special,key:a._data[0].key,name1:"收入"},e={name:a._data[0].name,data:a._data[0].data,color:a._data[0].color,color_special:a._data[0].color_special,key:a._data[0].key,name1:"支出"},n=[];n.push(t),n.push(e),n.forEach(function(t,e){var n=I(t.name1,s,a._fontSize,a._fontFamily),i=a._shapeWidth+a._innerGap+E(n,a._fontSize,a._fontFamily);if("vertical"===a._orient)a._legendItem(t,c,0,h,e),h=h+l+a._rowGap;else{var o=u+i+a._colGap;o>a._limitedWidth&&(u=0,o=i+a._colGap,h+=l+a._rowGap,c=r.append("g").attr("class",wn)),a._legendItem(t,c,u,h,e),u=o}});var i=st(r).width;"center"===a._horizontalAlign?r.call(G,a._limitedWidth/2-i/2,0):"left"===a._horizontalAlign?r.call(G,0,0):"right"===a._horizontalAlign&&r.call(G,a._limitedWidth-i,0)}return a}},{key:"_shapeElem",value:function(t){var e=void 0;return(e="rect"===this._shapeType?t.append("rect").attr("width",this._shapeWidth).attr("height",this._shapeHeight):t.append("circle").attr("cx",this._shapeWidth/2).attr("cy",this._shapeHeight/2).attr("r",Math.min(this._shapeWidth,this._shapeHeight)/2)).attr("class","legend-shape"),e}},{key:"_legendItem",value:function(e,t,n,i,o){var a=t.append("g").datum(e).attr("class","legend-item").call(G,n,i).on("click",this._onClick).each(this._each);return this._shapeElem(a).style("fill",function(t){return 0==o?e.color:e.color_special}),a.append("text").attr("x",this._shapeWidth+this._innerGap).attr("y",this._shapeHeight/2).attr("dy","0.35em").style("text-anchor","start").style("font-size",this._fontSize+"px").style("font-family",this._fontFamily).style("fill",this._fontColor).text(I(e.name1,this._limitedWidth-this._shapeWidth-this._innerGap,this._fontSize,this._fontFamily)),a}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"limitedWidth",value:function(t){return arguments.length?(this._limitedWidth=t,this):this._limitedWidth}},{key:"shapeType",value:function(t){return arguments.length?(this._shapeType=t,this):this._shapeType}},{key:"shapeWidth",value:function(t){return arguments.length?(this._shapeWidth=t,this):this._shapeWidth}},{key:"shapeHeight",value:function(t){return arguments.length?(this._shapeHeight=t,this):this._shapeHeight}},{key:"rowGap",value:function(t){return arguments.length?(this._rowGap=t,this):this._rowGap}},{key:"colGap",value:function(t){return arguments.length?(this._colGap=t,this):this._colGap}},{key:"innerGap",value:function(t){return arguments.length?(this._innerGap=t,this):this._innerGap}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"orient",value:function(t){return arguments.length?(this._orient=t,this):this._orient}},{key:"horizontalAlign",value:function(t){return arguments.length?(this._horizontalAlign=t,this):this._horizontalAlign}},{key:"onClick",value:function(t){return arguments.length?(this._onClick=t,this):this._onClick}},{key:"each",value:function(t){return arguments.length?(this._each=t,this):this._each}}]),n}();function On(t,e){var n=0,i=1;if(e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"vCol"===t.function&&(i=t.index)}),W(t,[n,i])||!C(t,i))return[];var o={},a=[],r=t.length,l=t[0][i];""!=l&&null!=l&&null!=l||(l="$-0"),o[l]={name:l,showLegend:"$-0"!=l,data:[]};for(var s=0,u=1;u<r;u++){var h=t[u],c=h[n];if(""!=c&&null!=c&&null!=c||(c="&-"+u),c){var _=l;1==u?s=isNaN(parseFloat(t[1][i]))?0:parseFloat(t[1][i]):s+=isNaN(parseFloat(h[i]))?0:parseFloat(h[i]),o[_].data.push({name:c,showAxisText:c!="&-"+u,value:""==h[i]||isNaN(parseFloat(h[i]))||null==h[i]||null==h[i]?0:h[i],total:s})}}for(var d in o)a.push(o[d]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Cn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","change-waterfall-histogram-chart"),e.grid=new Pt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e.legend=new Fn(e.group),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new kn(e.coreGroup),e.overlay=new zt(e.coreGroup),e._histogramWidth=1,e._yScaleHeight=1.05,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=0,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["上面","内部居下","内部居中"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.defs;t.selectAll("filter").remove();var e=t.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_changeWaterfall").attr("filterUnits","objectBoundingBox");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),e.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),e.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),e.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),e.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var i=r.toString()?r[0].data:[],o=n.grid,l=n.tooltip,a=n.rectPlot,s=n.overlay,u=n.selectOverlay,h=n._barWidthPercent,c=n.xScale,_=n.yScale,d=n.widthOfCore,f=n.heightOfCore,y=Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total})}),0),p=(d3.max(r,function(t){return d3.max(t.data,function(t){return+t.total})}),d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),r.length&&r[0].data[0].value,n.widthOfNoMargin,n.heightOfMainGroup);n.yAxis.width,n.xAxis.height;s.data(c.domain()).isScalePoint(!1).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update(),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+c(i)+",0)"),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),u.show()}).onMouseout(function(){l.hide(),u.hide()}),a.data(i).xScale(c).yScale(_).barCornerRadius(n._barCornerRadius).borderWidth(n._borderWidth).borderColor(n._borderColor).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).rectObj({xFunc:function(t,e){return c.step()*e+c.step()*(1-n._histogramWidth*h)/2},yFunc:function(t){return t.value<0?_(t.total-t.value):_(t.total)},widthFunc:function(){return c.step()*n._histogramWidth*h},heightFunc:function(t){return 0<y||0==y?Math.abs(_.range()[0]-_(Math.abs(t.value))):y<0?Math.abs(_(0)-_(Math.abs(t.value))):void 0}}).textObj({xFunc:function(t,e){return c.step()*e+c.step()*(1-n._histogramWidth*h)/2},yFunc:function(t){return t.value<0?_(t.total-t.value):_(t.total)},dxFunc:function(t,e){return c.step()*n._histogramWidth*h/2},dyFunc:function(t,e){return 0==n._positionOptions.indexOf(n._positionChoice)?.5*-n._textLabel.fontSize:1==n._positionOptions.indexOf(n._positionChoice)?0<y?_.range()[0]-_(Math.abs(t.value))-.5*n._textLabel.fontSize:_(0)-_(Math.abs(t.value))-.5*n._textLabel.fontSize:2==n._positionOptions.indexOf(n._positionChoice)?0<y?(_.range()[0]-_(Math.abs(t.value)))/2+.4*n._textLabel.fontSize:(_(0)-_(Math.abs(t.value)))/2+.4*n._textLabel.fontSize:void 0},colorFunc:function(){return n._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:n._textLabel.fontSize,fontFamily:n._textLabel.fontFamily,labelShow:n._labelShow}).fillOpacity(n._fillOpacity),o.width(d).height(f).xTickLocations(n.xAxis.tickLocations).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),u.width(c.step()).height(f).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)");var v=n.group.selectAll(".change-waterfall-histogram-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(v).remove(),a.updateChangeWaterfall(),u.update(),s.update();var g=n.yAxis.width;o.translate(g,0).update()}},{key:"updateLegend",value:function(){var t=this.legend,e=this.widthOfNoMargin;if(!this._legendShow)return t.hide();t.show(),t.limitedWidth(e).fontSize(this._fontSize).fontFamily(this._fontFamily).fontColor(this._fontColor).horizontalAlign(this._legendX).each(function(t){var e=!1===t.active;d3.select(this).classed("clicked",e).style("opacity",e?.5:1)}),this.configLegend(),t.update()}},{key:"configLegend",value:function(){var t=this.sortedDataCopy;this.legend.data(t).onClick(function(t){})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._barWidthPercent=e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.barCornerRadius?e.barCornerRadius:this._barCornerRadius,this._borderWidth=e.borderWidth?e.borderWidth:this._borderWidth,this._borderColor=e.borderColor?e.borderColor:this._borderColor,this._fillOpacity=e.fillOpacity?e.fillOpacity:this._fillOpacity),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=On;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=t.length?t[0].data.map(function(t){return t.name}):[0,1],i=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)*this._yScaleHeight]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?i[1]:parseFloat(e[1])]}}]),n}();function An(t,e){var n=0,i=1;if(e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"vCol"===t.function&&(i=t.index)}),W(t,[n,i])||!C(t,i))return[];var o={},a=[],r=t.length,l=t[0],s=l[i];o[s]={name:s,data:[]};for(var u=0,h=1;h<r;h++){var c=t[h],_=c[n];if(""!=_&&null!=_&&null!=_||(_="&-"+h),_){var d=l[i];1==h||2==h?u=isNaN(parseFloat(t[1][i]))?0:parseFloat(t[1][i]):u-=isNaN(parseFloat(t[h-1][i]))?0:parseFloat(t[h-1][i]),o[d].data.push({name:_,showAxisText:_!="&-"+h,value:""==c[i]||isNaN(parseFloat(c[i]))||null==c[i]||null==c[i]?0:c[i],total:u})}}for(var f in o)a.push(o[f]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Pn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","form-waterfall-histogram-chart"),e.grid=new Pt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new kn(e.coreGroup),e.overlay=new zt(e.coreGroup),e._histogramWidth=1,e._yScaleHeight=1.05,e._marginTop=20,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=1,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["上面","内部居下","内部居中"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.defs;t.selectAll("filter").remove();var e=t.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_formWaterfall").attr("filterUnits","objectBoundingBox");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),e.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),e.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),e.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),e.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var i=r.toString()?r[0].data:[],o=n.grid,l=n.tooltip,a=n.rectPlot,s=n.overlay,u=n.selectOverlay,h=n._barWidthPercent?n._barWidthPercent:.8,c=n.xScale,_=n.yScale,d=n.widthOfCore,f=n.heightOfCore,y=d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total-t.value})}),p=(n.widthOfNoMargin,n.heightOfMainGroup);n.yAxis.width,n.xAxis.height;y<0?(n.group.selectAll(".form-water-fall-histogram-chart .axis-x path").attr("transform","translate(0, "+-(_.range()[0]-_(0))+")"),n.group.selectAll(".form-water-fall-histogram-chart .axis-x line").attr("transform","translate(0, "+-(_.range()[0]-_(0))+")")):(n.group.selectAll(".form-water-fall-histogram-chart .axis-x path").attr("transform","translate(0,0)"),n.group.selectAll(".form-water-fall-histogram-chart .axis-x line").attr("transform","translate(0,0)")),s.data(c.domain()).isScalePoint(!1).bandWidth(c.step()).bandHeight(f).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update(),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+c(i)+",0)"),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),u.show()}).onMouseout(function(){l.hide(),u.hide()}),a.data(i).xScale(c).yScale(_).barCornerRadius(n._barCornerRadius).borderWidth(n._borderWidth).borderColor(n._borderColor).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).rectObj({xFunc:function(t,e){return c.step()*e+c.step()*(1-n._histogramWidth*h)/2},yFunc:function(t){return _(t.total)},widthFunc:function(){return c.step()*n._histogramWidth*h},heightFunc:function(t){return Math.abs(_(0)-_(t.value))}}).textObj({xFunc:function(t,e){return c.step()*e+c.step()*(1-n._histogramWidth*h)/2},yFunc:function(t){return _(t.total)},dxFunc:function(t,e){return c.step()*n._histogramWidth*h/2},dyFunc:function(t,e){return 0==n._positionOptions.indexOf(n._positionChoice)?.5*-n._textLabel.fontSize:1==n._positionOptions.indexOf(n._positionChoice)?_(0)-_(Math.abs(t.value))-.5*n._textLabel.fontSize:2==n._positionOptions.indexOf(n._positionChoice)?(_(0)-_(Math.abs(t.value)))/2+.4*n._textLabel.fontSize:void 0},colorFunc:function(){return n._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:n._textLabel.fontSize,fontFamily:n._textLabel.fontFamily,labelShow:n._labelShow}).fillOpacity(n._fillOpacity),o.width(d).height(f).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),u.width(c.step()).height(f).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)");var v=n.group.selectAll(".form-waterfall-histogram-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(v).remove(),a.updateFormWaterfall(),u.update(),s.update();var g=n.yAxis.width;o.translate(g,0).update()}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=An;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._barWidthPercent=e.barWidthPercent?e.barWidthPercent:this._barWidthPercent,this._barCornerRadius=e.barCornerRadius?e.barCornerRadius:this._barCornerRadius,this._borderWidth=e.borderWidth?e.borderWidth:this._borderWidth,this._borderColor=e.borderColor?e.borderColor:this._borderColor,this._fillOpacity=e.fillOpacity?e.fillOpacity:this._fillOpacity),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=0<t.length?t[0].data.map(function(t){return t.name}):[0,1],i=0<t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total-t.value})}),0),t[0].data[0].value*this._yScaleHeight]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?i[1]:parseFloat(e[1])]}}]),n}(),zn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","simple-bar-plot"),e._xScale=null,e._yScale=null,e._fill=null,e._stroke="none",e._strokeWidth=0,e._showZeroLine=!0,e._zeroLineStroke="#000",e._fontColor="#000",e._fontSize=13,e._cornerRadius=0,e}return h(n,P),s(n,[{key:"update",value:function(){for(var e=this,t=e._data,n=e._xScale,i=e._yScale.clamp(!0),o=n.bandwidth()*e._barWidthPercent,a=i.domain(),r=a.every(function(t){return 0<=t})?"up":a.every(function(t){return t<=0})?"down":"both",l=i.range()[0],s=e._transition?e._duration:0,u=[],h=0;h<t.length;h++)u.push(t[h].value);var c=ht(u,e._fontSize,e._fontFamily),_=e.group,f=e._defs;f.selectAll("filter").remove();var y=f.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_simplebar").attr("filterUnits","objectBoundingBox");if(y.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),y.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),y.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),y.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),y.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),"up"===r){var p=_.selectAll(".rect").data(t);p.exit().remove(),p.enter().append("path").attr("class","rect").merge(p).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke||d.color).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:i(0),width:o,height:0,cornerRadius:e._cornerRadius})}).call(qe,e).transition().duration(e._transition?e._duration:0).delay(e._transition?e._startDelay:0).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:i(t.value),width:o,height:Math.abs(l-i(t.value)),cornerRadius:e._cornerRadius})});var v=_.selectAll("text").data(t);v.exit().remove();var g=v.enter().append("text").attr("class","simple-bar-texts").merge(v).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("font-family",e._fontFamily).style("display",e._labelShow?"block":"none");g.attr("x",function(t){return n(t.name)+o*(1-e._barWidthPercent)}).attr("y",function(t){return i(t.value)}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(l-i(t.value))-6:void 0}).attr("text-anchor","middle").style("opacity",0).transition().duration(e._transition?.1*e._duration:0).delay(e._transition?e._startDelay+e._duration:0).style("opacity",1),null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?g.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?g.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o)+" "+(i(t.value)+Math.abs(l-i(t.value))-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):g.attr("transform","rotate(0)")}else if("down"===r){var m=_.selectAll(".rect").data(t);m.exit().remove(),m.enter().append("path").attr("class","rect").merge(m).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke||d.color).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:0,width:o,height:0,cornerRadius:e._cornerRadius})}).call(qe,e).transition().duration(e._transition?e._duration:0).delay(e._transition?e._startDelay:0).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:0,width:o,height:i(t.value),cornerRadius:e._cornerRadius})});var x=_.selectAll("text").data(t);x.exit().transition().duration(s).remove();var S=x.enter().append("text").attr("class","simple-bar-texts").merge(x).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("font-family",e._fontFamily).style("display",e._labelShow?"block":"none");S.attr("x",function(t){return n(t.name)+o*(1-e._barWidthPercent)}).attr("y",0).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?i(t.value)-6:void 0}).attr("text-anchor","middle").style("opacity",0).transition().duration(e._transition?.1*e._duration:0).delay(e._transition?e._startDelay+e._duration:0).style("opacity",1),null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?S.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?S.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o||0)+" "+(i(t.value)-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):S.attr("transform","rotate(0)")}else{var k=Math.round(i(0)),b=_.selectAll(".rect").data(t);b.exit().remove(),b.enter().append("path").attr("class","rect").merge(b).style("fill",function(t){return e._fill||t.color}).style("stroke-width",e._strokeWidth).style("stroke",e._stroke||d.color).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:i(0),width:o,height:0,cornerRadius:e._cornerRadius})}).call(qe,e).transition().duration(e._transition?e._duration:0).delay(e._transition?e._startDelay:0).attr("d",function(t){return lt({x:n(t.name)+o*(1-e._barWidthPercent),y:0<=t.value?i(t.value):k,width:o,height:Math.abs(k-i(t.value)),cornerRadius:e._cornerRadius})});var w=_.selectAll("text").data(t);w.exit().transition().duration(s).remove();var F=w.enter().append("text").attr("class","simple-bar-texts").merge(w).text(function(t){return t.value}).attr("fill",e._fontColor).attr("font-size",e._fontSize).style("font-family",e._fontFamily).style("display",e._labelShow?"block":"none");F.attr("x",function(t){return n(t.name)+o*(1-e._barWidthPercent)}).attr("y",function(t){return 0<=t.value?i(t.value):k}).attr("dx",o/2).attr("dy",function(t){return null==e._positionOptions||null==e._positionChoice?0:0==e._positionOptions.indexOf(e._positionChoice)?-6:1==e._positionOptions.indexOf(e._positionChoice)?Math.abs(k-i(t.value))-6:void 0}).attr("text-anchor","middle").style("opacity",0).transition().duration(e._transition?.1*e._duration:0).delay(e._transition?e._startDelay+e._duration:0).style("opacity",1),null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?F.style("display","none"):o<c&&1==e._positionOptions.indexOf(e._positionChoice)?F.attr("transform",function(t){return"rotate(-90 "+(n(t.name)+o||0)+" "+((0<=t.value?i(t.value):k)+Math.abs(k-i(t.value))-.5*e._fontSize-4)+" )"}).attr("text-anchor","start"):F.attr("transform","rotate(0)"),(_.select(".zero-line").empty()?_.append("line").attr("class","zero-line"):_.select(".zero-line")).attr("x1",n.range()[0]).attr("y1",k).attr("x2",n.range()[1]).attr("y2",k).style("stroke",e._showZeroLine?e._zeroLineStroke:"none")}if(null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice))_.selectAll(".simple-bar-texts").style("display","none");else if(o<c&&1==e._positionOptions.indexOf(e._positionChoice)){for(var O=_.selectAll(".simple-bar-texts"),C=[],A=[],P=0;P<O._groups[0].length;P++){A.push(P);for(var z=P+1;z<O._groups[0].length;z++){var D=st(d3.select(O._groups[0][P])),L=st(d3.select(O._groups[0][z])),M=D.width;D.width=D.height,D.height=M;var W=L.width;L.width=L.height,L.height=W,ut(D,L)&&(C.push(P),d3.select(O._groups[0][P]).style("visiblity","hidden"))}}for(var R=new Set(C),N=Array.from(R),T=rt(N,A),j=0;j<N.length;j++){for(var Y=[],X=0;X<T.length;X++){var B=st(d3.select(O._groups[0][N[j]])),G=st(d3.select(O._groups[0][T[X]])),E=B.width;B.width=B.height,B.height=E;var I=G.width;if(G.width=G.height,G.height=I,Y.push(ut(B,G)),ut(B,G)){if(N[j]==T[X])continue;d3.select(O._groups[0][N[j]]).style("visibility","hidden")}}0==Y.filter(function(t){return 1==t}).length&&T.push(N[j])}for(var H=0;H<T.length;H++)d3.select(O._groups[0][T[H]]).style("visibility","visible")}else{for(var V=_.selectAll(".simple-bar-texts"),U=[],q=[],Z=0;Z<V._groups[0].length;Z++){q.push(Z);for(var Q=Z+1;Q<V._groups[0].length;Q++){ut(st(d3.select(V._groups[0][Z])),st(d3.select(V._groups[0][Q])))&&(U.push(Z),d3.select(V._groups[0][Z]).style("visibility","hidden"))}}for(var $=new Set(U),J=Array.from($),K=rt(J,q),tt=0;tt<J.length;tt++){for(var et=[],nt=0;nt<K.length;nt++){var it=st(d3.select(V._groups[0][J[tt]])),ot=st(d3.select(V._groups[0][K[nt]]));if(et.push(ut(it,ot)),ut(it,ot)){if(J[tt]==K[nt])continue;d3.select(V._groups[0][J[tt]]).style("visibility","hidden")}}0==et.filter(function(t){return 1==t}).length&&K.push(J[tt])}for(var at=0;at<K.length;at++)d3.select(V._groups[0][K[at]]).style("visibility","visible")}function rt(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"showZeroLine",value:function(t){return arguments.length?(this._showZeroLine=t,this):this._showZeroLine}},{key:"zeroLineStroke",value:function(t){return arguments.length?(this._zeroLineStroke=t,this):this._zeroLineStroke}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),Dn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","simple-bar-chart"),e.grid=new Pt(e.coreGroup),e.core=new zn(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xTickShow=!0,e._yTickShow=!0,e._barWidthPercent=.5,e._cornerRadius=0,e._stroke="none",e._strokeWidth=0,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="内部居下",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var t=this,e=t.activeData,n=t.grid,i=t.core,o=t.tooltip,a=t.clipArea,r=t.widthOfCore,l=t.heightOfCore;n.width(r).height(l).xTickLocations(t.xAxis.tickLocations.slice(1)).yTickLocations(t.yAxis.tickLocations.slice(1)).showX(t._gridShowX).showY(t._gridShowY).stroke(t._gridStroke).strokeDasharray(t._gridStrokeDasharray),i.data(e).xScale(t.xScale).yScale(t.yScale).zeroLineStroke(t._axisLineStroke).cornerRadius(t._cornerRadius).stroke(t._stroke).barWidthPercent(t._barWidthPercent).strokeWidth(t._strokeWidth).fontSize(t._textLabel.fontSize).fontColor(t._textLabel.color).fontFamily(t._textLabel.fontFamily).labelShow(t._labelShow).positionOptions(t._positionOptions).positionChoice(t._positionChoice).defs(t.defs).transition(t._transition).duration(1e3*t._duration).easeStyle(t._easeStyle).startDelay(1e3*parseFloat(t._startDelay)).moveStyle(t._moveStyle).endPause(t._endPause).textObj({colorFunc:function(){return t._fontColor}}).onMouseover(function(t,e){d3.select(this).style("stroke","#000").style("stroke-width",1);var n=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];o.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){o.hide(),d3.select(this).style("stroke",i.stroke()).style("stroke-width",0)}),t.coreGroup.call(G,t.yAxis.width+.5,0),0!=t._clipShow.length?(a.width(r).height(l).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","url(#"+a.id+")")):(a.width(t._width).height(t._height).paddingVertical([0,0]).transition(t._transition).duration(t._duration),t.coreGroup.attr("clip-path","")),a.update();var s=t.group.selectAll(".simple-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="$-"+e});d3.selectAll(s).remove(),n.update(),i.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange||[]).slice().sort(d3.ascending),n=t.length?t.map(function(t){return t.name}):[0,1],i=void 0;if(t.length){var o=d3.min(t,function(t){return+t.value}),a=1.1*d3.max(t,function(t){return+t.value});i=o<0?a<=0?[o,0]:[o,a]:[0,a]}else i=[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&this.barWidthPercent(l(e.barWidthPercent?e.barWidthPercent:this._barWidthPercent)).cornerRadius(l(e.barCornerRadius?e.barCornerRadius:this._cornerRadius)).stroke(e.borderColor||this._stroke).strokeWidth(l(e.borderWidth?e.borderWidth:this._strokeWidth)),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}}]),n}(),Ln=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","progress-pie"),e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._innerRadius=0,e._outerRadius=0,e._startAngle=0,e._endAngle=2*Math.PI,e._cornerRadius=0,e._padRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._innerRadiusRatio=.75,e._sortMethod=null,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this;i._data;i.group.selectAll(".middleNumber").text("0%"),i.arcFunc.innerRadius(i._innerRadius).outerRadius(i._outerRadius).cornerRadius(i._cornerRadius).padAngle(i._padAngle).padRadius(i._padRadius),i.pieFunc.value(function(t){return Math.abs(t.value)}).startAngle(i._startAngle).endAngle(i._endAngle).sort(i._sortMethod);var t=i.pieFunc(i._data);i.group.selectAll(".pie-path").remove();var e=i.group.selectAll("path").data(t);if(e.exit().remove(),e.merge(e.enter().append("path")).attr("class","pie-path").style("stroke",i._areaBorderColor).style("stroke-width",i._areaBorderWidth).style("fill",function(t){return t.data.color}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout).transition().duration(i._transition?i._duration:0).ease(d3.easeLinear).delay(i._transition?i._startDelay:0).attrTween("d",function(e){var n=d3.interpolate(e.startAngle,e.endAngle);return function(t){return e.endAngle=n(t),i.arcFunc(e)}}).on("start",i._onTransitionStart).on("end",i._onTransitionEnd),i.group.selectAll(".pie-texts").remove(),i.group.selectAll(".pie-percents").remove(),i.group.selectAll(".pie-numbers").remove(),0==i._labelShow||null==i._labelShow||null==i._positionOptions||null==i._positionChoice||null==i._contentOption||null==i._contentChoice||0==i._positionOptions.indexOf(i._positionChoice)||2==i._positionOptions.indexOf(i._positionChoice)||-1==i._positionOptions.indexOf(i._positionChoice)||0==i._contentChoice.length)i.group.selectAll(".pie-texts text").style("display","none"),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none");else if(1==i._positionOptions.indexOf(i._positionChoice)){var n=i.group.append("g").selectAll("g").data(t);n.exit().remove(),n.enter().append("g").attr("class","pie-text-groups").merge(n).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-1.3*i._fontSize}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("text-anchor","middle").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+1.3*i._fontSize})}),1==i._contentChoice.length?0==i._contentOption.indexOf(i._contentChoice[0])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none")):1==i._contentOption.indexOf(i._contentChoice[0])?(i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),i.group.selectAll(".pie-texts text").style("display","none"),i.group.selectAll(".pie-numbers text").style("display","none")):2==i._contentOption.indexOf(i._contentChoice[0])&&(i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]}),i.group.selectAll(".pie-percents text").style("display","none"),i.group.selectAll(".pie-texts text").style("display","none")):2==i._contentChoice.length&&(0==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1])||1==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","none")):0==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&0==i._contentOption.indexOf(i._contentChoice[1])?(i.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-percents text").style("display","none")):(1==i._contentOption.indexOf(i._contentChoice[0])&&2==i._contentOption.indexOf(i._contentChoice[1])||2==i._contentOption.indexOf(i._contentChoice[0])&&1==i._contentOption.indexOf(i._contentChoice[1]))&&(i.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]-i._fontSize/1.7}),i.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return g(t)[0]}).attr("y",function(t){return g(t)[1]+i._fontSize/1.7}),i.group.selectAll(".pie-texts text").style("display","none")))}for(var o=i.group.selectAll(".pie-text-groups"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){ut(st(d3.select(o._groups[0][l])),st(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("opacity","0"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(o._groups[0][h[_]])),p=st(d3.select(o._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("opacity","0")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(o._groups[0][c[v]]).style("opacity","1");function g(t){var e=.7*i._outerRadius,n=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(n)*e,Math.sin(n)*e]}return i}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"outerRadius",value:function(t){return arguments.length?(this._outerRadius=t,this):this._outerRadius}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Mn=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,Ln),s(e,[{key:"update",value:function(){var t=this,e=(t._data,t.arcFunc.innerRadius(t._innerRadius).outerRadius(t._outerRadius).cornerRadius(t._cornerRadius).startAngle(t._startAngle).endAngle(t._endAngle));t.pieFunc.value(function(t){return+t.value}).startAngle(t._startAngle).endAngle(t._endAngle).sort(t._sortMethod);var n=t.pieFunc(t._data),i=t.group.selectAll("path").data(n,function(t){return t.data.key});i.exit().remove();i.merge(i.enter().append("path")).attr("d",e).style("stroke",t._stroke).style("stroke-width",t._strokeWidth).style("fill",function(t){return t.data.color_special});return t}}]),e}();function Wn(t,e){var n=0,i=1;if(e.forEach(function(t){"objCol"===t.function?n=t.index:"vCol"===t.function&&(i=t.index)}),W(t,[n,i])||!C(t,i))return[];var o=[],a=t[0][n],r=t[0][i],l=t.slice(1,2),s=parseFloat(l[0][i]);return s=10<s||10==s?(s/Math.pow(10,String(parseInt(s)).length)).toFixed(3):s<10&&1<s?(s/Math.pow(10,String(parseInt(s)).length+1)).toFixed(3):s.toFixed(3),isNaN(s)||o.push({name:l[0][n],value:+s,nameLabel:a,valueLabel:r}),o.forEach(function(t,e){t.key=M(t.name)+"-"+e}),o}var Rn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","Progress-Round-pie-chart"),e.pieBg=new Mn(e.mainGroup),e.core=e.pie=new Ln(e.mainGroup),e._innerRadius=0,e._padAngle=0,e._startAngle=0,e._endAngle=2*Math.PI,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._numberShow=!0,e._nFontSize=35,e._nFontFamily="noto",e._nColor="0",e._textShow=!0,e._tFontSize=25,e._tFontFamily="noto",e._tColor="1",e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var o=this,t=o.pieBg,a=o.pie,e=o.widthOfNoMargin,n=.88*e,i=.88*o.heightOfMainGroup,r=o._startAngle,l=o._endAngle,s=L(n,i,r,l),u=s.radius,h=o._innerRadius||(o._innerRadiusRatio?o._innerRadiusRatio*u:.75*u),c=s.cx+(e-n)/2,_=s.cy+.06*o.heightOfMainGroup;t.data(o.activeData).innerRadius(h).outerRadius(u).cornerRadius(o._cornerRadius).startAngle(r).endAngle(l),o.pieBg.translate(c,_).update(),a.data(o.activeData).innerRadius(h).outerRadius(u).cornerRadius(o._cornerRadius).startAngle(r).endAngle(l*(0<o.activeData.length?o.activeData[0].value:0)).areaBorderColor(o._areaBorderColor).areaBorderWidth(o._areaBorderWidth).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause).onTransitionStart(function(i,t){var e=d3.select(this.parentNode);if(e.selectAll("text").remove(),1==a.data().length){e.append("text").attr("class","middleNumber").attr("dy","-4").style("text-anchor","middle").text((-1==String(100*i.data.value).indexOf(".")?100*i.data.value:(100*i.data.value).toFixed(1))+"% ").style("pointer-events","none").style("fill",isNaN(parseFloat(o._nColor))?o._nColor:o._colorList[o._nColor]).attr("font-size",o._nFontSize).attr("font-family",o._nFontFamily).transition().duration(o._transition?1e3*o._duration:0).tween("d",function(){var e=this,t=-1==String(100*i.data.value).indexOf(".")?100*i.data.value:(100*i.data.value).toFixed(1),n=d3.interpolateNumber(0,t);return function(t){d3.select(e).text((-1==String(n(t)).indexOf(".")?n(t):n(t).toFixed(1))+"%")}});var n=e.append("text").attr("class","middleText").attr("dy",o._tFontSize+4).style("text-anchor","middle").text(i.data.name+" ").style("pointer-events","none").style("fill",isNaN(parseFloat(o._tColor))?o._tColor:o._colorList[o._tColor]).attr("font-size",o._tFontSize).attr("font-family",o._tFontFamily);1==o._textShow&&0==o._numberShow?n.attr("dy","0.5em"):0==o._textShow&&1==o._numberShow&&o.group.selectAll(".middleNumber").attr("dy","0.5em"),1==o._textShow&&0<o.activeData.length?o.group.selectAll(".middleText").style("display","block"):o.group.selectAll(".middleText").style("display","none"),null!=o._textShow&&0!=o._textShow&&null!=o._tFontSize&&null!=o._tColor&&null!=o._tFontFamily&&0!=o.activeData.length||o.group.selectAll(".middleText").style("display","none"),1==o._numberShow&&0<o.activeData.length?o.group.selectAll(".middleNumber").style("display","block"):o.group.selectAll(".middleNumber").style("display","none"),null!=o._numberShow&&0!=o._numberShow&&null!=o._nFontSize&&null!=o._nColor&&null!=o._nFontFamily&&0!=o.activeData.length||o.group.selectAll(".middleNumber").style("display","none")}}).onMouseover(function(i,t){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(u,1.05*u);return function(t){var e=n(t);return a.arcFunc.outerRadius(e),a.arcFunc(i)}});var e=[{text:i.data.name+": "+100*i.data.value+"%",color:i.data.color}];o.tooltip.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){o.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(i){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(1.05*u,u);return function(t){var e=n(t);return a.arcFunc.outerRadius(e),a.arcFunc(i)}}),o.tooltip.hide()}),0==o.activeData.length&&(o.group.selectAll(".middleText").style("display","none"),o.group.selectAll(".middleNumber").style("display","none")),o.pie.translate(c,_).update()}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Wn;switch(n.dataType){case"cross-table":i=_;break;default:i=Wn}return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._innerRadiusRatio=e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio,this._cornerRadius=e.cornerRadius?e.cornerRadius:this._cornerRadius,this._areaBorderWidth=e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth,this._areaBorderColor=e.areaBorderColor?e.areaBorderColor:this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(null!=n.numberLabel&&(this._numberShow=n.numberLabel?n.numberLabel.show:this._numberShow,this._nFontSize=n.numberLabel.fontSize?n.numberLabel.fontSize:this._nFontSize,this._nFontFamily=n.numberLabel.fontFamily?n.numberLabel.fontFamily:this._nFontFamily,this._nColor=n.numberLabel.color||0==n.numberLabel.color?n.numberLabel.color:this._nColor),null!=n.textLabel&&(this._textShow=n.textLabel?n.textLabel.show:this._textShow,this._tFontSize=n.textLabel.fontSize?n.textLabel.fontSize:this._tFontSize,this._tFontFamily=n.textLabel.fontFamily?n.textLabel.fontFamily:this._tFontFamily,this._tColor=n.textLabel.color||0==n.textLabel.color?n.textLabel.color:this._tColor))}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),n}(),Nn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","Half-Progress-pie-chart"),e.pieBg=new Mn(e.mainGroup),e.core=e.pie=new Ln(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI,e._padAngle=0,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._numberShow=!0,e._nFontSize=35,e._nFontFamily="noto",e._nColor="0",e._textShow=!0,e._tFontSize=25,e._tFontFamily="noto",e._tColor="1",e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var n=this,t=n.pieBg,o=n.pie,e=n.widthOfNoMargin,i=.88*e,a=n.heightOfMainGroup,r=n._startAngle,l=n._endAngle,s=function(t,e,n,i){var o=Math.min(t,e),a=o/2,r=e/2+a/2;o==e&&(r=1.1*(a=.88*e),t/2<a&&(r=e/2+(a=t/2)/2));return{radius:a,cx:t/2,cy:r,quadrant:0}}(i,a),u=s.radius,h=n._innerRadius||(n._innerRadiusRatio?n._innerRadiusRatio*u:.75*u),c=s.cx+(e-i)/2,_=s.cy;t.data(n.activeData).innerRadius(h).outerRadius(u).cornerRadius(n._cornerRadius).startAngle(r).endAngle(l/2),o.data(n.activeData).innerRadius(h).outerRadius(u).cornerRadius(n._cornerRadius).startAngle(r).endAngle(r+l*(0<n.activeData.length?n.activeData[0].value:0)).areaBorderColor(n._areaBorderColor).areaBorderWidth(n._areaBorderWidth).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).onTransitionStart(function(i,t){var e=d3.select(this.parentNode);if(e.selectAll("text").remove(),1==o.data().length){e.append("text").attr("class","middleNumber").attr("dy","-"+(parseFloat(n._tFontSize)+10)).style("text-anchor","middle").text("0%").style("pointer-events","none").style("fill",isNaN(parseFloat(n._nColor))?n._nColor:n._colorList[n._nColor]).attr("font-size",n._nFontSize).attr("font-family",n._nFontFamily).transition().duration(n._transition?1e3*n._duration:0).tween("d",function(){var e=this,t=-1==String(100*i.data.value).indexOf(".")?100*i.data.value:(100*i.data.value).toFixed(1),n=d3.interpolateNumber(0,t);return function(t){d3.select(e).text((-1==String(n(t)).indexOf(".")?n(t):n(t).toFixed(1))+"%")}}),e.append("text").attr("class","middleText").attr("dy","-0.1em").style("text-anchor","middle").text(i.data.name+" ").style("pointer-events","none").style("fill",isNaN(parseFloat(n._tColor))?n._tColor:n._colorList[n._tColor]).attr("font-size",n._tFontSize).attr("font-family",n._tFontFamily);1==n._textShow&&0==n._numberShow||0==n._textShow&&1==n._numberShow&&n.group.selectAll(".middleNumber").attr("dy","-0.1em"),1==n._textShow&&0<n.activeData.length?n.group.selectAll(".middleText").style("display","block"):n.group.selectAll(".middleText").style("display","none"),null!=n._textShow&&0!=n._textShow&&null!=n._tFontSize&&null!=n._tColor&&null!=n._tFontFamily||n.group.selectAll(".middleText").style("display","none"),1==n._numberShow&&0<n.activeData.length?n.group.selectAll(".middleNumber").style("display","block"):n.group.selectAll(".middleNumber").style("display","none"),null!=n._numberShow&&0!=n._numberShow&&null!=n._nFontSize&&null!=n._nColor&&null!=n._nFontFamily||n.group.selectAll(".middleNumber").style("display","none")}}).onMouseover(function(i,t){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(u,1.05*u);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}});var e=[{text:i.data.name+": "+100*i.data.value+"%",color:i.data.color}];n.tooltip.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){n.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(i){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(1.05*u,u);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}}),n.tooltip.hide()}),0==n.activeData.length&&(n.group.selectAll(".middleText").style("display","none"),n.group.selectAll(".middleNumber").style("display","none")),n.pie.translate(c,_).update(),n.pieBg.translate(c,_).update()}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Wn;switch(n.dataType){case"cross-table":i=_;break;default:i=Wn}return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._innerRadiusRatio=e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio,this._cornerRadius=e.cornerRadius?e.cornerRadius:this._cornerRadius,this._areaBorderWidth=e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth,this._areaBorderColor=e.areaBorderColor?e.areaBorderColor:this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(null!=n.numberLabel&&(this._numberShow=n.numberLabel?n.numberLabel.show:this._numberShow,this._nFontSize=n.numberLabel.fontSize?n.numberLabel.fontSize:this._nFontSize,this._nFontFamily=n.numberLabel.fontFamily?n.numberLabel.fontFamily:this._nFontFamily,this._nColor=n.numberLabel.color||0==n.numberLabel.color?n.numberLabel.color:this._nColor),null!=n.textLabel&&(this._textShow=n.textLabel?n.textLabel.show:_textShow,this._tFontSize=n.textLabel.fontSize?n.textLabel.fontSize:_tFontSize,this._tFontFamily=n.textLabel.fontFamily?n.textLabel.fontFamily:_tFontFamily,this._tColor=n.textLabel.color||0==n.textLabel.color?n.textLabel.color:this._tColor))}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),n}(),Tn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","half-pie-chart"),e.core=e.pie=new z(e.mainGroup),e.lineText=new T(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e._padAngle=0,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=0,e._areaBorderWidth=0,e._areaBorderColor=null,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var r=this,o=r.pie,t=r.defs;t.selectAll("filter").remove();var e=t.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_halfPie").attr("filterUnits","objectBoundingBox");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),e.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),e.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),e.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),e.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");for(var n=r.lineText,i=r.widthOfNoMargin,a=[],l=0;l<r.activeData.length;l++)a.push(r.activeData[l].name);var s=.74*i-ht(a,r._fontSize,r._fontFamily);null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice?s=.88*i:0!=r._labelShow&&1!=r._positionOptions.indexOf(r._positionChoice)&&-1!=r._positionOptions.indexOf(r._positionChoice)||(s=.88*i);var u=r.heightOfMainGroup,h=r._startAngle,c=r._endAngle,_=function(t,e,n,i){var o=Math.min(t,e),a=o/2,r=e/2+a/2;o==e&&(r=1.1*(a=.88*e),t/2<a&&(r=e/2+(a=t/2)/2));return{radius:a,cx:t/2,cy:r,quadrant:0}}(s,u),d=_.radius,f=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*d:.75*d);for(var y=[],p=0;p<r.activeData.length;p++)y.push(r.activeData[p].value);for(var v=0,g=0;g<r.activeData.length;g++)v+=r.activeData[g].value;for(var m=0;m<r.activeData.length;m++)r.activeData[m].percent=(r.activeData[m].value/v*100).toFixed(1);o.data(r.activeData).innerRadius(f).outerRadius(d).cornerRadius(r._cornerRadius).startAngle(h).endAngle(c).areaBorderColor(r._areaBorderColor).areaBorderWidth(r._areaBorderWidth).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onTransitionStart(function(t,e){var n=d3.select(this.parentNode),i="arc-path-"+t.data.key.replace(/\s*/g,"").replace(/\./g,"")+"-"+r.id;r.defs.select("#"+i).remove();var o=D((f+d)*r._labelRadiusRatio,t.startAngle+.025,t.endAngle-.025),a=r.defs.select("#"+i).empty()?r.defs.append("path").attr("d",o).attr("id",i):r.defs.select("#"+i).attr("d",o);null==r._labelShow||null==r._positionOptions||null==r._positionChoice||null==r._contentOption||null==r._contentChoice?r.group.selectAll(".chart-label-text").style("display","none"):0==r._labelShow?r.group.selectAll(".chart-label-text").style("display","none"):1==r._positionOptions.indexOf(r._positionChoice)&&(1==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,t.data.name=="$-"+e?"":t.data.name,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):1==r._contentOption.indexOf(r._contentChoice[0])?N(n,a,t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):2==r._contentOption.indexOf(r._contentChoice[0])&&N(n,a,t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("dx",0):2==r._contentChoice.length?0==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1])||1==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%",r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&0==r._contentOption.indexOf(r._contentChoice[1])?N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==r._contentOption.indexOf(r._contentChoice[0])&&2==r._contentOption.indexOf(r._contentChoice[1])||2==r._contentOption.indexOf(r._contentChoice[0])&&1==r._contentOption.indexOf(r._contentChoice[1]))&&N(n,a,t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==r._contentChoice.length&&N(n,a,(t.data.name=="$-"+e?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,r._textLabel.fontSize,r._textLabel.fontFamily).attr("class",r.labelTextClass).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve")),r.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(r._transition?1e3*r._duration*.1:0).delay(function(t,e){return r._duration?1e3*r._duration*.9:0}).style("opacity",1)}).onMouseover(function(i,t){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(d,1.05*d);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}});var e=[{text:""+(i.data.name=="$-"+t?"":i.data.name),color:i.data.color},{text:i.data.valueLabel+": "+i.data.value}];r.tooltip.data(e).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(i){d3.select(this).transition().duration(30).attrTween("d",function(){var n=d3.interpolateNumber(1.05*d,d);return function(t){var e=n(t);return o.arcFunc.outerRadius(e),o.arcFunc(i)}}),r.tooltip.hide()});var x=_.cx+(i-s)/2,S=_.cy;null!=r._labelShow&&(0!=r._labelShow&&0==r._positionOptions.indexOf(r._positionChoice)?(n.data(r.activeData).innerRadius(f).outerRadius(d).cornerRadius(r._cornerRadius).startAngle(h).endAngle(c).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).contentOption(r._contentOption).contentChoice(r._contentChoice).values(y).areaType("half").transition(!0).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause),r.group.select(".outside-text-polygon").attr("display","block")):r.group.select(".outside-text-polygon").attr("display","none")),r.lineText.translate(x||0,S).update(),r.pie.translate(x||0,S).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(e.innerRadiusRatio).cornerRadius(e.cornerRadius).areaBorderWidth(e.areaBorderWidth).areaBorderColor(e.areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}},{key:"innerRadiusRatio",value:function(t){return arguments.length?(this._innerRadiusRatio=t,this):this._innerRadiusRatio}},{key:"areaBorderWidth",value:function(t){return arguments.length?(this._areaBorderWidth=t,this):this._areaBorderWidth}},{key:"areaBorderColor",value:function(t){return arguments.length?(this._areaBorderColor=t,this):this._areaBorderColor}}]),n}(),jn=function(t){function a(t){r(this,a);var e=c(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t));return e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.xAxis=null,e.yAxis=null,e.yAxisDoubleY=null,e.xScale=null,e.yScale=null,e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._xDomain=null,e._yDomain=null,e._xTitle="",e._yTitle="",e._axisLineStroke=null,e._xTickShow=!0,e._yTickShow=!0,e._marginTop=20,e._marginRight=24,e._marginBottom=18,e._marginLeft=24,e._gapPadding=20,e._titlePadding=20,e._unitPadding=15,e._sourcePadding=10,e}return h(a,J),s(a,[{key:"update",value:function(){return this._titlePadding=this._unitWord&&this._unitShow?10:this._titlePadding,this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateAxis(),this.updateCore(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();t.xAxis;var e=t.yAxis,n=t.yAxisDoubleY,i=t.xScale,o=t.yScale,a=(t._xType,t._yType),r=(t._xOrient,t._yOrient),l=t._yOrientRight,s=t._fontSize,u=t.widthOfNoMargin,h=t.heightOfMainGroup;i.domain(t._xDomain),o.domain(t._yDomain),e.scaleFunc(o).allowedMaxTextWidth(.5*u).type(a).orient(r).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(s).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),n.scaleFunc(o).allowedMaxTextWidth(.5*u).type(a).orient(l).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(s).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);var c=(null==t._yTitle[0]?0:e.titleHeight)||(null==t._yTitle[1]?0:n.titleHeight),_=h/(3*s);e.tickCount(_),n.tickCount(_),o.nice().range([h-c,0]);e.width;var d=e.width,f=c;e.translate(d,f).update(),n.translate(d,f).update()}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yDomain||[],n=t.length?t[0].data.map(function(t){return t.name}):[0,1],i=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?i[1]:parseFloat(e[1])]}},{key:"xType",value:function(t){return arguments.length?(this._xType=t,this):this._xType}},{key:"yType",value:function(t){return arguments.length?(this._yType=t,this):this._yType}},{key:"xOrient",value:function(t){return arguments.length?(this._xOrient=t,this):this._xOrient}},{key:"yOrient",value:function(t){return arguments.length?(this._yOrient=t,this):this._yOrient}},{key:"yOrientRight",value:function(t){return arguments.length?(this._yOrientRight=t,this):this._yOrientRight}},{key:"xDomain",value:function(t){return arguments.length?(this._xDomain=t,this):this._xDomain}},{key:"yDomain",value:function(t){return arguments.length?(this._yDomain=t,this):this._yDomain}},{key:"xTitle",value:function(t){return arguments.length?(this._xTitle=t,this):this._xTitle}},{key:"yTitle",value:function(t){return arguments.length?(this._yTitle=t,this):this._yTitle}},{key:"axisLineStroke",value:function(t){return arguments.length?(this._axisLineStroke=t,this):this._axisLineStroke}},{key:"axisLabelShowLeft",value:function(t){return arguments.length?(this._axisLabelShowLeft=t,this):this._axisLabelShowLeft}},{key:"axisLabelShowRight",value:function(t){return arguments.length?(this._axisLabelShowRight=t,this):this._axisLabelShowRight}},{key:"xTickShow",value:function(t){return arguments.length?(this._xTickShow=t,this):this._xTickShow}},{key:"yTickShow",value:function(t){return arguments.length?(this._yTickShow=t,this):this._yTickShow}},{key:"setPublicOption",value:function(t){u(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"setPublicOption",this).call(this,t);var e=t.axis,n=e.x||{},i=e.y||{},o=e.y1||{};this.axisLineStroke(e.color).xTitle(n.name).axisLabelShowLeft(i.labelShow).axisLabelShowRight(o.labelShow).xDomain(n.range).yDomain(i.range)}},{key:"widthOfCore",get:function(){var t=this.yAxis?this.yAxis.width:0,e=this.widthOfNoMargin-t;return 0<e?e:0}},{key:"heightOfCore",get:function(){var t=this.xAxis?this.xAxis.height:0,e=this.yAxis||this.yAxisDoubleY?this.yAxis.titleHeight||this.yAxisDoubleY.titleHeight:0,n=this.heightOfMainGroup-t-e;return 0<n?n:0}}]),a}(),Yn="axis-group",Xn="y-slope-title",Bn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-slope"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e}return h(n,ft),s(n,[{key:"update",value:function(){var t=this,e=t._orient,n=t._scaleFunc,i=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(n):d3.axisLeft(n);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=i.select("."+Yn).empty()?i.append("g").attr("class",Yn):i.select("."+Yn);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return a[e]}),s.selectAll(".tick line").style("stroke",t._lineStroke),s.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none")});var u=Math.abs(n.range()[0]-n.range()[1]);if(t._title="left"==e?t._title[0]:"right"==e?t._title[1]:t._title,t._titleShow&&t._title){var h=i.select("."+Xn).empty()?i.append("g").attr("class",Xn):i.select("."+Xn),c=h.select("text").empty()?h.append("text"):h.select("text"),_=E(t._title,o,t._fontFamily);c.attr("x",_>=2*t.width?-_/2:0).attr("y",u+this._fontSize+4).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).style("text-anchor",_>=2*t.width?"start":"middle").text(t._title)}else i.select("."+Xn).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)});return s<=l?(n=t,i=s):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,console.log(e),e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),t}}]),n}(),Gn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","slope"),e._xScale=null,e._yScale=null,e._sWidth=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e.group;e.group.style("opacity",0).transition().duration(0).delay(e._transition?.3*e._duration:0).style("opacity",1),n.selectAll(".slope-lines").remove();var i=n.selectAll("line").data(t);i.exit().remove(),i.enter().append("line").attr("class","slope-lines").merge(i).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._lineWidth).style("stroke-dasharray",e._strokeDasharry).style("display","block").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).attr("x1",e._textLength).attr("y1",function(t){return t.data.length&&1==t.data[0].index?e._yScale(t.data[0].value):0}).attr("x2",e._sWidth).attr("y2",function(t){return 1<t.data.length?e._yScale(t.data[1].value):1==t.data.length&&2==t.data[0].index?e._yScale(t.data[0].value):0}).transition().duration(e._transition?.7*e._duration:0).delay(e._transition?.3*e._duration:0).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}});for(var o=n.selectAll(".slope-lines").nodes(),a=0;a<o.length;a++)0==o[a].__data__.data.length?d3.select(o[a]).style("display","none"):1==o[a].__data__.data.length?o[a].__data__.data[0].tooltipValueShow||d3.select(o[a]).style("display","none"):2==o[a].__data__.data.length&&(o[a].__data__.data[0].tooltipValueShow&&o[a].__data__.data[1].tooltipValueShow||d3.select(o[a]).style("display","none"));return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),En=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","slope-scatter-plot"),e._xScale=null,e._yScale=null,e._sWidth=null,e._circleRadius=2,e._circleBorderWidth=1,e._circleBorderColor="#000",e._fill=null,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,t=o.group,a=o._data,r=(o._xScale,o._yScale);t.selectAll(".slope-circles").remove(),t.selectAll(".slopeTexts text").remove(),t.selectAll(".slopeNumbers text").remove();var e=t.selectAll("g").data(a);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var n=d3.select(this).selectAll("circle").data(t.data);n.exit().remove(),n.enter().append("circle").attr("class","slope-circles").merge(n).style("fill",o._fill||t.color).style("stroke",o._circleBorderColor||t.color).style("stroke-width",o._circleBorderWidth).attr("r",o._circleRadius).attr("cx",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("cy",function(t){return r(t.value)||0})});var n=t.append("g").selectAll("g").data(a);n.exit().remove(),n.enter().append("g").attr("class","slope-text-groups").merge(n).each(function(t,e){var n=d3.select(this).append("g").attr("class","slopeNumbers").selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").merge(n).text(function(t){return t.value}).style("text-anchor",function(t){return 1==t.index?"end":2==t.index?"start":void 0}).attr("fill",o._fontColor).attr("font-size",o._fontSize).style("font-family",o._fontFamily).style("display","block").attr("x",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("y",function(t){return r(t.value)||0}).attr("dx",function(t){return 1==t.index?"-0.5em":2==t.index?E(a[e].name,o._fontSize,o._fontFamily)+o._fontSize:void 0}).attr("dy","0.3em");var i=d3.select(this).append("g").attr("class","slopeTexts").selectAll("text").data(t.data);i.exit().remove(),i.enter().append("text").merge(i).text(a[e].name).style("text-anchor",function(t){return 1==t.index?"end":2==t.index?"start":void 0}).attr("fill",o._fontColor).attr("font-size",o._fontSize).style("font-family",o._fontFamily).style("display","block").attr("x",function(t){return 1==t.index?o._textLength:2==t.index?o._sWidth:void 0}).attr("y",function(t){return r(t.value)||0}).attr("dx",function(t){return 1==t.index?-(E(a[e].data[0].value,o._fontSize,o._fontFamily)+o._fontSize):2==t.index?"0.5em":void 0}).attr("dy","0.3em")});var i=t.selectAll(".slopeTexts text").nodes().filter(function(t,e,n){return e%2==0}),l=t.selectAll(".slopeTexts text").nodes().filter(function(t,e){return e%2!=0}),s=t.selectAll(".slopeNumbers text").nodes().filter(function(t,e,n){return e%2==0}),u=t.selectAll(".slopeNumbers text").nodes().filter(function(t,e){return e%2!=0});null!=o._axisLabelShowLeft&&null!=o._axisLabelShowRight||(d3.selectAll(s).attr("fill","none"),d3.selectAll(u).attr("fill","none")),null==o._labelShow||null==o._positionOptions||null==o._positionChoice?(d3.selectAll(i).attr("fill","none"),d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),d3.selectAll(s).attr("dx","-0.5em")):0==o._labelShow?(d3.selectAll(i).attr("fill","none"),d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),d3.selectAll(s).attr("dx","-0.5em")):0==o._positionOptions.indexOf(o._positionChoice)?(d3.selectAll(l).attr("fill","none"),d3.selectAll(u).attr("dx","0.5em"),(0==o._axisLabelShowLeft&&1==o._axisLabelShowRight||0==o._axisLabelShowLeft&&0==o._axisLabelShowRight)&&d3.selectAll(i).attr("dx","-0.5em")):1==o._positionOptions.indexOf(o._positionChoice)?(d3.selectAll(i).attr("fill","none"),d3.selectAll(s).attr("dx","-0.5em")):2==o._positionOptions.indexOf(o._positionChoice)&&(0==o._axisLabelShowLeft&&1==o._axisLabelShowRight||0==o._axisLabelShowLeft&&0==o._axisLabelShowRight)&&d3.selectAll(i).attr("dx","-0.5em"),0==o._axisLabelShowLeft&&d3.selectAll(s).attr("fill","none"),0==o._axisLabelShowRight&&d3.selectAll(u).attr("fill","none");var h=t.selectAll(".slope-circles").nodes(),c=t.selectAll(".slopeTexts text").nodes(),y=t.selectAll(".slopeNumbers text").nodes(),_=c.concat(y);d3.selectAll(_);!function(t){for(var e=t,n=[],i=[],o=0;o<e._groups[0].length;o++){i.push(o);for(var a=o+1;a<e._groups[0].length;a++)ut(st(d3.select(e._groups[0][o])),st(d3.select(e._groups[0][a])))&&(n.push(o),d3.select(e._groups[0][o]).style("opacity","0"),d3.select(y[o]).style("opacity","0"))}for(var r=new Set(n),l=Array.from(r),s=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(l,i),u=0;u<l.length;u++){for(var h=[],c=0;c<s.length;c++){var _=st(d3.select(e._groups[0][l[u]])),d=st(d3.select(e._groups[0][s[c]]));if(h.push(ut(_,d)),ut(_,d)){if(l[u]==s[c])continue;d3.select(e._groups[0][l[u]]).style("opacity","0"),d3.select(y[l[u]]).style("opacity","0")}}0==h.filter(function(t){return 1==t}).length&&s.push(l[u])}for(var f=0;f<s.length;f++)d3.select(e._groups[0][s[f]]).style("opacity","1"),d3.select(y[s[f]]).style("opacity","1")}(d3.selectAll(c));for(var d=0;d<h.length;d++)h[d].__data__.tooltipValueShow||d3.select(h[d]).style("opacity","0");for(var f=0;f<c.length;f++)c[f].__data__.tooltipValueShow||d3.select(c[f]).style("opacity","0");for(var p=0;p<y.length;p++)y[p].__data__.tooltipValueShow||d3.select(y[p]).style("opacity","0");return o}},{key:"circleRadius",value:function(t){return arguments.length?(this._circleRadius=t,this):this._circleRadius}},{key:"circleBorderWidth",value:function(t){return arguments.length?(this._circleBorderWidth=t,this):this._circleBorderWidth}},{key:"circleBorderColor",value:function(t){return arguments.length?(this._circleBorderColor=t,this):this._circleBorderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"axisLabelShowLeft",value:function(t){return arguments.length?(this._axisLabelShowLeft=t,this):this._axisLabelShowLeft}},{key:"axisLabelShowRight",value:function(t){return arguments.length?(this._axisLabelShowRight=t,this):this._axisLabelShowRight}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"numberLength",value:function(t){return arguments.length?(this._numberLength=t,this):this._numberLength}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}}]),n}(),In=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","slopeOverlay-polygon"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e.group,i=n.selectAll("polygon").data(t);i.exit().remove(),i.enter().append("polygon").attr("class","slope-polygons").merge(i).style("fill",e._shadowColor).style("fill-opacity",.85).style("opacity",0).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().duration(e._transition?e._duration:0).attr("points",function(t){return e._textLength+","+((0<t.data.length?e._yScale(t.data[0].value):0)+.012*e._sHeight)+"\n        "+e._sWidth+","+((1<t.data.length?e._yScale(t.data[1].value):0)+.012*e._sHeight)+" \n        "+e._sWidth+","+((1<t.data.length?e._yScale(t.data[1].value):0)-.012*e._sHeight)+" \n        "+e._textLength+","+((0<t.data.length?e._yScale(t.data[0].value):0)-.012*e._sHeight)});for(var o=n.selectAll(".slope-polygons").nodes(),a=0;a<o.length;a++)0==o[a].__data__.data.length?d3.select(o[a]).style("display","none"):1==o[a].__data__.data.length?o[a].__data__.data[0].tooltipValueShow||d3.select(o[a]).style("display","none"):2==o[a].__data__.data.length&&(o[a].__data__.data[0].tooltipValueShow&&o[a].__data__.data[1].tooltipValueShow||d3.select(o[a]).style("display","none"));return e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),n}();function Hn(t,e){var n=0,i=!1;if(e.forEach(function(t){"objCol"===t.function&&(n=t.index,i=t.isLegend)}),W(t,[n],2))return[];var o=R(t,e),a={},r=[],l=o.length,s=o[0];if(i)for(var u=1;u<l;u++){var h=o[u],c=h[n];if(c){for(var _={name:c,index:u-1,data:[]},d=0;d<3;d++){var f=s[d];d!==n&&_.data.push({name:f,value:""==h[d]||isNaN(parseFloat(h[d]))||null==h[d]||null==h[d]?0:h[d],tooltipValueShow:!isNaN(parseFloat(h[d])),index:d})}r.push(_)}}else{s.forEach(function(t,e){e!==n&&t&&(a[t]={name:t,index:e-1,data:[]})});for(var y=1;y<l;y++){var p=o[y],v=p[n];if(v)for(var g=0;g<p.length+1;g++){var m=s[g];g!==n&&m&&a[m].data.push({name:v,index:y,value:""==p[g]||null==p[g]||null==p[g]?0:p[g],tooltipValueShow:!isNaN(parseFloat(p[g]))})}}for(var x in a)r.push(a[x])}return r.forEach(function(t,e){t.key=M(t.name)+"-"+e}),r}var Vn=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","slope-chart"),e.yAxis=new Bn(e.mainGroup),e.yAxisDoubleY=new Bn(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.slopeOverlay=new In(e.coreGroup),e.slope=new Gn(e.coreGroup),e.scatterPlot=new En(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._curve=d3.curveCardinal,e._showPoints=!0,e._marginRight=0,e._marginLeft=20,e._circleRadius=3.5,e._lineWidth=2,e._circleBorderWidth=1,e._circleBorderColor=null,e._shadowColor="#ccc",e._labelShow=!0,e._positionOptions=["左侧","右侧","两侧"],e._positionChoice="两侧",e._axisLabelShowLeft=!0,e._axisLabelShowRight=!0,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(o,jn),s(o,[{key:"updateCore",value:function(){var r=this;r.group.selectAll(".axis-y-slope").style("opacity",0).transition().duration(r._transition?.15*r._duration*1e3:0).style("opacity",1),r.group.selectAll(".slope-scatter-plot").style("opacity",0).transition().duration(r._transition?.15*r._duration*1e3:0).delay(r._transition?.15*r._duration*1e3:0).style("opacity",1);var t=r.activeData,e=r.slopeOverlay,n=r.slope,i=r.scatterPlot,o=(r.tooltip,r.xScale),a=r.yScale,l=(r.widthOfCore,r.heightOfCore);r.widthOfNoMargin;for(var s=function(t){for(var e,n=0;n<t.length;n++)for(var i=n;i<t.length;i++)0<t[n].data.length&&t[n].data[0].value<t[i].data[0].value&&(e=t[i],t[i]=t[n],t[n]=e);return t}(t),u=0;u<s.length;u++)s[u].index=u;for(var h=[],c=0;c<t.length;c++)h.push(t[c].name);for(var _=[],d=0;d<t.length;d++)0<t[d].data.length&&_.push(t[d].data[0].value),1<t[d].data.length&&_.push(t[d].data[1].value);var f=0<t.length&&0<t[0].data.length?ht(h,r._fontSize,r._fontFamily):0,y=0<t.length&&0<t[0].data.length?ht(_,r._fontSize,r._fontFamily):0,p=f+y,v=r.widthOfNoMargin-f-y;null==r._labelShow||0==r._labelShow||null==r._positionOptions||null==r._positionChoice?(r.yAxis.translate(9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y,0),v=r.widthOfNoMargin-y,p=y,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y,0),v=r.widthOfNoMargin-y,p=0):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),v=r.widthOfNoMargin,p=y):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),v=r.widthOfNoMargin,p=0)):0==r._positionOptions.indexOf(r._positionChoice)?(r.yAxis.translate(f+9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y,0),v=r.widthOfNoMargin-y,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y,0),v=r.widthOfNoMargin-y,p=f):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(f+9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),v=r.widthOfNoMargin):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9,0),v=r.widthOfNoMargin,p=f)):1==r._positionOptions.indexOf(r._positionChoice)?(r.yAxis.translate(9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin-f+9-y,0),p=y,0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y-f,0),v=r.widthOfNoMargin-y-f,p=0):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),v=r.widthOfNoMargin-f,p=y):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),v=r.widthOfNoMargin-f,p=0)):2==r._positionOptions.indexOf(r._positionChoice)&&(r.yAxis.translate(f+9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin-f+9-y,0),0==r._axisLabelShowLeft&&1==r._axisLabelShowRight?(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-y-f,0),v=r.widthOfNoMargin-y-f,p=f):1==r._axisLabelShowLeft&&0==r._axisLabelShowRight?(r.yAxis.translate(f+9+y,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),v=r.widthOfNoMargin-f):0==r._axisLabelShowLeft&&0==r._axisLabelShowRight&&(r.yAxis.translate(f+9,0),r.yAxisDoubleY.translate(r.widthOfNoMargin+9-f,0),v=r.widthOfNoMargin-f,p=f)),i.data(s).xScale(o).yScale(a).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._labelShow).positionOptions(r._positionOptions).positionChoice(r._positionChoice).axisLabelShowLeft(r._axisLabelShowLeft).axisLabelShowRight(r._axisLabelShowRight).textLength(p).numberLength(y).sWidth(v).circleBorderColor(r._circleBorderColor).circleBorderWidth(r._circleBorderWidth).circleRadius(r._circleRadius),n.data(s).xScale(o).yScale(a).textLength(p).sWidth(v).lineWidth(r._lineWidth).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onMouseover(function(t,e){var n=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),i=r.coreGroup.selectAll("polygon").nodes(),o=d3.select(this).node().__data__.index;d3.select(i[o]).style("opacity",.45),d3.select(n[2*o+1]).attr("r",1.8*r._circleRadius),d3.select(n[2*o]).attr("r",1.8*r._circleRadius);var a=[{text:t.name,color:t.color},{text:t.data[0].name+": "+(t.data[0].tooltipValueShow?t.data[0].value:""),color:"none"},{text:t.data[1].name+": "+(t.data[1].tooltipValueShow?t.data[1].value:""),color:"none"}];r.tooltip.data(a).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.tooltip.move([d3.event.offsetX,d3.event.offsetY]);var t=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),e=r.coreGroup.selectAll("polygon").nodes(),n=d3.select(this).node().__data__.index;d3.select(e[n]).style("opacity",.45),d3.select(t[2*n+1]).attr("r",1.8*r._circleRadius),d3.select(t[2*n]).attr("r",1.8*r._circleRadius)}).onMouseout(function(t){r.tooltip.hide();var e=d3.selectAll(".slope-chart .slope-scatter-plot circle").nodes(),n=r.coreGroup.selectAll("polygon").nodes(),i=d3.select(this).node().__data__.index;d3.select(n[i]).style("opacity",0),d3.select(e[2*i+1]).attr("r",r._circleRadius),d3.select(e[2*i]).attr("r",r._circleRadius)}),e.data(s).xScale(o).yScale(a).textLength(p).sWidth(v).sHeight(l).shadowColor(r._shadowColor).onMouseover(function(t,e){var n=r.coreGroup.selectAll("circle").nodes(),i=d3.select(this).node().__data__.index;d3.select(this).style("opacity",.35),d3.select(n[2*i+1]).attr("r",1.8*r._circleRadius),d3.select(n[2*i]).attr("r",1.8*r._circleRadius);var o=[{text:t.name,color:t.color},{text:t.data[0].name+": "+(t.data[0].tooltipValueShow?t.data[0].value:""),color:"none"},{text:t.data[1].name+": "+(t.data[1].tooltipValueShow?t.data[1].value:""),color:"none"}];r.tooltip.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.tooltip.move([d3.event.offsetX,d3.event.offsetY]);var t=r.coreGroup.selectAll("circle").nodes(),e=d3.select(this).node().__data__.index;d3.select(this).style("opacity",.35),d3.select(t[2*e+1]).attr("r",1.8*r._circleRadius),d3.select(t[2*e]).attr("r",1.8*r._circleRadius)}).onMouseout(function(t){r.tooltip.hide();var e=r.coreGroup.selectAll("circle").nodes(),n=d3.select(this).node().__data__.index;d3.select(this).style("opacity",0),d3.select(e[2*n+1]).attr("r",r._circleRadius),d3.select(e[2*n]).attr("r",r._circleRadius)}),r.coreGroup.call(G,r.yAxis.width+.5,0),e.update(),n.update(),i.translate(r.yAxis.width+.5,0).update()}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=Hn;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t.map(function(t){return t.name}):[0,1]),n=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=e,this._yDomain=n}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,n=e.y.name||null,i=e.y1.name||null;this.yTitle([n,i])}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._circleRadius=0==e.circleRadius||e.circleRadius?e.circleRadius:this._circleRadius,this._lineWidth=e.lineWidth?e.lineWidth:this._lineWidth,this._circleBorderWidth=e.circleBorderWidth?e.circleBorderWidth:this._circleBorderWidth,this._circleBorderColor=e.circleBorderColor?e.circleBorderColor:this._circleBorderColor,this._shadowColor=e.shadowColor?e.shadowColor:this._shadowColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"widthOfNoMargin",get:function(){var t=this._width-3*this._marginLeft-this._marginRight;return 0<t?t:0}}]),o}(),Un=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","bar-progress"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"bg",value:function(){var e=this,t=e._data;e.group.selectAll(".bg-rect").remove();var n=e.group.append("g").selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var i=n.enter().append("rect").attr("class","bg-rect").merge(n).style("fill",function(t){return t.color_special}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return t.color_special}).style("stroke-width",function(t){return e._strokeWidth||0});return this._rectObj?i.attr("x",this._rectObj.xFunc).attr("y",this._rectObj.yFunc).attr("width",this._rectObj.widthFunc).attr("height",this._rectObj.heightFunc):i.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),e}},{key:"update",value:function(){var e=this,t=e._data;e.group.selectAll(".progress-rect").remove();var n=e.group.append("g").selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var i=n.enter().append("g"),o=i.append("rect").attr("class","progress-rect").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});return e._rectObj?(o.attr("x",e._rectObj.xFunc),o.attr("y",e._rectObj.yFunc),o.attr("width",0),o.attr("height",e._rectObj.heightFunc)):o.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),o.transition().duration(e._transition?e._duration:0).attr("width",e._rectObj.widthFunc),e._textObj&&(e.group.selectAll(".bar-text").remove(),i.append("text").attr("class","bar-text").merge(n).text(e._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",e._textObj.xFunc).attr("y",e._textObj.yFunc).attr("dx",e._textObj.dxFunc).attr("dy",e._textObj.dyFunc).style("display",e._labelShow?"block":"none").transition().duration(e._transition?e._duration:0).tween("d",function(t){var e=this,n=-1==String(100*t.value).indexOf(".")?100*t.value:(100*t.value).toFixed(1),i=d3.interpolateNumber(0,n);return function(t){d3.select(e).text((-1==String(i(t)).indexOf(".")?i(t):i(t).toFixed(1))+"%")}})),o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),qn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","bar-progress-chart"),e.rectBg=new Un(e.mainGroup),e.rect=new Un(e.mainGroup),e._labelShow=!1,e._positionOptions=["内部居右","内部居中"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var i=this,t=i.rect,e=i.rectBg,n=i.activeData,o=i.defs;o.selectAll("filter").remove();var a=o.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_barprogress").attr("filterUnits","objectBoundingBox");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),a.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),a.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),a.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),a.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var r=.9*i.widthOfNoMargin,l=.9*i.heightOfMainGroup;var s,u,h,c=(h=.15*(s=r),(u=l)<s/5&&(h=.6*u),h);e.data(n).rectObj({xFunc:0,yFunc:l/2.1,widthFunc:function(t){return r},heightFunc:c}),t.data(n).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).labelShow(i._labelShow).rectObj({xFunc:0,yFunc:l/2.1,widthFunc:function(t){return r*t.value},heightFunc:c}).textObj({xFunc:function(t){return t.value},yFunc:l/2.1,dyFunc:c/2+.4*i._textLabel.fontSize,dxFunc:function(t,e){return 0==i._positionOptions.indexOf(i._positionChoice)?r*t.value-E((100*t.value).toFixed(1)+"%",i._textLabel.fontSize,i._fontFamily)-5:1==i._positionOptions.indexOf(i._positionChoice)?r*t.value/2-.5*E((100*t.value).toFixed(1)+"%",i._textLabel.fontSize,i._fontFamily):void 0},colorFunc:function(){return i._labelShow?i._textLabel.color:"none"},textFunc:function(t){return t.value},fontSize:i._textLabel.fontSize,fontFamily:i._textLabel.fontFamily}).fillOpacity(1).onMouseover(function(t,e){var n=[{text:t.name+": "+(100*t.value).toFixed(1)+"%",color:t.color}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){i.tooltip.hide()}),i.rect.translate(.1*i.widthOfNoMargin/2,0).update(),i.rectBg.translate(.1*i.widthOfNoMargin/2,0).bg()}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Wn;switch(n.dataType){case"cross-table":i=_;break;default:i=Wn}return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.label;0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel);var n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY)}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"padAngle",value:function(t){return arguments.length?(this._padAngle=t,this):this._padAngle}}]),n}(),Zn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","polygon-radar"),e._lineFunc=null,e._startAngle=0,e._endAngle=2*Math.PI,e._radius=100,e._stroke=null,e._borderWidth=2,e._strokeDasharry="",e._transition=!0,e}return h(n,P),s(n,[{key:"update",value:function(){for(var i=this,o=i._data,a=(i.startAngle,i.endAngle,i._radius),t=o.length?[0,1.1*d3.max(o,function(t){return d3.max(t.data,function(t){return parseFloat(+t.value)})})]:[0,1],e=d3.scaleLinear().domain(t).nice().range([0,a]),n=i._deadData[0].data.length,r=2*Math.PI/n,l=[],s=0;s<o.length;s++){l[s]=[];for(var u=0;u<o[s].data.length;u++){var h=o[s].data[u].value;l[s][u]=e(h)}}for(var c=[],_=0;_<l.length;_++)for(var d=l[_],f="",y=[],p=0;p<n;p++){var v=d[p],g=v*Math.sin(p*r),m=-v*Math.cos(p*r);f+=g+","+m+" ",y.push({x:g,y:m,value:o[_].data[p].value}),c[_]={polygon:f,points:y}}var x=i._lineFunc||d3.line().x(function(t){return t.x}).y(function(t){return t.y});x.curve(d3.curveLinearClosed);var S=i._lineFunc||d3.line().x(function(t){return 0}).y(function(t){return 0});S.curve(d3.curveLinearClosed);var k=i.group,b=k.selectAll("path").data(o,function(t){return t.key});b.exit().remove(),b.enter().append("path").merge(b).style("fill","none").attr("d",function(t,e){return S(c[e].points)}).style("stroke-opacity",i._fillOpacity).style("stroke",function(t){return i._stroke||t.color||"#000"}).style("stroke-width",i._borderWidth).style("stroke-dasharray",i._strokeDasharry).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout).transition().delay(function(t,e){return e*(i._transition?.8*i._duration/o.length:0)+.1*i._duration}).duration(i._transition?.8*i._duration/o.length:0).attr("d",function(t,e){return x(c[e].points)}),k.selectAll(".circle-g").remove();var w=k.append("g").selectAll("g").data(o);w.exit().remove(),w.enter().append("g").attr("class","circle-g").merge(w).each(function(t,e){var n=d3.select(this).selectAll("circle").data(c[e].points);n.exit().remove(),n.enter().append("circle").attr("class","circle-"+e).attr("cx",0).attr("cy",0).merge(n).style("fill",t.color).style("stroke","#FFFFFF").style("stroke-width",1).style("stroke-width",i._strokeWidth).attr("r",0).transition().delay(e*(i._transition?.8*i._duration/o.length:0)+.1*i._duration).duration(i._transition?.8*i._duration/o.length:0).attr("r",i._endPointRadius).attr("cx",function(t){return t.x||0}).attr("cy",function(t){return t.y||0})}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var F=[],O=0;O<n;O++){for(var C=[],A=0;A<c.length;A++)C.push(c[A].points[O].value);F.push(d3.max(C))}k.selectAll(".polygon-radar-texts").remove();var P=k.append("g").selectAll("g").data(o);P.exit().remove(),P.enter().append("g").merge(P).each(function(t,e){var n=d3.select(this).append("g").selectAll("text").data(c[e].points);n.exit().remove(),n.enter().append("text").attr("class","polygon-radar-texts").merge(n).text(function(t,e){return t.value}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return t.value==F[e]?t.x+.06*a*(e*r==1.5*Math.PI?-1:Math.sin(e*r))||0:t.x-.06*a*Math.sin(e*r)||0}).attr("y",function(t,e){return t.value==F[e]?t.y+.06*a*(e*r==0?1.5:Math.cos(e*r))+(e*r==0?i._fontSize/2.5:0)||0:t.y-.06*a*(e*r==Math.PI?-1.5:Math.cos(e*r))+(e*r==Math.PI?i._fontSize/2.5:0)||0}).attr("text-anchor",function(t,e){return e*r==0||e*r==Math.PI?"middle":e*r>Math.PI&&t.value!=F[e]?"start":e*r>Math.PI&&t.value==F[e]||0<e*r&&e*r<Math.PI&&t.value!=F[e]?"end":void 0}).attr("dy",function(t,e){if(t.value==F[e])if(t.value==d3.max(F)){if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.7em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.7em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"1.1em"}else{if(e*r==0)return"0.1em";if(e*r==Math.PI)return"0";if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.5em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.5em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"0.9em"}else if(t.value!=F[e])return e*r==0||e*r>Math.PI&&e*r<1.5*Math.PI?0:"0.4em"}).style("display",i._labelShow?"block":"none").style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+.9*i._duration:0).style("opacity",1)});for(var z=[],D=1.06*a,L=0;L<n;L++){var M=D*Math.sin(L*r),W=-D*Math.cos(L*r);z.push({x:M,y:W})}k.selectAll(".angle-text").remove();var R=k.append("g").selectAll("text").data(z);R.exit().remove(),R.enter().append("text").attr("class","angle-text").text(function(t,e){return i._deadData[0].data[e].name=="&-"+(e+1)?"":i._deadData[0].data[e].name}).style("font-size",i._themeFontSize).style("font-family",i._themeFontFamily).style("fill",i._themeFontColor).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",0).transition().duration(i._transition?.1*i._duration:0).style("opacity",1);for(var N=0;N<n;N++)N*r==0||N*r==Math.PI?d3.select(k.selectAll(".angle-text").nodes()[N]).attr("text-anchor","middle"):N*r>Math.PI?d3.select(k.selectAll(".angle-text").nodes()[N]).attr("text-anchor","end"):0<N*r&&N*r<Math.PI&&d3.select(k.selectAll(".angle-text").nodes()[N]).attr("text-anchor","start");for(var T=0;T<n;T++)T*r==Math.PI&&d3.select(k.selectAll(".angle-text").nodes()[T]).attr("dy","0.8em");for(var j=k.selectAll(".polygon-radar-texts"),Y=[],X=[],B=0;B<j._groups[0].length;B++){X.push(B);for(var G=B+1;G<j._groups[0].length;G++){ut(st(d3.select(j._groups[0][B])),st(d3.select(j._groups[0][G])))&&(Y.push(B),d3.select(j._groups[0][B]).style("visibility","hidden"))}}for(var E=new Set(Y),I=Array.from(E),H=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(I,X),V=0;V<I.length;V++){for(var U=[],q=0;q<H.length;q++){var Z=st(d3.select(j._groups[0][I[V]])),Q=st(d3.select(j._groups[0][H[q]]));if(U.push(ut(Z,Q)),ut(Z,Q)){if(I[V]==H[q])continue;d3.select(j._groups[0][I[V]]).style("visibility","hidden")}}0==U.filter(function(t){return 1==t}).length&&H.push(I[V])}for(var $=0;$<H.length;$++)d3.select(j._groups[0][H[$]]).style("visibility","visible");return i}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"deadData",value:function(t){return arguments.length?(this._deadData=t,this):this._deadData}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"themeFontColor",value:function(t){return arguments.length?(this._themeFontColor=t,this):this._themeFontColor}},{key:"themeFontSize",value:function(t){return arguments.length?(this._themeFontSize=t,this):this._themeFontSize}},{key:"themeFontFamily",value:function(t){return arguments.length?(this._themeFontFamily=t,this):this._themeFontFamily}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Qn="grid-polygon-path",$n="grid-line",Jn=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","polygon-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=8,e}return h(n,q),s(n,[{key:"update",value:function(){for(var e=this,t=e._data,n=(e._startAngle,e._endAngle,e._radius),i=e._donutCount,o=t[0].data.length||e._sectorCount,a=2*Math.PI/o,r={webs:[],webPoints:[]},l=i;0<l;l--){for(var s="",u=[],h=n/i*l,c=0;c<o;c++){var _=h*Math.sin(c*a),d=-h*Math.cos(c*a);s+=_+","+d+" ",u.push({x:_,y:d})}r.webs.push(s),r.webPoints.push(u)}var f=e.group.style("fill","none").style("stroke",e._stroke).style("stroke-dasharray","none");!function(){if(!e._showX)return f.selectAll("."+Qn).remove();var t=f.selectAll("."+Qn).data(r.webs);t.exit().remove(),t.enter().append("polygon").attr("class",Qn).merge(t).attr("points",function(t){return t}).attr("fill","white").attr("fill-opacity",1),d3.selectAll(t.nodes().filter(function(t,e){return e%2!=0})).attr("fill","#e4e3e6").attr("fill-opacity",.4)}(),function(){if(!e._showY)return f.selectAll("."+$n).remove();var t=f.selectAll("."+$n).data(r.webPoints[0]);t.exit().remove(),t.enter().append("line").attr("class",$n).merge(t).attr("x1",0).attr("y1",0).attr("x2",function(t){return t.x}).attr("y2",function(t){return t.y})}()}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"width",value:function(t){return arguments.length?(this._width=parseFloat(t),this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=parseFloat(t),this):this._height}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),n}();function Kn(t,e){var n=0,i=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(n=t.index,i=t.isLegend):"vCol"===t.function&&0==t.configurable&&o.push(t.index)}),W(t,[n],2))return[];var a=R(t,e),r={},l=[],s=a.length,u=a[0];if(i){for(var h=[],c=1;c<s;c++)h.push(a[c].length);h.sort(function(t,e){return e-t});for(var _=1;_<h[0];_++)if(_!==n){var d=u[_];""!=u[_]&&null!=u[_]&&null!=u[_]||(d="$-"+_),r[d+"-"+_]={name:d,showLegend:d!="$-"+_,data:[]}}for(var f=1;f<s;f++){var y=a[f],p=y[n];if(""!=p&&null!=p&&null!=p||(p="&-"+f),p)for(var v=0;v<h[0];v++){var g=u[v];""!=u[v]&&null!=u[v]&&null!=u[v]||(g="text-"+v),v!==n&&g&&r[g+"-"+v].data.push({name:p,showAxisText:p!="&-"+f,value:""==y[v]||isNaN(parseFloat(y[v]))||null==y[v]||null==y[v]?0:parseFloat(y[v]),tooltipValueShow:!isNaN(parseFloat(y[v]))})}}for(var m in r)l.push(r[m])}else{for(var x=[],S=1;S<s;S++)x.push(a[S].length);x.sort(function(t,e){return e-t});for(var k=1;k<s;k++){var b=a[k],w=b[n];if(""!=w&&null!=w&&null!=w||(w="$-"+k),w){for(var F={name:w,showLegend:w!="$-"+k,data:[]},O=0;O<x[0];O++){var C=u[O];""!=C&&null!=C&&null!=C||(C="&-"+O),O!==n&&F.data.push({name:C,showAxisText:C!="&-"+O,value:""==b[O]||isNaN(parseFloat(b[O]))||null==b[O]||null==b[O]?0:parseFloat(b[O]),tooltipValueShow:!isNaN(parseFloat(b[O]))})}l.push(F)}}}return l.forEach(function(t,e){t.key=M(t.name)+"-"+e}),l}var ti=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.gridPolygon=new Jn(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.radar=new Zn(e.coreGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._showPoints=!0,e._fillOpacity=0,e._endPointRadius=3.5,e._borderWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var a=this;a.group.selectAll(".polygon-grid").style("opacity",0).transition().duration(a._transition?.1*a._duration*1e3:0).delay(a._transition?1e3*a._startDelay:0).style("opacity",1);var r=a.activeData,t=a.gridPolygon,e=a.radar,n=(a.tooltip,a.widthOfCore,a.heightOfCore,a.widthOfNoMargin),i=a.heightOfMainGroup,o=L(.84*n,.84*a.heightOfMainGroup,a._startAngle,a._endAngle).radius,l=a.defs;l.selectAll("filter").remove();var s=l.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_polygonRadar").attr("filterUnits","objectBoundingBox");s.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),s.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),s.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),s.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),s.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(r).deadData(a.sortedDataCopy).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).themeFontSize(a._fontSize).themeFontColor(a._fontColor).themeFontFamily(a._fontFamily).fillOpacity(.6).labelShow(a._labelShow).radius(o).borderWidth(a._borderWidth).endPointRadius(a._endPointRadius).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).onMouseover(function(t,e){var n=[{text:r[e].name=="$-"+(e+1)?"":r[e].name,color:r[e].color}];r[e].data.forEach(function(t,e){n.push({text:(t.name=="&-"+(e+1)?"":t.name)+": "+t.value,color:"none"})}),d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var i=a.group.selectAll(".circle-g").nodes(),o=a.group.selectAll(".polygon-radar polygon").nodes();d3.selectAll(i[e].childNodes).style("r",1.5*a._endPointRadius),d3.select(o[e]).style("stroke-width",1.5*a._borderWidth),a.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(t,e){d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var n=a.group.selectAll(".circle-g").nodes(),i=a.group.selectAll(".polygon-radar polygon").nodes();d3.select(i[e]).style("stroke-width",1.5*a._borderWidth),d3.selectAll(n[e].childNodes).style("r",1.5*a._endPointRadius),a.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t,e){d3.select(this).style("stroke-opacity",.8).style("stroke-width",a._borderWidth);var n=a.group.selectAll(".circle-g").nodes(),i=a.group.selectAll(".polygon-radar polygon").nodes();d3.select(i[e]).style("stroke-width",a._borderWidth),d3.selectAll(n[e].childNodes).style("r",a._endPointRadius),a.tooltip.hide()}),t.data(a.sortedDataCopy).radius(o).fillOpacity(null==a._fillOpacity?0:a._fillOpacity).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray);var u=(a._width-a._marginLeft-a._marginRight)/2;a.gridPolygon.translate(u,i/2).update(),a.coreGroup.call(G,u,i/2),t.update(),e.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=Kn;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.fillOpacity(e.fillOpacity).endPointRadius(e.endPointRadius).borderWidth(e.borderWidth)}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"widthOfNoMargin",get:function(){var t=this._width-3*this._marginLeft-this._marginRight;return 0<t?t:0}}]),n}(),ei="axis-group",ni="y-ranking-title",ii=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-ranking"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e}return h(n,ft),s(n,[{key:"update",value:function(){var t=this,e=t._orient,n=t._scaleFunc,i=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(n):d3.axisLeft(n);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=i.select("."+ei).empty()?i.append("g").attr("class",ei):i.select("."+ei);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).text(function(t,e){return a[e]}),s.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),s.select("path").style("stroke",t._lineStroke).style("display","none")});var u=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var h=i.select("."+ni).empty()?i.append("g").attr("class",ni):i.select("."+ni),c=h.select("text").empty()?h.append("text"):h.select("text");E(t._title,o,t._fontFamily);h.call(G,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else i.select("."+ni).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);(t="category"===a?o.domain():o.ticks(e._tickCount)).push(1),t.splice(t.indexOf(0),1);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)});return s<=l?(n=t,i=s):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24+3:0):this._titleShow&&this._title?1.125*this._fontSize+24+3:0),t}}]),n}(),oi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","ranking-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,t=o._data,a=o._lineFunc||d3.line().x(function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2}).y(function(t){return o._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});a.curve(o._curve);var e=o.group;e.selectAll(".groups").remove(),e.selectAll(".animation-ranking-groups").remove();var n=e.append("g").attr("class","groups").selectAll("g").data(t);function s(t,e){var n=e.getPointAtLength(t);return[n.x,n.y]}n.exit().remove(),n.enter().append("g").attr("class","animation-ranking-groups").merge(n).each(function(e,t){var n=d3.select(this).append("path").attr("class","ranking-lines").style("fill","none").style("stroke",function(t){return o._stroke||e.color||"#000"}).style("stroke-width",o._lineWidth).style("stroke-dasharray",o._strokeDasharry).style("display","none").attr("d",a(e.data)),i=d3.select(this).append("path").attr("class",".arrow").attr("d","M-0,0 L-8,8 L8,0 L-8,-8 Z").style("stroke",function(t){return o._stroke||e.color||"#000"}).style("fill",e.color).style("display","none"),r=d3.select(this).select(".ranking-lines").node(),l=r.getTotalLength();i.transition().duration(o._transition?.9*o._duration:0).attrTween("transform",function(){return function(t){var e,n,i,o,a=t*l;return"translate("+s(a,r)+") rotate( "+(e=a,n=r,i=s(Math.max(e-.01,0),n),o=s(e+.01,n),180*Math.atan2(o[1]-i[1],o[0]-i[0])/Math.PI)+")"}}).style("display","block").transition().style("display","none"),n.transition().style("display","block").duration(o._transition?.9*o._duration:0).attrTween("stroke-dasharray",function(){return d3.interpolateString("0,"+l,l+","+l)})}),e.selectAll(".circle-group").remove();var i=e.append("g").attr("class","circle-group").selectAll("g").data(t,function(t){return t.name});i.exit().remove(),i.enter().append("g").merge(i).each(function(t,e){var n=d3.select(this).selectAll("circle").data(t.data);n.exit().remove(),n.enter().append("circle").attr("class","clip-scatter-plot").merge(n).style("fill",o._fill||t.color).style("stroke",o._stroke||t.color).style("stroke-width",o._strokeWidth).attr("cx",function(t){return o._xScale(t.name)+o._xScale.bandwidth()/2||0}).attr("cy",function(t){return o._yScale(t.value)||0}).transition().duration(o._transition?.9*o._duration:0).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,o._radius);return function(t){return e(t)}}).on("start",o._onTransitionStart).on("end",o._onTransitionEnd)});for(var r=e.selectAll(".clip-scatter-plot").nodes(),l=0;l<r.length;l++)""==r[l].__data__.value||isNaN(r[l].__data__.value)?d3.select(r[l]).style("opacity","0"):d3.select(r[l]).style("opacity","1");return o}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),ai=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.grid=new Pt(e.coreGroup),e.linePlot=new oi(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new ii(e.mainGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.stackText=new Wt(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._curve=d3.curveCardinal,e._showPoints=!0,e._endPointRadius=3.5,e._lineShadowColor="#ccc",e._lineWidth=2,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="下面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.grid,e=n.linePlot,l=n.tooltip,i=n.overlay,s=n.guideLine,o=n.stackText,u=n.xScale,a=n.yScale,h=n.widthOfCore,c=n.heightOfCore,_=(n.xAxis,n.yAxis,n.defs);_.selectAll("filter").remove();var d=_.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_line").attr("filterUnits","objectBoundingBox");d.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),d.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),d.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),d.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),d.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),t.width(h).height(c).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(u).yScale(a).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).mainGroup(n.mainGroup).lineWidth(n._lineWidth).radius(n._endPointRadius).fill("#fff").strokeWidth(2),s.y1(0).y2(c).stroke("#c6c6c6").strokeDasharray("0 0"),i.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(c).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show(),s.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(u(i)+u.bandwidth()/2)+",0)")}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide()}),o.data(r).xScale(u).yScale(a).type("mix").fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0);var f=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(f).remove(),i.update(),t.update(),e.update(),o.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),n=t.length?[d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0)]:[1,0];this._xDomain=e,this._yDomain=n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._endPointRadius=0==e.endPointRadius||e.endPointRadius?e.endPointRadius:this._endPointRadius,this._lineShadowColor=e.lineShadowColor?e.lineShadowColor:this._lineShadowColor,this._lineWidth=e.lineWidth?e.lineWidth:this._lineWidth),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}}]),n}(),ri="axis-group",li="y-percent-title",si=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-percent"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(n,ft),s(n,[{key:"update",value:function(){var t=this,e=t._orient,n=t._scaleFunc,i=t.group,o=t._fontSize,a=t._tickValueTexts,r=void 0;r=t.axisFunc="right"===e?d3.axisRight(n):d3.axisLeft(n);var l=null;"number"===t._type&&t._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(t._tickShow?t._tickValues:[]).tickSizeInner(t._tickShow?t._tickSize:0).tickSizeOuter(0).tickPadding(t._tickPadding).tickFormat(l);var s=i.select("."+ri).empty()?i.append("g").attr("class",ri):i.select("."+ri);s.transition().duration(t._transition?t._duration:0).call(r).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("dx",.6*-o).attr("dy",.4*o).text(function(t,e){return 100*a[e]+"%"}),s.selectAll(".tick line").style("stroke",t._lineStroke).style("display","none"),s.select("path").style("stroke",t._lineStroke).style("display",t._axisLineShow?"block":"none").style("display","none")});var u=Math.abs(n.range()[0]-n.range()[1]);if(t._titleShow&&t._title){var h=i.select("."+li).empty()?i.append("g").attr("class",li):i.select("."+li),c=h.select("text").empty()?h.append("text"):h.select("text");E(t._title,o,t._fontFamily);h.call(G,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",t._fontFamily).style("fill",t._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(t._title)}else i.select("."+li).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);var s=d3.max(t,function(t){return E(t,r,e._fontFamily)})+r;return s<=l?(n=t,i=s):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,e}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24+3:0):this._titleShow&&this._title?1.125*this._fontSize+24+3:0),t}}]),n}(),ui=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","percentage-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var o=this,t=o._data,i=o.group;i.selectAll(".percentageStackBar").remove();var e=i.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var n=o._rectObj.barWidthPercent,i=d3.select(this).selectAll("rect").data(t.data);i.exit().remove(),i.enter().append("rect").attr("class","percentageStackBar").merge(i).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return o._xScale.step()*e+o._xScale.step()*(1-n)/2}).attr("y",function(t){return o._yScale(0)}).attr("width",o._xScale.step()*n).attr("height",0).transition().duration(o._transition?.9*o._duration:0).attr("y",function(t){return o._yScale(t.total)}).attr("height",function(t){return 0<o._yScale(1-t.percent)?o._yScale(1-t.percent):0}),i.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),i.selectAll(".percentageStackBarTexts").remove();var n=i.append("g").selectAll("g").data(t);n.exit().remove(),n.enter().append("g").merge(n).each(function(t,e){var n=d3.select(this).append("g").attr("class","percentageStackBarTexts").selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").merge(n).text(function(t){return null==o._contentOption||null==o._contentChoice?0==t.value?"":t.value:0==o._contentOption.indexOf(o._contentChoice[0])?0==t.value?"":(100*parseFloat(t.percent)).toFixed(2)+"%":1==o._contentOption.indexOf(o._contentChoice[0])?0==t.value?"":t.value:void 0}).attr("fill",o._textObj.colorFunc).attr("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return o._xScale.step()*e+.25*o._xScale.step()}).attr("y",function(t){return o._yScale(t.total)}).attr("text-anchor","middle").attr("dx",.25*o._xScale.step()).attr("dy",function(t){return null==o._positionOptions||null==o._positionChoice?0:0==o._positionOptions.indexOf(o._positionChoice)?o._yScale(1-t.percent)/2+.4*o._fontSize:1==o._positionOptions.indexOf(o._positionChoice)?o._yScale(1-t.percent)-.3*o._fontSize:void 0}).style("display",o._labelShow?"block":"none").style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(o._transition?o._startDelay+.9*o._duration:0).style("opacity",1),null!=o._labelShow&&null!=o._positionOptions&&null!=o._positionChoice&&null!=o._contentOption&&null!=o._contentChoice&&-1!=o._positionOptions.indexOf(o._positionChoice)||i.selectAll(".percentageStackBarTexts text").style("display","none")});for(var a=i.selectAll(".percentageStackBarTexts text"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){ut(st(d3.select(a._groups[0][s])),st(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("visibility","hidden"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(c,l),d=0;d<c.length;d++){for(var f=[],y=0;y<_.length;y++){var p=st(d3.select(a._groups[0][c[d]])),v=st(d3.select(a._groups[0][_[y]]));if(f.push(ut(p,v)),ut(p,v)){if(c[d]==_[y])continue;d3.select(a._groups[0][c[d]]).style("visibility","hidden")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var g=0;g<_.length;g++)d3.select(a._groups[0][_[g]]).style("visibility","visible");return o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),hi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","percentage-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new ui(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new si(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._histogramWidth=1,e._yScaleHeight=1.05,e._barWidthPercent=.5,e._labelShow=!1,e._positionOptions=["内部居中","内部居下"],e._positionChoice="内部居中",e._contentOption=["百分比","数值"],e._contentChoice=["百分比"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=[],e=0;e<(0==r.length?0:r[0].data.length);e++){for(var i=0,o=0;o<r.length;o++)i+=parseFloat(r[o].data[e].value);t.push(i)}for(var a=0;a<r.length;a++)for(var l=0;l<r[a].data.length;l++)0==t[l]?r[a].data[l].percent=0:r[a].data[l].percent=r[a].data[l].value/t[l];for(var s=0;s<r.length;s++)for(var u=0;u<r[s].data.length;u++)r[s].data[u].total=0==s?parseFloat(r[s].data[u].percent):r[s-1].data[u].total+parseFloat(r[s].data[u].percent);var h=r,c=n.grid,_=n.tooltip,d=n.rectPlot,f=n.overlay,y=n.selectOverlay,p=n.xScale,v=n.yScale,g=n.widthOfCore,m=n.heightOfCore,x=n.defs;x.selectAll("filter").remove();var S=x.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_percentageBar").attr("filterUnits","objectBoundingBox");S.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),S.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),S.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),S.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),S.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),f.data(p.domain()).isScalePoint(!1).bandWidth(p.step()).bandHeight(m).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),_.data(o).update().move([d3.event.offsetX,d3.event.offsetY]),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+p(i)+",0)"),_.show()}).onMousemove(function(){_.move([d3.event.offsetX,d3.event.offsetY]),y.show()}).onMouseout(function(){_.hide(),y.hide()}),d.data(h).xScale(p).yScale(v).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).rectObj({barWidthPercent:n._barWidthPercent}).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),c.width(g).height(m).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),y.width(p.step()).height(m).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)");var k=n.group.selectAll(".percentage-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(k).remove(),d.update(),y.update(),f.update(),c.update()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]);this._xDomain=e,this._yDomain=[0,1]}}]),n}(),ci=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e._areaFunc||d3.area().x(function(t){return e._xScale(t.name)}).y0(e._yScale.range()[0]).y1(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(e._curve);var i=e.group.selectAll("path").data(t,function(t){return t.key});return i.exit().remove(),i.enter().append("path").merge(i).style("fill",function(t){return t.color}).style("fill-opacity",e._fillOpacity).transition().duration(e._transition?e._duration:0).attr("d",function(t){return n(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}}]),n}(),_i=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","percentage-line-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._strokeWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e._lineFunc||d3.line().x(function(t){return e._xScale(t.name)}).y(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(e._curve);var i=e.group.selectAll("path").data(t,function(t){return t.key});return i.exit().remove(),i.enter().append("path").merge(i).style("fill","none").style("stroke",function(t){return e._stroke||t.color||"#000"}).style("stroke-width",e._strokeWidth).style("stroke-dasharray",e._strokeDasharry).transition().duration(e._transition?e._duration:0).attr("d",function(t){return n(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}}]),n}(),di=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","percentage-area-text"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._strokeWidth=2,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n.group;e.selectAll(".stackAreaTexts").remove();var i=e.selectAll("g").data(t);i.exit().remove(),i.enter().append("g").merge(i).each(function(t){var e=d3.select(this).append("g").attr("class","stackAreaTexts").selectAll("text").data(t.data.slice(1));e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return null==n._contentOption||null==n._contentChoice?isNaN(parseFloat(t.value))||0==t.value?"":t.value:0==n._contentOption.indexOf(n._contentChoice[0])?isNaN(parseFloat(t.value))||0==t.value?"":(100*parseFloat(t.percent)).toFixed(1)+"%":1==n._contentOption.indexOf(n._contentChoice[0])?isNaN(parseFloat(t.value))||0==t.value?"":t.value:void 0}).attr("fill",n._textObj.colorFunc).attr("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return n._xScale.step()*(e+1)+.15*n._xScale.step()}).attr("y",function(t){return n._yScale(t.total)}).attr("text-anchor","middle").attr("dx",.15*-n._xScale.step()).attr("dy",function(t){return null==n._positionOptions||null==n._positionChoice?0:0==n._positionOptions.indexOf(n._positionChoice)?0:1==n._positionOptions.indexOf(n._positionChoice)?n._fontSize:void 0}).style("display",n._labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?n._startDelay+.9*n._duration:0).style("opacity",1)}),null!=n._labelShow&&null!=n._positionOptions&&null!=n._positionChoice&&null!=n._contentOption&&null!=n._contentChoice&&-1!=n._positionOptions.indexOf(n._positionChoice)||e.selectAll(".stackAreaTexts text").style("display","none");for(var o=e.selectAll(".stackAreaTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){ut(st(d3.select(o._groups[0][l])),st(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("visibility","hidden"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(o._groups[0][h[_]])),p=st(d3.select(o._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("visibility","hidden")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(o._groups[0][c[v]]).style("visibility","visible");for(var g=e.selectAll(".stackAreaTexts text").nodes(),m=0;m<g.length;m++)isNaN(g[m].__data__.value)&&d3.select(g[m]).style("visibility","hidden");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),fi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","percentage-area-chart"),e.grid=new Pt(e.coreGroup),e.areaPlot=new ci(e.coreGroup),e.linePlot=new _i(e.coreGroup),e.percentareatext=new di(e.mainGroup),e.overlay=new zt(e.mainGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new mn(e.coreGroup),e.clipArea=new Ft(e.defs),e.AnimationArea=new Ot(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new si(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._curve=null,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="下面",e._contentOption=["百分比","数值"],e._contentChoice=["百分比"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=[],e=0;e<(0==r.length?0:r[0].data.length);e++){for(var i=0,o=0;o<r.length;o++)i+=isNaN(parseFloat(r[o].data[e].value))?0:parseFloat(r[o].data[e].value);t.push(i)}for(var a=0;a<r.length;a++)for(var l=0;l<r[a].data.length;l++)0==t[l]||isNaN(parseFloat(r[a].data[l].value))?r[a].data[l].percent=0:r[a].data[l].percent=r[a].data[l].value/t[l];for(var s=0;s<r.length;s++)for(var u=0;u<r[s].data.length;u++)r[s].data[u].total=0==s?parseFloat(r[s].data[u].percent):r[s-1].data[u].total+parseFloat(r[s].data[u].percent);var h=n.defs;h.selectAll("filter").remove();var c=h.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_percentageArea").attr("filterUnits","objectBoundingBox");c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),c.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),c.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),c.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),c.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var _=n.grid,d=n.areaPlot,f=n.linePlot,y=n.percentareatext,p=n.guideScatter,v=n.tooltip,g=n.overlay,m=n.guideLine,x=(n.clipArea,n.AnimationArea),S=n.xScale,k=n.yScale,b=n.widthOfCore,w=n.heightOfCore;n.widthOfNoMargin,n.heightOfMainGroup;_.width(b).height(w).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),d.data(r).xScale(S).yScale(k).curve(n._curve).areaFunc(d3.area().x(function(t){return S(t.name)}).y0(function(t){return k(t.total-t.percent)}).y1(function(t){return k(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),f.data(r).xScale(S).yScale(k).curve(n._curve).lineFunc(d3.line().x(function(t){return S(t.name)}).y(function(t){return k(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),y.data(r).xScale(S).yScale(k).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}),p.data(r).xScale(S).yScale(k).fill("#fff"),m.y1(0).y2(w).stroke("#c6c6c6").strokeDasharray("0 0"),g.data(S.domain()).isScalePoint(!0).bandWidth(S.step()).bandHeight(w).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),v.data(o).update(),m.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+S(i)+",0)"),p.data(a).update(),v.move([d3.event.offsetX,d3.event.offsetY]).show(),m.show(),p.show()}).onMousemove(function(){v.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){v.hide(),m.hide(),p.hide()}),n.coreGroup.call(G,n.yAxis.width+.5,0),p.elem.style("pointer-events","none");var F=n.group.selectAll(".percentage-area-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(F).remove(),_.update(),d.update(),f.update(),y.translate(n.yAxis.width+.5,0).update(),g.translate(n.yAxis.width+.5,0).update(),x.width(0).height(n._height),x.update(),n.coreGroup.attr("clip-path","url(#"+x.id+")"),n.defs.select(".x"+x.id).transition().duration(n._transition?1e3*n._duration*.9:0).delay(n._transition?1e3*n._startDelay:0).attr("width",b)}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]);this._xDomain=e,this._yDomain=[0,1]}}]),n}(),yi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","arcDiagram-chart"),e._xScale=null,e._yScale=null,e._radius=function(){return 3},e._fill=null,e._stroke=null,e._strokeWidth=1,e._transition=!1,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e._sWidth=null,e._areaBorderColor="#fff",e._areaBorderWidth=1,e._sortMethod=null,e}return h(n,P),s(n,[{key:"update",value:function(){for(var h=this,t=h.group,n=h._data,e=[],i=0;i<n[0].length;i++)e.push(parseFloat(n[0][i].value));var o=d3.max(e),a=d3.scaleLinear().domain([0,o]).range([4.5,8.5]).clamp(!0),r=h._sWidth,c=(h._sHeight,r/(n[0].length-1)),l=(h._xScale,h._yScale,h.arcFunc.startAngle(h._startAngle).endAngle(h._endAngle));l.setRadius=function(t){var e=.5*Math.abs(t.x2-t.x1);this.innerRadius(e-h._lineWidth/2).outerRadius(e+h._lineWidth/2)},t.selectAll("path").remove();var s=t.selectAll("path").data(n[1]);s.exit().remove(),s.merge(s.enter().append("path")).attr("transform",function(t,e){return t.x1=n[0][t.target].displayOrder*c,t.x2=n[0][t.source].displayOrder*c,"translate("+(t.x1+t.x2)/2+",0)"}).style("stroke",function(t){return n[0][t.source].color}).style("stroke-width",0).style("fill",function(t){return n[0][t.source].color}).style("fill-opacity",h._lineOpacity).on("mouseover",h._onMouseover).on("mousemove",h._onMousemove).on("mouseout",h._onMouseout).transition().duration(h._transition?.7*h._duration/n[1].length:0).delay(function(t,e){return h._transition?.2*h._duration+.7*h._duration/n[1].length*e:0}).attrTween("d",function(e){var n=d3.interpolate(h._startAngle,h._endAngle);return function(t){return h._endAngle=n(t),(l=h.arcFunc.startAngle(h._startAngle).endAngle(h._endAngle)).setRadius(e),l(e)}}).on("start",h._onTransitionStart).on("end",h._onTransitionEnd),t.select(".arc-groups").remove();var u=t.append("g").attr("class","arc-groups").selectAll("circle").data(n[0]);u.exit().remove();u.enter().append("circle").attr("cx",function(t){return t.displayOrder*c||0}).attr("cy",0).merge(u).style("fill",function(t){return t.color}).style("fill-opacity",.5).style("stroke",function(t){return t.color}).style("stroke-width",1).attr("r",function(t){return a(t.value)}).attr("cx",function(t){return t.displayOrder*c||0}).attr("cy",0).style("opacity",0).transition().duration(h._transition?.2*h._duration:0).style("opacity",1);t.select(".arc-texts").remove();var _=t.append("g").attr("class","arc-texts").selectAll("g").data(n[0]);function d(t){return!!/^[\u4E00-\u9FA5]+$/.test(t)}return _.exit().remove(),_.enter().append("g").attr("class","arc-text").attr("fill",h._fontColor).attr("font-size",h._fontSize).attr("text-anchor","start").attr("x",function(t){return d(t.name)?t.displayOrder*c-.5*h._fontSize||0:t.displayOrder*c||0}).attr("y",function(t){return d(t.name)?h._fontSize+9:0}).attr("dx",function(t){return d(t.name)?0:-(E(t.name,h._fontSize,h._fontFamily)+h._fontSize)}).attr("transform",function(t){return d(t.name)?"":"rotate(-90 "+(t.displayOrder*c||0)+" "+.3*-h._fontSize+" )"}).each(function(t){if(d(t.name))for(var e=d3.select(this),n=t.name.split("").reverse(),i=void 0,o=[],a=0,r=(e.node().getBoundingClientRect().height,+e.attr("x")),l=+e.attr("y"),s=e.text(null).append("text").attr("x",r).attr("y",l);i=n.pop();){o.push(i);var u=0<a?"-":"";s.text(u+o.join("")),s.node().getComputedTextLength()>h._fontSize&&(o.pop(),s.text(o.join("")),o=[i],s=e.append("text").attr("x",r).attr("y",++a*h._fontSize*1.3+l).text(i))}else d3.select(this).append("text").text(function(t){return t.name}).attr("fill",h._fontColor).attr("font-size",h._fontSize).attr("text-anchor","start").attr("x",function(t){return d(t.name)?t.displayOrder*c-.5*h._fontSize||0:t.displayOrder*c||0}).attr("y",function(t){return d(t.name)?h._fontSize+9:0}).attr("dx",function(t){return d(t.name)?0:-(E(t.name,h._fontSize,h._fontFamily)+h._fontSize)})}).style("opacity",0).transition().duration(h._transition?.1*h._duration:0).delay(h._transition?.9*h._duration:0).style("opacity",1),h}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"lineOpacity",value:function(t){return arguments.length?(this._lineOpacity=t,this):this._lineOpacity}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),pi=function(t){function n(t,e){return r(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e))}return h(n,F),s(n,[{key:"data",get:function(){var t,n,e=this._dataSolveFunc(this._dataSrc.data[0],this._columnMap[0]),i=this.generateColorList(e.length);return n=i,(t=e)[0].forEach(function(t,e){t.color=n[e]}),t}}]),n}();function vi(t,e){var n=0,i=1,o=2;e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"targetCol"===t.function?i=t.index:"vCol"===t.function&&(o=t.index)});for(var a=[],r=t.length,l=[],s=1;s<r;s++){var u=t[s];""!=u[n]&&null!=u[n]&&null!=u[n]&&(l.push(u[n]),""!=u[i]&&null!=u[i]&&null!=u[i]&&l.push(u[i]))}Array.prototype.distinct=function(){var t,e,n=this.length;for(t=0;t<n;t++)for(e=t+1;e<n;e++)this[t]==this[e]&&(this.splice(e,1),n--,e--);return this};for(var h=l.distinct(),c=[],_=0;_<h.length;_++)c.push({name:h[_]});for(var d=[],f=1;f<r;f++){var y=t[f];d.push({source:h.indexOf(y[n]),target:h.indexOf(y[i]),s:y[n],t:y[i],value:""==y[o]||null==y[o]||null==y[o]?0:y[o]})}for(var p=0;p<c.length;p++)c[p].value=0,c[p].displayOrder=p;return a.push(c),a.push(d),a[0].forEach(function(t,e){t.key=t.name+"-"+e}),a}var gi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","arcDiagram-chart"),e.arcDiagram=new yi(e.mainGroup),e._innerRadius=0,e._startAngle=-Math.PI/2,e._endAngle=Math.PI/2,e.lineOpacity=.7,e.lineWidth=1,e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var r=this,t=r.activeData,l=[];l.push(O(t[0]));for(var e=[],n=0;n<l[0].length;n++)null!=l[0][n].name&&e.push(l[0][n].name);for(var s=ht(e,r._fontSize,r._fontFamily),i=0;i<t[1].length;i++)-1==e.indexOf(t[1][i].s)||-1==e.indexOf(t[1][i].t)?t[1][i].active=!1:t[1][i].active=!0;l.push(O(t[1]));for(var o=0;o<l[0].length;o++)l[0][o].value=0,l[0][o].displayOrder=o;for(var a=0;a<l[1].length;a++)for(var u=0;u<l[0].length;u++)l[1][a].s==l[0][u].name&&(l[1][a].source=l[0][u].displayOrder),l[1][a].t==l[0][u].name&&(l[1][a].target=l[0][u].displayOrder);for(var h=0;h<l[1].length;h++){var c=l[1][h];l[0][c.source].value+=parseFloat(c.value),l[0][c.target].value+=parseFloat(c.value)}var _=r.arcDiagram,d=r.widthOfNoMargin,f=(r.heightOfNoMargin,d),y=r.heightOfMainGroup,p=r._startAngle,v=r._endAngle,g=function(t,e,n,i){var o=Math.min(t,e),a=o/2,r=0,l=e/2+a/2-s/2;o==e&&(r=(t-2*(a=.85*e-s/2))/2,l=1.1*a-s/2,t/2<a&&(r=0,l=e/2+(a=t/2)/2-s/2));return{radius:a,cx:r,cy:l,quadrant:0}}(f,y),m=g.radius;r._innerRadius||r._innerRadiusRatio&&r._innerRadiusRatio;for(var x=1e8,S=0,k=0;k<l[0].length;k++)x=Math.min(x,l[0][k].value),S=Math.max(S,l[0][k].value);function b(t,e,n,i,o){return i+(Math.min(Math.max(t,e),n)-e)/(n-e)*(o-i)}_.data(l).startAngle(p).endAngle(v).sWidth(2*m).lineWidth(r.lineWidth).lineOpacity(r.lineOpacity).fontSize(r._fontSize).fontColor(r._fontColor).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){var n=d3.select(this)._groups[0][0].__data__.source,i=d3.select(this)._groups[0][0].__data__.target,o=d3.selectAll(".arc-groups circle").nodes();d3.select(o[n]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),d3.select(o[i]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)});var a=[{text:l[0][t.source].name+"→"+l[0][t.target].name+"："+t.value,color:l[0][t.source].color}];r.tooltip.data(a).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){var t=d3.select(this)._groups[0][0].__data__.source,e=d3.select(this)._groups[0][0].__data__.target,n=d3.selectAll(".arc-groups circle").nodes();d3.select(n[t]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),d3.select(n[e]).attr("r",function(t){return 1.3*(b(t.value,x,S,4.5,8.5)||4.5)}),r.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){var e=d3.select(this)._groups[0][0].__data__.source,n=d3.select(this)._groups[0][0].__data__.target,i=d3.selectAll(".arc-groups circle").nodes();d3.select(i[e]).attr("r",function(t){return b(t.value,x,S,4.5,8.5)||4.5}),d3.select(i[n]).attr("r",function(t){return b(t.value,x,S,4.5,8.5)||4.5}),r.tooltip.hide()});var w=g.cx,F=g.cy;r.arcDiagram.translate(w||0,F||0).update()}},{key:"configLegend",value:function(){var e=this,i=e.sortedDataCopy;e.legend.data(i[0]).onClick(function(t){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i[0].forEach(function(e){e.key===t.key&&(e.active=!n),i[1].forEach(function(t){e.active==!n&&(t.s!=e.name&&t.t!=e.name||(t.active=!n))})}),e.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new pi(t,e),i=vi;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this.lineOpacity=e.lineOpacity?e.lineOpacity:this.lineOpacity,this.lineWidth=e.lineWidth?e.lineWidth:this.lineWidth)}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}}]),n}(),mi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","basic-horizontal-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new kn(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._barWidthPercent=.5,e._barCornerRadius=0,e._borderWidth=0,e._borderColor="none",e._fillOpacity=1,e._labelShow=!1,e._positionOptions=["外部居右","内部居左","内部居中","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var a=this,r=a.activeData,t=a.defs;t.selectAll("filter").remove();var e=t.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_basicHorizontal").attr("filterUnits","objectBoundingBox");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),e.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),e.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),e.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),e.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");for(var n=a.grid,i=a.rectPlot,l=a.tooltip,o=a.overlay,s=a.selectOverlay,u=a.barWidthPercent?a.barWidthPercent:.8,h=a.xScale,c=a.yScale,_=a.widthOfCore,d=a.heightOfCore,f=c.step(),y=[],p=[],v=0;v<a.activeData.length;v++)null==a._labelShow||null==a._positionOptions||null==a._positionChoice||-1==a._positionOptions.indexOf(a._positionChoice)?(y.push(0),p.push(0)):1==a._labelShow&&0==a._positionOptions.indexOf(a._positionChoice)?0<parseFloat(a.activeData[v].value)||0==parseFloat(a.activeData[v].value)?p.push(E(a.activeData[v].value,a._textLabel.fontSize,a._textLabel.fontFamily)):parseFloat(a.activeData[v].value)<0&&y.push(E(a.activeData[v].value,a._textLabel.fontSize,a._textLabel.fontFamily)):(y.push(0),p.push(0));Math.min(d3.min(r,function(t){return+t.value}),0);n.width(_-(0==y.length?0:d3.max(y))-(0==p.length?0:d3.max(p))).height(d).xTickLocations(a.xAxis.tickLocations).yTickLocations(a.yAxis.tickLocations).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray),o.data(c.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(_-(0==y.length?0:d3.max(y))-(0==p.length?0:d3.max(p))).bandHeight(c.step()).onMouseover(function(t,e){var n=c.domain()[r.length-e-1==-1?1:r.length-e-1==-2?0:r.length-e-1],i=r.filter(function(t){return t.name===n}),o=[];n&&1!=n&&((o=[{text:i[0].valueLabel}]).push({text:(i[0].showLegend?n:"")+": "+i[0].value,color:i[0].color}),a.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+c(n)+")")),l.data(o).update(),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),s.show()}).onMouseout(function(){l.hide(),s.hide()}),s.width(_-(0==y.length?0:d3.max(y))-(0==p.length?0:d3.max(p))).height(c.step()).shadowColor("#ccc").hide(),i.data(r).xScale(h).yScale(c).fontSize(a._fontSize).barCornerRadius(a._barCornerRadius).borderWidth(a._borderWidth).borderColor(a._borderColor).fillOpacity(a._fillOpacity).labelShow(a._labelShow).positionOptions(a._positionOptions).positionChoice(a._positionChoice).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).rectObj({xFunc:function(t,e){return 0<t.value||0==t.value?a.xScale(0):t.value<0?a.xScale(t.value):void 0},yFunc:function(t,e){return a.yScale.range()[0]-(e*f+(f-f*u)/2+f*u)},widthFunc:function(t){return 0<t.value||0==t.value?0<a.xScale(t.value)-a.xScale(0)?a.xScale(t.value)-a.xScale(0):0:t.value<0?0<a.xScale(0)-a.xScale(t.value)?a.xScale(0)-a.xScale(t.value):0:void 0},heightFunc:function(t){return f*u}}).textObj({xFunc:function(t,e){return a.xScale(t.value)},yFunc:function(t,e){return a.yScale.range()[0]-(e*f+(f-.9*f*u)/2+.7*f*u)},dyFunc:.5*f*u/2+a._textLabel.fontSize/3,colorFunc:function(){return a._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:a._textLabel.fontSize,fontFamily:a._textLabel.fontFamily,labelShow:a._labelShow}),a.coreGroup.call(G,a.yAxis.width+.5,0);var g=a.group.selectAll(".basic-horizontal-bar-chart .axis-y-horizontal .tick text").nodes().filter(function(t,e){return t.__data__=="$-"+e});d3.selectAll(g).remove(),n.update(),s.update(),i.updateHorizontalBar(),o.update(),a.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==y.length?0:d3.max(y))+",0 )"),a.group.selectAll(".bands-overlay").attr("transform","translate("+(0==y.length?0:d3.max(y))+",0 )"),a.group.selectAll(".selectOverlay-rect").attr("x",""+(0==y.length?0:d3.max(y)))}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);for(var _=[],d=[],f=0;f<e.activeData.length;f++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(_.push(0),d.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].value)||0==parseFloat(e.activeData[f].value)?d.push(E(e.activeData[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].value)<0&&_.push(E(e.activeData[f].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(_.push(0),d.push(0));n&&n.titleHeight;var y=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(y).compute(),n.compute();var p=(h-n.width-(0==_.length?0:d3.max(_))-(0==d.length?0:d3.max(d)))/t._tickValues.length,v=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),g=(t._tickShow?t._tickSize+t._tickPadding+(v<p?1.125*t._fontSize:t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-g,0]),n.compute(),i.range([0==_.length?0:d3.max(_),h-n.width-(0==d.length?0:d3.max(d))]),t.compute();var m=n.width,x=c-g,S=n.width;t.translate(m,x).update(),n.translate(S,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"computeDomain",value:function(){var t=this.activeData,e=((this._yRange||[]).slice().sort(d3.ascending),t.length?t.map(function(t){return t.name}):[0,1]),n=t.length?[1.1*Math.min(d3.min(t,function(t){return+t.value}),0),Math.max(1.1*d3.max(t,function(t){return+t.value}),0)]:[0,1];this._yDomain=e,this._xDomain=n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&(this.barWidthPercent=e.barWidthPercent?e.barWidthPercent:this.barWidthPercent,this.barCornerRadius=e.barCornerRadius?e.barCornerRadius:this.barCornerRadius,this.borderWidth=e.borderWidth?e.borderWidth:this.borderWidth,this.borderColor=e.borderColor?e.borderColor:this.borderColor,this.fillOpacity=e.fillOpacity?e.fillOpacity:this.fillOpacity)}}]),n}(),xi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,t=i._data,o=i.group;o.selectAll(".stackBars").remove();var e=o.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var n=d3.select(this).selectAll("rect").data(t.data);n.exit().remove(),n.enter().append("rect").attr("class","stackBars").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._strokeColor||t.color}).style("stroke-width",function(t){return i._strokeWidth||0}).attr("x",function(t,e){return i._xScale.step()*e+.25*i._xScale.step()}).attr("width",i._xScale.step()/2).attr("y",function(t){return i._yScale(0)}).attr("height",0).transition().duration(i._transition?i._duration:0).delay(i._transition?i._startDelay:0).attr("y",function(t){return 0<t.value||0==t.value?i._yScale(t.total):t.value<0?i._yScale(t.downtotal-t.value):void 0}).attr("height",function(t){return 0<t.value||0==t.value?0<i._yScale(0)-i._yScale(t.value)?i._yScale(0)-i._yScale(t.value):0:t.value<0?0<i._yScale(t.value)-i._yScale(0)?i._yScale(t.value)-i._yScale(0):0:void 0}),n.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackBarTexts").remove();var n=i._defs;n.selectAll("filter").remove();var a=n.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stackbar").attr("filterUnits","objectBoundingBox");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),a.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),a.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),a.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),a.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var r=o.append("g").selectAll("g").data(t);r.exit().remove(),r.enter().append("g").merge(r).each(function(t,e){var n=d3.select(this).append("g").attr("class","stackBarTexts").selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").merge(n).text(function(t){return 0==t.value?"":t.value}).attr("fill",i._textObj.colorFunc).attr("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return i._xScale.step()*e+.25*i._xScale.step()}).attr("y",function(t){if(null==i._positionOptions||null==i._positionChoice)return 0;if(0==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return i._yScale(t.total)+(i._yScale(0)-i._yScale(t.value))/2+.4*i._fontSize;if(t.value<0)return i._yScale(t.downtotal-t.value)+(i._yScale(t.value)-i._yScale(0))/2+.4*i._fontSize}else if(1==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return i._yScale(t.total)+(i._yScale(0)-i._yScale(t.value))-.2*i._fontSize;if(t.value<0)return i._yScale(t.downtotal-t.value)+(i._yScale(t.value)-i._yScale(0))-.2*i._fontSize}}).attr("text-anchor","middle").attr("dx",.25*i._xScale.step()).style("display",function(t){return i._labelShow&&t.textShow?"block":"none"}).style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+i._duration:0).style("opacity",1),0==i._labelShow||null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?o.selectAll(".stackBarTexts").style("display","none"):o.selectAll(".stackBarTexts").style("display","block")});for(var l=o.selectAll(".stackBarTexts text"),s=[],u=[],h=0;h<l._groups[0].length;h++){u.push(h);for(var c=h+1;c<l._groups[0].length;c++){ut(st(d3.select(l._groups[0][h])),st(d3.select(l._groups[0][c])))&&(s.push(h),d3.select(l._groups[0][h]).style("visibility","hidden"))}}for(var _=new Set(s),d=Array.from(_),f=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(d,u),y=0;y<d.length;y++){for(var p=[],v=0;v<f.length;v++){var g=st(d3.select(l._groups[0][d[y]])),m=st(d3.select(l._groups[0][f[v]]));if(p.push(ut(g,m)),ut(g,m)){if(d[y]==f[v])continue;d3.select(l._groups[0][d[y]]).style("visibility","hidden")}}0==p.filter(function(t){return 1==t}).length&&f.push(d[y])}for(var x=0;x<f.length;x++)d3.select(l._groups[0][f[x]]).style("visibility","visible");return i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),Si=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new xi(e.coreGroup),e.overlay=new zt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["内部居中","内部居下"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=0;t<(0==r.length?0:r[0].data.length);t++)for(var e=0;e<r.length;e++)parseFloat(r[e].data[t].value);for(var i=0;i<r.length;i++)for(var o=0;o<r[i].data.length;o++)0==i?0<r[i].data[o].value||0==r[i].data[o].value?(r[i].data[o].total=parseFloat(r[i].data[o].value),r[i].data[o].downtotal=0):r[i].data[o].value<0&&(r[i].data[o].downtotal=parseFloat(r[i].data[o].value),r[i].data[o].total=0):0<r[i].data[o].value||0==r[i].data[o].value?(r[i].data[o].total=r[i-1].data[o].total+parseFloat(r[i].data[o].value),r[i].data[o].downtotal=r[i-1].data[o].downtotal):r[i].data[o].value<0&&(r[i].data[o].total=r[i-1].data[o].total,r[i].data[o].downtotal=r[i-1].data[o].downtotal+parseFloat(r[i].data[o].value)),0<r[i].data[o].value||0==r[i].data[o].value?n.yScale(0)-n.yScale(r[i].data[o].value)<n._textLabel.fontSize?r[i].data[o].textShow=!1:r[i].data[o].textShow=!0:r[i].data[o].value<0&&(n.yScale(r[i].data[o].value-n.yScale(0))<n._textLabel.fontSize?r[i].data[o].textShow=!1:r[i].data[o].textShow=!0);var a=r,l=n.grid,s=n.tooltip,u=n.rectPlot,h=n.overlay,c=n.selectOverlay,_=n.clipArea,d=n.xScale,f=n.yScale,y=n.widthOfCore,p=n.heightOfCore,v=1.1*Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);v<0?(n.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")"),n.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(f.range()[0]-f(0))+")")):(n.group.selectAll(".stack-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),n.group.selectAll(".stack-bar-chart .axis-x-line line").attr("transform","translate(0,0)")),h.data(d.domain()).isScalePoint(!1).bandWidth(d.step()).bandHeight(p).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),s.data(o).update(),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+d(i)+",0)"),s.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){s.move([d3.event.offsetX,d3.event.offsetY]),c.show()}).onMouseout(function(){s.hide(),c.hide()}),u.data(a).xScale(d).yScale(f).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).defs(n.defs).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),l.width(y).height(p).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),c.width(d.step()).height(p).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)"),0!=n._clipShow.length?(_.width(y).height(p).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+_.id+")")):(_.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),_.update();var g=n.group.selectAll(".stack-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(g).remove(),u.update(),c.update(),h.update(),l.update(),v<0?(n.coreGroup.selectAll(".fake-x-line").remove(),n.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",d.range()[0]).attr("y1",f.range()[0]).attr("x2",d.range()[1]).attr("y2",f.range()[0]).attr("stroke","rgb(233, 233, 233)")):n.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var n=0;n<t[e].data.length;n++)0==e?0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=parseFloat(t[e].data[n].value),t[e].data[n].downtotal=0):t[e].data[n].value<0&&(t[e].data[n].downtotal=parseFloat(t[e].data[n].value),t[e].data[n].total=0):0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=t[e-1].data[n].total+parseFloat(t[e].data[n].value),t[e].data[n].downtotal=t[e-1].data[n].downtotal):t[e].data[n].value<0&&(t[e].data[n].total=t[e-1].data[n].total,t[e].data[n].downtotal=t[e-1].data[n].downtotal+parseFloat(t[e].data[n].value));var i=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),1.1*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total+1})}),0)]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(i[0]))?a[0]:parseFloat(i[0]),isNaN(parseFloat(i[1]))?isNaN(parseFloat(i[0]))?a[1]:a[1]<i[0]?1.5*i[0]:a[1]:parseFloat(i[1])]}}]),n}(),ki=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,t=i._data,o=i.group;o.selectAll(".stackHorizontalBar").remove();var e=o.append("g").selectAll("g").data(t);e.exit().remove(),e.enter().append("g").merge(e).each(function(t,e){var n=d3.select(this).selectAll("rect").data(t.data);n.exit().remove(),n.enter().append("rect").attr("class","stackHorizontalBar").merge(n).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._strokeColor||t.color}).style("stroke-width",function(t){return i._strokeWidth||0}).attr("y",function(t,e){return i._yScale(t.name)+i._yScale.step()*(1-i._barWidthPercent)/2}).attr("x",function(t){return i._xScale(0)}).attr("height",i._yScale.step()*i._barWidthPercent).attr("width",0).transition().duration(i._transition?.9*i._duration:0).attr("x",function(t){return 0<t.value||0==t.value?i._xScale(t.total-t.value):t.value<0?i._xScale(t.downtotal):void 0}).attr("width",function(t){return 0<t.value||0==t.value?Math.abs(i._xScale(0)-i._xScale(t.value)):t.value<0?Math.abs(i._xScale(t.value)-i._xScale(0)):void 0}),n.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o.selectAll(".stackHorizontalBarTexts").remove();var n=o.append("g").selectAll("g").data(t);n.exit().remove(),n.enter().append("g").merge(n).each(function(t,e){var n=d3.select(this).append("g").attr("class","stackHorizontalBarTexts").selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").merge(n).text(function(t){return 0==t.value?"":t.value}).attr("fill",i._textObj.colorFunc).attr("font-size",i._fontSize).style("font-family",i._fontFamily).attr("text-anchor","start").attr("y",function(t,e){return i._yScale(t.name)+.75*i._yScale.step()}).attr("x",function(t,e){if(null==i._labelShow||null==i._positionOptions||null==i._positionChoice)return 0;if(1==i._positionOptions.indexOf(i._positionChoice)){if(0<t.value||0==t.value)return i._xScale(t.total-t.value)+.3*i._fontSize;if(t.value<0)return i._xScale(t.downtotal)+.3*i._fontSize}else if(0==i._positionOptions.indexOf(i._positionChoice)){if(d3.selectAll(".stackHorizontalBarTexts text").attr("text-anchor","middle"),0<t.value||0==t.value)return i._xScale(t.total-t.value)+Math.abs(i._xScale(0)-i._xScale(t.value))/2;if(t.value<0)return i._xScale(t.downtotal)+Math.abs(i._xScale(t.value)-i._xScale(0))/2}}).attr("dy",-(i._yScale.step()/4-i._fontSize/2.7)).style("display",i._labelShow?"block":"none").style("opacity",0).transition().duration(i._transition?.1*i._duration:0).delay(i._transition?i._startDelay+i._duration:0).style("opacity",1),null!=i._labelShow&&null!=i._positionOptions&&null!=i._positionChoice&&-1!=i._positionOptions.indexOf(i._positionChoice)||o.selectAll(".stackHorizontalBarTexts").style("display","none")});for(var a=o.selectAll(".stackHorizontalBarTexts text"),r=[],l=[],s=0;s<a._groups[0].length;s++){l.push(s);for(var u=s+1;u<a._groups[0].length;u++){ut(st(d3.select(a._groups[0][s])),st(d3.select(a._groups[0][u])))&&(r.push(s),d3.select(a._groups[0][s]).style("visibility","hidden"))}}for(var h=new Set(r),c=Array.from(h),_=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(c,l),d=0;d<c.length;d++){for(var f=[],y=0;y<_.length;y++){var p=st(d3.select(a._groups[0][c[d]])),v=st(d3.select(a._groups[0][_[y]]));if(f.push(ut(p,v)),ut(p,v)){if(c[d]==_[y])continue;d3.select(a._groups[0][c[d]]).style("visibility","hidden")}}0==f.filter(function(t){return 1==t}).length&&_.push(c[d])}for(var g=0;g<_.length;g++)d3.select(a._groups[0][_[g]]).style("visibility","visible");return i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=parseFloat(t),this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return ar}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"barWidthPercent",value:function(t){return arguments.length?(this._barWidthPercent=t,this):this._barWidthPercent}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),bi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-horizontal-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new ki(e.coreGroup),e.overlay=new zt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=1,e._yScaleHeight=1.05,e._labelShow=!1,e._barWidthPercent=.5,e._positionOptions=["内部居中","内部居左"],e._positionChoice="内部居中",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,a=n.activeData,t=0;t<(0==a.length?0:a[0].data.length);t++)for(var e=0;e<a.length;e++)parseFloat(a[e].data[t].value);for(var i=0;i<a.length;i++)for(var o=0;o<a[i].data.length;o++)0==i?0<a[i].data[o].value||0==a[i].data[o].value?(a[i].data[o].total=parseFloat(a[i].data[o].value),a[i].data[o].downtotal=0):a[i].data[o].value<0&&(a[i].data[o].downtotal=parseFloat(a[i].data[o].value),a[i].data[o].total=0):0<a[i].data[o].value||0==a[i].data[o].value?(a[i].data[o].total=a[i-1].data[o].total+parseFloat(a[i].data[o].value),a[i].data[o].downtotal=a[i-1].data[o].downtotal):a[i].data[o].value<0&&(a[i].data[o].total=a[i-1].data[o].total,a[i].data[o].downtotal=a[i-1].data[o].downtotal+parseFloat(a[i].data[o].value));var r=n.defs;r.selectAll("filter").remove();var l=r.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stackHorizontalBar").attr("filterUnits","objectBoundingBox");l.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),l.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),l.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),l.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),l.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var s=a,u=n.grid,h=n.tooltip,c=n.rectPlot,_=n.overlay,d=n.selectOverlay,f=n.clipArea,y=n.xScale,p=n.yScale,v=n.widthOfCore,g=n.heightOfCore,m=1.1*Math.min(d3.min(a,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0);m<0?(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+-(y.range()[0]-y(0))+",0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+-(y.range()[0]-y(0))+",0)")):(d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,0)")),_.data(p.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(v).bandHeight(p.step()).onMouseover(function(t,e){var i=p.domain()[p.domain().length-e-1==-1?1:p.domain().length-e-1==-2?0:p.domain().length-e-1],o=[{text:i=="&-"+(p.domain().length-e)?"":i}];i&&1!=i&&(a.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+p(i)+")")),h.data(o).update(),h.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){h.move([d3.event.offsetX,d3.event.offsetY]),d.show()}).onMouseout(function(){h.hide(),d.hide()}),c.data(s).xScale(y).yScale(p).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).barWidthPercent(n._barWidthPercent).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),u.width(v).height(g).xTickLocations(n.xAxis.tickLocations).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),d.width(v).height(p.step()).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)"),0!=n._clipShow.length?f.width(v).height(g).paddingVertical([0,0]).transition(n._transition).duration(n._duration):f.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+f.id+")"),f.update();var x=n.group.selectAll(".stack-horizontal-bar-chart .axis-y-horizontal .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(x).remove(),c.update(),d.update(),_.update(),u.update(),m<0?(n.coreGroup.selectAll(".fake-y-line").remove(),this.coreGroup.append("g").attr("class","fake-y-line").append("line").attr("x1",y.range()[0]).attr("y1",p.range()[0]).attr("x2",y.range()[0]).attr("y2",p.range()[1]).attr("stroke","rgb(233, 233, 233)")):n.coreGroup.selectAll(".fake-y-line").remove()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);n&&n.titleHeight;var _=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(_).compute(),n.compute();var d=(h-n.width)/t._tickValues.length,f=d3.max(t._tickValues,function(t){return E(t,u,e._fontFamily)}),y=(t._tickShow?t._tickSize+t._tickPadding+(f<.8*d?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-y,0]),i.range([0,h-n.width]),t.compute();var p=n.width,v=c-y,g=n.width;t.translate(p,v).update(),n.translate(g,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var n=0;n<t[e].data.length;n++)0==e?0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=parseFloat(t[e].data[n].value),t[e].data[n].downtotal=0):t[e].data[n].value<0&&(t[e].data[n].downtotal=parseFloat(t[e].data[n].value),t[e].data[n].total=0):0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=t[e-1].data[n].total+parseFloat(t[e].data[n].value),t[e].data[n].downtotal=t[e-1].data[n].downtotal):t[e].data[n].value<0&&(t[e].data[n].total=t[e-1].data[n].total,t[e].data[n].downtotal=t[e-1].data[n].downtotal+parseFloat(t[e].data[n].value));var i=this._xRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),Math.max(1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),0)]:[0,1];this._xDomain=[isNaN(parseFloat(i[0]))?a[0]:parseFloat(i[0]),isNaN(parseFloat(i[1]))?isNaN(parseFloat(i[0]))?a[1]:a[1]<i[0]?1.5*i[0]:a[1]:parseFloat(i[1])],this._yDomain=o}}]),n}(),wi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","grouped-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){for(var o=this,a=o._data,t=[],e=0;e<a.length;e++)for(var n=0;n<a[e].data.length;n++)t.push(Number(a[e].data[n].value));var r=ht(t,o._fontSize,o._fontFamily),l=o.group;l.selectAll(".group-bar-rects").remove(),l.selectAll(".group-bar-texts").remove();var i=l.append("g").selectAll("g").data(a,function(t){return t.name});i.exit().remove(),i.enter().append("g").merge(i).each(function(t,n){var i=2*o._xScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","group-bar-rects").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return(i/a.length+(3<a.length||1==a.length?0:1))*n+i/4+o._xScale.step()*e}).attr("width",0<i/a.length?i/a.length:0).attr("y",o._yScale(0)).attr("height",0).transition().duration(o._transition?.9*o._duration:0).attr("y",function(t){return t.value<0?o._yScale(0):0<t.value?o._yScale(t.value):void 0}).attr("height",function(t){return t.value<0?o._yScale(t.value)-o._yScale(0)<0?0:o._yScale(t.value)-o._yScale(0):0<t.value?o._yScale(0)-o._yScale(t.value)<0?0:o._yScale(0)-o._yScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var s=2*o._xScale.step()/3,u=0<s/a.length?s/a.length:0,h=l.append("g").selectAll("g").data(a,function(t){return t.name});if(h.exit().remove(),h.enter().append("g").merge(h).each(function(t,n){var e=d3.select(this).attr("class","groupedBarTexts").selectAll("text").data(t.data);e.exit().remove();var i=e.enter().append("text").attr("class","group-bar-texts").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",o._textObj.colorFunc).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return(s/a.length+(3<a.length||1==a.length?0:1))*n+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==o._positionOptions||null==o._positionChoice?o._yScale(t.value):0==o._positionOptions.indexOf(o._positionChoice)?t.value<0?o._yScale(t.value)+1.05*o._fontSize:o._yScale(t.value)-.3*o._fontSize:1==o._positionOptions.indexOf(o._positionChoice)?0<t.value?o._yScale(0)-.3*o._fontSize:o._yScale(t.value)-.3*o._fontSize:void 0}).style("display",o._labelShow?"block":"none");null==o._positionOptions||null==o._positionChoice||u<r&&1==o._positionOptions.indexOf(o._positionChoice)&&i.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+((s/a.length+(3<a.length||1==a.length?0:1))*n+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2||0)+"\n                         "+(o._yScale(t.value)+o._yScale(0)-o._yScale(t.value)-.65*o._fontSize)+" )":"rotate(-90 "+((s/a.length+(3<a.length||1==a.length?0:1))*n+s/4+o._xScale.step()*e+(0<s/a.length?s/a.length:0)/2||0)+"\n                         "+(o._yScale(t.value)-.65*o._fontSize)+" )"}).attr("text-anchor","start"),i.style("opacity",0).transition().duration(o._transition?.1*o._duration:0).delay(o._transition?.9*o._duration:0).style("opacity",1),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice)?l.selectAll(".groupedBarTexts").style("display","none"):l.selectAll(".groupedBarTexts").style("display","block")}),null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice))l.selectAll(".groupedBarTexts").style("display","none");else if(u<r&&1==o._positionOptions.indexOf(o._positionChoice)){for(var c=l.selectAll(".group-bar-texts"),_=[],d=[],f=0;f<c._groups[0].length;f++){d.push(f);for(var y=f+1;y<c._groups[0].length;y++){var p=st(d3.select(c._groups[0][f])),v=st(d3.select(c._groups[0][y])),g=p.width;p.width=p.height,p.height=g;var m=v.width;v.width=v.height,v.height=m,ut(p,v)&&(_.push(f),d3.select(c._groups[0][f]).style("visibility","hidden"))}}for(var x=new Set(_),S=Array.from(x),k=H(S,d),b=0;b<S.length;b++){for(var w=[],F=0;F<k.length;F++){var O=st(d3.select(c._groups[0][S[b]])),C=st(d3.select(c._groups[0][k[F]])),A=O.width;O.width=O.height,O.height=A;var P=C.width;if(C.width=C.height,C.height=P,w.push(ut(O,C)),ut(O,C)){if(S[b]==k[F])continue;d3.select(c._groups[0][S[b]]).style("visibility","hidden")}}0==w.filter(function(t){return 1==t}).length&&k.push(S[b])}for(var z=0;z<k.length;z++)d3.select(c._groups[0][k[z]]).style("visibility","visible")}else{for(var D=l.selectAll(".group-bar-texts"),L=[],M=[],W=0;W<D._groups[0].length;W++){M.push(W);for(var R=W+1;R<D._groups[0].length;R++){ut(st(d3.select(D._groups[0][W])),st(d3.select(D._groups[0][R])))&&(L.push(W),d3.select(D._groups[0][W]).style("visibility","hidden"))}}for(var N=new Set(L),T=Array.from(N),j=H(T,M),Y=0;Y<T.length;Y++){for(var X=[],B=0;B<j.length;B++){var G=st(d3.select(D._groups[0][T[Y]])),E=st(d3.select(D._groups[0][j[B]]));if(X.push(ut(G,E)),ut(G,E)){if(T[Y]==j[B])continue;d3.select(D._groups[0][T[Y]]).style("visibility","hidden")}}0==X.filter(function(t){return 1==t}).length&&j.push(T[Y])}for(var I=0;I<j.length;I++)d3.select(D._groups[0][j[I]]).style("visibility","visible")}function H(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}return o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Fi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","grouped-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new wi(e.coreGroup),e.overlay=new zt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=r,e=n.grid,l=n.tooltip,i=n.rectPlot,o=n.overlay,a=n.selectOverlay,s=n.clipArea,u=n.xScale,h=n.yScale,c=n.widthOfCore,_=n.heightOfCore,d=1.1*Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);d<0?(n.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),n.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(n.group.selectAll(".grouped-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),n.group.selectAll(".grouped-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var f=n.defs;f.selectAll("filter").remove();var y=f.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupBar").attr("filterUnits","objectBoundingBox");y.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),y.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),y.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),y.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),y.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),l.data(o).update(),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+u(i)+",0)"),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),a.show()}).onMouseout(function(){l.hide(),a.hide()}),i.data(t).xScale(u).yScale(h).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),e.width(c).height(_).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),s.width(c).height(_).paddingVertical([0,0]).transition(n._transition).duration(n._duration),a.width(u.step()).height(_).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)"),0!=n._clipShow.length?(s.width(c).height(_).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+s.id+")")):(s.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),s.update();var p=n.group.selectAll(".grouped-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),i.update(),a.update(),o.update(),e.update(),d<0?(n.coreGroup.selectAll(".fake-x-line").remove(),n.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",u.range()[0]).attr("y1",h.range()[0]).attr("x2",u.range()[1]).attr("y2",h.range()[0]).attr("stroke","rgb(233, 233, 233)")):n.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=t.length?t[0].data.map(function(t){return t.name}):[0,1],i=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}}]),n}(),Oi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var g=this,m=g._data,x=g.group;x.selectAll(".groupedHoizontalBar").remove(),x.selectAll(".groupedHoizontalBarTexts").remove();var t=x.selectAll("g").data(m);t.exit().remove(),t.enter().append("g").merge(t).each(function(t,n){var i=2*g._yScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","groupedHoizontalBar").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return g._fillOpacity}).style("stroke",function(t){return g._strokeColor||t.color}).style("stroke-width",function(t){return g._strokeWidth||0}).attr("y",function(t,e){return Math.abs(g._yScale.range()[0]-g._yScale.range()[1])-((i/m.length+(3<m.length||1==m.length?0:1))*n+i/4+g._yScale.step()*e)-(0<i/m.length?i/m.length:0)}).attr("x",function(t){return g._xScale(0)}).attr("height",0<i/m.length?i/m.length:0).attr("width",0).transition().duration(g._transition?.9*g._duration:0).attr("x",function(t){return 0<t.value?g._xScale(0):t.value<0?g._xScale(t.value):void 0}).attr("width",function(t){return 0<t.value?g._xScale(t.value)-g._xScale(0)<0?0:g._xScale(t.value)-g._xScale(0):t.value<0?g._xScale(0)-g._xScale(t.value)<0?0:g._xScale(0)-g._xScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var e=x.append("g").selectAll("g").data(m);return e.exit().remove(),e.enter().append("g").merge(e).each(function(t,n){var i=2*g._yScale.step()/3,e=d3.select(this).append("g").attr("class","groupedHoizontalBarTexts").selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",g._textObj.colorFunc).attr("font-size",g._fontSize).style("font-family",g._fontFamily).attr("text-anchor","start").attr("x",function(t){return 0<t.value?g._xScale(0):t.value<0?g._xScale(t.value):void 0}).attr("y",function(t,e){return Math.abs(g._yScale.range()[0]-g._yScale.range()[1])-((i/m.length+(3<m.length||1==m.length?0:1))*n+i/4+g._yScale.step()*e)-(0<i/m.length?i/m.length:0)}).attr("dy",(0<i/m.length?i/m.length:0)/2+g._fontSize/3).attr("dx",function(t,e){if(null==g._positionOptions||null==g._positionChoice)return 0;if(0==g._positionOptions.indexOf(g._positionChoice)){if(0<t.value)return g._xScale(t.value)-g._xScale(0)+.3*g._fontSize;if(t.value<0)return.3*-g._fontSize}else if(1==g._positionOptions.indexOf(g._positionChoice)){if(0<t.value)return.3*g._fontSize;if(t.value<0)return g._xScale(0)-g._xScale(t.value)-.3*g._fontSize}else if(2==g._positionOptions.indexOf(g._positionChoice)){if(t.value<0)return.3*g._fontSize+E(t.value,g._fontSize,g._fontFamily);if(0<t.value)return(g._xScale(t.value)-g._xScale(0)<0?0:g._xScale(t.value)-g._xScale(0))-E(t.value,g._fontSize,g._fontFamily)-.3*g._fontSize}}).style("display",g._labelShow?"block":"none").style("opacity",0).transition().duration(g._transition?.1*g._duration:0).delay(g._transition?.9*g._duration:0).style("opacity",1),d3.selectAll(x.selectAll(".groupedHoizontalBarTexts text").nodes().filter(function(t){return t.__data__.value<0})).attr("text-anchor","end"),null!=g._labelShow&&0!=g._labelShow&&null!=g._positionOptions&&null!=g._positionChoice&&-1!=g._positionOptions.indexOf(g._positionChoice)||x.selectAll(".groupedHoizontalBarTexts").style("display","none");for(var o=x.selectAll(".groupedHoizontalBarTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){ut(st(d3.select(o._groups[0][l])),st(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("visibility","hidden"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(o._groups[0][h[_]])),p=st(d3.select(o._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("visibility","hidden")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(o._groups[0][c[v]]).style("visibility","visible")}),g}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ci=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","grouped-horizontal-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new Oi(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["右边","内部居左","内部居右"],e._positionChoice="内部居右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,a=n.activeData,t=a,e=n.grid,r=n.tooltip,i=n.rectPlot,o=n.overlay,l=n.selectOverlay,s=n.xScale,u=n.yScale,h=n.widthOfCore,c=n.heightOfCore,_=d3.min(a,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],f=[],y=0;y<n.activeData.length;y++)for(var p=0;p<n.activeData[y].data.length;p++)null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?(f.push(0),d.push(0)):1==n._labelShow&&0==n._positionOptions.indexOf(n._positionChoice)?0<parseFloat(n.activeData[y].data[p].value)||0==parseFloat(n.activeData[y].data[p].value)?d.push(E(n.activeData[y].data[p].value,n._textLabel.fontSize,n._textLabel.fontFamily)):parseFloat(n.activeData[y].data[p].value)<0&&f.push(E(n.activeData[y].data[p].value,n._textLabel.fontSize,n._textLabel.fontFamily)):(f.push(0),d.push(0));_<0?(d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)"),d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+","+-u.step()/2+")")):(d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".grouped-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")"));var v=n.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupHorizontal").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var i=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],o=[{text:i=="&-"+(u.domain().length-e)?"":i}];i&&1!=i&&(a.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+u(i)+")")),r.data(o).update(),r.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.move([d3.event.offsetX,d3.event.offsetY]),l.show()}).onMouseout(function(){r.hide(),l.hide()}),i.data(t).xScale(s).yScale(u).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),e.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(n.xAxis.tickLocations).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),l.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)");var m=n.group.selectAll(".grouped-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(m).remove(),i.update(),l.update(),o.update(),e.update(),n.group.selectAll(".selectOverlay-rect").attr("x",""+(0==f.length?0:d3.max(f))),n.group.selectAll(".bands-overlay").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),n.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )")}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);n&&n.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],f=0;f<e.activeData.length;f++)for(var y=0;y<e.activeData[f].data.length;y++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].data[y].value)||0==parseFloat(e.activeData[f].data[y].value)?_.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].data[y].value)<0&&d.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var p=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(p).compute(),n.compute();var v=Math.abs(0==d.length?0:d3.max(d)-(h-n.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,g=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(g<.8*v?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),n.compute(),i.range([0==d.length?0:d3.max(d),h-n.width-(0==_.length?0:d3.max(_))]),t.compute();var x=n.width,S=c-m,k=n.width;t.translate(x,S).update(),n.translate(k,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),n=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=n,this._yDomain=e}}]),n}(),Ai=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","negative-horizontal-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var g=this,m=g._data,x=g.group;x.selectAll(".negativeHoizontalBar").remove(),x.selectAll(".negativeHoizontalBarTexts").remove();var t=x.selectAll("g").data(m);t.exit().remove(),t.enter().append("g").merge(t).each(function(t,n){var i=2*g._yScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").attr("class","negativeHoizontalBar").merge(e).style("fill",function(t){return t.color}).style("fill-opacity",function(t){return g._fillOpacity}).style("stroke",function(t){return g._strokeColor||t.color}).style("stroke-width",function(t){return g._strokeWidth||0}).attr("y",function(t,e){return Math.abs(g._yScale.range()[0]-g._yScale.range()[1])-((i/m.length+(3<m.length||1==m.length?0:1))*n+i/4+g._yScale.step()*e)-(0<i/m.length?i/m.length:0)}).attr("x",function(t){return g._xScale(0)}).attr("height",0<i/m.length?i/m.length:0).attr("width",0).transition().duration(g._transition?.9*g._duration:0).attr("x",function(t){return 0<t.value?g._xScale(0):t.value<0?g._xScale(t.value):void 0}).attr("width",function(t){return 0<t.value?g._xScale(t.value)-g._xScale(0)<0?0:g._xScale(t.value)-g._xScale(0):t.value<0?g._xScale(0)-g._xScale(t.value)<0?0:g._xScale(0)-g._xScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)});var e=x.append("g").selectAll("g").data(m);return e.exit().remove(),e.enter().append("g").merge(e).each(function(t,n){var i=2*g._yScale.step()/3,e=d3.select(this).append("g").attr("class","negativeHoizontalBarTexts").selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",g._textObj.colorFunc).attr("font-size",g._fontSize).style("font-family",g._fontFamily).attr("text-anchor","start").attr("x",function(t){return 0<t.value?g._xScale(0):t.value<0?g._xScale(t.value):void 0}).attr("y",function(t,e){return Math.abs(g._yScale.range()[0]-g._yScale.range()[1])-((i/m.length+(3<m.length||1==m.length?0:1))*n+i/4+g._yScale.step()*e)-(0<i/m.length?i/m.length:0)}).attr("dy",(0<i/m.length?i/m.length:0)/2+g._fontSize/3).attr("dx",function(t,e){if(null==g._positionOptions||null==g._positionChoice)return 0;if(0==g._positionOptions.indexOf(g._positionChoice)){if(0<t.value)return g._xScale(t.value)-g._xScale(0)+.3*g._fontSize;if(t.value<0)return.3*-g._fontSize}else if(1==g._positionOptions.indexOf(g._positionChoice)){if(0<t.value)return.3*g._fontSize;if(t.value<0)return g._xScale(0)-g._xScale(t.value)-.3*g._fontSize}}).style("display",g._labelShow?"block":"none").style("opacity",0).transition().duration(g._transition?.1*g._duration:0).delay(g._transition?.9*g._duration:0).style("opacity",1),d3.selectAll(x.selectAll(".negativeHoizontalBarTexts text").nodes().filter(function(t){return t.__data__.value<0})).attr("text-anchor","end"),null!=g._labelShow&&0!=g._labelShow&&null!=g._positionOptions&&null!=g._positionChoice&&-1!=g._positionOptions.indexOf(g._positionChoice)||d3.selectAll(".negativeHoizontalBarTexts").style("display","none");for(var o=x.selectAll(".negativeHoizontalBarTexts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){ut(st(d3.select(o._groups[0][l])),st(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("visibility","hidden"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(o._groups[0][h[_]])),p=st(d3.select(o._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("visibility","hidden")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(o._groups[0][c[v]]).style("visibility","visible")}),g}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Pi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","negative-horizontal-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new Ai(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["外部","内部"],e._positionChoice="外部",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,a=n.activeData,t=a,e=n.grid,r=n.tooltip,i=n.rectPlot,o=n.overlay,l=n.selectOverlay,s=n.xScale,u=n.yScale,h=n.widthOfCore,c=n.heightOfCore,_=d3.min(a,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],f=[],y=0;y<n.activeData.length;y++)for(var p=0;p<n.activeData[y].data.length;p++)null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?(f.push(0),d.push(0)):1==n._labelShow&&0==n._positionOptions.indexOf(n._positionChoice)?0<parseFloat(n.activeData[y].data[p].value)||0==parseFloat(n.activeData[y].data[p].value)?d.push(E(n.activeData[y].data[p].value,n._textLabel.fontSize,n._textLabel.fontFamily)):parseFloat(n.activeData[y].data[p].value)<0&&f.push(E(n.activeData[y].data[p].value,n._textLabel.fontSize,n._textLabel.fontFamily)):(f.push(0),d.push(0));_<0?(d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)"),d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+","+-u.step()/2+")")):(d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".negative-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,"+-u.step()/2+")"));var v=n.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_negativeHorizontal").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var i=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],o=[{text:i=="&-"+(u.domain().length-e)?"":i}];i&&1!=i&&(a.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),n.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+u(i)+")")),r.data(o).update(),r.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.move([d3.event.offsetX,d3.event.offsetY]),l.show()}).onMouseout(function(){r.hide(),l.hide()}),i.data(t).xScale(s).yScale(u).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).contentOption(n._contentOption).contentChoice(n._contentChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).textObj({colorFunc:function(){return n._textLabel.color}}).fillOpacity(1),e.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(n.xAxis.tickLocations).yTickLocations(n.yAxis.tickLocations).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),l.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),n.coreGroup.attr("transform","translate("+n.yAxis.width+",0)");var m=n.group.selectAll(".negative-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(m).remove(),i.update(),l.update(),o.update(),e.update(),n.group.selectAll(".selectOverlay-rect").attr("x",""+(0==f.length?0:d3.max(f))),n.group.selectAll(".bands-overlay").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),n.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),_<0?(n.coreGroup.selectAll(".fake-y-line").remove(),this.coreGroup.append("g").attr("class","fake-y-line").append("line").attr("x1",s.range()[0]-(0==f.length?0:d3.max(f))).attr("y1",u.range()[0]).attr("x2",s.range()[0]-(0==f.length?0:d3.max(f))).attr("y2",u.range()[1]).attr("stroke","rgb(233, 233, 233)")):n.coreGroup.selectAll(".fake-y-line").remove()}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);n&&n.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],f=0;f<e.activeData.length;f++)for(var y=0;y<e.activeData[f].data.length;y++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].data[y].value)||0==parseFloat(e.activeData[f].data[y].value)?_.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].data[y].value)<0&&d.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var p=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(p).compute(),n.compute();var v=Math.abs(0==d.length?0:d3.max(d)-(h-n.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,g=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(g<.8*v?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),n.compute(),i.range([0==d.length?0:d3.max(d),h-n.width-(0==_.length?0:d3.max(_))]),t.compute();var x=n.width,S=c-m,k=n.width;t.translate(x,S).update(),n.translate(k,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=_;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t[0].data.map(function(t){return t.name}):[0,1]),n=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=n,this._yDomain=e}}]),n}(),zi="axis-group",Di="y-mix-title",Li=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-y-mix"),e._orient="left",e._type="number",e._allowedMaxTextWidth=100,e._tickTextWidth=0,e._tickPadding=2,e}return h(n,ft),s(n,[{key:"update",value:function(){var n=this,i=n._orient,t=n._scaleFunc,e=n.group,o=n._fontSize,a=n._tickValueTexts,r=void 0;r=n.axisFunc="right"===i?d3.axisRight(t):d3.axisLeft(t);var l=null;"number"===n._type&&n._tickValues.every(function(t){return 0===Math.abs(t)||1<Math.abs(t)})&&(l=d3.format("d")),r.tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding).tickFormat(l),e.select(".axis-group").remove();var s=e.select("."+zi).empty()?e.append("g").attr("class",zi):e.select("."+zi);s.transition().duration(n._transition?n._duration:0).call(r).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dx",function(t,e){return"left"==i?.6*-o:"right"==i?.6*o:void 0}).attr("dy",.4*o).text(function(t,e){return a[e]+(n._unit?n._unit:"")}),s.selectAll(".tick line").style("stroke",n._lineStroke).style("display","none"),s.select("path").style("stroke",n._lineStroke).style("display","none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(n._titleShow&&n._title){var h=e.select("."+Di).empty()?e.append("g").attr("class",Di):e.select("."+Di),c=h.select("text").empty()?h.append("text"):h.select("text");E(n._title,o,n._fontFamily);h.call(G,-(this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0),u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("transform","rotate(-90)").style("text-anchor","middle").text(n._title),"second"==n._times&&(h.call(G,this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth:0,u/2),c.attr("y",-7).style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("transform","rotate(90)").style("text-anchor","middle").text(n._title))}else e.select("."+Di).remove()}},{key:"compute",value:function(){var e=this,t=[],n=[],i=0;var o=e._scaleFunc,a=e._type,r=e._fontSize,l=(e._minTickDistance,e._allowedMaxTextWidth);t="category"===a?o.domain():o.ticks(e._tickCount);for(var s=0;s<t.length;s++)t[s]=t[s]+(e._unit?e._unit:"");var u=d3.max(t,function(t){return E(t,r,e._fontFamily)});return t="category"===a?o.domain():o.ticks(e._tickCount),u<=l?(n=t,i=u):(n=t.map(function(t){return I(t,l,r,e._fontFamily)}),i=l),e._tickValues=t,e._tickValueTexts=n,e._tickTextWidth=i,e}},{key:"unit",value:function(t){return arguments.length?(this._unit=t,this):this._unit}},{key:"times",value:function(t){return arguments.length?(this._times=t,this):this._times}},{key:"allowedMaxTextWidth",value:function(t){return arguments.length?(this._allowedMaxTextWidth=t,this):this._allowedMaxTextWidth}},{key:"width",get:function(){var t=0;return this.isShow&&(t=this._tickShow?this._tickSize+this._tickPadding+this._tickTextWidth+(this._title?1.125*this._fontSize+24+3:0):this._titleShow&&this._title?1.125*this._fontSize+24+3:0),t}}]),n}(),Mi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","mix-line-bar-rect"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){for(var o=this,a=o._data,t=[],e=0;e<a.length;e++)for(var n=0;n<a[e].data.length;n++)t.push(Number(a[e].data[n].value));ht(t,o._fontSize,o._fontFamily);var i=o.group;i.selectAll("g").remove();var r=i.append("g").selectAll("g").data(a,function(t){return t.name});return r.exit().remove(),r.enter().append("g").attr("class","mix-line-bar-bar-rects").merge(r).each(function(t,n){var i=2*o._xScale.step()/3,e=d3.select(this).selectAll("rect").data(t.data);e.exit().remove(),e.enter().append("rect").merge(e).style("fill",function(t){return o._fillColor||t.color}).style("fill-opacity",function(t){return o._fillOpacity}).style("stroke",function(t){return o._strokeColor||t.color}).style("stroke-width",function(t){return o._strokeWidth||0}).attr("x",function(t,e){return(i/a.length+(3<a.length||1==a.length?0:1))*n+i/4+o._xScale.step()*e}).attr("width",0<i/a.length?i/a.length:0).attr("y",o._yScale(0)).attr("height",0).transition().duration(o._transition?.9*o._duration:0).attr("y",function(t){return t.value<0?o._yScale(0):0<t.value?o._yScale(t.value):void 0}).attr("height",function(t){return t.value<0?o._yScale(t.value)-o._yScale(0)<0?0:o._yScale(t.value)-o._yScale(0):0<t.value?o._yScale(0)-o._yScale(t.value)<0?0:o._yScale(0)-o._yScale(t.value):void 0}),e.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout)}),o}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Wi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","mix-line-bar-text"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e}return h(n,P),s(n,[{key:"update",value:function(){for(var r=this,l=r._data,t=[],e=0;e<l.length;e++)for(var n=0;n<l[e].data.length;n++)t.push(Number(l[e].data[n].value));var s=ht(t,r._fontSize,r._fontFamily),u=r.group;u.selectAll("g").remove(),u.append("g").selectAll("g").data(l,function(t){return t.name}).exit().remove();var i=u.append("g").selectAll("g").data(l,function(t){return t.name});return i.exit().remove(),i.enter().append("g").merge(i).each(function(t,n){var i=2*r._xScale.step()/3,e=d3.select(this).attr("class","mixLineBarTexts").selectAll("text").data(t.data);e.exit().remove();var o=e.enter().append("text").attr("class","mix-line-bar-texts").merge(e).text(function(t){return 0==t.value?"":t.value}).attr("fill",r._textObj.colorFunc).style("font-size",r._fontSize).style("font-family",r._fontFamily).attr("x",function(t,e){return(i/l.length+(3<l.length||1==l.length?0:1))*n+i/4+r._xScale.step()*e+(0<i/l.length?i/l.length:0)/2}).attr("text-anchor","middle").attr("y",function(t){return null==r._positionOptions||null==r._positionChoice?r._yScale(t.value):0==r._positionOptions.indexOf(r._positionChoice)?t.value<0?r._yScale(0)-.3*r._fontSize:r._yScale(t.value)-.3*r._fontSize:1==r._positionOptions.indexOf(r._positionChoice)?(r._yScale(0)+r._yScale(t.value))/2+.35*r._fontSize:2==r._positionOptions.indexOf(r._positionChoice)?0<t.value?r._yScale(0)-.3*r._fontSize:r._yScale(t.value)-.3*r._fontSize:void 0}).style("display",r._labelShow?"block":"none").style("opacity",0).transition().duration(r._transition?.1*r._duration:0).delay(r._transition?r._startDelay+.9*r._duration:0).style("opacity",1),a=0<i/l.length?i/l.length:0;null==r._positionOptions||null==r._positionChoice||a<s&&2==r._positionOptions.indexOf(r._positionChoice)&&o.attr("transform",function(t,e){return 0<t.value?"rotate(-90 "+((i/l.length+(3<l.length||1==l.length?0:1))*n+i/4+r._xScale.step()*e+(0<i/l.length?i/l.length:0)/2||0)+"\n                         "+(r._yScale(t.value)+r._yScale(0)-r._yScale(t.value)-.65*r._fontSize)+" )":"rotate(-90 "+((i/l.length+(3<l.length||1==l.length?0:1))*n+i/4+r._xScale.step()*e+(0<i/l.length?i/l.length:0)/2||0)+"\n                         "+(r._yScale(t.value)-.65*r._fontSize)+" )"}).attr("text-anchor","start"),0==r._labelShow||null==r._labelShow||null==r._positionOptions||null==r._positionChoice?u.selectAll(".mixLineBarTexts").style("display","none"):u.selectAll(".mixLineBarTexts").style("display","block")}),r}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ri=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","axis-tooltip"),e._width=0,e._height=0,e._shadowColor="#000",e}return h(n,P),s(n,[{key:"update",value:function(){var t=this._data,e=this.group,n=this._defs;n.selectAll("#bg").remove();var i=n.append("filter").attr("x","-15%").attr("y","-25%").attr("width","135%").attr("height","150%").attr("id","bg");i.append("feFlood").attr("flood-color","black"),i.append("feComposite").attr("in","SourceGraphic");var o=e.selectAll("text").attr("class","axis-tooltip-text").data(t);o.exit().remove();o.enter().append("g").append("text").merge(o).text(function(t){return t.text}).attr("filter","url(#bg)").style("fill","white").style("fill-opacity",1).style("opacity",.8).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("dy","0.4em").attr("font-size",10).style("transition","transform 0.15s").on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);return this}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"data",value:function(t){return arguments.length?(this._data=t,this):this._data}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"textLength",value:function(t){return arguments.length?(this._textLength=t,this):this._textLength}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"shadowColor",value:function(t){return arguments.length?(this._shadowColor=t,this):this._shadowColor}}]),n}();function Ni(t,e){var n=0,i=0;e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"vCol"===t.function&&"折线列"==t.name&&(i=t.index)});for(var o={},a=[],r=t.length,l=t[0],s=[],u=1;u<r;u++)s.push(t[u].length);s.sort(function(t,e){return e-t});for(var h=[],c=0;c<r;c++)for(var _=0;_<s[0];_++)h.push(isNaN(parseFloat(t[c][_])));if(0==h.filter(function(t,e){return 0==t}).length)return[];for(var d=1;d<s[0];d++)if(d!==n){var f=l[d];""!=f&&null!=f&&null!=f||(f="$-"+d),o[f]=d==i?{name:f,data:[],showLegend:f!="$-"+d,type:"折线列"}:{name:f,showLegend:f!="$-"+d,data:[]}}for(var y=1;y<r;y++){var p=t[y],v=p[n];if(""!=v&&null!=v&&null!=v||(v="&-"+y),v)for(var g=0;g<s[0];g++){var m=l[g];g!==n&&(""!=l[g]&&null!=l[g]&&null!=l[g]||(m="$-"+g),o[m].data.push({name:v,showAxisText:v!="&-"+y,value:g==i||""!=p[g]&&null!=p[g]&&null!=p[g]&&!isNaN(parseFloat(p[g]))?p[g]:0,tooltipValueShow:!isNaN(parseFloat(p[g]))}))}}for(var x in o)a.push(o[x]);return a.forEach(function(t,e){t.key=t.name+"-"+e}),a}var Ti=function(t){function o(t){r(this,o);var e=c(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.elem.attr("class","mix-line-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new Mi(e.coreGroup),e.linePlot=new Mt(e.coreGroup),e.scatterPlot=new kt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.textPlot=new Wi(e.coreGroup),e.stackText=new Wt(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new Li(e.mainGroup),e.yAxisDoubleY=new Li(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e.yScaleRight=d3.scaleLinear(),e.axisTooltip=new Ri(e.mainGroup),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._yOrientRight="right",e._sortValue=0,e._curve=null,e._histogramWidth=.7,e._yScaleHeight=1.05,e._bardisplay=!1,e._barpositionOptions=["外部居上","内部居中","内部居下"],e._barpositionChoice="外部居上",e._linedisplay=!1,e._linepositionOptions=["上面","下面"],e._linepositionChoice="上面",e._lineWidth=2,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=1.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(o,dt),s(o,[{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.yAxis,i=t.yAxisDoubleY,o=t.xScale,a=t.yScale,r=t.yScaleRight,l=t._xType,s=t._yType,u=t._xOrient,h=t._yOrient,c=t._yOrientRight,_=t._fontSize,d=t.widthOfNoMargin,f=t.heightOfMainGroup;o.domain(t._xDomain),a.domain(t._yDomain),r.domain(t._yDomain1),e.scaleFunc(o).allowedMaxTextHeight(.3*f).type(l).orient(u).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),n.scaleFunc(a).allowedMaxTextWidth(.5*d).type(s).orient(h).title(t._yLeftName).unit(t._yLeftTitle?t._yLeftTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),i.scaleFunc(r).allowedMaxTextWidth(.5*d).type(s).orient(c).title(t._yRightName).times("second").unit(t._yRightTitle?t._yRightTitle:null).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(_).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);n.titleHeight;var y=(f-e.allowedMaxTextHeight())/(3*_);n.tickCount(y),i.tickCount(y),n.compute(),i.compute();var p=t.activeData,v=n.width,g=i.width;0==p.filter(function(t){return"折线列"==t.type}).length&&(v=n.width,g=t._yRightName?24:0),0==p.filter(function(t){return"折线列"!=t.type}).length&&(v=t._yLeftName?24:0,g=i.width),0==p.length&&(v=t.yAxis.width,g=t.yAxisDoubleY.width),o.range([0,d-v-g]),e.compute(),a.range([f-e.height,0]),r.range([f-e.height,0]);var m=v,x=f-e.height,S=v;e.translate(m,x),n.translate(S,0);var k=d-g;i.translate(k,0),0==p.length&&(e.translate(m,x),n.translate(S,0),i.translate(k,0)),e.update(),n.update(),i.update()}},{key:"updateCore",value:function(){var r=this,l=r.activeData,t=l,e=r.grid,s=r.tooltip,n=(r.axisTooltip,r.rectPlot),i=r.textPlot,o=r.linePlot,a=r.overlay,u=(r.scatterPlot,r.selectOverlay),h=r.guideLine,c=r.stackText,_=r.xScale,d=r.yScale,f=r.yScaleRight,y=1.2*Math.min(d3.min(l.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0);y<0?(r.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(d.range()[0]-d(0))+")"),r.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(d.range()[0]-d(0))+")")):(r.group.selectAll(".mix-line-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),r.group.selectAll(".mix-line-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var p=r.yAxis.width,v=r.yAxisDoubleY.width;0==l.filter(function(t){return"折线列"==t.type}).length&&(p=r.yAxis.width,v=r._yRightName?24:0),0==l.filter(function(t){return"折线列"!=t.type}).length&&(p=r._yLeftName?24:0,v=r.yAxisDoubleY.width),0==l.length&&(p=r.yAxis.width,v=r.yAxisDoubleY.width);var g=r.widthOfNoMargin-p-v,m=r.heightOfCore,x=r.defs;x.selectAll("filter").remove();var S=x.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_line").attr("filterUnits","objectBoundingBox");S.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),S.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),S.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),S.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),S.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.width(g).height(m).xTickLocations(r.xAxis.tickLocations).yTickLocations(r.yAxis.tickLocations).showX(r._gridShowX).showY(r._gridShowY).stroke(r._gridStroke).strokeDasharray(r._gridStrokeDasharray),0==l.filter(function(t){return"折线列"!=t.type}).length&&e.width(g).height(m).xTickLocations(r.xAxis.tickLocations).yTickLocations(r.yAxisDoubleY.tickLocations).showX(r._gridShowX).showY(r._gridShowY).stroke(r._gridStroke).strokeDasharray(r._gridStrokeDasharray),a.data(_.domain()).isScalePoint(!1).bandWidth(_.step()).bandHeight(m).onMouseover(function(t,e){s.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show();var n=r.elem.node().parentNode,i=(d3.mouse(n),e);d3.select(r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").nodes()[i]).attr("r",5),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").nodes().filter(function(t,e){return e!=i})).attr("r",3.5)}).onMousemove(function(t,e){var n=r.elem.node().parentNode,i=(d3.mouse(n),d3.mouse(this)[0],d3.mouse(this)[1],_.step(),e),o=t,a=[{text:o=="&-"+(i+1)?"":o}];o&&(l.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===o});a.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(n[0].tooltipValueShow?n[0].value:""),color:t.color})}),r.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+_(o)+",0)")),s.data(a).update().move([d3.event.offsetX,d3.event.offsetY]),d3.select(r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").nodes()[i]).attr("r",5),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").nodes().filter(function(t,e){return e!=i})).attr("r",3.5)}).onMouseout(function(){s.hide(),u.hide(),d3.selectAll(r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").nodes()).attr("r",3.5)}),n.data(t.filter(function(t){return"折线列"!=t.type})).xScale(_).yScale(d).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._bardisplay).positionOptions(r._barpositionOptions).positionChoice(r._barpositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).textObj({colorFunc:function(){return r._textLabel.color}}).fillOpacity(1),o.data(l.filter(function(t){return"折线列"==t.type})).xScale(_).yScale(f).labelShow(r._linedisplay).positionOptions(r._linepositionOptions).positionChoice(r._linepositionChoice).lineWidth(r._lineWidth).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).curve(r._curve).radius(3.5).stroke("#fff").strokeWidth(1).lineFunc(d3.line().x(function(t){return _(t.name)}).y(function(t){return f(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))})),h.x1(0).x2(g).strokeDasharray(r._gridStrokeDasharray),i.data(t.filter(function(t){return"折线列"!=t.type})).xScale(_).yScale(d).fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._bardisplay).positionOptions(r._barpositionOptions).positionChoice(r._barpositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause).textObj({colorFunc:function(){return r._textLabel.color}}).fillOpacity(1),c.data(l.filter(function(t){return"折线列"==t.type})).xScale(_).yScale(f).type("mix").fontSize(r._textLabel.fontSize).fontColor(r._textLabel.color).fontFamily(r._textLabel.fontFamily).labelShow(r._linedisplay).positionOptions(r._linepositionOptions).positionChoice(r._linepositionChoice).transition(r._transition).duration(1e3*r._duration).easeStyle(r._easeStyle).startDelay(1e3*parseFloat(r._startDelay)).moveStyle(r._moveStyle).endPause(r._endPause),u.width(_.step()).height(m).shadowColor("#ccc").hide(),r.coreGroup.attr("transform","translate("+p+",0)");var k=r.group.selectAll(".mix-line-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(k).remove(),n.update(),o.translate(_.step()/2,0).update(),r.group.selectAll(".mix-line-bar-chart .animation-line-circle-plot circle").attr("transform","translate("+-_.step()/2+", 0)"),i.update(),c.update(),u.update(),a.update(),e.update(),y<0?(r.coreGroup.selectAll(".fake-x-line").remove(),r.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",_.range()[0]).attr("y1",d.range()[0]).attr("x2",_.range()[1]).attr("y2",d.range()[0]).attr("stroke","rgb(233, 233, 233)")):r.coreGroup.selectAll(".fake-x-line").remove();var b=r.group.selectAll(".mix-line-bar-texts").nodes(),w=r.group.selectAll(".ranking-text-group text").nodes(),F=b.concat(w),O=d3.selectAll(F);if(null==r._barpositionOptions||null==r._barpositionChoice||-1==r._barpositionOptions.indexOf(r._barpositionChoice))r.group.selectAll(".mixLineBarTexts").style("display","none");else if(0==r._barpositionOptions.indexOf(r._barpositionChoice)||1==r._barpositionOptions.indexOf(r._barpositionChoice)){for(var C=[],A=[],P=0;P<O._groups[0].length;P++){A.push(P);for(var z=P+1;z<O._groups[0].length;z++){ut(st(d3.select(O._groups[0][P])),st(d3.select(O._groups[0][z])))&&(C.push(P),d3.select(O._groups[0][P]).style("visibility","hidden"))}}for(var D=new Set(C),L=Array.from(D),M=at(L,A),W=0;W<L.length;W++){for(var R=[],N=0;N<M.length;N++){var T=st(d3.select(O._groups[0][L[W]])),j=st(d3.select(O._groups[0][M[N]]));if(R.push(ut(T,j)),ut(T,j)){if(L[W]==M[N])continue;d3.select(O._groups[0][L[W]]).style("visibility","hidden")}}0==R.filter(function(t){return 1==t}).length&&M.push(L[W])}for(var Y=0;Y<M.length;Y++)d3.select(O._groups[0][M[Y]]).style("visibility","visible")}else if(2==r._barpositionOptions.indexOf(r._barpositionChoice)){for(var X=[],B=[],G=0;G<O._groups[0].length;G++){B.push(G);for(var E=G+1;E<O._groups[0].length;E++){var I=st(d3.select(O._groups[0][G])),H=st(d3.select(O._groups[0][E]));if(G<b.length){var V=I.width;I.width=I.height,I.height=V}if(E<b.length){var U=H.width;H.width=H.height,H.height=U}ut(I,H)&&(X.push(G),d3.select(O._groups[0][G]).style("visibility","hidden"))}}for(var q=new Set(X),Z=Array.from(q),Q=at(Z,B),$=0;$<Z.length;$++){for(var J=[],K=0;K<Q.length;K++){var tt=st(d3.select(O._groups[0][Z[$]])),et=st(d3.select(O._groups[0][Q[K]]));if(Z[$]<b.length){var nt=tt.width;tt.width=tt.height,tt.height=nt}if(Q[K]<b.length){var it=et.width;et.width=et.height,et.height=it}if(J.push(ut(tt,et)),ut(tt,et)){if(Z[$]==Q[K])continue;d3.select(O._groups[0][Z[$]]).style("visibility","hidden")}}0==J.filter(function(t){return 1==t}).length&&Q.push(Z[$])}for(var ot=0;ot<Q.length;ot++)d3.select(O._groups[0][Q[ot]]).style("visibility","visible")}function at(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"onDataChange",value:function(){this.removeLabelText(),this.updateAxis(),this.updateCore()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setPublicOption",value:function(t){u(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setPublicOption",this).call(this,t);var e=t.axis,n=e.x||{},i=e.y||{};this.axisLineStroke(e.color).xTitle(n.name).yTitle(i.name).xTickShow(n.labelShow).yTickShow(i.labelShow).xDomain(n.range).yDomain(i.range).yLeftName(i.leftName).yLeftTitle(i.leftTitle).yRightName(i.rightName).yRightTitle(i.rightTitle)}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=Ni;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._bardisplay=e?e.bardisplay:this._bardisplay,this._linedisplay=e?e.linedisplay:this._linedisplay,this._barpositionChoice=e.barpositionChoice?e.barpositionChoice:this._barpositionChoice,this._linepositionChoice=e.linepositionChoice?e.linepositionChoice:this._linepositionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yDomain,t.length?t[0].data.map(function(t){return t.name}):[0,1]),n=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"!=t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1],i=t.length?[1.2*Math.min(d3.min(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.2*Math.max(d3.max(t.filter(function(t){return"折线列"==t.type}),function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=e,this._yDomain=n,this._yDomain1=i}}]),o}(),ji=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","deformed-pie"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n._startAngle,i=n._endAngle,o=d3.max(t,function(t){return Math.abs(t.value)}),a=n._radius,r=d3.scaleLinear().domain([0,o]).range([0,a]),l=n.arcFunc.innerRadius(0).outerRadius(function(t){return r(Math.abs(t.data.value))}).cornerRadius(n._cornerRadius),s=n.pieFunc.value(1).startAngle(e).endAngle(i).sort(n._sortMethod),u=n.group.selectAll("g.arc-group").data(s(t));u.exit().remove();var h=u.enter().append("g").attr("class","arc-group");if(h.append("path"),u.merge(h).on("mouseover",n._onMouseover).on("mousemove",n._onMousemove).on("mouseout",n._onMouseout).select("path").style("stroke",n._stroke).style("stroke-width",n._strokeWidth).style("fill",function(t){return t.data.color}).transition().duration(n._transition?n._duration:0).ease(d3.easeLinear).attrTween("d",function(n){var i=d3.interpolateNumber(0,r(Math.abs(n.data.value)));return function(t){var e=i(t);return l.outerRadius(e),l(n)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd),n.group.selectAll(".pie-texts").remove(),n.group.selectAll(".pie-percents").remove(),n.group.selectAll(".pie-numbers").remove(),0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||null==n._contentOption||null==n._contentChoice||0==n._positionOptions.indexOf(n._positionChoice)||2==n._positionOptions.indexOf(n._positionChoice)||-1==n._positionOptions.indexOf(n._positionChoice)||0==n._contentChoice.length)n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none");else if(1==n._positionOptions.indexOf(n._positionChoice)){var c=n.group.append("g").selectAll("g").data(s(t));c.exit().remove(),c.enter().append("g").attr("class","pie-text-groups").merge(c).each(function(t,e){d3.select(this).append("g").attr("class","pie-texts").append("text").text(t.data.name).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-1.3*n._fontSize}).style("opacity",function(){return"$-"==t.data.name.slice(0,2)?0:1}),d3.select(this).append("g").attr("class","pie-percents").append("text").text(t.data.percent+"%").attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),d3.select(this).append("g").attr("class","pie-numbers").append("text").text(t.data.value).attr("fill",n._fontColor).attr("font-size",n._fontSize).attr("font-family",n._fontFamily).attr("text-anchor","middle").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+1.3*n._fontSize})}),1==n._contentChoice.length?0==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-texts text").style("display","none"),n.group.selectAll(".pie-numbers text").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]}),n.group.selectAll(".pie-percents text").style("display","none"),n.group.selectAll(".pie-texts text").style("display","none")):2==n._contentChoice.length&&(0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","none")):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(n.group.selectAll(".pie-texts text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-percents text").style("display","none")):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(n.group.selectAll(".pie-percents text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]-n._fontSize/1.7}),n.group.selectAll(".pie-numbers text").style("display","block").attr("x",function(t){return O(t)[0]}).attr("y",function(t){return O(t)[1]+n._fontSize/1.7}),n.group.selectAll(".pie-texts text").style("display","none")))}n.group.selectAll(".pie-text-groups").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(function(t,e){return n._duration?n._startDelay+.9*n._duration:0}).style("opacity",1);for(var _=n.group.selectAll(".pie-text-groups"),d=[],f=[],y=0;y<_._groups[0].length;y++){f.push(y);for(var p=y+1;p<_._groups[0].length;p++){ut(st(d3.select(_._groups[0][y])),st(d3.select(_._groups[0][p])))&&(d.push(y),d3.select(_._groups[0][y]).style("visibility","hidden"))}}for(var v=new Set(d),g=Array.from(v),m=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(g,f),x=0;x<g.length;x++){for(var S=[],k=0;k<m.length;k++){var b=st(d3.select(_._groups[0][g[x]])),w=st(d3.select(_._groups[0][m[k]]));if(S.push(ut(b,w)),ut(b,w)){if(g[x]==m[k])continue;d3.select(_._groups[0][g[x]]).style("visibility","hidden")}}0==S.filter(function(t){return 1==t}).length&&m.push(g[x])}for(var F=0;F<m.length;F++)d3.select(_._groups[0][m[F]]).style("visibility","visible");function O(t){var e=.7*r(Math.abs(t.data.value)),n=(t.startAngle+t.endAngle)/2-Math.PI/2;return[Math.cos(n)*e,Math.sin(n)*e]}}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),Yi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","deformed-pie-chart"),e.core=e.rose=new ji(e.mainGroup),e.lineText=new T(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._cornerRadius=0,e._stroke="#fff",e._strokeWidth=1,e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部径向",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称","百分比"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var u=this,h=u.rose,t=u.lineText,e=u._startAngle,n=u._endAngle,i=u.widthOfNoMargin,o=u.heightOfMainGroup,c=u._fontSize,a=(u.legend.height(),[]),r=0;r<u.activeData.length;r++)a.push(u.activeData[r].name);ht(a,u._fontSize,u._fontFamily);var l=.74*u.heightOfMainGroup,s=.74*u.widthOfNoMargin;null==u._labelShow||null==u._positionOptions||null==u._positionChoice||null==u._contentOption||null==u._contentChoice||0==u._contentChoice.length?(l=.88*u.heightOfMainGroup,s=.88*u.widthOfNoMargin):0!=u._labelShow&&0!=u._positionOptions.indexOf(u._positionChoice)&&1!=u._positionOptions.indexOf(u._positionChoice)&&-1!=u._positionOptions.indexOf(u._positionChoice)||(l=.88*u.heightOfMainGroup,s=.88*u.widthOfNoMargin);for(var _=s,d=l,f=L(_,d,e,n),y=f.radius,p=f.cx,v=f.cy,g=y+c,m=[],x=0;x<u.activeData.length;x++)m.push(u.activeData[x].value);for(var S=0,k=0;k<u.activeData.length;k++)S+=u.activeData[k].value;for(var b=0;b<u.activeData.length;b++)u.activeData[b].percent=(u.activeData[b].value/S*100).toFixed(1);var w=u.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});w.unshift(w[w.length-1]),w.pop(w[w.length-1]);var F=u.defs;F.selectAll("filter").remove();var O=F.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_deform").attr("filterUnits","objectBoundingBox");O.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),O.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),O.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),O.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),O.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),h.data(w).radius(y).fontSize(u._textLabel.fontSize).fontFamily(u._textLabel.fontFamily).fontColor(u._textLabel.color).labelShow(u._labelShow).positionOptions(u._positionOptions).positionChoice(u._positionChoice).contentOption(u._contentOption).contentChoice(u._contentChoice).startAngle(e).endAngle(n).cornerRadius(u._cornerRadius).stroke(u._stroke).strokeWidth(u._strokeWidth).sortMethod(u._sortMethod).defs(u.defs).transition(u._transition).duration(1e3*u._duration).easeStyle(u._easeStyle).startDelay(1e3*parseFloat(u._startDelay)).moveStyle(u._moveStyle).endPause(u._endPause).onTransitionEnd(function(t,e){var n=h.arcFunc.outerRadius()(t),i=d3.select(this.parentNode),o=t.startAngle,a=t.endAngle,r="arc-path-"+t.data.key+"-"+u.id,l=D(n-c,o+.015,a-.015),s=u.defs.select("#"+r).empty()?u.defs.append("path").attr("d",l).attr("id",r):u.defs.select("#"+r).attr("d",l);0==u._labelShow||null==u._labelShow||null==u._positionOptions||null==u._positionChoice||null==u._contentOption||null==u._contentChoice||1==u._positionOptions.indexOf(u._positionChoice)||2==u._positionOptions.indexOf(u._positionChoice)||0==u._contentChoice.length?u.group.selectAll(".chart-label-text").style("display","none"):0==u._positionOptions.indexOf(u._positionChoice)&&(1==u._contentChoice.length?0==u._contentOption.indexOf(u._contentChoice[0])?N(i,s,"$-"==t.data.name.slice(0,2)?"":t.data.name,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):1==u._contentOption.indexOf(u._contentChoice[0])?N(i,s,t.data.percent+"%",u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):2==u._contentOption.indexOf(u._contentChoice[0])&&N(i,s,t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily):2==u._contentChoice.length?0==u._contentOption.indexOf(u._contentChoice[0])&&1==u._contentOption.indexOf(u._contentChoice[1])||1==u._contentOption.indexOf(u._contentChoice[0])&&0==u._contentOption.indexOf(u._contentChoice[1])?N(i,s,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.percent+"%",u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):0==u._contentOption.indexOf(u._contentChoice[0])&&2==u._contentOption.indexOf(u._contentChoice[1])||2==u._contentOption.indexOf(u._contentChoice[0])&&0==u._contentOption.indexOf(u._contentChoice[1])?N(i,s,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):(1==u._contentOption.indexOf(u._contentChoice[0])&&2==u._contentOption.indexOf(u._contentChoice[1])||2==u._contentOption.indexOf(u._contentChoice[0])&&1==u._contentOption.indexOf(u._contentChoice[1]))&&N(i,s,t.data.percent+"%  "+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","middle").attr("xml:space","preserve"):3==u._contentChoice.length&&N(i,s,("$-"==t.data.name.slice(0,2)?"":t.data.name+"  ")+t.data.percent+"%  "+t.data.value,u._textLabel.fontSize,u._textLabel.fontFamily,"53%").attr("class",u.labelTextClass).style("pointer-events","none").style("fill",u._textLabel.color).style("font-size",u._textLabel.fontSize).style("font-family",u._textLabel.fontFamily).attr("text-anchor","start").attr("xml:space","preserve")),u.group.selectAll(".chart-label-text").style("opacity",0).transition().duration(u._transition?1e3*u._duration*.1:0).style("opacity",1)}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var n=[{text:""+("$-"==t.data.name.slice(0,2)?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];u.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){u.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),u.tooltip.hide()});var C=(i-_)/2+p,A=(o-d)/2+v,P=(g-y)/2;switch(f.quadrant){case 4:C+=P,A+=P;break;case 1:C-=P,A+=P;break;case 2:C-=P,A-=P;break;case 3:C+=P,A-=spcae}if(null!=u._labelShow)if(0!=u._labelShow&&2==u._positionOptions.indexOf(u._positionChoice)){var z=u.activeData.sort(function(t,e){return e.key.slice(-1)-t.key.slice(-1)});z.unshift(z[z.length-1]),z.pop(z[z.length-1]),t.data(z).outerRadius(y).type("change").cornerRadius(u._cornerRadius).startAngle(e).endAngle(n).fontSize(u._textLabel.fontSize).fontColor(u._textLabel.color).fontFamily(u._textLabel.fontFamily).labelShow(u._labelShow).positionOptions(u._positionOptions).positionChoice(u._positionChoice).contentOption(u._contentOption).contentChoice(u._contentChoice).values(m).transition(u._transition).duration(1e3*u._duration).easeStyle(u._easeStyle).startDelay(1e3*parseFloat(u._startDelay)).moveStyle(u._moveStyle).endPause(u._endPause),u.lineText.translate(C||0,A).update(),u.group.selectAll(".outside-text-polygon").attr("display","block")}else 0!=u._labelShow&&0!=u._positionOptions.indexOf(u._positionChoice)&&1!=u._positionOptions.indexOf(u._positionChoice)&&-1!=u._positionOptions.indexOf(u._positionChoice)||u.group.selectAll(".outside-text-polygon").attr("display","none");h.translate(C||0,A).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}}]),n}(),Xi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._padAngle=.01,e._labelRadiusRatio=.5,e._innerRadiusRatio=.75,e._cornerRadius=null,e._areaBorderColor="#fff",e._areaBorderWidth=0,e._labelShow=!0,e._positionOptions=["外部","内部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,j),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}}]),n}(),Bi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","funnel-polygon"),e._fontColor="#ffffff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var o=this,a=o._data,t=d3.max(a,function(t){return Math.abs(t.value)}),r=0<a.length?a[0].value:0,l=d3.scaleLinear().domain([0,t]).range([0,o._sWidth]),n=(0<o._sHeight?o._sHeight:0)/a.length,e=o.group,i=0;i<a.length;i++)a[i].percent=Math.ceil(a[i].value/t*100);o.group.selectAll("*").remove(),o.group.selectAll(".funnel-groups").remove();var s=e.selectAll("polygon").data(a);s.exit().remove();var u=s.enter().append("g").attr("class","funnel-groups"),h=(u.append("polygon").merge(s).attr("class","funnel-polygons").style("fill",function(t){return t.color}).style("fill-opacity",1).style("stroke","#ffffff").style("opacity",1).attr("points",function(t,e){return e==a.length-1?l(a[e].total)/2+(o._sWidth-l(r))/2+","+n*e+"\n        "+(l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*e+" \n        "+(l(t.value)/2+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1):l(a[e].total)/2+(o._sWidth-l(r))/2+","+n*e+"\n        "+(l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*e+" \n        "+(l(a[e+1].value)+l(a[e+1].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1)+" \n        "+(l(a[e+1].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1)}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),o._defs);h.selectAll("filter").remove();var c=h.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_funnel").attr("filterUnits","objectBoundingBox");if(c.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),c.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),c.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),c.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),c.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice)||0==o._contentChoice.length)o.group.selectAll(".funnel-text-group").remove();else if(0==o._positionOptions.indexOf(o._positionChoice)&&o._labelShow){o.group.selectAll(".funnel-text-group").remove();var _=u.append("g").merge(s).attr("class","funnel-text-group").style("opacity",0);_.transition().duration(o._transition?.1*o._duration:0).delay(o._transition?o._startDelay+.9*o._duration:0).style("opacity",1),_.append("text").text(function(t,e){return t.name=="$-"+e?"":t.name}).attr("class","funnel-texts-name").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return l(t.value)/2+l(a[e].total)/2+(o._sWidth-l(r))/2}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",o._labelShow?"block":"none"),_.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return l(t.value)/2+l(a[e].total)/2+(o._sWidth-l(r))/2}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",o._labelShow?"block":"none"),_.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return l(t.value)/2+l(a[e].total)/2+(o._sWidth-l(r))/2}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",o._labelShow?"block":"none"),0==o._labelShow||null==o._labelShow||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block"),e.selectAll(".funnel-texts-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block")):2==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),e.selectAll(".funnel-texts-value").style("display","none"),_.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,o._fontSize,o._fontFamily)-E(t.percent,o._fontSize,o._fontFamily))/2+", 0)"})):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),_.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,o._fontSize,o._fontFamily)-E(t.value,o._fontSize,o._fontFamily))/2+", 0)"})):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),_.attr("transform",function(t,e){return"translate("+(E(t.percent,o._fontSize,o._fontFamily)-E(t.value,o._fontSize,o._fontFamily))/2+", 0)"})):3==o._contentChoice.length&&o._labelShow&&(e.selectAll(".funnel-texts-name").attr("text-anchor","end").attr("dx","-1.5em"),e.selectAll(".funnel-texts-percent"),e.selectAll(".funnel-texts-value").attr("text-anchor","start").attr("dx","1.5em"),_.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,o._fontSize,o._fontFamily)-E(t.value,o._fontSize,o._fontFamily))/2+", 0)"}))}else if(1==o._positionOptions.indexOf(o._positionChoice)&&o._labelShow){o.group.selectAll(".funnel-text-group").remove();var d=u.append("g").merge(s).attr("class","funnel-text-group");d.append("line").attr("class","funnel-texts-line").attr("x1",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)}).attr("y1",function(t,e){return n*(e+1)-n/2}).attr("x2",function(t,e){return.78*o._width}).attr("y2",function(t,e){return n*(e+1)-n/2}).style("stroke",function(t){return"#bfbfbf"}).style("stroke-width",1).style("display",o._labelShow?"block":"none"),d.append("text").text(function(t,e){return I(t.name=="$-"+e?"":t.name,.18*o._width,o._fontSize,o._fontFamily)}).attr("class","funnel-texts-name").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","-0.35em").style("display",o._labelShow?"block":"none"),d.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none"),d.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(t.percent+"%",o._fontSize,o._fontFamily)+5)+",0)"}),0==o._labelShow||null==o._labelShow||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.35em").attr("transform","translate(0, 0)")):2==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.75em"),e.selectAll(".funnel-texts-value").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):3==o._contentChoice.length&&o._labelShow}else if(2==o._positionOptions.indexOf(o._positionChoice)&&o._labelShow){o.group.selectAll(".funnel-text-group").remove();var f=u.append("g").merge(s).attr("class","funnel-text-group");f.append("line").attr("class","funnel-texts-line").attr("x1",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)}).attr("y1",function(t,e){return n*(e+1)-n/2}).attr("x2",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width}).attr("y2",function(t,e){return n*(e+1)-n/2}).style("stroke",function(t){return t.color}).style("stroke-width",1).style("display",o._labelShow?"block":"none"),f.append("text").text(function(t,e){if(e==a.length-1){var n=l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width;return I(t.name=="$-"+e?"":t.name,.96*o._width-n,o._fontSize,o._fontFamily)}var i=l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width;return I(t.name=="$-"+e?"":t.name,.96*o._width-i,o._fontSize,o._fontFamily)}).attr("class","funnel-texts-name").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","-0.35em").style("display",o._labelShow?"block":"none"),f.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none"),f.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(t.percent+"%",o._fontSize,o._fontFamily)+5)+",0)"}),0==o._labelShow||null==o._labelShow||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.35em").attr("transform","translate(0, 0)")):2==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.75em"),e.selectAll(".funnel-texts-value").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):3==o._contentChoice.length&&o._labelShow}return o}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),Gi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","funnel-chart"),e.funnel=new Bi(e.mainGroup),e.AnimationArea=new Ot(e.defs),e._sortValue=null,e._labelShow=!0,e._positionOptions=["内部","外部对齐","外部跟随"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#FFFFFF",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var i=this,t=i.activeData.filter(function(t,e){return 0<t.value||0==t.value}),e=i.funnel,n=i.AnimationArea,o=i.widthOfNoMargin,a=.69*o,r=.92*i.heightOfMainGroup,l=0;l<t.length;l++)t[l].percent=0==l?0:t[l-1].value-t[l].value;for(var s=0;s<t.length;s++)t[s].total=0==s?0:t[s-1].total+parseFloat(t[s].percent);e.data(t).width(o).sWidth(a).sHeight(r).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){d3.select(this).transition().duration(30).style("opacity",.8);var n=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().duration(30).style("opacity",1),i.tooltip.hide()});var u=.155*o,h=.04*r;null==i._labelShow||null==i._positionOptions||null==i._positionChoice||0==i._contentChoice.length||1!=i._positionOptions.indexOf(i._positionChoice)&&2!=i._positionOptions.indexOf(i._positionChoice)||1==i._labelShow&&(u=.04*o),i.funnel.translate(u,h).update(),n.width(i._width).height(0),n.update(),i.mainGroup.attr("clip-path","url(#"+n.id+")"),i.defs.select(".x"+n.id).transition().duration(i._transition?1e3*i._duration*.9:0).delay(i._transition?1e3*i._startDelay:0).attr("height",i.heightOfMainGroup)}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice)}}]),n}(),Ei=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","bee-line-chart"),e._showPoints=!1,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._labelShow=!1,e._endPointRadius=3.5,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,Nt),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveLinear)}}]),n}(),Ii=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stacked-linear-chart"),e.elem.attr("class","stacked-linear-chart"),e.grid=new Pt(e.coreGroup),e.areaPlot=new Xe(e.coreGroup),e.linePlot=new xn(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new mn(e.coreGroup),e.areaStackText=new wt(e.coreGroup),e.clipArea=new Ft(e.defs),e.AnimationArea=new Ot(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._endPointRadius=2,e._radius=3.5,e._curve=d3.curveLinear,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=n.grid,e=n.areaPlot,i=n.linePlot,o=(n.StackedScatterPlot,n.areaStackText),l=n.tooltip,a=n.overlay,s=n.guideLine,u=n.guideScatter,h=n.clipArea,c=n.AnimationArea,_=n.xScale,d=n.yScale,f=n.widthOfCore,y=n.heightOfCore,p=0;p<r.length;p++)for(var v=0;v<r[p].data.length;v++)r[p].data[v].value=parseFloat(r[p].data[v].value),r[p].data[v].total=0==p?isNaN(parseFloat(r[p].data[v].value))?0:parseFloat(r[p].data[v].value):r[p-1].data[v].total+(isNaN(parseFloat(r[p].data[v].value))?0:parseFloat(r[p].data[v].value));Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total})}),0);t.width(f).height(y).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(_).yScale(d).fillOpacity(.7).curve(n._curve).areaFunc(d3.area().x(function(t){return _(t.name)}).y0(function(t){return d(t.total-t.value)}).y1(function(t){return d(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),i.data(r).xScale(_).yScale(d).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).mainGroup(n.mainGroup).curve(n._curve).lineFunc(d3.line().x(function(t){return _(t.name)}).y(function(t){return d(t.total)}).defined(function(t){return!isNaN(parseFloat(t.value))})),u.data(r).xScale(_).yScale(d).radius(3.5).stroke("#fff").strokeWidth(2),s.y1(0).y2(y).stroke("#c6c6c6").strokeDasharray("0 0"),a.data(_.domain()).bandWidth(_.step()).bandHeight(y).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update(),s.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+_(i)+",0)"),u.data(a).update(),l.move([d3.event.offsetX,d3.event.offsetY]).show(),s.show(),u.show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide(),u.hide()});var g=n.defs;g.selectAll("filter").remove();var m=g.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stacklinear").attr("filterUnits","objectBoundingBox");m.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),m.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),m.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),m.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),m.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(r).xScale(_).yScale(d).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?(h.width(f).height(y).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+h.id+")")):(h.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),h.update(),u.elem.style("pointer-events","none");var x=n.group.selectAll(".stacked-linear-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(x).remove(),t.update(),a.update(),e.update(),i.update(),o.update(),c.width(0).height(n._height),c.update(),n.coreGroup.select(".area-plot").attr("clip-path","url(#"+c.id+")"),n.coreGroup.select(".ranking-line-plot").attr("clip-path","url(#"+c.id+")"),n.defs.select(".x"+c.id).transition().duration(n._transition?1e3*n._duration:0).delay(n._transition?1e3*n._startDelay:0).attr("width",f)}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=Dt;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var n=0;n<t[e].data.length;n++)t[e].data[n].value=parseFloat(t[e].data[n].value),t[e].data[n].total=0==e?isNaN(parseFloat(t[e].data[n].value))?0:parseFloat(t[e].data[n].value):t[e-1].data[n].total+(isNaN(parseFloat(t[e].data[n].value))?0:parseFloat(t[e].data[n].value));var i=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.total})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})})]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(i[0]))?a[0]:parseFloat(i[0]),isNaN(parseFloat(i[1]))?isNaN(parseFloat(i[0]))?a[1]:a[1]<i[0]?1.5*i[0]:a[1]:parseFloat(i[1])]}}]),n}(),Hi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","smooth-line-chart"),e._showPoints=!1,e._curve=d3.curveCardinal,e._strokeWidth=2,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,Nt),s(n,[{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._lineWidth=e.lineWidth?l(e.lineWidth):this._lineWidth,this._curve=e.lineType?r[e.lineType]:d3.curveCardinal)}}]),n}(),Vi="axis-group",Ui="x-title",qi=function(t){function e(t){return r(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,vt),s(e,[{key:"update",value:function(){var n=this,i=n._orient,t=n._scaleFunc,e=n.group,o=n._fontSize,a=n._tickTextRotate,r=n._tickValueTexts,l=void 0;if("top"===i){(l=n.axisFunc=d3.axisTop(t)).tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding).tickFormat(n._tickFormat);var s=e.select("."+Vi).empty()?e.append("g").attr("class",Vi):e.select("."+Vi);s.style("font-size",o+"px").style("font-family",n._fontFamily).transition().duration(n._transition?n._duration:0).call(l).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",n._fontColor).attr("dx",0).attr("dy","-1em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){return t+"%"}).filter(function(){return a}).attr("dx","-0.5em").attr("dy","-0.3em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"top"!==i}),s.selectAll(".tick line").style("stroke",n._lineStroke),s.select("path").style("stroke",n._lineStroke).style("display",n._axisLineShow?"block":"none")});var u=Math.abs(t.range()[0]-t.range()[1]);if(n._titleShow&&n._title){var h=e.select("."+Ui).empty()?e.append("g").attr("class",Ui):e.select("."+Ui),c=h.select("text").empty()?h.append("text"):h.select("text"),_=r.map(function(t){return t+"%"}),d=u/_.length,f=d3.max(_,function(t){return E(t,o,n._fontFamily)});h.call(G,u/2+Math.abs(t.range()[0]),-(this._tickShow?this._tickSize+this._tickPadding+(f<.8*d?this._tickTextHeight:1.2*this._tickTextHeight):0)),c.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dy",-6).text(n._title)}else e.select("."+Ui).remove()}else{(l=n.axisFunc=d3.axisBottom(t)).tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding);var y=e.select("."+Vi).empty()?e.append("g").attr("class",Vi):e.select("."+Vi);y.style("font-size",o+"px").style("font-family",n._fontFamily).transition().duration(n._transition?n._duration:0).call(l).on("start",function(t,e){y.selectAll(".tick text").remove(),y.selectAll(".tick").append("text").style("fill",n._fontColor).attr("dx",0).attr("dy",parseFloat(o)+6).attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){return t+"%"}).filter(function(){return a}).attr("dx","-0.6em").attr("dy","0.5em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"bottom"!==i}),y.selectAll(".tick line").style("stroke",n._lineStroke),y.select("path").style("stroke",n._lineStroke).style("display",n._axisLineShow?"block":"none")});var p=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"&-"==String(t.__data__).slice(0,2)}),v=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return"$-"==String(t.__data__).slice(0,2)});d3.selectAll(p).remove(),d3.selectAll(v).remove();var g=Math.abs(t.range()[0]-t.range()[1]);if(n._titleShow&&n._title){var m=e.select("."+Ui).empty()?e.append("g").attr("class",Ui):e.select("."+Ui),x=m.select("text").empty()?m.append("text"):m.select("text"),S=r.map(function(t){return t+"%"}),k=g/S.length,b=d3.max(S,function(t){return E(t,o,n._fontFamily)});m.call(G,g/2+Math.abs(t.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(b<.8*k?this._tickTextHeight:1.2*this._tickTextHeight):0),x.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dy",1.125*o/2+6).text(n._title)}else e.select("."+Ui).remove()}}},{key:"compute",value:function(){var n=this,i=[],o=[],a=0,r=0;function l(){n._tickTextRotate=a,n._tickValues=i,n._tickValueTexts=o,n._tickTextHeight=r}var t=n._scaleFunc,e=n._type,s=n._fontSize,u=(n._minTickDistance,n._allowedMaxTextHeight),h=Math.abs(t.range()[0]-t.range()[1]),c=void 0,_=void 0;if(i="category"===e?t.domain():t.ticks(),function(){var t=!1;c=h/i.length;var e=i.map(function(t){return t+="%"});(_=d3.max(e,function(t){return E(t,s,n._fontFamily)}))<.8*c&&(a=0,o=i,r=1.125*s,l(),t=!0);return t}())return n;a="top"===n._orient?45:-45;var d=Math.abs(Math.sin(Math.PI/4));_*d<u?(r=_*d,o=i):(r=u,o=i.map(function(t){return I(t,r/d,s,n._fontFamily)}));var f=h/i.length;if("category"!=e&&f<2*s){var y=Math.ceil(2*s/f);i=i.filter(function(t,e){return e%y==0})}return l(),n}},{key:"height",get:function(){var e=this,t=this._scaleFunc,n=Math.abs(t.range()[0]-t.range()[1]),i=this._tickValueTexts.map(function(t){return t+"%"}),o=n/i.length,a=d3.max(i.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,e._fontSize,e._fontFamily)}),r=0;return this.isShow&&(r=(this._tickShow?(a?this._tickSize+this._tickPadding:0)+(a<.8*o?this._tickTextHeight:1.2*this._tickTextHeight):0)+(this._title&&this._titleShow?this._titlePadding+1.25*this._fontSize:0)),r}}]),e}(),Zi=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rect-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=5,e._borderColor="#000",e._borderWidth=1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,e=this,t=e._data,i=e.group;i.selectAll(".symmetric-rect").remove();var o=i.selectAll("rect").data(t,function(t){return t.key});o.exit().remove();var a=o.enter().append("g").attr("class","symmetric-rect").append("rect").merge(o).style("fill",function(t){return e._fillColor||t.color}).style("fill-opacity",function(t){return e._fillOpacity}).style("stroke",function(t){return e._strokeColor||t.color}).style("stroke-width",function(t){return e._strokeWidth||0});if(this._rectObj?(a.attr("x",e._rectObj.xFunc),a.attr("y",this._rectObj.yFunc),a.attr("width",this._rectObj.widthFunc),a.attr("height",this._rectObj.heightFunc)):a.attr("x",function(t){return t.value}).attr("y",function(t){return t.value}).attr("width",function(t){return t.value}).attr("height",function(t){return t.value}),this._textObj){i.selectAll(".symmetric-texts").remove();var r=i.append("g").attr("class","symmetric-texts").selectAll("text").data(t,function(t){return t.key});r.exit().remove();r.enter().append("g").append("text").merge(r).text(this._textObj.textFunc).attr("fill",e._textObj.colorFunc).attr("font-size",e._textObj.fontSize).attr("font-family",e._textObj.fontFamily).attr("x",this._textObj.xFunc).attr("y",this._textObj.yFunc).attr("dx",this._textObj.dxFunc).attr("dy",this._textObj.dyFunc).attr("text-anchor","middle").style("display",function(t,e){return n._textObj.labelShow&&t.textShow?"block":"none"})}a.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),e._defs.selectAll("clipPath").remove();var l=e.AnimationArea=new Ot(e._defs);return l.width(e._width).height(0),l.update(),e.group.attr("clip-path","url(#"+l.id+")"),e._defs.select(".x"+l.id).transition().duration(e._transition?.8*e._duration:0).delay(e._transition?e._startDelay:0).attr("height",e._height),e}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=parseFloat(t),this):this._fontSize}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"height",value:function(t){return arguments.length?(this._height=t,this):this._height}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}();function Qi(t,e){var n=0,i=[];if(e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"vCol"===t.function&&0!=t.configurable&&i.push(t.index-1)}),W(t,[n],2))return[];var o=R(t,e),a=o[0],r=o.slice(1),l=a.slice(1),s=[],u=[],h=[],c=r.map(function(t){return t.slice(1)});return l.forEach(function(t,e){s.push({name:t,data:[]})}),r.forEach(function(t){var e=0;t.slice(1).forEach(function(t){e+=""==t||isNaN(parseFloat(t))||null==t||null==t?0:parseFloat(t)}),u.push(e)}),c.forEach(function(t,e){h.push(t.map(function(t){return 0==u[e]?0:(t/u[e]*100).toFixed(2)}))}),r.forEach(function(n,i){s.forEach(function(t,e){t.data.push({name:""==n[0]?"&-"+i:n[0],type:t.name,value:""==n[e+1]||isNaN(parseFloat(n[e+1]))||null==n[e+1]||null==n[e+1]?0:parseFloat(n[e+1]),total:u[i],rate:h[i][e]+"%"})})}),s.forEach(function(t,e){t.key=M(t.name)+"-"+e}),s}var $i=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","symmetric-chart"),e.grid=new Pt(e.coreGroup),e.rectPlot=new Zi(e.coreGroup),e.xAxis=new qi(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="top",e._yOrient="left",e._sortValue=null,e._curve=d3.curveCardinal,e._histogramWidth=.5,e._yScaleHeight=1.05,e._shapeType="rect",e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"update",value:function(){return this._marginLeft=this._yTitle?0:24,this._titlePadding=this._unitWord&&this._unitShow?10:this._titlePadding,this.sortData(),this.styleSvg(),this.removeLabelText(),this.updateLegend(),"top"==this._xOrient?(this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"top"==this._legendY?8:15:this._gapPadding=0,this._marginTop=this._xTitle&&0==this._legendShow?8:20,this._marginTop=this._xTitle&&0==this.legend.height()?8:20):(this._marginTop=20,this._legendShow&&0!=this.legend.height()?this._gapPadding=this._xTitle&&"bottom"==this._legendY?8:15:this._gapPadding=0),this.updateTitle(),this.updateUnit(),this.updateSource(),this.updateAxis(),this.updateCore(),this.updateScale(),this.layout(),this.tooltip&&this.tooltip.fontSize(this._fontSize).fontFamily(this._fontFamily).hide().lock(!this._tooltipShow),this}},{key:"updateCore",value:function(){for(var o=this,t=o.activeData,e=o.grid,a=o.tooltip,n=o.rectPlot,r=o.xScale,i=o.yScale,l=o.widthOfCore,s=o.heightOfCore,u=0;u<t.length;u++)for(var h=0;h<t[u].data.length;h++){var c=Math.abs(r.domain()[0])+Math.abs(r.domain()[1]);t[u].data[h].rate.replace(/\%$/,"")/c*r.range()[1]<E(t[u].data[h].value,o._fontSize,o._fontFamily)?t[u].data[h].textShow=!1:t[u].data[h].textShow=!0}n.data(o.drawData).xScale(r).yScale(i).width(o.widthOfNoMargin).height(o.heightOfMainGroup).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause).defs(o.defs).rectObj({xFunc:function(t,e){return r(t.x)},yFunc:function(t,e){return"top"==o._xOrient?i(t.name)+i.step()*(1-o._histogramWidth)/2+o.xAxis.height:i(t.name)+i.step()*(1-o._histogramWidth)/2},widthFunc:function(t){var e=Math.abs(r.domain()[0])+Math.abs(r.domain()[1]);return t.rate.replace(/\%$/,"")/e*r.range()[1]},heightFunc:function(t){return i.step()*o._histogramWidth}}).textObj({xFunc:function(t,e){var n=Math.abs(r.domain()[0])+Math.abs(r.domain()[1]),i=t.rate.replace(/\%$/,"")/n*r.range()[1];return r(t.x)+i/2},yFunc:function(t,e){return"top"==o._xOrient?i(t.name)+i.step()*(1-o._histogramWidth)/2+o.xAxis.height:i(t.name)+i.step()*(1-o._histogramWidth)/2},dxFunc:0,dyFunc:function(t){return i.step()*o._histogramWidth/2+o._textLabel.fontSize/2},colorFunc:function(){return o._textLabel.color},textFunc:function(t){return 0==t.value?"":t.value},fontSize:o._textLabel.fontSize,fontFamily:o._textLabel.fontFamily,labelShow:o._labelShow}).fillOpacity(1).onMousemove(function(t,e){var n=o.elem.node().parentNode,i=(d3.mouse(n),[{text:"&-"==t.name.slice(0,2)?"":t.name},{text:t.type,color:t.color},{text:"数值:"+t.value},{text:"比例:"+t.rate}]);a.show(),a.data(i).update().move([d3.event.offsetX,d3.event.offsetY]),d3.select(this).style("cursor","pointer")}).onMouseout(function(){a.hide()}),e.width(l).height(s).xTickLocations(o.xAxis.tickLocations.slice()).yTickLocations(o.yAxis.tickLocations.slice()).showX(o._gridShowX).showY(o._gridShowY).stroke(o._gridStroke).strokeDasharray(o._gridStrokeDasharray),o.coreGroup.attr("transform","translate("+o.yAxis.width+",0)"),n.update(),"top"==o._xOrient?e.translate(0,o.xAxis.height).update():e.update(),o.mainGroup.selectAll(".axis-x-line").style("opacity",0).transition().duration(o._transition?.2*o._duration*1e3:0).delay(o._transition?1e3*o._startDelay:0).style("opacity",1),o.mainGroup.selectAll(".axis-y-line").style("opacity",0).transition().duration(o._transition?.2*o._duration*1e3:0).delay(o._transition?1e3*o._startDelay:0).style("opacity",1),o.mainGroup.selectAll(".plane-grid").style("opacity",0).transition().duration(o._transition?.2*o._duration*1e3:0).delay(o._transition?1e3*o._startDelay:0).style("opacity",1),o.mainGroup.selectAll(".symmetric-line").style("opacity",0).transition().duration(o._transition?.2*o._duration*1e3:0).delay(o._transition?1e3*o._startDelay:0).style("opacity",1)}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var n=new bn(t,e);this.rawData=t.dataSrc.data[0];var i=Qi;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData||[];this.drawData=function(t,e,n){for(var i=[],o=[],a=[],r=n.slice(1).map(function(t){return t.slice(1)}),l=[],s=[],u=[],h=[],c=0<t.length?t[0].data.length:0,_=[],d=0;d<c;d++){for(var f=[],y=0;y<t.length;y++)f.push(t[y].data[d].value);_.push(f)}var p=Math.floor(e.length/2);if(t.forEach(function(t){o.push(t.key.split("-")[1])}),r.forEach(function(e){var n=[];o.forEach(function(t){n.push(e[t])})}),_.forEach(function(t){var e=0;t.forEach(function(t){e+=""==t||isNaN(parseFloat(t))||null==t||null==t?0:parseFloat(t)}),l.push(e)}),_.forEach(function(t,e){a.push(t.map(function(t){return 0==l[e]?0:(t/l[e]*100).toFixed(2)}))}),-1!=o.indexOf(p.toString())&&e.length%2!=0&&1!=e.length){var v=o.indexOf(p.toString());a.forEach(function(t,e){var n=-t[v]/2,i=t[v]/2;s.push([]),s[e][v]=-(t[v]/2).toFixed(2);for(var o=v-1;0<=o;o--)s[e][o]=parseFloat((-t[o]+s[e][o+1]).toFixed(2)),n+=-t[o];for(var a=v+1;a<t.length;a++)s[e][a]=parseFloat((s[e][a-1]+ +t[a-1]).toFixed(2)),i+=+t[a];u.push(n),h.push(i)})}else{for(var g=-1,m=0;m<o.length;m++){if(+o[m]>=p){g=m;break}if(m==o.length-1){g=m+1;break}}a.forEach(function(t,e){var n=0,i=+t[g]||0;s.push([]),s[e][g]=0;for(var o=g-1;0<=o;o--)s[e][o]=parseFloat((-t[o]+s[e][o+1]).toFixed(2)),n+=-t[o];for(var a=g+1;a<t.length;a++)s[e][a]=parseFloat((s[e][a-1]+ +t[a-1]).toFixed(2)),i+=+t[a];u.push(n),h.push(i)})}return t.forEach(function(t,n){t.data.forEach(function(t,e){t.x=s[e][n],t.rate=a[e][n]+"%"})}),t.forEach(function(t){t.range=[Math.min.apply(null,u),Math.max.apply(null,h)],t.data.forEach(function(t){i.push(t)})}),i}(t,this.data(),this.rawData)||[];var e=[],n=[];t[0]&&(t[0].data.forEach(function(t){n.push(t.name)}),e=[t[0].range[0]-5,t[0].range[1]+5]),this._xDomain=""==e?[-100,100]:e,this._yDomain=""==n?[0,1]:n.reverse()}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.yAxis,i=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;i.domain(t._xDomain),e.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),o.domain(t._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);n&&n.titleHeight;var _=t._tickCount?t._tickCount:(h-n.allowedMaxTextWidth())/(2*u);if(e.tickCount(_).compute(),n.compute(),i.range([0,h-n.width]),e.compute(),o.range([c-e.height,0]),n.compute(),"top"==l){var d=n.width,f=e.height,y=n.width,p=e.height;e.translate(d,f).update(),n.translate(y,p).update(),this.coreGroup.selectAll("line").remove(),this.coreGroup.append("line").attr("class","symmetric-line").attr("x1",i(0)).attr("y1",e.height).attr("x2",i(0)).attr("y2",o.range()[0]+e.height).attr("stroke","#000000")}else{var v=n.width,g=c-e.height,m=n.width;e.translate(v,g).update(),n.translate(m,0).update(),this.coreGroup.selectAll("line").remove(),this.coreGroup.append("line").attr("class","symmetric-line").attr("x1",i(0)).attr("y1",0).attr("x2",i(0)).attr("y2",o.range()[0]).attr("stroke","#000000")}}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return""!=t.name});t.legend.data(i).shapeType("rect").onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}}]),n}();var Ji=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","simple-line-circle-plot"),e._xScale=null,e._yScale=null,e._lineFunc=null,e._stroke=null,e._lineWidth=2,e._strokeWidth=1,e._strokeDasharry="",e._curve=d3.curveLinear,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,i=n._xScale,o=n._yScale,e=n.group;e.selectAll("g").remove();var a=n._lineFunc||d3.line().x(function(t){return n._xScale(t.name)+n._xScale.bandwidth()/2}).y(function(t){return n._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});a.curve(n._curve),e.selectAll("path").remove();var r=e.selectAll("path").data(t,function(t){return t.key});r.exit().remove(),r.enter().append("path").merge(r).style("fill","none").style("stroke",function(t){return t.color||"#000"}).style("stroke-width",n._lineWidth).style("stroke-dasharray",n._strokeDasharry).attr("d",function(t){return a(t.data)}).transition().duration(n._transition?.9*n._duration:0).delay(n._startDelay).ease(d3.easeLinear).attrTween("stroke-dasharray",function(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}),e.selectAll("g").remove();var l=e.append("g").selectAll("g").data(t,function(t){return t.name});l.exit().remove(),l.enter().append("g").merge(l).each(function(t){var e=d3.select(this).selectAll("circle").data(t.data);e.exit().remove(),e.enter().append("circle").attr("class","clip-scatter-plot").merge(e).style("fill",n._fill||t.color).style("stroke",n._stroke||t.color).style("stroke-width",n._strokeWidth).attr("cx",function(t){return i(t.name)+i.bandwidth()/2||0}).attr("cy",function(t){return o(t.value)||0}).transition().duration(n._transition?.9*n._duration:0).delay(n._startDelay).ease(d3.easeLinear).attrTween("r",function(){var e=d3.interpolate(0,n._radius);return function(t){return e(t)}}).on("start",n._onTransitionStart).on("end",n._onTransitionEnd)});for(var s=e.selectAll(".clip-scatter-plot").nodes(),u=0;u<s.length;u++)""==s[u].__data__.value||isNaN(s[u].__data__.value)?d3.select(s[u]).style("opacity","0"):d3.select(s[u]).style("opacity","1");return n}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"fill",value:function(t){return arguments.length?(this._fill=t,this):this._fill}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"lineWidth",value:function(t){return arguments.length?(this._lineWidth=t,this):this._lineWidth}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"mainGroup",value:function(t){return arguments.length?(this._mainGroup=t,this):this._mainGroup}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Ki=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","simple-line-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n.group,i=n._xScale,o=n._yScale;e.selectAll("filter").remove();var a=n._defs.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_simpleLine").attr("filterUnits","objectBoundingBox");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),a.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.5).attr("result","offsetBlurredAlpha"),a.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","1"),a.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),a.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over");var r=e.selectAll("g").data(t,function(t){return t.name});r.exit().remove(),r.enter().append("g").attr("class","simple-text-group").merge(r).each(function(t){var e=d3.select(this).selectAll("text").data(t.data);e.exit().remove(),e.enter().append("text").attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return o(t.value)||0}).merge(e).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t){return i(t.name)+("mix"==n._type?i.bandwidth()/2:0)||0}).attr("y",function(t){return o(t.value)||0}).attr("text-anchor","middle").style("display",n._labelShow?"block":"none").style("opacity",0).transition().duration(n._transition?.1*n._duration:0).delay(n._transition?.9*n._duration:0).style("opacity",1)}),null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".simple-text-group text").style("display","none"):0==n._positionOptions.indexOf(n._positionChoice)?e.selectAll(".simple-text-group text").attr("dy",.4*-n._fontSize):1==n._positionOptions.indexOf(n._positionChoice)&&e.selectAll(".simple-text-group text").attr("dy",1.3*n._fontSize);for(var l=e.selectAll(".simple-text-group text"),s=[],u=[],h=0;h<l._groups[0].length;h++){u.push(h);for(var c=h+1;c<l._groups[0].length;c++){ut(st(d3.select(l._groups[0][h])),st(d3.select(l._groups[0][c])))&&(s.push(h),d3.select(l._groups[0][h]).style("visibility","hidden"))}}for(var _=new Set(s),d=Array.from(_),f=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(d,u),y=0;y<d.length;y++){for(var p=[],v=0;v<f.length;v++){var g=st(d3.select(l._groups[0][d[y]])),m=st(d3.select(l._groups[0][f[v]]));if(p.push(ut(g,m)),ut(g,m)){if(d[y]==f[v])continue;d3.select(l._groups[0][d[y]]).style("visibility","hidden")}}0==p.filter(function(t){return 1==t}).length&&f.push(d[y])}for(var x=0;x<f.length;x++)d3.select(l._groups[0][f[x]]).style("visibility","visible");return n}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),to=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","simple-line-chart"),e.grid=new Pt(e.coreGroup),e.linePlot=new Ji(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new Rt(e.coreGroup),e.SimpleLineText=new Ki(e.coreGroup),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._showPoints=!0,e._curve=d3.curveLinear,e._lineWidth=2,e._strokeWidth=1,e._endPointRadius=3.5,e._labelShow=!1,e._positionOptions=["上面","下面"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var n=this,r=n.activeData,t=n.grid,e=n.linePlot,i=n.clipArea,l=n.tooltip,o=n.overlay,s=n.guideLine,u=n.guideScatter,a=n.SimpleLineText,h=n.xScale,c=n.yScale,_=n.widthOfCore,d=n.heightOfCore;Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),0);t.width(_).height(d).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray),e.data(r).xScale(h).yScale(c).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).curve(n._curve).lineWidth(n._lineWidth).radius(n._endPointRadius).stroke("#fff").strokeWidth(n._strokeWidth).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(0).moveStyle(n._moveStyle).endPause(n._endPause),s.y1(0).y2(d).stroke("#c6c6c6").strokeDasharray("0 0"),u.xScale(h).yScale(c).fill("#fff"),o.data(h.domain()).isScalePoint(!1).bandWidth(h.step()).bandHeight(d).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:("$-0"==t.name?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update().move([d3.event.offsetX,d3.event.offsetY]).show(),s.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+(h(i)+h.bandwidth()/2)+",0)"),u.data(a).update().show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),s.hide(),u.hide()}),a.data(r).xScale(h).yScale(c).type("mix").defs(n.defs).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(0).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?i.width(_).height(d).paddingVertical([0,0]).transition(n._transition).duration(n._duration):i.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+i.id+")"),i.update(),u.elem.style("pointer-events","none");var f=n.group.selectAll(".axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(f).remove(),o.update(),t.update(),e.update(),a.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=On;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel);var r={straight:d3.curveLinear,step:d3.curveStepAfter,curve:d3.curveCardinal};0!==Object.getOwnPropertyNames(e).length&&(this._strokeWidth=l(e.lineWidth?e.lineWidth:this._strokeWidth),this._curve=r[e.lineType]||this._curve)}}]),n}(),eo="axis-group",no="x-title",io=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._hmsShow=null,e}return h(n,vt),s(n,[{key:"update",value:function(){var n=this,t=n._orient,e=n._scaleFunc,i=n.group,o=n._fontSize,a=n._tickTextRotate,r=n._tickValueTexts,l=void 0;(l=n.axisFunc="top"===t?d3.axisTop(e):d3.axisBottom(e)).tickValues(n._tickShow?n._tickValues:[]).tickSizeInner(n._tickShow?n._tickSize:0).tickSizeOuter(0).tickPadding(n._tickPadding).tickFormat(n._tickFormat);var s=i.select("."+eo).empty()?i.append("g").attr("class",eo):i.select("."+eo);s.style("font-size",o+"px").style("font-family",n._fontFamily).transition().duration(n._transition?n._duration:0).call(l).on("start",function(){s.selectAll(".tick text").remove(),s.selectAll(".tick").append("text").style("fill",n._fontColor).attr("dx",0).attr("dy","1.5em").attr("transform","rotate(0)").style("text-anchor","middle").text(function(t){var e=new Date(t);return n._hmsShow?e.toLocaleDateString()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds():e.toLocaleDateString()}).filter(function(){return a}).attr("dx","-0.5em").style("text-anchor","end").attr("transform","rotate("+n._tickTextRotate+")").filter(function(){return"top"!==t}).attr("dy","0.5em"),s.selectAll(".tick line").style("stroke",n._lineStroke),s.select("path").style("stroke",n._lineStroke).style("display",n._axisLineShow?"block":"none")});var u=Math.abs(e.range()[0]-e.range()[1]);if(n._titleShow&&n._title){var h=i.select("."+no).empty()?i.append("g").attr("class",no):i.select("."+no),c=h.select("text").empty()?h.append("text"):h.select("text"),_=u/r.length,d=d3.max(r,function(t){return E(t,o,n._fontFamily)});h.call(G,u/2+Math.abs(e.range()[0]),this._tickShow?this._tickSize+this._tickPadding+(d<.8*_?this._tickTextHeight:1.2*this._tickTextHeight):0),c.attr("text-anchor","middle").style("font-size",o+"px").style("font-family",n._fontFamily).style("fill",n._fontColor).attr("dy",1.125*o/2+6).text(n._title)}else i.select("."+no).remove()}},{key:"compute",value:function(){var o=this,d=[],a=[],r=0,l=0,t=!1;function s(){o._tickTextRotate=r,o._tickValues=d,o._tickValueTexts=a,o._tickTextHeight=l,o._rotateFlag=t}var f=o._scaleFunc,e=o._type,u=o._fontSize,n=(o._minTickDistance,o._allowedMaxTextHeight),h=Math.abs(f.range()[0]-f.range()[1]),c=void 0,_=void 0;if(function(){if(""==f.domain())return;for(var t=[1,2,6,12,24,48,168],e=new Date(f.domain()[0]),n=new Date(f.domain()[1]),i=parseInt(n.getTime()-e.getTime()),o=!1,a=0,r=0;r<t.length;r++)if(i/(36e5*t[r])<=12){o=!0,a=36e5*t[r];break}if(o)for(var l=0;!(f.domain()[0]+a*l>=f.domain()[1]);l++)d.push(f.domain()[0]+a*l);else{var s=e.toLocaleDateString().split("/"),u=n.toLocaleDateString().split("/");if(3<=u[0]-s[0]){a=Math.ceil((u[0]-s[0])/12);for(var h=0;!(+new Date(e).setFullYear(parseInt(s[0])+h*a)>=f.domain()[1]);h++)d.push(+new Date(e).setFullYear(parseInt(s[0])+h*a))}else if(i<=31536e6)for(var c=0;!(+new Date(e).setMonth(parseInt(s[1])-1+c)>=f.domain()[1]);c++)d.push(+new Date(e).setMonth(parseInt(s[1])-1+c));else for(var _=0;!(+new Date(e).setMonth(parseInt(s[1])-1+3*_)>=f.domain()[1]);_++)d.push(+new Date(e).setMonth(parseInt(s[1])-1+3*_))}}(),function(){var t=!1;c=h/d.length;for(var e=[],n=0;n<d.length;n++){var i=new Date(d[n]);o._hmsShow?e.push(i.toLocaleDateString()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()):e.push(i.toLocaleDateString())}(_=d3.max(e,function(t){return E(t,u,o._fontFamily)}))<c&&(r=0,a=d,l=1.125*u,s(),t=!0);return t}())return o;r="top"===o._orient?45:-45;var i=Math.abs(Math.sin(Math.PI/4));_*i<n?(l=_*i,a=d,t=!1):(l=n,a=d.map(function(t){return I(t,l/i,u,o._fontFamily)}),t=!0);var y=h/d.length;if("category"===e&&y<2*u){var p=Math.ceil(2*u/y);d=d.filter(function(t,e){return e%p==0})}return s(),o}},{key:"hmsShow",value:function(t){return arguments.length?(this._hmsShow=t,this):this._hmsShow}}]),n}();function oo(t,e){var n=0,i=1,o=2,a=3;if(e.forEach(function(t){"任务"===t.name?n=t.index:"起始时间"===t.name?i=t.index:"终止时间"===t.name?o=t.index:"说明"===t.name&&(a=t.index)}),W(t,[n,i,o]))return[];var r={},l=[],s=t.slice(1).map(function(t){return t[n]}),u=t.slice(1);for(var h in u.forEach(function(t,e){l.push({name:""==s[e]||null==s[e]||null==s[e]?"&-"+e:s[e],data:[{name:""==s[e]||null==s[e]||null==s[e]?"&-"+e:s[e],showLegend:""!=s[e]&&null!=s[e]&&null!=s[e],timeStart:null==t[i]||!isNaN(t[i])||isNaN(Date.parse(t[i]))?"":t[i],timeEnd:null==t[o]||!isNaN(t[o])||isNaN(Date.parse(t[o]))?"":t[o],tip:t[a]}]})}),r)l.push(r[h]);return l.forEach(function(t,e){t.key=t.name+"-"+e}),l}var ao=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","gantt-chart"),e.grid=new Pt(e.coreGroup),e.rectPlot=new kn(e.coreGroup),e.xAxis=new io(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(1),e.AnimationArea=new Ot(e.defs),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=-1,e._curve=d3.curveCardinal,e._rectHeight=.5,e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var t,e,o=this,n=o.activeData,i=(t=n,e=[],t.forEach(function(t){e.push(t.data[0])}),e).filter(function(t,e){return""!=t.timeStart}).filter(function(t,e){return""!=t.timeEnd}),a=o.grid,r=o.tooltip,l=o.rectPlot,s=o.xScale,u=o.yScale,h=o.widthOfCore,c=o.heightOfCore,_=o.AnimationArea;l.data(i).xScale(s).yScale(u).rectObj({xFunc:function(t){return s(+new Date(t.timeStart))},yFunc:function(t){return u(t.name)+u.step()*(1-o._rectHeight)/2},widthFunc:function(t){return s(+new Date(t.timeEnd))-s(+new Date(t.timeStart))},heightFunc:function(){return u.step()*o._rectHeight}}).fillOpacity(1).onMousemove(function(t,e){var n=o.elem.node().parentNode,i=(d3.mouse(n),[{text:t.name=="&-"+e?"":t.name,color:t.color},{text:null==t.tip||null==t.tip?"":t.tip},{text:"起始时间: "+t.timeStart},{text:"终止时间: "+t.timeEnd}]);t.tip||(i=[{text:t.name=="&-"+e?"":t.name,color:t.color},{text:"起始时间: "+t.timeStart},{text:"终止时间: "+t.timeEnd}]),r.show(),r.data(i).update().move([d3.event.offsetX,d3.event.offsetY]),d3.select(this).style("cursor","pointer")}).onMouseout(function(){r.hide()}),a.width(h).height(c).xTickLocations(o.xAxis.tickLocations.slice(0)).yTickLocations(o.yAxis.tickLocations.slice(0)).showX(o._gridShowX).showY(o._gridShowY).stroke(o._gridStroke).strokeDasharray(o._gridStrokeDasharray),o.coreGroup.attr("transform","translate("+o.yAxis.width+",0)"),l.update(),a.update(),_.width(0).height(o._height),_.update(),o.coreGroup.attr("clip-path","url(#"+_.id+")"),o.defs.select(".x"+_.id).transition().duration(o._transition?1e3*o._duration:0).delay(o._transition?1e3*o._startDelay:0).attr("width",h)}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"updateAxis",value:function(){var t=this;t.computeDomain();var e=t.xAxis,n=t.yAxis,i=t.xScale,o=t.yScale,a=t._xType,r=t._yType,l=t._xOrient,s=t._yOrient,u=t._fontSize,h=t.widthOfNoMargin,c=t.heightOfMainGroup;i.domain(t._xDomain),e.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(t._xTitle).tickShow(t._xTickShow).lineStroke(t._axisLineStroke).fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration),o.domain(t._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(t._yTitle).tickShow(t._yTickShow).lineStroke("transparent").fontSize(u).fontColor(t._fontColor).fontFamily(t._fontFamily).transition(t._transition).duration(t._duration);n&&n.titleHeight;n.compute(),i.range([0,h-n.width]),e.compute(),o.range([c-e.height,0]),n.compute();var _=n.width,d=c-e.height,f=n.width;e.translate(_,d).update(),n.translate(f,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.data[0].showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=oo;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t,e=this.data().filter(function(t,e){return""!=t.data[0].timeStart}).filter(function(t,e){return""!=t.data[0].timeEnd}),n=this.activeData.filter(function(t,e){return""!=t.data[0].timeStart}).filter(function(t,e){return""!=t.data[0].timeEnd}),i=this.activeData.length?this.activeData.map(function(t){return t.name}):[0,1],o=!1,a=[];e.forEach(function(t){o||(1<t.data[0].timeStart.split(" ").length&&(o=!0),1<t.data[0].timeEnd.split(" ").length&&(o=!0))}),n.forEach(function(t){a.push(+new Date(t.data[0].timeStart)),a.push(+new Date(t.data[0].timeEnd))}),t=""!=a.length?[Math.min.apply(null,a),Math.max.apply(null,a)]:[0,1],this._xDomain=t,this._yDomain=i,this.xAxis.hmsShow(o)}},{key:"setSelfOption",value:function(t){var e=t.animation,n=t.unitDisplay,i=t.sourceDisplay;0!==Object.getOwnPropertyNames(e).length&&(this._transition=e?e.transition:this._transition,this._easeStyle=e.easeStyle?e.easeStyle:this._easeStyle,this._duration=e.duration?e.duration:this._duration,this._startDelay=e.startDelay?e.startDelay:this._startDelay,this._moveStyle=e.moveStyle?e.moveStyle:this._moveStyle,this._endPause=e.endPause?e.endPause:this._endPause),0!==Object.getOwnPropertyNames(n).length&&(this._unitShow=n?n.show:this._unitShow,this._unitWord=n.text?n.text:this._unitWord,this._unitFontSize=n.fontSize?n.fontSize:this._unitSize,this._unitFontColor=n.color?n.color:this._unitColor,this._unitFontFamily=n.fontFamily?n.fontFamily:this._unitFamily,this._unitX=n.xPosition?n.xPosition:this._unitX,this._unitY=n.yPosition?n.yPosition:this._unitY),0!==Object.getOwnPropertyNames(i).length&&(this._sourceShow=i?i.show:this._sourceShow,this._sourceWord=i.text?i.text:this._sourceWord,this._sourceFontSize=i.fontSize?i.fontSize:this._sourceSize,this._sourceFontColor=i.color?i.color:this._sourceColor,this._sourceFontFamily=i.fontFamily?i.fontFamily:this._sourceFamily,this._sourceX=i.xPosition?i.xPosition:this._sourceX,this._sourceY=i.yPosition?i.yPosition:this._sourceY)}}]),n}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ro,lo,so=(function(t,e){var n;n=function(){return function(n){var i={};function o(t){if(i[t])return i[t].exports;var e=i[t]={exports:{},id:t,loaded:!1};return n[t].call(e.exports,e,e.exports,o),e.loaded=!0,e.exports}return o.m=n,o.c=i,o.p="",o(0)}([function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();var h=n(1),r=(n(2),n(6).default),c='<div class="__wc_loading_wrapper__"><div style="padding-left: 60px;" class="__wc_loading_wrapper_item__"><div class="__wc_loading_wrapper_item_inner__">',_="</div></div></div>",o=e.Js2WordCloud=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),window.wordcloudContainer=t,this._container=t,this._wrapper=null,this._canvas=null,this._maskCanvas=null,this._dataMask=null,this._tooltip=null,this._wordcloud2=null,this._option=null,this._init()}return i(e,[{key:"setOption",value:function(t){var o=this;this._option=r.copy(t,!0);var a=this._option.hover;this._option.fontFamily=this._option.fontFamily||"Microsoft YaHei,Helvetica,Times,serif",this._fixWeightFactor(this._option),this._maskCanvas=null;var e;t.tooltip&&!0===t.tooltip.show&&(this._tooltip||(this._tooltip=window.document.createElement("div"),this._tooltip.className="__wc_tooltip__",this._tooltip.style.backgroundColor=t.tooltip.backgroundColor||"rgba(0, 0, 0, 0.701961)",this._tooltip.style.color="#fff",this._tooltip.style.padding="5px",this._tooltip.style.borderRadius="5px",this._tooltip.style.fontSize="12px",this._tooltip.style.fontFamily=t.fontFamily||this._option.fontFamily,this._tooltip.style.lineHeight=1.4,this._tooltip.style.webkitTransition="left 0.2s, top 0.2s",this._tooltip.style.mozTransition="left 0.2s, top 0.2s",this._tooltip.style.transition="left 0.2s, top 0.2s",this._tooltip.style.position="absolute",this._tooltip.style.whiteSpace="nowrap",this._tooltip.style.zIndex=999,this._tooltip.style.display="none",this._container.appendChild(this._tooltip),this._container.onmouseout=function(){o._tooltip.style.display="none"}),this._option.hover=function(t,e,n){if(t){var i=t[0]+": "+t[1];"function"==typeof o._option.tooltip.formatter&&(i=o._option.tooltip.formatter(t)),o._tooltip.innerHTML=i,o._tooltip.style.top=n.offsetY+10+"px",o._tooltip.style.left=n.offsetX+15+"px",o._tooltip.style.display="block",o._container.style.cursor="pointer"}else o._tooltip.style.display="none",o._container.style.cursor="default";a&&a(t,e,n)}),(e=this._option).list&&e.list.sort(function(t,e){return e[1]-t[1]}),this._option&&/\.(jpg|png)$/.test(this._option.imageShape)?function(r){var l=this,s=window.document.createElement("img");s.crossOrigin="Anonymous",s.onload=function(){l._maskCanvas=window.document.createElement("canvas"),l._maskCanvas.width=s.width,l._maskCanvas.height=s.height;var t=l._maskCanvas.getContext("2d");t.drawImage(s,0,0,s.width,s.height);for(var e=t.getImageData(0,0,l._maskCanvas.width,l._maskCanvas.height),n=t.createImageData(e),i=0;i<e.data.length;i+=4){var o=e.data[i]+e.data[i+1]+e.data[i+2],a=e.data[i+3];a<128||384<o?(n.data[i]=n.data[i+1]=n.data[i+2]=255,n.data[i+3]=0):(n.data[i]=n.data[i+1]=n.data[i+2]=0,n.data[i+3]=255)}t.putImageData(n,0,0),u.call(l,r)},s.onerror=function(){u.call(this,r)},s.src=r.imageShape}.call(this,this._option):"circle"===this._option.shape?function(t){this._maskCanvas=window.document.createElement("canvas"),this._maskCanvas.width=500,this._maskCanvas.height=500;var e=this._maskCanvas.getContext("2d");e.fillStyle="#000000",e.beginPath(),e.arc(250,250,240,0,2*Math.PI,!0),e.closePath(),e.fill();for(var n=e.getImageData(0,0,this._maskCanvas.width,this._maskCanvas.height),i=e.createImageData(n),o=0;o<n.data.length;o+=4){var a=n.data[o]+n.data[o+1]+n.data[o+2],r=n.data[o+3];r<128||384<a?(i.data[o]=i.data[o+1]=i.data[o+2]=255,i.data[o+3]=0):(i.data[o]=i.data[o+1]=i.data[o+2]=0,i.data[o+3]=255)}e.putImageData(i,0,0),u.call(this,t)}.call(this,this._option):u.call(this,this._option)}},{key:"on",value:function(){}},{key:"showLoading",value:function(t){var e,n='<div class="__wc_loading__"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';if(t)if(t.backgroundColor&&(this._dataMask.style.backgroundColor=t.backgroundColor),e=void 0===t.text?"正在加载...":t.text,"spin"===t.effect){this._showMask(c+n+e+_);var i=this._dataMask.childNodes[0].childNodes[0],o=i.style.paddingLeft;i.style.paddingLeft=parseInt(o)+45+"px"}else this._showMask(c+e+_);else this._showMask(c+n+"正在加载..."+_)}},{key:"hideLoading",value:function(){this._dataMask&&(this._dataMask.style.display="none")}},{key:"resize",value:function(){this._canvas.width=this._container.clientWidth,this._canvas.height=this._container.clientHeight,u.call(this,this._option)}},{key:"_init",value:function(){var t=this._container.clientWidth,e=this._container.clientHeight;this._container.innerHTML="",this._canvas=window.document.createElement("canvas"),this._canvas.width=t,this._canvas.height=e,this._canvas.style.position="absolute",this._canvas.style.zIndex="1",this._container.appendChild(this._canvas)}},{key:"_fixWeightFactor",value:function(e){if(e.maxFontSize="number"==typeof e.maxFontSize?e.maxFontSize:60,e.minFontSize="number"==typeof e.minFontSize?e.minFontSize:12,e.list&&0<e.list.length){for(var t=e.list[0][1],n=0,i=0,o=e.list.length;i<o;i++)t>e.list[i][1]&&(t=e.list[i][1]),n<e.list[i][1]&&(n=e.list[i][1]);if(t<n){var a="number"==typeof e.fontSizeFactor?e.fontSizeFactor:.1,r=(e.maxFontSize-e.minFontSize)/(Math.pow(n,a)-Math.pow(t,a)),l=e.maxFontSize-r*Math.pow(n,a);e.weightFactor=function(t){return Math.ceil(r*Math.pow(t,a)+l)}}else e.weightFactor=function(t){return e.minFontSize}}}},{key:"_showMask",value:function(t){this._dataMask&&(this._dataMask.innerHTML=t,this._dataMask.style.display=""===t?"none":"block")}},{key:"_dataEmpty",value:function(){return!this._option||!this._option.list||this._option.list.length<=0}}]),e}();function u(t){if(this._maskCanvas){t.clearCanvas=!1;var e=window.document.createElement("canvas").getContext("2d");e.fillStyle=t.backgroundColor||"#fff",e.fillRect(0,0,1,1);var n=e.getImageData(0,0,1,1).data,i=window.document.createElement("canvas");i.width=this._canvas.width,i.height=this._canvas.height;var o=i.getContext("2d");o.drawImage(this._maskCanvas,0,0,this._maskCanvas.width,this._maskCanvas.height,0,0,i.width,i.height);for(var a=o.getImageData(0,0,i.width,i.height),r=o.createImageData(a),l=0;l<a.data.length;l+=4)128<a.data[l+3]?(r.data[l]=n[0],r.data[l+1]=n[1],r.data[l+2]=n[2],r.data[l+3]=n[3]):(r.data[l]=n[0],r.data[l+1]=n[1],r.data[l+2]=n[2],r.data[l+3]=n[3]?n[3]-1:1);o.putImageData(r,0,0),(o=this._canvas.getContext("2d")).clearRect(0,0,this._canvas.width,this._canvas.height),o.drawImage(i,0,0)}if(this._dataEmpty()&&t&&t.noDataLoadingOption){var s="";t.noDataLoadingOption.textStyle&&("string"==typeof t.noDataLoadingOption.textStyle.color&&(s+="color: "+t.noDataLoadingOption.textStyle.color+";"),"number"==typeof t.noDataLoadingOption.textStyle.fontSize&&(s+="font-size: "+t.noDataLoadingOption.textStyle.fontSize+"px;")),"string"==typeof t.noDataLoadingOption.backgroundColor&&(this._dataMask.style.backgroundColor=t.noDataLoadingOption.backgroundColor);var u=t.noDataLoadingOption.text||"";this._showMask(c+'<span class="__wc_no_data_text__" style="'+s+'">'+u+"</span>"+_)}else this._showMask(""),this._wordcloud2=h(this._canvas,t)}t.exports=o},function(n,i,t){var o;(function(){var t,h,R,N,e;window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var n=[void 0],i="zero-timeout-message";return window.addEventListener("message",function(t){if("string"==typeof t.data&&t.data.substr(0,i.length)===i){t.stopImmediatePropagation();var e=parseInt(t.data.substr(i.length),36);n[e]&&(n[e](),n[e]=void 0)}},!0),window.clearImmediate=function(t){n[t]&&(n[t]=void 0)},function(t){var e=n.length;return n.push(t),window.postMessage(i+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),t=this,h=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push))}(),R=function(){if(h){for(var t,e,n=document.createElement("canvas").getContext("2d"),i=20;i;){if(n.font=i.toString(10)+"px sans-serif",n.measureText("Ｗ").width===t&&n.measureText("m").width===e)return i+1;t=n.measureText("Ｗ").width,e=n.measureText("m").width,i--}return 0}}(),N=function(t){for(var e,n,i=t.length;i;e=Math.floor(Math.random()*i),n=t[--i],t[i]=t[e],t[e]=n);return t},(e=function(y,t){if(h){Array.isArray(y)||(y=[y]),y.forEach(function(t,e){if("string"==typeof t){if(y[e]=document.getElementById(t),!y[e])throw"The element id specified is not found."}else if(!t.tagName&&!t.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var O={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var e in t)e in O&&(O[e]=t[e]);if("function"!=typeof O.weightFactor){var n=O.weightFactor;O.weightFactor=function(t){return t*n}}if("function"!=typeof O.shape)switch(O.shape){case"circle":default:O.shape="circle";break;case"cardioid":O.shape=function(t){return 1-Math.sin(t)};break;case"diamond":case"square":O.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"triangle-forward":O.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":O.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":O.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":O.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}O.gridSize=Math.max(Math.floor(O.gridSize),4);var p,v,g,m,x,S,f,C=O.gridSize,a=C-O.maskGapWidth,i=Math.abs(O.maxRotation-O.minRotation),c=Math.min(O.maxRotation,O.minRotation),_=Math.max(O.maxRotation,O.minRotation);switch(O.color){case"random-dark":f=function(){return u(10,50)};break;case"random-light":f=function(){return u(50,90)};break;default:"function"==typeof O.color&&(f=O.color)}var k=null;"function"==typeof O.classes&&(k=O.classes);var b,w=!1,F=[],o=function(t){var e,n,i=t.currentTarget,o=i.getBoundingClientRect();t.touches?(e=t.touches[0].clientX,n=t.touches[0].clientY):(e=t.clientX,n=t.clientY);var a=e-o.left,r=n-o.top,l=Math.floor(a*(i.width/o.width||1)/C),s=Math.floor(r*(i.height/o.height||1)/C);return F[l][s]},A=function(t){var e=o(t);b!==e&&((b=e)?O.hover(e.item,e.dimension,t):O.hover(void 0,void 0,t))},P=function(t){var e=o(t);e&&(O.click(e.item,e.dimension,t),t.preventDefault())},r=[],d=function(t){if(r[t])return r[t];var e=8*t,n=e,i=[];for(0===t&&i.push([m[0],m[1],0]);n--;){var o=1;"circle"!==O.shape&&(o=O.shape(n/e*2*Math.PI)),i.push([m[0]+t*o*Math.cos(-n/e*2*Math.PI),m[1]+t*o*Math.sin(-n/e*2*Math.PI)*O.ellipticity,n/e*2*Math.PI])}return r[t]=i},z=function(){return 0<O.abortThreshold&&(new Date).getTime()-S>O.abortThreshold},D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttribute("xmlns","http://www.w3.org/2000/svg"),D.setAttribute("version","1.1");var l=window.wordcloudContainer.clientWidth,s=window.wordcloudContainer.clientHeight;D.setAttribute("width",l),D.setAttribute("height",s);window.wordcloudContainer.appendChild(D);var L=function(t,e,n,i,o){if(!(v<=t||g<=e||t<0||e<0)){if(p[t][e]=!1,n)y[0].getContext("2d").fillRect(t*C,e*C,a,a);w&&(F[t][e]={item:o,dimension:i})}},M=function(o){var a,r,l;Array.isArray(o)?(a=o[0],r=o[1]):(a=o.word,r=o.weight,l=o.attributes);var s=0===O.rotateRatio?0:Math.random()>O.rotateRatio?0:0===i?c:c<0&&0<_?c+Math.round(Math.random())*i:c+Math.random()*i,u=function(t,e,n){var i=O.weightFactor(e);if(i<=O.minSize)return!1;var o=1;i<R&&(o=function(){for(var t=2;t*i<R;)t+=2;return t}());var a=document.createElement("canvas"),r=a.getContext("2d",{willReadFrequently:!0});r.font=O.fontWeight+" "+(i*o).toString(10)+"px "+O.fontFamily;var l=r.measureText(t).width/o,s=Math.max(i*o,r.measureText("m").width,r.measureText("Ｗ").width)/o,u=l+2*s,h=3*s,c=Math.ceil(u/C),_=Math.ceil(h/C);u=c*C,h=_*C;var d=-l/2,f=.4*-s,y=Math.ceil((u*Math.abs(Math.sin(n))+h*Math.abs(Math.cos(n)))/C),p=Math.ceil((u*Math.abs(Math.cos(n))+h*Math.abs(Math.sin(n)))/C),v=p*C,g=y*C;a.setAttribute("width",v),a.setAttribute("height",g),r.scale(1/o,1/o),r.translate(v*o/2,g*o/2),r.rotate(-n),r.font=O.fontWeight+" "+(i*o).toString(10)+"px "+O.fontFamily,r.fillStyle="#000",r.textBaseline="middle",r.fillText(t,d*o,(f+.5*i)*o);var m=r.getImageData(0,0,v,g).data;if(z())return!1;for(var x,S,k,b=[],w=p,F=[y/2,p/2,y/2,p/2];w--;)for(x=y;x--;){k=C;t:for(;k--;)for(S=C;S--;)if(m[4*((x*C+k)*v+(w*C+S))+3]){b.push([w,x]),w<F[3]&&(F[3]=w),w>F[1]&&(F[1]=w),x<F[0]&&(F[0]=x),x>F[2]&&(F[2]=x);break t}}return{mu:o,occupied:b,bounds:F,gw:p,gh:y,fillTextOffsetX:d,fillTextOffsetY:f,fillTextWidth:l,fillTextHeight:s,fontSize:i}}(a,r,s);if(!u)return!1;if(z())return!1;if(!O.drawOutOfBound){var t=u.bounds;if(t[1]-t[3]+1>v||t[2]-t[0]+1>g)return!1}for(var h=x+1,e=function(t){var e=Math.floor(t[0]-u.gw/2),n=Math.floor(t[1]-u.gh/2);u.gw,u.gh;if(!function(t,e,n,i,o){for(var a=o.length;a--;){var r=t+o[a][0],l=e+o[a][1];if(v<=r||g<=l||r<0||l<0){if(!O.drawOutOfBound)return!1}else if(!p[r][l])return!1}return!0}(e,n,0,0,u.occupied))return!1;!function(l,s,u,h,t,e,n,c,i){var _,d=u.fontSize;_=f?f(h,t,d,e,n):O.color,k?k(h,t,d,e,n):O.classes;var o=u.bounds;o[3],o[0],o[1],o[3],o[2],o[0],y.forEach(function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","text"),n="";n="rotate("+-c/Math.PI*180+" "+((l+u.gw/2)*C+u.fillTextOffsetX+u.fillTextWidth/2)+" "+((s+u.gh/2)*C+u.fillTextOffsetY+u.fillTextHeight/2)+")",1!==u.mu&&(n+="translateX(-"+u.fillTextWidth/4+"px) scale("+1/u.mu+")");var i={font:O.fontWeight+" "+d*u.mu+"px "+O.fontFamily},o={transform:n,webkitTransform:n,msTransform:n,x:(l+u.gw/2)*C+u.fillTextOffsetX+"px",y:(s+u.gh/2)*C+u.fillTextOffsetY+"px",dy:"0.8em"};for(var a in _&&(i.fill=_),e.textContent=h,i)e.style[a]=i[a];for(var r in o)e.setAttribute(r,o[r]);D.append(e)})}(e,n,u,a,r,x-h,t[2],s);var i={};return i.gx=e,i.gy=n,i.info=u,i.word=a,i.weight=r,i.distance=x-h,i.theta=t[2],i.rotateDeg=s,i.attributes=l,function(t,e,n,i,o,a){var r,l,s=o.occupied,u=O.drawMask;if(u&&((r=y[0].getContext("2d")).save(),r.fillStyle=O.maskColor),w){var h=o.bounds;l={x:(t+h[3])*C,y:(e+h[0])*C,w:(h[1]-h[3]+1)*C,h:(h[2]-h[0]+1)*C}}for(var c=s.length;c--;){var _=t+s[c][0],d=e+s[c][1];v<=_||g<=d||_<0||d<0||L(_,d,u,l,a)}u&&r.restore()}(e,n,0,0,u,o),!0};h--;){var n=d(x-h);if(O.shuffle&&(n=[].concat(n),N(n)),n.some(e))return!0}return!1},W=function(n,i,o){if(i)return!y.some(function(t){var e=document.createEvent("CustomEvent");return e.initCustomEvent(n,!0,i,o||{}),!t.dispatchEvent(e)},this);y.forEach(function(t){var e=document.createEvent("CustomEvent");e.initCustomEvent(n,!0,i,o||{}),t.dispatchEvent(e)},this)};!function(){var e=y[0];if(e.getContext)v=Math.ceil(e.width/C),g=Math.ceil(e.height/C);else{var t=e.getBoundingClientRect();v=Math.ceil(t.width/C),g=Math.ceil(t.height/C)}if(W("wordcloudstart",!0)){var n,i,o,a,r;if(m=O.origin?[O.origin[0]/C,O.origin[1]/C]:[v/2,g/2],x=Math.floor(Math.sqrt(v*v+g*g)),p=[],!e.getContext||O.clearCanvas)for(y.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=O.backgroundColor,e.clearRect(0,0,v*(C+1),g*(C+1)),e.fillRect(0,0,v*(C+1),g*(C+1))}else t.textContent="",t.style.backgroundColor=O.backgroundColor,t.style.position="relative"}),n=v;n--;)for(p[n]=[],i=g;i--;)p[n][i]=!0;else{var l=document.createElement("canvas").getContext("2d");l.fillStyle=O.backgroundColor,l.fillRect(0,0,1,1);var s,u,h=l.getImageData(0,0,1,1).data,c=e.getContext("2d").getImageData(0,0,v*C,g*C).data;for(n=v;n--;)for(p[n]=[],i=g;i--;){u=C;t:for(;u--;)for(s=C;s--;)for(o=4;o--;)if(c[4*((i*C+u)*v*C+(n*C+s))+o]!==h[o]){p[n][i]=!1;break t}!1!==p[n][i]&&(p[n][i]=!0)}c=l=h=void 0}if(O.hover||O.click){for(w=!0,n=v+1;n--;)F[n]=[];O.hover&&e.addEventListener("mousemove",A),O.click&&(e.addEventListener("click",P),e.addEventListener("touchstart",P),e.addEventListener("touchend",function(t){t.preventDefault()}),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",A),e.removeEventListener("click",P),b=void 0})}(o=0)!==O.wait?(a=window.setTimeout,r=window.clearTimeout):(a=window.setImmediate,r=window.clearImmediate);var _=function(e,n){y.forEach(function(t){t.removeEventListener(e,n)},this)},d=function t(){_("wordcloudstart",t),r(f)};!function(e,n){y.forEach(function(t){t.addEventListener(e,n)},this)}("wordcloudstart",d);var f=a(function t(){if(o>=O.list.length)return r(f),W("wordcloudstop",!1),void _("wordcloudstart",d);S=(new Date).getTime();var e=M(O.list[o]),n=!W("wordclouddrawn",!0,{item:O.list[o],drawn:e});if(z()||n)return r(f),O.abort(),W("wordcloudabort",!1),W("wordcloudstop",!1),void _("wordcloudstart",d);o++,f=a(t,O.wait)},O.wait)}}()}function u(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}).isSupported=h,e.minFontSize=R,t.WordCloud=e,void 0===(o=function(){return e}.apply(i,[]))||(n.exports=o)}).call(window)},function(t,e,n){var i=n(3);"string"==typeof i&&(i=[[t.id,i,""]]);n(5)(i,{});i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(4)()).push([t.id,"@-webkit-keyframes __wc_loading_animation__ {\r\n  50% {\r\n    opacity: 0.3;\r\n    -webkit-transform: scale(0.4);\r\n            transform: scale(0.4); }\r\n\r\n  100% {\r\n    opacity: 1;\r\n    -webkit-transform: scale(1);\r\n            transform: scale(1); } }\r\n\r\n@keyframes __wc_loading_animation__ {\r\n  50% {\r\n    opacity: 0.3;\r\n    -webkit-transform: scale(0.4);\r\n            transform: scale(0.4); }\r\n\r\n  100% {\r\n    opacity: 1;\r\n    -webkit-transform: scale(1);\r\n            transform: scale(1); } }\r\n\r\n.__wc_loading_wrapper__ {\r\n  display: table;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n.__wc_loading_wrapper_item__ {\r\n  display: table-cell;\r\n  vertical-align: middle;\r\n  text-align: center;\r\n  position: relative;\r\n  padding-right: 60px;\r\n  line-height: 1.4;\r\n}\r\n.__wc_loading_wrapper_item_inner__ {\r\n  position: relative;\r\n  text-align: left;\r\n  display: inline-block;\r\n}\r\n\r\n.__wc_loading__ {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: -40px;\r\n  margin-top: -6px;\r\n}\r\n\r\n  .__wc_loading__ > div:nth-child(1) {\r\n    top: 15px;\r\n    left: 0;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(2) {\r\n    top: 10.22726px;\r\n    left: 10.22726px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.12s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.12s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(3) {\r\n    top: 0;\r\n    left: 15px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.24s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.24s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(4) {\r\n    top: -10.22726px;\r\n    left: 10.22726px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.36s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.36s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(5) {\r\n    top: -15px;\r\n    left: 0;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.48s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.48s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(6) {\r\n    top: -10.22726px;\r\n    left: -10.22726px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.6s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.6s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(7) {\r\n    top: 0;\r\n    left: -15px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.72s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.72s infinite linear; }\r\n  .__wc_loading__ > div:nth-child(8) {\r\n    top: 10.22726px;\r\n    left: -10.22726px;\r\n    -webkit-animation: __wc_loading_animation__ 1s 0.84s infinite linear;\r\n            animation: __wc_loading_animation__ 1s 0.84s infinite linear; }\r\n  .__wc_loading__ > div {\r\n    background-color: #d3d3d3;\r\n    width: 10px;\r\n    height: 10px;\r\n    border-radius: 100%;\r\n    margin: 2px;\r\n    -webkit-animation-fill-mode: both;\r\n            animation-fill-mode: both;\r\n    position: absolute; \r\n  }",""])},function(t,e){t.exports=function(){var r=[];return r.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},r.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&n[a[0]]||(e&&!a[2]?a[2]=e:e&&(a[2]="("+a[2]+") and ("+e+")"),r.push(a))}},r}},function(t,e,n){var s={},i=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}},o=i(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),a=i(function(){return document.head||document.getElementsByTagName("head")[0]}),u=null,h=0,r=[];function c(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=s[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(l(i.parts[a],e))}else{var r=[];for(a=0;a<i.parts.length;a++)r.push(l(i.parts[a],e));s[i.id]={id:i.id,refs:1,parts:r}}}}function _(t){for(var e=[],n={},i=0;i<t.length;i++){var o=t[i],a=o[0],r={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(r):e.push(n[a]={id:a,parts:[r]})}return e}function d(t,e){var n=a(),i=r[r.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),r.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function f(t){t.parentNode.removeChild(t);var e=r.indexOf(t);0<=e&&r.splice(e,1)}function y(t){var e=document.createElement("style");return e.type="text/css",d(t,e),e}function l(e,t){var n,i,o,a,r;if(t.singleton){var l=h++;n=u||(u=y(t)),i=g.bind(null,n,l,!1),o=g.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=t,(r=document.createElement("link")).rel="stylesheet",d(a,r),i=function(t,e){var n=e.css,i=e.sourceMap;i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}.bind(null,n=r),o=function(){f(n),n.href&&URL.revokeObjectURL(n.href)}):(n=y(t),i=function(t,e){var n=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),o=function(){f(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}t.exports=function(t,r){void 0===(r=r||{}).singleton&&(r.singleton=o()),void 0===r.insertAt&&(r.insertAt="bottom");var l=_(t);return c(l,r),function(t){for(var e=[],n=0;n<l.length;n++){var i=l[n];(o=s[i.id]).refs--,e.push(o)}t&&c(_(t),r);for(n=0;n<e.length;n++){var o;if(0===(o=e[n]).refs){for(var a=0;a<o.parts.length;a++)o.parts[a]();delete s[o.id]}}}};var p,v=(p=[],function(t,e){return p[t]=e,p.filter(Boolean).join("\n")});function g(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=v(e,o);else{var a=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(a,r[e]):t.appendChild(a)}}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});for(var l="function"==typeof Symbol&&"symbol"===f(Symbol.iterator)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":f(t)},n={},i=["Null","Undefined","Number","Boolean","String","Object","Function","Array","RegExp","Date"],o=0;o<i.length;o++)n["[object "+i[o]+"]"]=i[o].toLowerCase();function s(t){return n[Object.prototype.toString.call(t)]||"Object"}e.default={copy:function(t,e){if(null===t||"object"!=(void 0===t?"undefined":l(t)))return t;var n,i,o,a,r=(a="array",s(t)===a?[]:{});for(n in t)o=s(i=t[n]),r[n]=!e||"array"!==o&&"object"!==o?i:this.copy(i);return r}}}])},t.exports=n()}(ro={exports:{}},ro.exports),ro.exports),uo=(lo=so)&&lo.__esModule&&Object.prototype.hasOwnProperty.call(lo,"default")?lo.default:lo,ho=(so.Js2WordCloud,function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._container=t,e._fontFamily="noto",e._fontSizeMax="45",e._fontSizeMin="13",e._outerImgUrl="circle.png",e._outerShape="circle",e._textDirection="横向",e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var t=this,e=t._data,n=[],i=0;i<e.length;i++)n.push([e[i].name,e[i].value]);var o=0,a=0,r=0,l=0;"横向"==t._textDirection?l=r=a=0:"对角线"==t._textDirection?(a=-.7854,r=.7854,l=1):"横竖混排"==t._textDirection?(r=a=1.5708,l=.5):"横斜混排"==t._textDirection&&(r=a=.7854,l=.5);var s={tooltip:{show:t._tooltipShow,formatter:function(t){return t[0]+"："+t[1]}},list:n,fontFamily:t._fontFamily,fontWeight:"bold",fontSizeFactor:1,maxFontSize:parseFloat(t._fontSizeMax),minFontSize:parseFloat(t._fontSizeMin),minRotation:a,maxRotation:r,rotateRatio:l,size:.1,shape:t._outerShape,backgroundColor:"transparent",color:function(){return o++,t._data[o-1].color},ellipticity:1,gridSize:5,classes:t.id};new uo(t._container).setOption(s);t._container.getElementsByClassName(""+t.id)}},{key:"setSelfOption",value:function(t){var e=t.display;0!==Object.getOwnPropertyNames(e).length&&(this._fontFamily=e.fontFamily?e.fontFamily:this._fontFamily,this._fontSizeMax=e.fontSizeMax?e.fontSizeMax:this._fontSizeMax,this._fontSizeMin=e.fontSizeMin?e.fontSizeMin:this._fontSizeMin,this._outerImgUrl=e.outerImgUrl?e.outerImgUrl:this._outerImgUrl,this._outerShape=e.outerShape?e.outerShape:this._outerShape,this._textDirection=e.textDirection?e.textDirection:this._textDirection)}}]),n}()),co=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","relative-radar"),e._lineFunc=null,e._startAngle=0,e._endAngle=2*Math.PI,e._radius=100,e._stroke=null,e._borderWidth=2,e._strokeDasharry="",e._transition=!0,e}return h(n,P),s(n,[{key:"update",value:function(){for(var i=this,o=i._data,a=(i.startAngle,i.endAngle,i._radius),t=i._deadData[0].data.length,r=2*Math.PI/t,l=[],s=[],e=function(t){for(var e=[],n=0;n<o.length;n++)e.push(o[n].data[t].value);0<o.length?(l.push([0,d3.max(e)]),s.push(d3.range(6).map(function(t){return d3.max(e)/5*t}))):(l.push([0,1]),s.push(d3.range(6).map(function(t){return.2*t})))},n=0;n<(0<o.length?o[0].data.length:0);n++)e(n);for(var u=d3.scaleLinear().domain([0,1]).range([0,a]).clamp(!0),h=[],c=0;c<o.length;c++){h[c]=[];for(n=0;n<o[c].data.length;n++){var _=o[c].data[n].value;u=d3.scaleLinear().domain(l[n]).range([0,a]).clamp(!0),h[c][n]=u(_)}}for(var d=[],f=0;f<h.length;f++)for(var y=h[f],p="",v=[],g=0;g<t;g++){var m=y[g],x=m*Math.sin(g*r),S=-m*Math.cos(g*r);p+=x+","+S+" ",v.push({x:x,y:S,value:o[f].data[g].value}),d[f]={polygon:p,points:v}}for(var k=5;0<k;k--)for(var b=[],w=a/5*k,F=0;F<t;F++){var O=w*Math.sin(F*r),C=-w*Math.cos(F*r);b.push({x:O,y:C})}for(var A=0<s.length?s[0].length-1:0;0<=A;A--){for(var P=[],z=0;z<s.length;z++)0!=s[z][A]&&P.push(s[z][A]);P.length}var D=i.group;D.selectAll("g").remove();var L=i._lineFunc||d3.line().x(function(t){return t.x}).y(function(t){return t.y});L.curve(d3.curveLinearClosed);var M=i._lineFunc||d3.line().x(function(t){return 0}).y(function(t){return 0});M.curve(d3.curveLinearClosed),D.selectAll(".radar-area-point").remove(),D.selectAll(".relative-polygon").remove(),D.selectAll(".circle-g").remove();var W=D.append("g").selectAll("g").data(d);W.exit().remove(),W.enter().append("g").attr("class","radar-area-point").merge(W).each(function(t,n){d3.select(this).append("path").attr("class","relative-polygon").attr("d",function(t,e){return M(d[n].points)}).style("fill","none").style("stroke-opacity",1).style("stroke",function(t,e){return i._stroke||o[n].color||"#000"}).style("stroke-width",i._borderWidth).transition().delay(n*(i._transition?.8*i._duration/o.length:0)+.1*i._duration).duration(i._transition?.8*i._duration/o.length:0).attr("d",function(t,e){return L(d[n].points)});var e=d3.select(this).selectAll("circle").data(t.points);e.exit().remove(),e.enter().append("circle").attr("class","circle-g").merge(e).attr("cx",0).attr("cy",0).style("stroke","#FFFFFF").style("stroke-width",1).attr("r",0).attr("fill",o[n].color).transition().delay(n*(i._transition?.8*i._duration/o.length:0)+.1*i._duration).duration(i._transition?.8*i._duration/o.length:0).attr("r",i._endPointRadius).attr("cx",function(t,e){return t.x||0}).attr("cy",function(t,e){return t.y||0})}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout);for(var R=[],N=0;N<t;N++){for(var T=[],j=0;j<d.length;j++)T.push(d[j].points[N].value);R.push(d3.max(T))}D.selectAll(".polygon-radar-texts").remove();var Y=D.append("g").selectAll("g").data(o);Y.exit().remove(),Y.enter().append("g").merge(Y).each(function(t,e){var n=d3.select(this).append("g").selectAll("text").data(d[e].points);n.exit().remove(),n.enter().append("text").attr("class","polygon-radar-texts").merge(n).text(function(t,e){return t.value}).attr("fill",i._fontColor).attr("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t,e){return t.value==R[e]?t.x+.06*a*(e*r==1.5*Math.PI?-1:Math.sin(e*r))||0:t.x-.06*a*Math.sin(e*r)||0}).attr("y",function(t,e){return t.value==R[e]?t.y+.06*a*(e*r==0?1.5:Math.cos(e*r))+(e*r==0?i._fontSize/2.5:0)||0:t.y-.06*a*(e*r==Math.PI?-1.5:Math.cos(e*r))+(e*r==Math.PI?i._fontSize/2.5:0)||0}).attr("text-anchor",function(t,e){return e*r==0||e*r==Math.PI?"middle":e*r>Math.PI&&t.value!=R[e]?"start":e*r>Math.PI&&t.value==R[e]||0<e*r&&e*r<Math.PI&&t.value!=R[e]?"end":void 0}).attr("dy",function(t,e){if(t.value==R[e])if(t.value==d3.max(R)){if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.8em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.8em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"1.2em"}else{if(e*r==0)return"0.2em";if(e*r==Math.PI)return"0";if(e*r<Math.PI/2||e*r>1.5*Math.PI)return"0.6em";if(e*r>Math.PI/2&&e*r<1.5*Math.PI)return"-0.6em";if(e*r==Math.PI/2||e*r==1.5*Math.PI)return"1em"}else if(t.value!=R[e])return e*r==0||e*r>Math.PI&&e*r<1.5*Math.PI?"0.3em":"0.2em"}).style("display",i._labelShow?"block":"none").style("opacity",0).transition().delay(i._transition?.9*i._duration:0).duration(i._transition?.1*i._duration:0).style("opacity",1)});for(var X=[],B=1.1*a,G=0;G<t;G++){var E=B*Math.sin(G*r),I=-B*Math.cos(G*r);X.push({x:E,y:I})}D.selectAll(".angle-text").remove();var H=D.append("g").selectAll("text").data(X);H.exit().remove(),H.enter().append("text").attr("class","angle-text").text(function(t,e){return i._deadData[0].data[e].name=="&-"+(e+1)?"":i._deadData[0].data[e].name}).style("font-size",i._themeFontSize).style("font-family",i._themeFontFamily).style("fill",i._themeFontColor).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).style("opacity",0).transition().duration(500).style("opacity",1);for(var V=0;V<t;V++)V*r==0||V*r==Math.PI?d3.select(D.selectAll(".angle-text").nodes()[V]).attr("text-anchor","middle"):V*r>Math.PI?d3.select(D.selectAll(".angle-text").nodes()[V]).attr("text-anchor","end"):0<V*r&&V*r<Math.PI&&d3.select(D.selectAll(".angle-text").nodes()[V]).attr("text-anchor","start");for(var U=0;U<t;U++)U*r==Math.PI&&d3.select(D.selectAll(".angle-text").nodes()[U]).attr("dy","0.8em");for(var q=D.selectAll(".polygon-radar-texts"),Z=[],Q=[],$=0;$<q._groups[0].length;$++){Q.push($);for(var J=$+1;J<q._groups[0].length;J++){ut(st(d3.select(q._groups[0][$])),st(d3.select(q._groups[0][J])))&&(Z.push($),d3.select(q._groups[0][$]).style("visibility","hidden"))}}for(var K=new Set(Z),tt=Array.from(K),et=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(tt,Q),nt=0;nt<tt.length;nt++){for(var it=[],ot=0;ot<et.length;ot++){var at=st(d3.select(q._groups[0][tt[nt]])),rt=st(d3.select(q._groups[0][et[ot]]));if(it.push(ut(at,rt)),ut(at,rt)){if(tt[nt]==et[ot])continue;d3.select(q._groups[0][tt[nt]]).style("visibility","hidden")}}0==it.filter(function(t){return 1==t}).length&&et.push(tt[nt])}for(var lt=0;lt<et.length;lt++)d3.select(q._groups[0][et[lt]]).style("visibility","visible");return i}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"deadData",value:function(t){return arguments.length?(this._deadData=t,this):this._deadData}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"themeFontColor",value:function(t){return arguments.length?(this._themeFontColor=t,this):this._themeFontColor}},{key:"themeFontSize",value:function(t){return arguments.length?(this._themeFontSize=t,this):this._themeFontSize}},{key:"themeFontFamily",value:function(t){return arguments.length?(this._themeFontFamily=t,this):this._themeFontFamily}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeDasharry",value:function(t){return arguments.length?(this._strokeDasharry=t,this):this._strokeDasharry}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),_o=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.gridPolygon=new Jn(e.mainGroup),e.coreGroup=e.mainGroup.append("g").attr("class","core-group"),e.radar=new co(e.coreGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._showPoints=!0,e._fillOpacity=0,e._endPointRadius=3.5,e._borderWidth=2,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var a=this;a.group.selectAll(".polygon-grid").style("opacity",0).transition().duration(a._transition?.1*a._duration:0).style("opacity",1);var r=a.activeData,t=a.gridPolygon,e=a.radar,n=(a.tooltip,a.widthOfCore,a.heightOfCore,a.widthOfNoMargin),i=a.heightOfMainGroup,o=L(.84*n,.84*a.heightOfMainGroup,a._startAngle,a._endAngle).radius,l=a.defs;l.selectAll("filter").remove();var s=l.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_relativeRadar").attr("filterUnits","objectBoundingBox");s.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),s.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),s.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),s.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),s.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(r).deadData(a.sortedDataCopy).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).themeFontSize(a._fontSize).themeFontColor(a._fontColor).themeFontFamily(a._fontFamily).fillOpacity(.6).labelShow(a._labelShow).radius(o).borderWidth(a._borderWidth).endPointRadius(a._endPointRadius).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).onMouseover(function(t,e){a.group.selectAll(".relative-polygon").transition().style("fill-opacity",.5);var n=[{text:r[e].name=="$-"+(e+1)?"":r[e].name,color:r[e].color}];r[e].data.forEach(function(t,e){n.push({text:(t.name=="&-"+(e+1)?"":t.name)+": "+t.value,color:"none"})}),d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var i=a.group.selectAll(".radar-area-point").nodes(),o=a.group.selectAll(".relative-radar .relative-polygon").nodes();d3.selectAll(i[e].childNodes).style("r",1.5*a._endPointRadius),d3.select(o[e]).transition().style("stroke-width",1.5*a._borderWidth),a.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(t,e){d3.select(this).style("stroke-opacity",1).style("stroke-width",1.5*a._borderWidth);var n=a.group.selectAll(".radar-area-point").nodes(),i=a.group.selectAll(".relative-radar .relative-polygon").nodes();d3.select(i[e]).style("stroke-width",1.5*a._borderWidth),d3.selectAll(n[e].childNodes).style("r",1.5*a._endPointRadius),a.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t,e){a.group.transition().selectAll(".relative-polygon").style("fill-opacity",.6),d3.select(this).style("stroke-opacity",.8).style("stroke-width",a._borderWidth);var n=a.group.selectAll(".radar-area-point").nodes(),i=a.group.selectAll(".relative-radar .relative-polygon").nodes();d3.select(i[e]).style("stroke-width",a._borderWidth),d3.selectAll(n[e].childNodes).style("r",a._endPointRadius),a.tooltip.hide()}),t.data(a.sortedDataCopy).radius(o).fillOpacity(null==a._fillOpacity?0:a._fillOpacity).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray);var u=(a._width-a._marginLeft-a._marginRight)/2;a.gridPolygon.translate(u,i/2).update(),a.coreGroup.call(G,u,i/2),t.update(),e.update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=Kn;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),0!==Object.getOwnPropertyNames(e).length&&this.fillOpacity(e.fillOpacity).endPointRadius(e.endPointRadius).borderWidth(e.borderWidth)}},{key:"endPointRadius",value:function(t){return arguments.length?(this._endPointRadius=t,this):this._endPointRadius}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"widthOfNoMargin",get:function(){var t=this._width-3*this._marginLeft-this._marginRight;return 0<t?t:0}}]),n}(),fo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","contrastive-funnel-polygon"),e._fontColor="#ffffff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var n=this,i=n._data,t=n._maxValue,o=0<i.length?i[0].value:0,a=d3.scaleLinear().domain([0,t]).range([0,n._sWidth]),r=(0<n._sHeight?n._sHeight:0)/i.length,e=n.group,l=0;l<i.length;l++)i[l].percent=Math.ceil(i[l].value/t*100);n.group.selectAll("*").remove(),n.group.selectAll(".funnel-groups").remove();var s=e.selectAll("polygon").data(i);s.exit().remove();var u=s.enter().append("g").attr("class","funnel-groups");u.append("polygon").merge(s).attr("class","funnel-polygons").style("fill",function(t){return t.color}).style("fill-opacity",1).style("stroke","#ffffff").style("opacity",1).attr("points",function(t,e){return e==i.length-1?a(i[e].total)/2+(n._sWidth-a(o))/2+","+r*e+"\n        "+(a(t.value)+a(i[e].total)/2+(n._sWidth-a(o))/2)+","+r*e+" \n        "+(a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2)+","+r*(e+1):a(i[e].total)/2+(n._sWidth-a(o))/2+","+r*e+"\n        "+(a(t.value)+a(i[e].total)/2+(n._sWidth-a(o))/2)+","+r*e+" \n        "+(a(i[e+1].value)+a(i[e+1].total)/2+(n._sWidth-a(o))/2)+","+r*(e+1)+" \n        "+(a(i[e+1].total)/2+(n._sWidth-a(o))/2)+","+r*(e+1)}).style("display",function(t){return t.tooltipValueShow?"block":"none"}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);if(0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)||0==n._contentChoice.length)n.group.selectAll(".funnel-text-group").remove();else if(0==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){n.group.selectAll(".funnel-text-group").remove();var h=u.append("g").merge(s).attr("class","funnel-text-group");h.append("text").text(function(t,e){return t.name=="$-"+e?"":t.name}).attr("class","funnel-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","1em").style("display",n._labelShow?"block":"none"),h.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","1em").style("display",n._labelShow?"block":"none"),h.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","1em").style("display",n._labelShow?"block":"none"),0==n._labelShow||null==n._labelShow||null==n._contentOption||null==n._contentChoice||0==n._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block"),e.selectAll(".funnel-texts-value").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block")):2==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),e.selectAll(".funnel-texts-value").style("display","none"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.percent,n._fontSize,n._fontFamily))/2+", 0)"})):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),h.attr("transform",function(t,e){return"translate("+(E(t.percent,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):3==n._contentChoice.length&&n._labelShow&&(e.selectAll(".funnel-texts-name").attr("text-anchor","end").attr("dx","-1.5em"),e.selectAll(".funnel-texts-percent"),e.selectAll(".funnel-texts-value").attr("text-anchor","start").attr("dx","1.5em"),h.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"}))}else if(1==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){n.group.selectAll(".funnel-text-group").remove();var c=u.append("g").merge(s).attr("class","funnel-text-group");c.append("text").text(function(t,e){return(t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName)}).attr("class","funnel-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","-0.1em").style("display",n._labelShow?"block":"none"),c.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","start").attr("dy","1em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(-E((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),n._fontSize,n._fontFamily)/2+E(t.value.toString(),n._fontSize,n._fontFamily)+5)+",0)"}),c.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","start").attr("dy","1em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+-E((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),n._fontSize,n._fontFamily)/2+",0)"}),0==n._labelShow||null==n._labelShow||null==n._contentOption||null==n._contentChoice||0==n._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","0.5em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","middle").attr("dy","0.5em").attr("transform","translate(0, 0)"),e.selectAll(".funnel-texts-value").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","middle").attr("dy","0.5em").attr("transform","translate(0, 0)")):2==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","middle").attr("transform","translate(0, 0)"),e.selectAll(".funnel-texts-value").style("display","none")):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","middle").attr("transform","translate(0, 0)")):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","middle").attr("transform","translate(0, 0)").attr("dy","-0.1em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","middle").attr("transform","translate(0, 0)").attr("dy","1em")):3==n._contentChoice.length&&n._labelShow}else if(2==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){n.group.selectAll(".funnel-text-group").remove();var _=u.append("g").merge(s).attr("class","funnel-text-group").style("opacity",0);_.transition().duration(n._transition?.1*n._duration:0).delay(n._transition?n._startDelay+.9*n._duration:0).style("opacity",1),_.append("text").text(function(t,e){return(t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName)}).attr("class","funnel-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",n._labelShow?"block":"none"),_.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",n._labelShow?"block":"none"),_.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","0.3em").style("display",n._labelShow?"block":"none"),0==n._labelShow||null==n._labelShow||null==n._contentOption||null==n._contentChoice||0==n._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block"),e.selectAll(".funnel-texts-value").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block")):2==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),e.selectAll(".funnel-texts-value").style("display","none"),_.attr("transform",function(t,e){return"translate("+(E((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),n._fontSize,n._fontFamily)-E(t.percent,n._fontSize,n._fontFamily))/2+", 0)"})):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),_.attr("transform",function(t,e){return"translate("+(E((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),_.attr("transform",function(t,e){return"translate("+(E(t.percent,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):3==n._contentChoice.length&&n._labelShow&&(e.selectAll(".funnel-texts-name").attr("text-anchor","end").attr("dx","-1.5em"),e.selectAll(".funnel-texts-percent"),e.selectAll(".funnel-texts-value").attr("text-anchor","start").attr("dx","1.5em"),_.attr("transform",function(t,e){return"translate("+(E((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"}))}return n}},{key:"maxValue",value:function(t){return arguments.length?(this._maxValue=t,this):this._maxValue}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),yo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","contrastive-funnel-bg"),e._fontColor="#ffffff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var o=this,a=o._data,t=o._maxValue,r=0<a.length?a[0].value:0,l=d3.scaleLinear().domain([0,t]).range([0,o._sWidth]),n=(0<o._sHeight?o._sHeight:0)/a.length,e=o.group,i=0;i<a.length;i++)a[i].percent=Math.ceil(a[i].value/t*100);o.group.selectAll("*").remove(),o.group.selectAll(".bg-funnel-groups").remove();var s=e.selectAll("polygon").data(a);s.exit().remove();var u=s.enter().append("g").attr("class","bg-funnel-groups");u.append("polygon").merge(s).attr("class","bg-funnel-polygons").style("fill",function(t){return t.color}).style("fill-opacity",.8).style("stroke","#ffffff").style("opacity",1).attr("points",function(t,e){return e==a.length-1?l(a[e].total)/2+(o._sWidth-l(r))/2+","+n*e+"\n        "+(l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*e+" \n        "+(l(t.value)/2+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1):l(a[e].total)/2+(o._sWidth-l(r))/2+","+n*e+"\n        "+(l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2)+","+n*e+" \n        "+(l(a[e+1].value)+l(a[e+1].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1)+" \n        "+(l(a[e+1].total)/2+(o._sWidth-l(r))/2)+","+n*(e+1)}).style("display",function(t){return t.tooltipValueShow?"block":"none"}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);if(0==o._labelShow||null==o._labelShow||null==o._positionOptions||null==o._positionChoice||-1==o._positionOptions.indexOf(o._positionChoice)||2==o._positionOptions.indexOf(o._positionChoice)||0==o._contentChoice.length)o.group.selectAll(".funnel-text-group").remove();else if(0==o._positionOptions.indexOf(o._positionChoice)&&o._labelShow){o.group.selectAll(".funnel-text-group").remove(),u.append("g").merge(s).attr("class","funnel-text-group").append("text").text(function(t,e){if(e==a.length-1){var n=l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width;return I(t.firstName=="$-"+e+1?"":t.firstName,.96*o._width-n,o._fontSize,o._fontFamily)}var i=l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width;return I(t.firstName=="$-"+e+1?"":t.firstName,.96*o._width-i,o._fontSize,o._fontFamily)}).attr("class","funnel-texts-name").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2+.11*o._width:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)+.11*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.35em").style("display",o._labelShow?"block":"none"),0!=o._labelShow&&null!=o._labelShow&&null!=o._contentOption&&null!=o._contentChoice&&0!=o._contentChoice.length||e.selectAll(".funnel-texts-name").style("display","none")}else if(1==o._positionOptions.indexOf(o._positionChoice)&&o._labelShow){o.group.selectAll(".funnel-text-group").remove();var h=u.append("g").merge(s).attr("class","funnel-text-group");h.append("line").attr("class","funnel-texts-line").attr("x1",function(t,e){return e==a.length-1?l(t.value)+l(a[e].total)/2-l(a[e].value)/4+(o._sWidth-l(r))/2:l(t.value)+l(a[e].total)/2+(o._sWidth-l(r))/2-(0<a[e].value-a[e+1].value?l(a[e].value-a[e+1].value)/4:-l(a[e+1].value-a[e].value)/4)}).attr("y1",function(t,e){return n*(e+1)-n/2}).attr("x2",function(t,e){return.78*o._width}).attr("y2",function(t,e){return n*(e+1)-n/2}).style("stroke",function(t){return"#bfbfbf"}).style("stroke-width",1).style("display",o._labelShow?"block":"none"),h.append("text").text(function(t,e){return I((t.name=="$-"+e?"":t.name)+(t.firstName=="$-"+e+1?"":t.firstName),.18*o._width,o._fontSize,o._fontFamily)}).attr("class","funnel-texts-name").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","-0.35em").style("display",o._labelShow?"block":"none"),h.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none"),h.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",o._fontColor).style("font-size",o._fontSize).style("font-family",o._fontFamily).attr("x",function(t,e){return.78*o._width}).attr("y",function(t,e){return n*(e+1)-n/2}).attr("text-anchor","start").attr("dy","0.75em").style("display",o._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(t.percent+"%",o._fontSize,o._fontFamily)+5)+",0)"}),0==o._labelShow||null==o._labelShow||null==o._contentOption||null==o._contentChoice||0==o._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==o._contentOption.indexOf(o._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.35em"),e.selectAll(".funnel-texts-value").style("display","none")):2==o._contentOption.indexOf(o._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.35em").attr("transform","translate(0, 0)")):2==o._contentChoice.length&&o._labelShow?0==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1])||1==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","0.75em"),e.selectAll(".funnel-texts-value").style("display","none")):0==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&0==o._contentOption.indexOf(o._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):(1==o._contentOption.indexOf(o._contentChoice[0])&&2==o._contentOption.indexOf(o._contentChoice[1])||2==o._contentOption.indexOf(o._contentChoice[0])&&1==o._contentOption.indexOf(o._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("dy","-0.35em"),e.selectAll(".funnel-texts-value").style("display","block").attr("dy","0.75em").attr("transform","translate(0, 0)")):3==o._contentChoice.length&&o._labelShow}return o}},{key:"maxValue",value:function(t){return arguments.length?(this._maxValue=t,this):this._maxValue}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),po=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","contrastive-bg-text"),e._fontColor="#ffffff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var n=this,i=n._data,t=n._maxValue,o=0<i.length?i[0].value:0,a=d3.scaleLinear().domain([0,t]).range([0,n._sWidth]),r=(0<n._sHeight?n._sHeight:0)/i.length,e=n.group,l=0;l<i.length;l++)i[l].percent=Math.ceil(i[l].value/t*100);if(n.group.selectAll("*").remove(),0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice)||2==n._positionOptions.indexOf(n._positionChoice)||0==n._contentChoice.length)n.group.selectAll(".funnel-text-group").remove();else if(0==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){n.group.selectAll(".funnel-text-group").remove();var s=e.selectAll("g").data(i);s.exit().remove();var u=s.enter().append("g").attr("class","funnel-text-group");u.append("text").text(function(t,e){return t.name=="$-"+e?"":t.name}).attr("class","funnel-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","-0.1em").style("display",n._labelShow?"block":"none"),u.append("text").text(function(t){return t.percent+"%"}).attr("class","funnel-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","-0.1em").style("display",n._labelShow?"block":"none"),u.append("text").text(function(t){return t.value}).attr("class","funnel-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",function(t,e){return a(t.value)/2+a(i[e].total)/2+(n._sWidth-a(o))/2}).attr("y",function(t,e){return r*(e+1)-r/2}).attr("text-anchor","middle").attr("dy","-0.1em").style("display",n._labelShow?"block":"none"),0==n._labelShow||null==n._labelShow||null==n._contentOption||null==n._contentChoice||0==n._contentChoice.length?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","block"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","none")):1==n._contentOption.indexOf(n._contentChoice[0])?(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block"),e.selectAll(".funnel-texts-value").style("display","none")):2==n._contentOption.indexOf(n._contentChoice[0])&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block")):2==n._contentChoice.length&&n._labelShow?0==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1])||1==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),e.selectAll(".funnel-texts-value").style("display","none"),u.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.percent,n._fontSize,n._fontFamily))/2+", 0)"})):0==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&0==n._contentOption.indexOf(n._contentChoice[1])?(e.selectAll(".funnel-texts-name").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-percent").style("display","none"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),u.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):(1==n._contentOption.indexOf(n._contentChoice[0])&&2==n._contentOption.indexOf(n._contentChoice[1])||2==n._contentOption.indexOf(n._contentChoice[0])&&1==n._contentOption.indexOf(n._contentChoice[1]))&&(e.selectAll(".funnel-texts-name").style("display","none"),e.selectAll(".funnel-texts-percent").style("display","block").attr("text-anchor","end").attr("dx","-0.3em"),e.selectAll(".funnel-texts-value").style("display","block").attr("text-anchor","start").attr("dx","0.3em"),u.attr("transform",function(t,e){return"translate("+(E(t.percent,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"})):3==n._contentChoice.length&&n._labelShow&&(e.selectAll(".funnel-texts-name").attr("text-anchor","end").attr("dx","-1.5em"),e.selectAll(".funnel-texts-percent"),e.selectAll(".funnel-texts-value").attr("text-anchor","start").attr("dx","1.5em"),u.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(t.value,n._fontSize,n._fontFamily))/2+", 0)"}))}return n}},{key:"maxValue",value:function(t){return arguments.length?(this._maxValue=t,this):this._maxValue}},{key:"defs",value:function(t){return arguments.length?(this.defs=t,this):this.defs}},{key:"sWidth",value:function(t){return arguments.length?(this._sWidth=t,this):this._sWidth}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"sHeight",value:function(t){return arguments.length?(this._sHeight=t,this):this._sHeight}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}();function vo(t,e){var n=0,i=1,o=2;if(e.forEach(function(t){"objCol"===t.function?(n=t.index,t.isLegend):"vCol"===t.function&&("实际值"==t.name?i=t.index:o=t.index)}),W(t,[n],2))return[];if(!C(t,i)||!C(t,o))return[];for(var a={},r=[],l=t.length,s=t[0],u=[],h=1;h<l;h++)u.push(t[h].length);u.sort(function(t,e){return e-t});for(var c=1;c<l;c++){var _=t[c],d=_[n];if(""!=d&&null!=d&&null!=d||(d="$-"+c),d){for(var f={name:d,showLegend:d!="$-"+c,data:[]},y=0;y<u[0];y++)if(y==i||y==o){var p=s[y];""!=p&&null!=p&&null!=p||(p="&-"+y),p&&(y==i&&f.data.push({name:p,value:""==_[y]||isNaN(parseFloat(_[y]))||null==_[y]||null==_[y]||parseFloat(_[y])<0?0:_[y],tooltipValueShow:!(isNaN(parseFloat(_[y]))||parseFloat(_[y])<0),type:"实际值"}),y==o&&f.data.push({name:p,value:""==_[y]||isNaN(parseFloat(_[y]))||null==_[y]||null==_[y]||parseFloat(_[y])<0?0:_[y],tooltipValueShow:!(isNaN(parseFloat(_[y]))||parseFloat(_[y])<0)}))}r.push(f)}}for(var v in a)r.push(a[v]);return r.forEach(function(t,e){t.key=M(t.name)+"-"+e}),r}var go=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","contrasitive-funnel-chart"),e.funnelBg=new yo(e.mainGroup),e.funnel=new fo(e.mainGroup),e.contrastiveBgText=new po(e.mainGroup),e._sortValue=null,e._labelShow=!1,e._positionOptions=["主体展示","内外展示","仅内部"],e._positionChoice="主体展示",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#FFFFFF",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){for(var i=this,o=i.activeData,t=i.funnelBg,e=i.funnel,n=i.contrastiveBgText,a=i.widthOfNoMargin,r=.69*a,l=.92*i.heightOfMainGroup,s=0;s<o.length;s++)for(var u=0;u<o[s].data.length;u++)o[s].data[u].diff=0==s?0:o[s-1].data[u].value-o[s].data[u].value;for(var h=0;h<o.length;h++)for(var c=0;c<o[h].data.length;c++)o[h].data[c].total=0==h?0:o[h-1].data[c].total+parseFloat(o[h].data[c].diff);for(var _=[],d=[],f=0;f<o.length;f++){_[f]={},d[f]={},_[f].color=o[f].color,_[f].firstName=o[f].name,d[f].color=o[f].color,d[f].firstName=o[f].name;for(var y=0;y<o[f].data.length;y++)"实际值"==o[f].data[y].type?(_[f].name=o[f].data[y].name,_[f].value=o[f].data[y].value,_[f].total=o[f].data[y].total,_[f].tooltipValueShow=o[f].data[y].tooltipValueShow):(d[f].name=o[f].data[y].name,d[f].value=o[f].data[y].value,d[f].total=o[f].data[y].total,d[f].tooltipValueShow=o[f].data[y].tooltipValueShow)}var p=d3.max(o,function(t){return d3.max(t.data,function(t){return+t.value})});t.data(d).maxValue(p).width(a).sWidth(r).sHeight(l).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){var n=[{text:""+(o[e].showLegend?o[e].name:""),color:t.color},{text:("&-"==o[e].data[0].name.slice(0,2)?"":o[e].data[0].name)+": "+(o[e].data[0].tooltipValueShow?o[e].data[0].value:"")},{text:("&-"==o[e].data[1].name.slice(0,2)?"":o[e].data[1].name)+": "+(o[e].data[1].tooltipValueShow?o[e].data[1].value:"")}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){i.tooltip.hide()}),e.data(_).maxValue(p).width(a).sWidth(r).sHeight(l).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){var n=[{text:""+(o[e].showLegend?o[e].name:""),color:t.color},{text:("&-"==o[e].data[0].name.slice(0,2)?"":o[e].data[0].name)+": "+(o[e].data[0].tooltipValueShow?o[e].data[0].value:"")},{text:("&-"==o[e].data[1].name.slice(0,2)?"":o[e].data[1].name)+": "+(o[e].data[1].tooltipValueShow?o[e].data[1].value:"")}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){i.tooltip.hide()}),n.data(d).maxValue(p).width(a).sWidth(r).sHeight(l).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).contentOption(i._contentOption).contentChoice(i._contentChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily);var v=.155*a,g=.04*l;null==i._labelShow||null==i._positionOptions||null==i._positionChoice||2==i._positionOptions.indexOf(i._positionChoice)||0==i._contentChoice.length||0!=i._positionOptions.indexOf(i._positionChoice)&&1!=i._positionOptions.indexOf(i._positionChoice)||1==i._labelShow&&(v=.04*a),i.funnel.translate(v,g).update(),i.funnelBg.translate(v,g).update(),i.contrastiveBgText.translate(v,g).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"buildOption",value:function(t,e){var n=new bn(t,e),i=vo;return n.dataSolveFunc(i),n}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel,this._contentChoice=e.contentChoice?e.contentChoice:this._contentChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice)}}]),n}(),mo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-circle"),e._fontColor="#ffffff",e}return h(n,P),s(n,[{key:"update",value:function(){for(var n=this,i=n._data,o=d3.max(i,function(t){return Math.abs(t.value)}),a=(0<i.length&&i[0].value,d3.scaleLinear().domain([0,o]).range([0,n._maxRadius])),t=n.group,e=0;e<i.length;e++)i[e].percent=Math.ceil(i[e].value/o*100);t.selectAll("*").remove(),n.group.selectAll(".stack-circle-groups").remove();var r=t.selectAll("circle").data(i);r.exit().remove();r.enter().append("g").attr("class","stack-circle-groups").append("circle").merge(r).attr("class","stack-circles").style("fill",function(t){return t.color}).attr("r",function(t,e){return a(t.value)}).attr("transform",function(t,e){return"translate(0, "+a(t.total)+")"}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);if(0==n._labelShow||null==n._labelShow||null==n._positionOptions||null==n._positionChoice||-1==n._positionOptions.indexOf(n._positionChoice))t.selectAll(".stack-circle-texts-name").style("display","none"),t.selectAll(".stack-circle-texts-percent").style("display","none"),t.selectAll(".stack-circle-texts-value").style("display","none"),t.selectAll(".stack-circle-text-group").remove(),t.selectAll(".outer-circle-texts-name").style("display","none"),t.selectAll(".outer-circle-texts-percent").style("display","none"),t.selectAll(".outer-circle-texts-value").style("display","none"),t.selectAll(".outer-circle-texts-line").style("display","none"),t.selectAll(".outer-circle-text-group").remove();else if(0==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){t.selectAll(".outer-circle-texts-name").style("display","none"),t.selectAll(".outer-circle-texts-percent").style("display","none"),t.selectAll(".outer-circle-texts-value").style("display","none"),t.selectAll(".outer-circle-texts-line").style("display","none"),t.selectAll(".stack-circle-text-group").remove();var l=n.group.append("g").attr("class","stack-circle-text-group").selectAll("g").data(i);l.exit().remove();var s=l.enter().append("g");s.append("text").text(function(t,e){return t.name=="$-"+e?"":t.name}).attr("class","stack-circle-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",0).attr("y",function(t,e){return e==i.length-1?-a(t.value):-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","end").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(-E(t.value.toString(),n._fontSize,n._fontFamily)/2-5)+","+n._maxRadius+")"}),s.append("text").text(function(t){return parseFloat(t.value/o*100).toFixed(0)+"%"}).attr("class","stack-circle-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",0).attr("y",function(t,e){return e==i.length-1?-a(t.value):-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","start").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(t.value.toString(),n._fontSize,n._fontFamily)/2+5)+","+n._maxRadius+")"}),s.append("text").text(function(t){return t.value}).attr("class","stack-circle-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",0).attr("y",function(t,e){return e==i.length-1?-a(t.value):-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","middle").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate(0,"+n._maxRadius+")"}),s.attr("transform",function(t,e){return"translate("+(E(t.name=="$-"+e?"":t.name,n._fontSize,n._fontFamily)-E(parseFloat(t.value/o*100).toFixed(0)+"%",n._fontSize,n._fontFamily))/2+", 0)"})}else if(1==n._positionOptions.indexOf(n._positionChoice)&&n._labelShow){t.selectAll(".stack-circle-texts-name").style("display","none"),t.selectAll(".stack-circle-texts-percent").style("display","none"),t.selectAll(".stack-circle-texts-value").style("display","none"),t.selectAll(".outer-circle-text-group").remove();var u=n.group.append("g").attr("class","outer-circle-text-group").selectAll("g").data(i);u.exit().remove();var h=u.enter().append("g");h.append("line").attr("class","outer-circle-texts-line").attr("x1",0).attr("y1",function(t,e){return e==i.length-1?2*-a(t.value):2*-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("x2",.32*n._width).attr("y2",function(t,e){return e==i.length-1?2*-a(t.value):2*-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).style("stroke",function(t){return t.color}).style("stroke-width",1).style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate(0,"+(n._maxRadius+1)+")"}),h.append("text").text(function(t,e){return I(t.name=="$-"+e?"":t.name,.36*n._width-E(parseFloat(t.value/o*100).toFixed(0)+"%",n._fontSize,n._fontFamily)-E(t.value.toString(),n._fontSize,n._fontFamily)-10,n._fontSize,n._fontFamily)}).attr("class","outer-circle-texts-name").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",.32*n._width+2).attr("y",function(t,e){return e==i.length-1?2*-a(t.value):2*-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","start").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate(0,"+n._maxRadius+")"}),h.append("text").text(function(t){return parseFloat(t.value/o*100).toFixed(0)+"%"}).attr("class","outer-circle-texts-percent").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",.32*n._width+2).attr("y",function(t,e){return e==i.length-1?2*-a(t.value):2*-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","start").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(I(t.name=="$-"+e?"":t.name,.36*n._width-E(parseFloat(t.value/o*100).toFixed(0)+"%",n._fontSize,n._fontFamily)-E(t.value.toString(),n._fontSize,n._fontFamily)-10,n._fontSize,n._fontFamily),n._fontSize,n._fontFamily)+E(t.value.toString(),n._fontSize,n._fontFamily)+10)+","+n._maxRadius+")"}),h.append("text").text(function(t){return t.value}).attr("class","outer-circle-texts-value").style("fill",n._fontColor).style("font-size",n._fontSize).style("font-family",n._fontFamily).attr("x",.32*n._width+2).attr("y",function(t,e){return e==i.length-1?2*-a(t.value):2*-a(i[e].value-i[e+1].value)-2*a(i[e+1].value)}).attr("text-anchor","start").attr("dy","0.5em").style("display",n._labelShow?"block":"none").attr("transform",function(t,e){return"translate("+(E(I(t.name=="$-"+e?"":t.name,.36*n._width-E(parseFloat(t.value/o*100).toFixed(0)+"%",n._fontSize,n._fontFamily)-E(t.value.toString(),n._fontSize,n._fontFamily)-10,n._fontSize,n._fontFamily),n._fontSize,n._fontFamily)+5)+","+n._maxRadius+")"})}return n}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"width",value:function(t){return arguments.length?(this._width=t,this):this._width}},{key:"maxRadius",value:function(t){return arguments.length?(this._maxRadius=t,this):this._maxRadius}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}}]),n}(),xo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","stack-circle-chart"),e.stackCircle=new mo(e.mainGroup),e._sortValue=-1,e._labelShow=!1,e._positionOptions=["内部居中","外部"],e._positionChoice=["内部居中"],e._textLabel={color:"#FFFFFF",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,A),s(n,[{key:"updateCore",value:function(){var i=this,t=i.activeData.filter(function(t,e){return 0<t.value||0==t.value}),e=i.stackCircle,n=i.widthOfNoMargin,o=.86*i.heightOfMainGroup,a=.56*i.widthOfNoMargin;null==i._labelShow||null==i._positionOptions||null==i._positionChoice?(o=.88*i.heightOfMainGroup,a=.88*i.widthOfNoMargin):0!=i._labelShow&&0!=i._positionOptions.indexOf(i._positionChoice)&&-1!=i._positionOptions.indexOf(i._positionChoice)||(o=.88*i.heightOfMainGroup,a=.88*i.widthOfNoMargin);for(var r=L(a,o,i._startAngle,i._endAngle),l=r.radius,s=d3.max(t,function(t){return Math.abs(t.value)}),u=0;u<t.length;u++)t[u].total=parseFloat(s)-parseFloat(t[u].value);e.data(t).maxRadius(l).width(i.widthOfNoMargin).labelShow(i._labelShow).positionOptions(i._positionOptions).positionChoice(i._positionChoice).defs(i.defs).transition(i._transition).duration(1e3*i._duration).easeStyle(i._easeStyle).startDelay(1e3*parseFloat(i._startDelay)).moveStyle(i._moveStyle).endPause(i._endPause).fontSize(i._textLabel.fontSize).fontColor(i._textLabel.color).fontFamily(i._textLabel.fontFamily).onTransitionEnd(function(t,e){}).onMouseover(function(t,e){d3.select(this).transition().duration(30).style("opacity",.8);var n=[{text:""+(t.name=="$-"+e?"":t.name),color:t.color},{text:t.valueLabel+": "+t.value}];i.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){i.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().duration(30).style("opacity",1),i.tooltip.hide()});var h=r.cx+(n-a)/2,c=i.heightOfMainGroup/2;null==i._labelShow||null==i._positionOptions||null==i._positionChoice||1==i._positionOptions.indexOf(i._positionChoice)&&1==i._labelShow&&(h=l+.04*n),i.stackCircle.translate(h||0,c).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._textLabel=e.textLabel?e.textLabel:this._textLabel,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice)}}]),n}(),So=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-area-plot"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var e=this,t=e._data,n=e._areaFunc||d3.area().x(function(t){return e._xScale(t.name)}).y0(e._yScale.range()[0]).y1(function(t){return e._yScale(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))});n.curve(e._curve);var i=e.group,o=[];if(0<t.length)for(var a=0;a<t[0].data.length;a++)if(a!=t[0].data.length-1){var r={},l={},s={},u={},h={};l.x=e._xScale(t[0].data[a].name),l.y=e._yScale(t[0].data[a].value),s.x=e._xScale(t[0].data[a+1].name),s.y=e._yScale(t[0].data[a+1].value),u.x=e._xScale(t[0].data[a].name),u.y=e._yScale(t[0].data[a].total-t[0].data[a].value),h.x=e._xScale(t[0].data[a+1].name),h.y=e._yScale(t[0].data[a+1].total-t[0].data[a+1].value),r.a=l,r.b=s,r.c=u,r.d=h,o.push(r)}for(var c=[],_=0;_<o.length;_++)0==m(o[_].a,o[_].b,o[_].c,o[_].d)||c.push(m(o[_].a,o[_].b,o[_].c,o[_].d));for(var d=[{offset:0,stopColour:0<t.length?t[0].colorTop:""}],f=0,y=0;y<c.length;y++){var p={};p.stopColour=f%2==0?0<t.length?t[0].colorTop:"":0<t.length?t[0].colorBottom:"",p.offset=c[y].x/e._xScale.range()[1];var v={};v.stopColour=0==!(f%2)?0<t.length?t[0].colorTop:"":0<t.length?t[0].colorBottom:"",v.offset=c[y].x/e._xScale.range()[1],f++,d.push(p),d.push(v)}i.selectAll("defs").remove(),i.append("defs").append("linearGradient").attr("id","area-gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").selectAll("stop").data(d).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.stopColour});var g=i.selectAll("path").data(t,function(t){return t.key});function m(t,e,n,i){var o=(e.y-t.y)*(i.x-n.x)-(t.x-e.x)*(n.y-i.y);if(0==o)return!1;var a=((e.x-t.x)*(i.x-n.x)*(n.y-t.y)+(e.y-t.y)*(i.x-n.x)*t.x-(i.y-n.y)*(e.x-t.x)*n.x)/o,r=-((e.y-t.y)*(i.y-n.y)*(n.x-t.x)+(e.x-t.x)*(i.y-n.y)*t.y-(i.x-n.x)*(e.y-t.y)*n.y)/o;return(a-t.x)*(a-e.x)<=0&&(r-t.y)*(r-e.y)<=0&&(a-n.x)*(a-i.x)<=0&&(r-n.y)*(r-i.y)<=0&&{x:a,y:r}}return g.exit().remove(),g.enter().append("path").merge(g).style("fill",function(t,e){return 0==t.showArea?"transparent":"url("+S("#area-gradient")+")"}).style("fill-opacity",e._fillOpacity).transition().duration(e._transition?e._duration:0).attr("d",function(t){return n(t.data)}),e}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),ko=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-area-circle"),e._xScale=null,e._yScale=null,e._areaFunc=null,e._curve=d3.curveLinear,e._fillOpacity=.7,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var t=this,e=t._data,n=[];if(0<e.length)for(var i=0;i<e[0].data.length;i++)if(i!=e[0].data.length-1){var o={},a={},r={},l={},s={};a.x=t._xScale(e[0].data[i].name),a.y=t._yScale(e[0].data[i].value),r.x=t._xScale(e[0].data[i+1].name),r.y=t._yScale(e[0].data[i+1].value),l.x=t._xScale(e[0].data[i].name),l.y=t._yScale(e[0].data[i].total-e[0].data[i].value),s.x=t._xScale(e[0].data[i+1].name),s.y=t._yScale(e[0].data[i+1].total-e[0].data[i+1].value),o.a=a,o.b=r,o.c=l,o.d=s,n.push(o)}for(var u=[],h=0;h<n.length;h++)0==_(n[h].a,n[h].b,n[h].c,n[h].d)||u.push(_(n[h].a,n[h].b,n[h].c,n[h].d));var c=t.group.selectAll("circle").data(u);function _(t,e,n,i){var o=(e.y-t.y)*(i.x-n.x)-(t.x-e.x)*(n.y-i.y);if(0==o)return!1;var a=((e.x-t.x)*(i.x-n.x)*(n.y-t.y)+(e.y-t.y)*(i.x-n.x)*t.x-(i.y-n.y)*(e.x-t.x)*n.x)/o,r=-((e.y-t.y)*(i.y-n.y)*(n.x-t.x)+(e.x-t.x)*(i.y-n.y)*t.y-(i.x-n.x)*(e.y-t.y)*n.y)/o;return(a-t.x)*(a-e.x)<=0&&(r-t.y)*(r-e.y)<=0&&(a-n.x)*(a-i.x)<=0&&(r-n.y)*(r-i.y)<=0&&{x:a,y:r}}return c.exit().remove(),c.enter().append("circle").merge(c).attr("cx",function(t){return t.x||0}).attr("cy",function(t){return t.y||0}).style("fill","fff").style("stroke",t._strokeColor).style("stroke-width",t._strokeWidth).attr("r",3.5),t}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"areaFunc",value:function(t){return arguments.length?(this._areaFunc=t,this):this._areaFunc}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}}]),n}(),bo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-area-texts"),e._xScale=null,e._yScale=null,e._transition=!1,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,o=i._data,t=i.group,a=i._xScale,r=i._yScale;t.selectAll("*").remove();var e=t.selectAll("g").data(o);e.exit().remove(),e.enter().append("g").attr("class","range-area-text-group").merge(e).each(function(t,e){var n=d3.select(this).selectAll("text").data(t.data);n.exit().remove(),n.enter().append("text").attr("class","range-area-text").attr("x",function(t){return a(t.name)+("mix"==i._type?a.bandwidth()/2:0)||0}).attr("y",function(t){return t.value&&r(t.value)||0}).merge(n).text(function(t){return isNaN(parseFloat(t.value))?"":t.value}).style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("x",function(t){return a(t.name)+("mix"==i._type?a.bandwidth()/2:0)||0}).attr("y",function(t){return t.value&&r(t.value)||0}).attr("dy",function(t,e){return 1<o.length?null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?0:0==i._positionOptions.indexOf(i._positionChoice)?t.value==d3.max([o[0].data[e].value,o[1].data[e].value])?-6:i._fontSize/1.3+6:void 0:-6}).attr("text-anchor","middle").style("display",i._labelShow?"block":"none")});var n=i._pointData,l=[];if(0<n.length)for(var s=0;s<n[0].data.length;s++)if(s!=n[0].data.length-1){var u={},h={},c={},_={},d={};h.x=i._xScale(n[0].data[s].name),h.y=i._yScale(n[0].data[s].value),c.x=i._xScale(n[0].data[s+1].name),c.y=i._yScale(n[0].data[s+1].value),_.x=i._xScale(n[0].data[s].name),_.y=i._yScale(n[0].data[s].total-n[0].data[s].value),d.x=i._xScale(n[0].data[s+1].name),d.y=i._yScale(n[0].data[s+1].total-n[0].data[s+1].value),u.a=h,u.b=c,u.c=_,u.d=d,l.push(u)}for(var f=[],y=0;y<l.length;y++)0==v(l[y].a,l[y].b,l[y].c,l[y].d)||f.push(v(l[y].a,l[y].b,l[y].c,l[y].d));t.selectAll(".point-texts").remove();var p=t.append("g").attr("class","point-texts").selectAll("text").data(f);function v(t,e,n,i){var o=(e.y-t.y)*(i.x-n.x)-(t.x-e.x)*(n.y-i.y);if(0==o)return!1;var a=((e.x-t.x)*(i.x-n.x)*(n.y-t.y)+(e.y-t.y)*(i.x-n.x)*t.x-(i.y-n.y)*(e.x-t.x)*n.x)/o,r=-((e.y-t.y)*(i.y-n.y)*(n.x-t.x)+(e.x-t.x)*(i.y-n.y)*t.y-(i.x-n.x)*(e.y-t.y)*n.y)/o;return(a-t.x)*(a-e.x)<=0&&(r-t.y)*(r-e.y)<=0&&(a-n.x)*(a-i.x)<=0&&(r-n.y)*(r-i.y)<=0&&{x:a,y:r}}p.exit().remove(),p.enter().append("text").attr("class","range-area-text").merge(p).text(function(t){return i._yScale.invert(t.y).toFixed(1)}).attr("x",function(t){return t.x||0}).attr("y",function(t){return t.y||0}).attr("dy",-9.5).style("fill",i._fontColor).style("font-size",i._fontSize).style("font-family",i._fontFamily).attr("text-anchor","middle").style("display",i._labelShow?"block":"none"),null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?t.selectAll(".range-area-text").style("display","none"):1==i._positionOptions.indexOf(i._positionChoice)?(t.selectAll(".range-area-text").attr("dy",-6),t.selectAll(".point-texts text").attr("dy",-9.5)):2==i._positionOptions.indexOf(i._positionChoice)&&(t.selectAll(".range-area-text").attr("dy",i._fontSize/1.3+6),t.selectAll(".point-texts text").attr("dy",i._fontSize/1.3+9.5));for(var g=t.selectAll(".range-area-text"),m=[],x=[],S=0;S<g._groups[0].length;S++){x.push(S);for(var k=S+1;k<g._groups[0].length;k++){ut(st(d3.select(g._groups[0][S])),st(d3.select(g._groups[0][k])))&&(m.push(S),d3.select(g._groups[0][S]).style("visibility","hidden"))}}for(var b=new Set(m),w=Array.from(b),F=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(w,x),O=0;O<w.length;O++){for(var C=[],A=0;A<F.length;A++){var P=st(d3.select(g._groups[0][w[O]])),z=st(d3.select(g._groups[0][F[A]]));if(C.push(ut(P,z)),ut(P,z)){if(w[O]==F[A])continue;d3.select(g._groups[0][w[O]]).style("visibility","hidden")}}0==C.filter(function(t){return 1==t}).length&&F.push(w[O])}for(var D=0;D<F.length;D++)d3.select(g._groups[0][F[D]]).style("visibility","visible");return i}},{key:"pointData",value:function(t){return arguments.length?(this._pointData=t,this):this._pointData}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"lineFunc",value:function(t){return arguments.length?(this._lineFunc=t,this):this._lineFunc}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"type",value:function(t){return arguments.length?(this._type=t,this):this._type}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveLinear,this):this._curve}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}();function wo(t,e){var n=0,i=!1,o=[];if(e.forEach(function(t){"objCol"===t.function?(n=t.index,i=t.isLegend):"vCol"===t.function&&o.push(t.index)}),W(t,[n],2))return[];if(!C(t,o[0])||!C(t,o[1]))return[];var a={},r=[],l=t.length,s=t[0];if(i){for(var u=[],h=1;h<l;h++)u.push(t[h].length);u.sort(function(t,e){return e-t});for(var c=1;c<l;c++){var _=t[c],d=_[n];if(""!=d&&null!=d&&null!=d||(d="$-"+c),d){for(var f={name:d,showLegend:d!="$-"+c,data:[]},y=0;y<u[0];y++){var p=s[y];""!=p&&null!=p&&null!=p||(p="&-"+y),p&&(y==o[0]&&f.data.push({name:p,showAxisText:p!="&-"+y,value:""==_[y]||null==_[y]||isNaN(parseFloat(_[y]))?null:parseFloat(_[y])}),y==o[1]&&f.data.push({name:p,showAxisText:p!="&-"+y,value:""==_[y]||null==_[y]||isNaN(parseFloat(_[y]))?null:parseFloat(_[y])}))}r.push(f)}}}else{for(var v=[],g=1;g<l;g++)v.push(t[g].length);v.sort(function(t,e){return e-t});for(var m=1;m<v[0];m++)if(-1!=o.indexOf(m)&&m!==n){var x=s[m];""!=s[m]&&null!=s[m]&&null!=s[m]||(x="$-"+m),a[x+"-"+m]={name:x,showLegend:x!="$-"+m,data:[]}}for(var S=1;S<l;S++){var k=t[S],b=k[n];if(""!=b&&null!=b&&null!=b||(b="&-"+S),b)for(var w=0;w<v[0];w++)if(-1!=o.indexOf(w)){var F=s[w];""!=s[w]&&null!=s[w]&&null!=s[w]||(F="$-"+w),F&&a[F+"-"+w].data.push({name:b,showAxisText:b!="&-"+S,value:(""==k[w]||null==k[w])&&0!=k[w]||isNaN(parseFloat(k[w]))?null:parseFloat(k[w])})}}for(var O in a)r.push(a[O])}return r.forEach(function(t,e){t.key=M(t.name)+"-"+e}),r}var Fo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-area-chart"),e.elem.attr("class","range-area-chart"),e.grid=new Pt(e.coreGroup),e.areaPlot=new So(e.coreGroup),e.linePlot=new xn(e.coreGroup),e.rangeAreaCircle=new ko(e.coreGroup),e.overlay=new zt(e.coreGroup),e.guideLine=new St(e.coreGroup),e.guideScatter=new kt(e.coreGroup),e.rangeAreaText=new bo(e.coreGroup),e.clipArea=new Ft(e.defs),e.AnimationArea=new Ot(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xScale=d3.scalePoint(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=null,e._endPointRadius=2,e._radius=3.5,e._curve=d3.curveLinear,e._labelShow=!1,e._positionOptions=["外部","居上","居下"],e._positionChoice="外部",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var n=this,r=n.activeData,t=n.grid,e=n.areaPlot,i=n.linePlot,o=(n.StackedScatterPlot,n.rangeAreaText),a=n.rangeAreaCircle,l=n.tooltip,s=n.overlay,u=n.guideLine,h=n.guideScatter,c=n.clipArea,_=n.AnimationArea,d=n.xScale,f=n.yScale,y=n.widthOfCore,p=n.heightOfCore,v=0;v<r.length;v++)for(var g=0;g<r[v].data.length;g++)r[v].data[g].value=isNaN(parseFloat(r[v].data[g].value))?0:parseFloat(r[v].data[g].value),r[v].data[g].total=0==v?isNaN(parseFloat(r[v].data[g].value))?0:parseFloat(r[v].data[g].value):r[v-1].data[g].total+(isNaN(parseFloat(r[v].data[g].value))?0:parseFloat(r[v].data[g].value));Math.min(d3.min(r,function(t){return d3.min(t.data,function(t){return+t.total})}),0);t.width(y).height(p).xTickLocations(n.xAxis.tickLocations.slice(1)).yTickLocations(n.yAxis.tickLocations.slice(1)).showX(n._gridShowX).showY(n._gridShowY).stroke(n._gridStroke).strokeDasharray(n._gridStrokeDasharray);var m="",x="";if(1<r.length){var S=d3.max([r[0].data[0].value,r[1].data[0].value]);S==r[0].data[0].value?(m=r[0].color,x=r[1].color):S==r[1].data[0].value&&(m=r[1].color,x=r[0].color)}var k=[];1<r.length?(r[1].showArea=!0,r[1].colorTop=m,r[1].colorBottom=x,k.push(r[1])):1==r.length?(r[0].showArea=!1,k.push(r[0])):k.push(),e.data(k).xScale(d).yScale(f).fillOpacity(.6).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).curve(n._curve).areaFunc(d3.area().x(function(t){return d(t.name)}).y0(function(t){return f(t.total-t.value)}).y1(function(t){return f(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))})),i.data(r).xScale(d).yScale(f).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause).mainGroup(n.mainGroup).curve(n._curve).lineFunc(d3.line().x(function(t){return d(t.name)}).y(function(t){return f(t.value)}).defined(function(t){return!isNaN(parseFloat(t.value))})),a.data(k).xScale(d).yScale(f).strokeWidth(2).strokeColor(r[0]?r[0].color:"transparent"),h.data(r).xScale(d).yScale(f).radius(3.5).stroke("#fff").strokeWidth(2),u.y1(0).y2(p).stroke("#c6c6c6").strokeDasharray("0 0"),s.data(d.domain()).bandWidth(d.step()).bandHeight(p).onMouseover(function(t,e){var i=t,o=[{text:i=="&-"+(e+1)?"":i}],a=[];r.forEach(function(t,e){var n=t.data.filter(function(t){return t.name===i});a.push({key:t.key,name:t.name,color:t.color,data:n}),o.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+(isNaN(parseFloat(n[0].value))?"":n[0].value),color:t.color})}),l.data(o).update(),u.x(0).update().show(),n.group.selectAll(".guide-line").transition().duration(200).attr("transform","translate("+d(i)+",0)"),h.data(a).update(),l.move([d3.event.offsetX,d3.event.offsetY]).show(),u.show(),h.show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(){l.hide(),u.hide(),h.hide()});var b=n.defs;b.selectAll("filter").remove();var w=b.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_stacklinear").attr("filterUnits","objectBoundingBox");w.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),w.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),w.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),w.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),w.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),o.data(r).pointData(k).xScale(d).yScale(f).fontSize(n._textLabel.fontSize).fontColor(n._textLabel.color).fontFamily(n._textLabel.fontFamily).labelShow(n._labelShow).positionOptions(n._positionOptions).positionChoice(n._positionChoice).transition(n._transition).duration(1e3*n._duration).easeStyle(n._easeStyle).startDelay(1e3*parseFloat(n._startDelay)).moveStyle(n._moveStyle).endPause(n._endPause),n.coreGroup.call(G,n.yAxis.width+.5,0),0!=n._clipShow.length?(c.width(y).height(p).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","url(#"+c.id+")")):(c.width(n._width).height(n._height).paddingVertical([0,0]).transition(n._transition).duration(n._duration),n.coreGroup.attr("clip-path","")),c.update(),h.elem.style("pointer-events","none");var F=n.group.selectAll(".stacked-linear-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(F).remove(),t.update(),s.update(),e.update(),i.update(),a.update(),o.update(),_.width(0).height(n._height),_.update(),n.coreGroup.select(".area-plot").attr("clip-path","url(#"+_.id+")"),n.coreGroup.select(".ranking-line-plot").attr("clip-path","url(#"+_.id+")"),n.defs.select(".x"+_.id).transition().duration(n._transition?1e3*n._duration:0).delay(n._transition?1e3*n._startDelay:0).attr("width",y)}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n.transition||0==n.transition?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=wo;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=t.length?t[0].data.map(function(t){return t.name}):[0,1],i=t.length?[Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}}]),n}(),Oo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-bar-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="#000",e._borderWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,t=i._data,e=i.group;i.group.selectAll("*").remove(),e.selectAll("rect").remove();var n=e.selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("g").append("rect").merge(n).style("fill",function(t){return i._fillColor||t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._strokeColor||t.color}).style("stroke-width",function(t){return i._strokeWidth||0}).attr("x",function(t,e){return i._xScale(t.name)+i._xScale.step()/4}).attr("y",function(t,e){return null==t.data[0].value&&null==t.data[1].value?0:i._yScale(d3.max([t.data[0].value,t.data[1].value]))}).attr("width",function(t,e){return i._xScale.step()/2}).attr("height",function(t,e){return null==t.data[0].value||null==t.data[1].value?0:Math.abs(i._yScale(t.data[0].value)-i._yScale(t.data[1].value))});e.selectAll(".range-bar-textGroup").remove();var a=e.append("g").selectAll("g").data(t);a.exit().remove(),a.enter().append("g").attr("class","range-bar-textGroup").merge(a).each(function(n,t){var e=d3.select(this).selectAll("text").data(n.data);e.exit().remove();e.enter().append("text").attr("class","range-bar-text").merge(e).text(function(t){return null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?"":0==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value||null==n.data[0].value||null==n.data[1].value?"":t.value:1==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value||null==n.data[0].value||null==n.data[1].value?"":d3.max([n.data[0].value,n.data[1].value])-d3.min([n.data[0].value,n.data[1].value]):void 0}).attr("text-anchor","middle").attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("x",i._xScale(n.name)+i._xScale.step()/2).attr("y",function(t,e){return null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?i._yScale(t.value):0==i._positionOptions.indexOf(i._positionChoice)?t.value==d3.max([n.data[0].value,n.data[1].value])?(null==n.data[0].value&&null==n.data[1].value?0:i._yScale(d3.max([n.data[0].value,n.data[1].value])))-6:(null==n.data[0].value&&null==n.data[1].value?0:i._yScale(d3.min([n.data[0].value,n.data[1].value])))+i._fontSize/1.3+6:1==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value?0:i._yScale(d3.max([n.data[0].value,n.data[1].value]))+Math.abs(i._yScale(n.data[0].value)-i._yScale(n.data[1].value))/2+i._fontSize/1.3/2:void 0}).style("display",i._labelShow?"block":"none")}),o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout),0==i._labelShow||null==i._labelShow||null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?e.selectAll(".range-bar-text").style("display","none"):e.selectAll(".range-bar-text").style("display","block");for(var r=e.selectAll(".range-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Co=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new Oo(e.coreGroup),e.overlay=new zt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.5,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["上下","内部差值"],e._positionChoice="上下",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var o=this,a=o.activeData,t=a,e=o.grid,r=o.tooltip,n=o.rectPlot,i=o.overlay,l=o.selectOverlay,s=o.clipArea,u=o.xScale,h=o.yScale,c=o.widthOfCore,_=o.heightOfCore,d=1.1*Math.min(d3.min(a,function(t){return d3.min(t.data,function(t){return+t.value})}),0);d<0?(o.group.selectAll(".range-bar-chart .axis-x-line path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),o.group.selectAll(".range-bar-chart .axis-x-line line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(o.group.selectAll(".range-bar-chart .axis-x-line path").attr("transform","translate(0,0)"),o.group.selectAll(".range-bar-chart .axis-x-line line").attr("transform","translate(0,0)"));var f=o.defs;f.selectAll("filter").remove();var y=f.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupBar").attr("filterUnits","objectBoundingBox");y.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),y.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),y.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),y.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),y.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,i=[{text:n=="$-"+(e+1)?"":n,color:0<a.length?a[e].color:""}];0<a.length&&i.push({text:(null==a[e].data[0].value?"":a[e].data[0].value)+"->"+(null==a[e].data[1].value?"":a[e].data[1].value)}),r.data(i).update(),o.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+u(n)+",0)"),r.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){r.move([d3.event.offsetX,d3.event.offsetY]),l.show()}).onMouseout(function(){r.hide(),l.hide()}),n.data(t).xScale(u).yScale(h).fontSize(o._textLabel.fontSize).fontColor(o._textLabel.color).fontFamily(o._textLabel.fontFamily).labelShow(o._labelShow).positionOptions(o._positionOptions).positionChoice(o._positionChoice).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause).textObj({colorFunc:function(){return o._textLabel.color}}).fillOpacity(1),e.width(c).height(_).xTickLocations(o.xAxis.tickLocations.slice(1)).yTickLocations(o.yAxis.tickLocations.slice(1)).showX(o._gridShowX).showY(o._gridShowY).stroke(o._gridStroke).strokeDasharray(o._gridStrokeDasharray),s.width(c).height(_).paddingVertical([0,0]).transition(o._transition).duration(o._duration),l.width(u.step()).height(_).shadowColor("#ccc").hide(),o.coreGroup.attr("transform","translate("+o.yAxis.width+",0)"),0!=o._clipShow.length?(s.width(c).height(_).paddingVertical([0,0]).transition(o._transition).duration(o._duration),o.coreGroup.attr("clip-path","url(#"+s.id+")")):(s.width(o._width).height(o._height).paddingVertical([0,0]).transition(o._transition).duration(o._duration),o.coreGroup.attr("clip-path","")),s.update();var p=o.group.selectAll(".range-bar-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),n.update(),l.update(),i.update(),e.update(),d<0?(o.coreGroup.selectAll(".fake-x-line").remove(),o.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",u.range()[0]).attr("y1",h.range()[0]).attr("x2",u.range()[1]).attr("y2",h.range()[0]).attr("stroke","rgb(233, 233, 233)")):o.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=wo;return n.dataSolveFunc(i),n}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=this._yRange||[],n=t.length?t.map(function(t){return t.name}):[0,1],i=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.1*d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})})]:[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}}]),n}(),Ao=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-horizontal-bar-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="#000",e._borderWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,t=i._data,e=i.group;i.group.selectAll("*").remove(),e.selectAll("rect").remove();var n=e.selectAll("rect").data(t,function(t){return t.key});n.exit().remove();var o=n.enter().append("g").append("rect").merge(n).style("fill",function(t){return i._fillColor||t.color}).style("fill-opacity",function(t){return i._fillOpacity}).style("stroke",function(t){return i._strokeColor||t.color}).style("stroke-width",function(t){return i._strokeWidth||0}).attr("y",function(t,e){return i._yScale(t.name)+i._yScale.step()/4}).attr("x",function(t,e){return null==t.data[0].value&&null==t.data[1].value?0:i._xScale(d3.min([t.data[0].value,t.data[1].value]))}).attr("height",function(t,e){return i._yScale.step()/2}).attr("width",function(t,e){return null==t.data[0].value||null==t.data[1].value?0:Math.abs(i._xScale(t.data[0].value)-i._xScale(t.data[1].value))});e.selectAll(".range-horizontal-bar-textGroup").remove();var a=e.append("g").selectAll("g").data(t);a.exit().remove(),a.enter().append("g").attr("class","range-horizontal-bar-textGroup").merge(a).each(function(n,t){var e=d3.select(this).selectAll("text").data(n.data);e.exit().remove();e.enter().append("text").attr("class","range-horizontal-bar-text").merge(e).text(function(t){return null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?"":0==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value||null==n.data[0].value||null==n.data[1].value?"":t.value:1==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value||null==n.data[0].value||null==n.data[1].value?"":d3.max([n.data[0].value,n.data[1].value])-d3.min([n.data[0].value,n.data[1].value]):void 0}).attr("text-anchor","middle").attr("fill",i._fontColor).attr("font-size",i._fontSize).attr("font-family",i._fontFamily).attr("y",i._yScale(n.name)+i._yScale.step()/2+i._fontSize/1.3/2).attr("x",function(t,e){return null==i._positionOptions||null==i._positionChoice||-1==i._positionOptions.indexOf(i._positionChoice)?0:0==i._positionOptions.indexOf(i._positionChoice)?t.value==d3.max([n.data[0].value,n.data[1].value])?(null==n.data[0].value&&null==n.data[1].value?0:i._xScale(d3.max([n.data[0].value,n.data[1].value])))+E(parseFloat(t.value).toString(),i._fontSize,i._fontFamily)/2+6:(null==n.data[0].value&&null==n.data[1].value?0:i._xScale(d3.min([n.data[0].value,n.data[1].value])))-E(parseFloat(t.value).toString(),i._fontSize,i._fontFamily)/2-6:1==i._positionOptions.indexOf(i._positionChoice)?null==n.data[0].value&&null==n.data[1].value?0:i._xScale(d3.min([n.data[0].value,n.data[1].value]))+Math.abs(i._xScale(n.data[0].value)-i._xScale(n.data[1].value))/2:void 0}).style("display",i._labelShow?"block":"none")}),o.on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var r=e.selectAll(".range-horizontal-bar-text"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var h=u+1;h<r._groups[0].length;h++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][h])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var c=new Set(l),_=Array.from(c),d=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(_,s),f=0;f<_.length;f++){for(var y=[],p=0;p<d.length;p++){var v=st(d3.select(r._groups[0][_[f]])),g=st(d3.select(r._groups[0][d[p]]));if(y.push(ut(v,g)),ut(v,g)){if(_[f]==d[p])continue;d3.select(r._groups[0][_[f]]).style("opacity","0")}}0==y.filter(function(t){return 1==t}).length&&d.push(_[f])}for(var m=0;m<d.length;m++)d3.select(r._groups[0][d[m]]).style("opacity","1");return i}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Po=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","range-horizontal-bar-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new Ao(e.coreGroup),e.overlay=new zt(e.coreGroup),e.xAxis=new vt(e.mainGroup),e.yAxis=new sn(e.mainGroup),e.yAxis.minTickDistance(1),e.xScale=d3.scaleLinear(),e.yScale=d3.scaleBand(),e._xType="number",e._yType="category",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["左右","内部差值"],e._positionChoice="左右",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){for(var a=this,r=a.activeData,t=r,e=a.grid,l=a.tooltip,n=a.rectPlot,i=a.overlay,o=a.selectOverlay,s=a.xScale,u=a.yScale,h=a.widthOfCore,c=a.heightOfCore,_=d3.min(r,function(t){return d3.min(t.data,function(t){return+t.value})}),d=[],f=[],y=0;y<a.activeData.length;y++)for(var p=0;p<a.activeData[y].data.length;p++)null==a._labelShow||null==a._positionOptions||null==a._positionChoice||-1==a._positionOptions.indexOf(a._positionChoice)?(f.push(0),d.push(0)):1==a._labelShow&&0==a._positionOptions.indexOf(a._positionChoice)?0<parseFloat(a.activeData[y].data[p].value)||0==parseFloat(a.activeData[y].data[p].value)?d.push(E(a.activeData[y].data[p].value,a._textLabel.fontSize,a._textLabel.fontFamily)):parseFloat(a.activeData[y].data[p].value)<0&&f.push(E(a.activeData[y].data[p].value,a._textLabel.fontSize,a._textLabel.fontFamily)):(f.push(0),d.push(0));_<0?(d3.selectAll(".range-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)"),d3.selectAll(".range-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate("+(-(s.range()[0]-s(0))+(0==f.length?0:d3.max(f)))+",0)")):(d3.selectAll(".range-horizontal-bar-chart .axis-y-horizontal path").attr("transform","translate(0,0)"),d3.selectAll(".range-horizontal-bar-chart .axis-y-horizontal line").attr("transform","translate(0,0)"));var v=a.defs;v.selectAll("filter").remove();var g=v.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupHorizontal").attr("filterUnits","objectBoundingBox");g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),g.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),g.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),g.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),g.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(u.domain()).isScalePoint(!1).isHorizontal(!0).bandWidth(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).bandHeight(u.step()).onMouseover(function(t,e){var n=u.domain()[u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1],i=u.domain().length-e-1==-1?1:u.domain().length-e-1==-2?0:u.domain().length-e-1,o=[{text:n=="$-"+(i+1)?"":n,color:0<r.length?r[e].color:""}];0<r.length&&o.push({text:(null==r[i].data[0].value?"":r[i].data[0].value)+"->"+(null==r[i].data[1].value?"":r[i].data[1].value)}),a.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate(0,"+u(n)+")"),l.data(o).update(),l.move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.move([d3.event.offsetX,d3.event.offsetY]),o.show()}).onMouseout(function(){l.hide(),o.hide()}),n.data(t).xScale(s).yScale(u).fontSize(a._textLabel.fontSize).fontColor(a._textLabel.color).fontFamily(a._textLabel.fontFamily).labelShow(a._labelShow).positionOptions(a._positionOptions).positionChoice(a._positionChoice).contentOption(a._contentOption).contentChoice(a._contentChoice).transition(a._transition).duration(1e3*a._duration).easeStyle(a._easeStyle).startDelay(1e3*parseFloat(a._startDelay)).moveStyle(a._moveStyle).endPause(a._endPause).textObj({colorFunc:function(){return a._textLabel.color}}).fillOpacity(1),e.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(c).xTickLocations(a.xAxis.tickLocations).yTickLocations(a.yAxis.tickLocations).showX(a._gridShowX).showY(a._gridShowY).stroke(a._gridStroke).strokeDasharray(a._gridStrokeDasharray),o.width(h-(0==f.length?0:d3.max(f))-(0==d.length?0:d3.max(d))).height(u.step()).shadowColor("#ccc").hide(),a.coreGroup.attr("transform","translate("+a.yAxis.width+",0)");var m=a.group.selectAll(".range-horizontal-bar-chart .axis-y-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(m).remove(),n.update(),o.update(),i.update(),e.update(),a.group.selectAll(".selectOverlay-rect").attr("x",""+(0==f.length?0:d3.max(f))),a.group.selectAll(".bands-overlay").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )"),a.group.selectAll(".plane-grid .grid-x-line").attr("transform","translate("+(0==f.length?0:d3.max(f))+",0 )")}},{key:"updateAxis",value:function(){var e=this;e.computeDomain();var t=e.xAxis,n=e.yAxis,i=e.xScale,o=e.yScale,a=e._xType,r=e._yType,l=e._xOrient,s=e._yOrient,u=e._fontSize,h=e._width-e._marginLeft-e._marginRight,c=e.heightOfMainGroup;i.domain(e._xDomain),t.scaleFunc(i).allowedMaxTextHeight(.3*c).type(a).orient(l).title(e._xTitle).tickShow(e._xTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).xRange(e._xRange).transition(e._transition).duration(e._duration),o.domain(e._yDomain),n.scaleFunc(o).allowedMaxTextWidth(.5*h).type(r).orient(s).title(e._yTitle).tickShow(e._yTickShow).lineStroke(e._axisLineStroke).fontSize(u).fontColor(e._fontColor).fontFamily(e._fontFamily).yRange(e._yRange).transition(e._transition).duration(e._duration);n&&n.titleHeight;e.data().forEach(function(t){t.data.forEach(function(t){})});for(var _=[],d=[],f=0;f<e.activeData.length;f++)for(var y=0;y<e.activeData[f].data.length;y++)null==e._labelShow||null==e._positionOptions||null==e._positionChoice||-1==e._positionOptions.indexOf(e._positionChoice)?(d.push(0),_.push(0)):1==e._labelShow&&0==e._positionOptions.indexOf(e._positionChoice)?0<parseFloat(e.activeData[f].data[y].value)||0==parseFloat(e.activeData[f].data[y].value)?_.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):parseFloat(e.activeData[f].data[y].value)<0&&d.push(E(e.activeData[f].data[y].value,e._textLabel.fontSize,e._textLabel.fontFamily)):(d.push(0),_.push(0));var p=e._tickCount?e._tickCount:(h-n.allowedMaxTextWidth())/(3*u);t.tickCount(p).compute(),n.compute();var v=Math.abs(0==d.length?0:d3.max(d)-(h-n.width-(0==_.length?0:d3.max(_))))/t._tickValues.length,g=d3.max(t._tickValues.filter(function(t,e){return t!="$-"+e&&t!="&-"+(e+1)}),function(t){return E(t,u,e._fontFamily)}),m=(t._tickShow?t._tickSize+t._tickPadding+(g<.8*v?1.125*t._fontSize:1.2*t._tickTextHeight):0)+(t._title&&t._titleShow?t._titlePadding+1.25*t._fontSize:0);o.range([c-m,0]),n.compute(),i.range([0==d.length?0:d3.max(d),h-n.width-(0==_.length?0:d3.max(_))]),t.compute();var x=n.width,S=c-m,k=n.width;t.translate(x,S).update(),n.translate(k,0).update()}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){t.display;var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"buildOption",value:function(t,e){var n=new F(t,e),i=wo;return n.dataSolveFunc(i),n}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange,t.length?t.map(function(t){return t.name}):[0,1]),n=t.length?[1.05*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.value})}),0),1.05*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.value})}),0)]:[0,1];this._xDomain=n,this._yDomain=e}}]),n}(),zo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","polar-stack-bar"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(n,P),s(n,[{key:"update",value:function(){var i=this,t=i._data,e=i._startAngle,n=i._endAngle,o=d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),a=i._radius,r=d3.scaleLinear().domain([0,o]).range([i._innerRadius,a]),l=i.arcFunc.innerRadius(function(t){return r(Math.abs(t.data.total)-Math.abs(t.data.value))}).outerRadius(function(t){return r(Math.abs(t.data.total))}).cornerRadius(i._cornerRadius),s=i.pieFunc.value(1).startAngle(e).endAngle(n).sort(i._sortMethod);i.group.selectAll("*").remove(),i.group.selectAll("g.polar-stack-bar-group").remove();var u=i.group.selectAll("g.polar-stack-bar-group").data(t);u.exit().remove();u.enter().append("g").attr("class","polar-stack-bar-group").merge(u).each(function(e,t){var n=d3.select(this).selectAll("path").data(s(e.data));n.exit().remove();n.enter().append("path").attr("class","polar-stack-bars").merge(n).style("stroke",i._stroke).style("stroke-width",i._strokeWidth).attr("d",function(t){return l(t)}).style("fill",function(t){return e.color}).on("mouseover",i._onMouseover).on("mousemove",i._onMousemove).on("mouseout",i._onMouseout)});i.group.append("g").selectAll("g").data(s(0==t.length?0:t[0].data)).enter().append("g").transition().on("start",i._onTransitionStart).on("end",i._onTransitionEnd)}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Do=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","polar-stack-bar-text"),e._stroke="#fff",e._strokeWidth=1,e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._radius=0,e._cornerRadius=0,e.arcFunc=d3.arc(),e.pieFunc=d3.pie(),e}return h(n,P),s(n,[{key:"update",value:function(){var h=this,t=h._data,e=h._startAngle,n=h._endAngle,i=d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total})}),o=h._radius,c=d3.scaleLinear().domain([0,i]).range([h._innerRadius,o]),_=(h.arcFunc.innerRadius(function(t){return c(Math.abs(t.data.total)-Math.abs(t.data.value))}).outerRadius(function(t){return c(Math.abs(t.data.total))}).cornerRadius(h._cornerRadius),h.pieFunc.value(1).startAngle(e).endAngle(n).sort(h._sortMethod));h.group.selectAll("*").remove(),h.group.selectAll("g.polar-stack-bar-text-group").remove();var a=h.group.selectAll("g.polar-stack-bar-text-group").data(t);a.exit().remove();a.enter().append("g").attr("class","polar-stack-bar-text-group").merge(a).each(function(t,i){var e=d3.select(this).selectAll("g").data(_(t.data));e.exit().remove();for(var n=e.enter().append("g"),o=0;o<t.data.length;o++){var a=c(Math.abs(t.data[o].total)),r=_(t.data)[o].startAngle,l=_(t.data)[o].endAngle,s="arc-path-"+o+"-"+i+"-"+h.id,u=D(a-h._fontSize/1.3/2-6,r+.015,l-.015);h._defs.select("#"+s).empty()?h._defs.append("path").attr("d",u).attr("id",s):h._defs.select("#"+s).attr("d",u)}n.append("text").style("text-anchor","middle").style("font-size",h._fontSize).style("font-family",h._fontFamily).style("font-family",h._fontFamily).style("fill",h._fontColor).attr("dy","0.35em").append("textPath").attr("startOffset","50%").attr("xlink:href",function(t,e){return"#arc-path-"+e+"-"+i+"-"+h.id}).text(function(t,e){var n=h._defs.select("#arc-path-"+e+"-"+i+"-"+h.id).node().getTotalLength();return I(t.data.value.toString(),n,h._fontSize,h._fontFamily)}).style("display",h._labelShow?"block":"none")});for(var r=h.group.selectAll(".pie-text-groups"),l=[],s=[],u=0;u<r._groups[0].length;u++){s.push(u);for(var d=u+1;d<r._groups[0].length;d++){ut(st(d3.select(r._groups[0][u])),st(d3.select(r._groups[0][d])))&&(l.push(u),d3.select(r._groups[0][u]).style("opacity","0"))}}for(var f=new Set(l),y=Array.from(f),p=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(y,s),v=0;v<y.length;v++){for(var g=[],m=0;m<p.length;m++){var x=st(d3.select(r._groups[0][y[v]])),S=st(d3.select(r._groups[0][p[m]]));if(g.push(ut(x,S)),ut(x,S)){if(y[v]==p[m])continue;d3.select(r._groups[0][y[v]]).style("opacity","0")}}0==g.filter(function(t){return 1==t}).length&&p.push(y[v])}for(var k=0;k<p.length;k++)d3.select(r._groups[0][p[k]]).style("opacity","1")}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"defs",value:function(t){return arguments.length?(this._defs=t,this):this._defs}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"innerRadius",value:function(t){return arguments.length?(this._innerRadius=t,this):this._innerRadius}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this.positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this.positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this.contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this.contentChoice}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Lo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","polar-stack-bar-chart"),e.core=e.rose=new zo(e.mainGroup),e.grid=new $(e.mainGroup),e.roseText=new Do(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._labelRadiusRatio=.8,e._innerRadiusRatio=0,e._cornerRadius=0,e._labelShow=!1,e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var l=this,e=l.activeData;l.group.selectAll(".polar-grid").style("opacity",0).transition().duration(l._transition?.1*l._duration*1e3:0).delay(l._duration?1e3*l._startDelay:0).style("opacity",1);for(var t=l.rose,n=l.grid,i=l.roseText,o=l._startAngle,a=l._endAngle,r=l.widthOfNoMargin,s=l.heightOfMainGroup,u=l._fontSize,h=.88*r,c=.88*s,_=L(h,c,o,a),d=_.radius,f=_.cx,y=_.cy,p=d-.55*u-6,v=p-5,g=l._innerRadius||(l._innerRadiusRatio?l._innerRadiusRatio*v:0),m=0;m<(0==e.length?0:e[0].data.length);m++)for(var x=0;x<e.length;x++)parseFloat(e[x].data[m].value);for(var S=0;S<e.length;S++)for(var k=0;k<e[S].data.length;k++)0==S?0<e[S].data[k].value||0==e[S].data[k].value?(e[S].data[k].total=parseFloat(e[S].data[k].value),e[S].data[k].downtotal=0):e[S].data[k].value<0&&(e[S].data[k].downtotal=parseFloat(e[S].data[k].value),e[S].data[k].total=0):0<e[S].data[k].value||0==e[S].data[k].value?(e[S].data[k].total=e[S-1].data[k].total+parseFloat(e[S].data[k].value),e[S].data[k].downtotal=e[S-1].data[k].downtotal):e[S].data[k].value<0&&(e[S].data[k].total=e[S-1].data[k].total,e[S].data[k].downtotal=e[S-1].data[k].downtotal+parseFloat(e[S].data[k].value));n.donutCount(6).sectorCount(0==l.activeData.length?0:l.activeData[0].data.length).startAngle(o).endAngle(a).radius(p).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray).showX(l._gridShowX).showY(l._gridShowY),t.data(e).radius(v).innerRadius(g).startAngle(o).endAngle(a).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(!0).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionStart(function(t,e){var n=d3.select(this);n.selectAll("*").remove();var i=null==t?0:t.startAngle,o=null==t?0:t.endAngle,a="outer-arc-path-"+e+"-"+l.id,r=D(d,i+.015,o-.015);N(n,l.defs.select("#"+a).empty()?l.defs.append("path").attr("d",r).attr("id",a):l.defs.select("#"+a).attr("d",r),null==t?"":t.data.name=="&-"+(e+1)?"":t.data.name,u,l._fontFamily).attr("class",l.labelTextClass).style("pointer-events","none").style("fill",l._fontColor)}).onMouseover(function(t,n){d3.select(this).transition().style("opacity",.8);var i=[{text:""+(t.data.name=="&-"+(n+1)?"":t.data.name)}];e.forEach(function(t,e){i.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+t.data[n].value,color:t.color})}),l.tooltip.data(i).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),l.tooltip.hide()});var b=l.defs;b.selectAll("filter").remove();var w=b.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_rose").attr("filterUnits","objectBoundingBox");w.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),w.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),w.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),w.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),w.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(e).radius(v).innerRadius(g).startAngle(o).endAngle(a).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).defs(l.defs).labelShow(l._labelShow).fontSize(l._textLabel.fontSize).fontColor(l._textLabel.color).fontFamily(l._textLabel.fontFamily).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause);var F=(r-h)/2+f,O=(s-c)/2+y,C=_.quadrant,A=(d-v)/2;switch(C){case 4:F+=A,O+=A;break;case 1:F-=A,O+=A;break;case 2:F-=A,O-=A;break;case 3:F+=A,O-=spcae}n.translate(F,O).update(),t.translate(F,O).update(),i.translate(F,O).update()}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"stroke",value:function(t){return arguments.length?(this._stroke=t,this):this._stroke}},{key:"sortMethod",value:function(t){return arguments.length?(this._sortMethod=t,this):this._sortMethod}},{key:"cornerRadius",value:function(t){return arguments.length?(this._cornerRadius=t,this):this._cornerRadius}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._textLabel=n.textLabel?n.textLabel:this._textLabel),this.cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).stroke(e.areaBorderColor||this._stroke).strokeWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._strokeWidth))}},{key:"computeDomain",value:function(){for(var t=this.activeData,e=0;e<t.length;e++)for(var n=0;n<t[e].data.length;n++)0==e?0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=parseFloat(t[e].data[n].value),t[e].data[n].downtotal=0):t[e].data[n].value<0&&(t[e].data[n].downtotal=parseFloat(t[e].data[n].value),t[e].data[n].total=0):0<t[e].data[n].value||0==t[e].data[n].value?(t[e].data[n].total=t[e-1].data[n].total+parseFloat(t[e].data[n].value),t[e].data[n].downtotal=t[e-1].data[n].downtotal):t[e].data[n].value<0&&(t[e].data[n].total=t[e-1].data[n].total,t[e].data[n].downtotal=t[e-1].data[n].downtotal+parseFloat(t[e].data[n].value));var i=this._yRange||[],o=t.length?t[0].data.map(function(t){return t.name}):[0,1],a=t.length?[1.1*Math.min(d3.min(t,function(t){return d3.min(t.data,function(t){return+t.downtotal})}),0),1.1*Math.max(d3.max(t,function(t){return d3.max(t.data,function(t){return+t.total+1})}),0)]:[0,1];this._xDomain=o,this._yDomain=[isNaN(parseFloat(i[0]))?a[0]:parseFloat(i[0]),isNaN(parseFloat(i[1]))?isNaN(parseFloat(i[0]))?a[1]:a[1]<i[0]?1.5*i[0]:a[1]:parseFloat(i[1])]}}]),n}(),Mo="donut-grid-arc-path",Wo="donut-grid-line",Ro=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.elem=t.append("g").attr("class","donut-polar-grid"),e.group=e.elem.append("g"),e._radius=100,e._startAngle=0,e._endAngle=2*Math.PI,e._donutCount=5,e._sectorCount=5,e}return h(n,q),s(n,[{key:"update",value:function(){var n=this,o=n._startAngle,a=n._endAngle,r=n._radius,l=n.group.style("fill","none").style("stroke",n._stroke).style("stroke-dasharray",n._strokeDasharray);!function(){if(!n._showX)return l.selectAll("."+Mo).remove();var i=n._donutCount,t=l.selectAll("."+Mo).data(d3.range(i));t.exit().remove(),t.enter().append("path").attr("class",Mo).merge(t).attr("d",function(t,e){var n=.3*r+.7*r/i*(e+1);return D(n,o,a)})}(),function(){if(!n._showY)return l.selectAll("."+Wo).remove();var t=n._sectorCount||1,i=(a-o)/t,e=l.selectAll("."+Wo).data(d3.range(t+1));e.exit().remove(),e.enter().append("line").attr("class",Wo).merge(e).attr("x1",function(t,e){var n=o+i*e;return Math.cos(n-Math.PI/2)*r*.3}).attr("y1",function(t,e){var n=o+i*e;return Math.sin(n-Math.PI/2)*r*.3}).attr("x2",function(t,e){var n=o+i*e;return Math.cos(n-Math.PI/2)*r}).attr("y2",function(t,e){var n=o+i*e;return Math.sin(n-Math.PI/2)*r})}()}},{key:"radius",value:function(t){return arguments.length?(this._radius=t,this):this._radius}},{key:"startAngle",value:function(t){return arguments.length?(this._startAngle=t,this):this._startAngle}},{key:"endAngle",value:function(t){return arguments.length?(this._endAngle=t,this):this._endAngle}},{key:"donutCount",value:function(t){return arguments.length?(this._donutCount=parseFloat(t),this):this._donutCount}},{key:"sectorCount",value:function(t){return arguments.length?(this._sectorCount=parseFloat(t),this):this._sectorCount}}]),n}(),No=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","polar-stack-donut-bar-chart"),e.core=e.rose=new zo(e.mainGroup),e.grid=new Ro(e.mainGroup),e.roseText=new Do(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._labelRadiusRatio=.65,e._innerRadiusRatio=.3,e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!1,e._easeStyle="",e._duration=0,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var l=this,e=l.activeData;l.group.selectAll(".polar-grid").style("opacity",0).transition().duration(l._transition?.1*l._duration*1e3:0).delay(l._duration?1e3*l._startDelay:0).style("opacity",1);for(var t=l.rose,n=l.grid,i=l.roseText,o=l._startAngle,a=l._endAngle,r=l.widthOfNoMargin,s=l.heightOfMainGroup,u=l._fontSize,h=.88*r,c=.88*s,_=L(h,c,o,a),d=_.radius,f=_.cx,y=_.cy,p=d-.55*u-6,v=p-5,g=l._innerRadius||(l._innerRadiusRatio?l._innerRadiusRatio*v:0),m=0;m<(0==e.length?0:e[0].data.length);m++)for(var x=0;x<e.length;x++)parseFloat(e[x].data[m].value);for(var S=0;S<e.length;S++)for(var k=0;k<e[S].data.length;k++)0==S?0<e[S].data[k].value||0==e[S].data[k].value?(e[S].data[k].total=parseFloat(e[S].data[k].value),e[S].data[k].downtotal=0):e[S].data[k].value<0&&(e[S].data[k].downtotal=parseFloat(e[S].data[k].value),e[S].data[k].total=0):0<e[S].data[k].value||0==e[S].data[k].value?(e[S].data[k].total=e[S-1].data[k].total+parseFloat(e[S].data[k].value),e[S].data[k].downtotal=e[S-1].data[k].downtotal):e[S].data[k].value<0&&(e[S].data[k].total=e[S-1].data[k].total,e[S].data[k].downtotal=e[S-1].data[k].downtotal+parseFloat(e[S].data[k].value));n.donutCount(6).sectorCount(0==l.activeData.length?0:l.activeData[0].data.length).startAngle(o).endAngle(a).radius(p).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray).showX(l._gridShowX).showY(l._gridShowY),t.data(e).radius(v).innerRadius(g).startAngle(o).endAngle(a).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(!0).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionStart(function(t,e){var n=d3.select(this);n.selectAll("*").remove();var i=null==t?0:t.startAngle,o=null==t?0:t.endAngle,a="outer-arc-path-"+e+"-"+l.id,r=D(d,i+.015,o-.015);N(n,l.defs.select("#"+a).empty()?l.defs.append("path").attr("d",r).attr("id",a):l.defs.select("#"+a).attr("d",r),null==t?"":t.data.name=="&-"+(e+1)?"":t.data.name,u,l._fontFamily).attr("class",l.labelTextClass).style("pointer-events","none").style("fill",l._fontColor)}).onMouseover(function(t,n){d3.select(this).transition().style("opacity",.8);var i=[{text:""+(t.data.name=="&-"+(n+1)?"":t.data.name)}];e.forEach(function(t,e){i.push({text:(t.name=="$-"+(e+1)?"":t.name)+": "+t.data[n].value,color:t.color})}),l.tooltip.data(i).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),l.tooltip.hide()});var b=l.defs;b.selectAll("filter").remove();var w=b.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_rose").attr("filterUnits","objectBoundingBox");w.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),w.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),w.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),w.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),w.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(e).radius(v).innerRadius(g).startAngle(o).endAngle(a).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).defs(l.defs).labelShow(l._labelShow).fontSize(l._textLabel.fontSize).fontColor(l._textLabel.color).fontFamily(l._textLabel.fontFamily).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause);var F=(r-h)/2+f,O=(s-c)/2+y,C=_.quadrant,A=(d-v)/2;switch(C){case 4:F+=A,O+=A;break;case 1:F-=A,O+=A;break;case 2:F-=A,O-=A;break;case 3:F+=A,O-=spcae}n.translate(F,O).update(),t.translate(F,O).update(),i.translate(F,O).update()}},{key:"_onTransitionEnd",value:function(){var r=this,t=r._startAngle,e=r._endAngle,n=L(.88*r.widthOfNoMargin,.88*r.heightOfMainGroup,t,e).radius-.55*r._fontSize-6-5,l=r._innerRadius||(r._innerRadiusRatio?r._innerRadiusRatio*n:0);return function(t,e){var n=r.roseText.arcFunc.outerRadius()(t),i=d3.select(this.parentNode),o=(t.startAngle,t.endAngle,"arc-path-"+t.data.key+"-"+r.id),a=D((l+n)*r._labelRadiusRatio,t.startAngle+.015,t.endAngle-.015);N(i,r.defs.select("#"+o).empty()?r.defs.append("path").attr("d",a).attr("id",o):r.defs.select("#"+o).attr("d",a),t.data.value.toString(),r._textLabel.fontSize,r._textLabel.fontFamily).classed(r.labelTextClass,!0).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily),0==r._labelShow?i.selectAll("text").style("display","none"):i.selectAll("text").style("display","block")}}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}}]),n}(),To=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","rose-donut-chart"),e.core=e.rose=new V(e.mainGroup),e.grid=new Ro(e.mainGroup),e.roseText=new U(e.mainGroup),e._startAngle=0,e._endAngle=2*Math.PI,e._sortMethod=null,e._labelRadiusRatio=.65,e._innerRadiusRatio=.3,e._areaBorderWidth=1,e._areaBorderColor="#fff",e._labelShow=!0,e._positionOptions=["内部径向","内部水平","外部"],e._positionChoice="内部",e._contentOption=["名称","百分比","数值"],e._contentChoice=["名称"],e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=.5,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,J),s(n,[{key:"updateCore",value:function(){var l=this;l.group.selectAll(".polar-grid").style("opacity",0).transition().duration(l._transition?.1*l._duration*1e3:0).delay(l._duration?1e3*l._startDelay:0).style("opacity",1);for(var s=l.rose,t=l.grid,e=l.roseText,n=l._startAngle,i=l._endAngle,o=l.widthOfNoMargin,a=l.heightOfMainGroup,u=l._fontSize,r=.88*o,h=.88*a,c=L(r,h,n,i),_=c.radius,d=c.cx,f=c.cy,y=_-.55*u-6,p=y-5,v=l._innerRadius||(l._innerRadiusRatio?l._innerRadiusRatio*p:0),g=0,m=0;m<l.activeData.length;m++)g+=l.activeData[m].value;for(var x=0;x<l.activeData.length;x++)l.activeData[x].percent=parseFloat(l.activeData[x].value/g*100).toFixed(1);t.donutCount(6).sectorCount(l.activeData.length).startAngle(n).endAngle(i).radius(y).stroke(l._gridStroke).strokeDasharray(l._gridStrokeDasharray).showX(l._gridShowX).showY(l._gridShowY),s.data(l.activeData).radius(p).innerRadius(v).startAngle(n).endAngle(i).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionEnd(function(t,e){s.arcFunc.outerRadius()(t);var n=d3.select(this.parentNode),i=t.startAngle,o=t.endAngle,a="outer-arc-path-"+t.data.key+"-"+l.id,r=D(_,i+.015,o-.015);N(n,l.defs.select("#"+a).empty()?l.defs.append("path").attr("d",r).attr("id",a):l.defs.select("#"+a).attr("d",r),t.data.name=="$-"+e?"":t.data.name,u,l._fontFamily).attr("class",l.labelTextClass).style("pointer-events","none").style("fill",l._fontColor)}).onMouseover(function(t,e){d3.select(this).transition().style("opacity",.8);var n=[{text:""+(t.data.name=="$-"+e?"":t.data.name),color:t.data.color},{text:t.data.valueLabel+": "+t.data.value}];l.tooltip.data(n).update().move([d3.event.offsetX,d3.event.offsetY]).show()}).onMousemove(function(){l.tooltip.move([d3.event.offsetX,d3.event.offsetY])}).onMouseout(function(t){d3.select(this).transition().style("opacity",1),l.tooltip.hide()});var S=l.defs;S.selectAll("filter").remove();var k=S.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_rose").attr("filterUnits","objectBoundingBox");k.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),k.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),k.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),k.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),k.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),e.data(l.activeData).radius(p).innerRadius(v).startAngle(n).endAngle(i).cornerRadius(l._cornerRadius).stroke(l._stroke).strokeWidth(l._strokeWidth).sortMethod(l._sortMethod).transition(l._transition).duration(1e3*l._duration).easeStyle(l._easeStyle).startDelay(0).moveStyle(l._moveStyle).endPause(l._endPause).onTransitionEnd(l._onTransitionEnd());var b=(o-r)/2+d,w=(a-h)/2+f,F=c.quadrant,O=(_-p)/2;switch(F){case 4:b+=O,w+=O;break;case 1:b-=O,w+=O;break;case 2:b-=O,w-=O;break;case 3:b+=O,w-=spcae}t.translate(b,w).update(),s.translate(b,w).update(),e.translate(b,w).update()}},{key:"_onTransitionEnd",value:function(){var r=this,t=r._startAngle,e=r._endAngle,n=L(.88*r.widthOfNoMargin,.88*r.heightOfMainGroup,t,e).radius-.55*r._fontSize-6-5;r._innerRadius||r._innerRadiusRatio&&r._innerRadiusRatio;return function(t,e){var n=r.roseText.arcFunc.outerRadius()(t),i=d3.select(this.parentNode),o=(t.startAngle,t.endAngle,"arc-path-"+t.data.key+"-"+r.id),a=D(n-r._textLabel.fontSize/1.3*.5-6,t.startAngle+.015,t.endAngle-.015);N(i,r.defs.select("#"+o).empty()?r.defs.append("path").attr("d",a).attr("id",o):r.defs.select("#"+o).attr("d",a),t.data.value.toString(),r._textLabel.fontSize,r._textLabel.fontFamily).classed(r.labelTextClass,!0).style("pointer-events","none").style("fill",r._textLabel.color).style("font-size",r._textLabel.fontSize).style("font-family",r._textLabel.fontFamily),0==r._labelShow?i.selectAll("text").style("display","none"):i.selectAll("text").style("display","block")}}},{key:"setSelfOption",value:function(t){var e=t.display,n=t.label,i=t.animation,o=t.unitDisplay,a=t.sourceDisplay;0!==Object.getOwnPropertyNames(i).length&&(this._transition=i.transition||0==i.transition?i.transition:this._transition,this._easeStyle=i.easeStyle?i.easeStyle:this._easeStyle,this._duration=i.duration?i.duration:this._duration,this._startDelay=i.startDelay?i.startDelay:this._startDelay,this._moveStyle=i.moveStyle?i.moveStyle:this._moveStyle,this._endPause=i.endPause?i.endPause:this._endPause),0!==Object.getOwnPropertyNames(o).length&&(this._unitShow=o?o.show:this._unitShow,this._unitWord=o.text?o.text:this._unitWord,this._unitFontSize=o.fontSize?o.fontSize:this._unitSize,this._unitFontColor=o.color?o.color:this._unitColor,this._unitFontFamily=o.fontFamily?o.fontFamily:this._unitFamily,this._unitX=o.xPosition?o.xPosition:this._unitX,this._unitY=o.yPosition?o.yPosition:this._unitY),0!==Object.getOwnPropertyNames(a).length&&(this._sourceShow=a?a.show:this._sourceShow,this._sourceWord=a.text?a.text:this._sourceWord,this._sourceFontSize=a.fontSize?a.fontSize:this._sourceSize,this._sourceFontColor=a.color?a.color:this._sourceColor,this._sourceFontFamily=a.fontFamily?a.fontFamily:this._sourceFamily,this._sourceX=a.xPosition?a.xPosition:this._sourceX,this._sourceY=a.yPosition?a.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&this.innerRadiusRatio(l(e.innerRadiusRatio?e.innerRadiusRatio:this._innerRadiusRatio)).cornerRadius(l(e.cornerRadius?e.cornerRadius:this._cornerRadius)).areaBorderWidth(l(e.areaBorderWidth?e.areaBorderWidth:this._areaBorderWidth)).areaBorderColor(e.areaBorderColor||this._areaBorderColor),0!==Object.getOwnPropertyNames(n).length&&(this._labelShow=n?n.display:this._labelShow,this._positionChoice=n.positionChoice?n.positionChoice:this._positionChoice,this._contentChoice=n.contentChoice?n.contentChoice:this._contentChoice,this._textLabel=n.textLabel?n.textLabel:this._textLabel)}}]),n}(),jo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","histogram-plot"),e._xScale=null,e._yScale=null,e._rectObj=null,e._textObj=null,e._fillColor="",e._strokeColor="",e._strokeWidth="",e._fillOpacity=.7,e._barCornerRadius=0,e._borderColor="#000",e._borderWidth=0,e}return h(n,P),s(n,[{key:"update",value:function(){var n=this,t=n._data,e=n.group;e.selectAll("rect").remove();var i=e.selectAll("rect").data(t,function(t){return t.key});i.exit().remove(),i.enter().append("g").append("rect").merge(i).style("fill",function(t){return n._fillColor||t.color}).style("fill-opacity",function(t){return n._fillOpacity}).style("stroke",function(t){return n._strokeColor||t.color}).style("stroke-width",function(t){return n._strokeWidth||0}).attr("x",function(t,e){return n._xScale(t.name)+1}).attr("width",function(t,e){return n._xScale.step()-2}).attr("y",function(t){return t.value<0?n._yScale(0):0<t.value?n._yScale(t.value):void 0}).attr("height",function(t){return t.value<0?n._yScale(t.value)-n._yScale(0)<0?0:n._yScale(t.value)-n._yScale(0):0<t.value?n._yScale(0)-n._yScale(t.value)<0?0:n._yScale(0)-n._yScale(t.value):void 0}).on("mouseover",this._onMouseover).on("mousemove",this._onMousemove).on("mouseout",this._onMouseout);for(var o=e.selectAll(".symmetric-texts text"),a=[],r=[],l=0;l<o._groups[0].length;l++){r.push(l);for(var s=l+1;s<o._groups[0].length;s++){ut(st(d3.select(o._groups[0][l])),st(d3.select(o._groups[0][s])))&&(a.push(l),d3.select(o._groups[0][l]).style("opacity","0"))}}for(var u=new Set(a),h=Array.from(u),c=function(t,e){for(var n=e,i=[],o=t.concat(n),a={},r=0;r<o.length;r++)o[r]in a?a[o[r]]++:a[o[r]]=1;for(var l in a)1==a[l]&&i.push(Number(l));return i}(h,r),_=0;_<h.length;_++){for(var d=[],f=0;f<c.length;f++){var y=st(d3.select(o._groups[0][h[_]])),p=st(d3.select(o._groups[0][c[f]]));if(d.push(ut(y,p)),ut(y,p)){if(h[_]==c[f])continue;d3.select(o._groups[0][h[_]]).style("opacity","0")}}0==d.filter(function(t){return 1==t}).length&&c.push(h[_])}for(var v=0;v<c.length;v++)d3.select(o._groups[0][c[v]]).style("opacity","1");return n}},{key:"fontSize",value:function(t){return arguments.length?(this._fontSize=t,this):this._fontSize}},{key:"fontColor",value:function(t){return arguments.length?(this._fontColor=t,this):this._fontColor}},{key:"fontFamily",value:function(t){return arguments.length?(this._fontFamily=t,this):this._fontFamily}},{key:"barCornerRadius",value:function(t){return arguments.length?(this._barCornerRadius=t,this):this._barCornerRadius}},{key:"borderWidth",value:function(t){return arguments.length?(this._borderWidth=t,this):this._borderWidth}},{key:"borderColor",value:function(t){return arguments.length?(this._borderColor=t,this):this._borderColor}},{key:"labelShow",value:function(t){return arguments.length?(this._labelShow=t,this):this._labelShow}},{key:"positionOptions",value:function(t){return arguments.length?(this._positionOptions=t,this):this._positionOptions}},{key:"positionChoice",value:function(t){return arguments.length?(this._positionChoice=t,this):this._positionChoice}},{key:"contentOption",value:function(t){return arguments.length?(this._contentOption=t,this):this._contentOption}},{key:"contentChoice",value:function(t){return arguments.length?(this._contentChoice=t,this):this._contentChoice}},{key:"xScale",value:function(t){return arguments.length?(this._xScale=t,this):this._xScale}},{key:"yScale",value:function(t){return arguments.length?(this._yScale=t,this):this._yScale}},{key:"rectObj",value:function(t){return arguments.length?(this._rectObj=t,this):this._rectObj}},{key:"textObj",value:function(t){return arguments.length?(this._textObj=t,this):this._textObj}},{key:"fillOpacity",value:function(t){return arguments.length?(this._fillOpacity=t,this):this._fillOpacity}},{key:"fillColor",value:function(t){return arguments.length?(this._fillColor=t,this):this._fillColor}},{key:"strokeColor",value:function(t){return arguments.length?(this._strokeColor=t,this):this._strokeColor}},{key:"strokeWidth",value:function(t){return arguments.length?(this._strokeWidth=t,this):this._strokeWidth}},{key:"onMouseover",value:function(t){return arguments.length?(this._onMouseover="function"==typeof t?t:function(){},this):this._onMouseover}},{key:"onMousemove",value:function(t){return arguments.length?(this._onMousemove="function"==typeof t?t:function(){},this):this._onMousemove}},{key:"onMouseout",value:function(t){return arguments.length?(this._onMouseout="function"==typeof t?t:function(){},this):this._onMouseout}},{key:"transition",value:function(t){return arguments.length?(this._transition=t,this):this._transition}},{key:"duration",value:function(t){return arguments.length?(this._duration=parseFloat(t),this):this._duration}},{key:"easeStyle",value:function(t){return arguments.length?(this._easeStyle=parseFloat(t),this):this._easeStyle}},{key:"startDelay",value:function(t){return arguments.length?(this._startDelay=parseFloat(t),this):this._startDelay}},{key:"moveStyle",value:function(t){return arguments.length?(this._moveStyle=parseFloat(t),this):this._moveStyle}},{key:"endPause",value:function(t){return arguments.length?(this._endPause=parseFloat(t),this):this._endPause}}]),n}(),Yo=function(t){function n(t){r(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.elem.attr("class","histogram-chart"),e.grid=new Pt(e.coreGroup),e.selectOverlay=new vn(e.coreGroup),e.rectPlot=new jo(e.coreGroup),e.overlay=new zt(e.coreGroup),e.clipArea=new Ft(e.defs),e.xAxis=new vt(e.mainGroup),e.yAxis=new xt(e.mainGroup),e.xAxis.minTickDistance(5),e.xScale=d3.scaleBand(),e.yScale=d3.scaleLinear(),e._xType="category",e._yType="number",e._xOrient="bottom",e._yOrient="left",e._sortValue=0,e._curve=d3.curveCardinal,e._histogramWidth=.7,e._yScaleHeight=1.05,e._labelShow=!1,e._positionOptions=["上面","内部居下"],e._positionChoice="上面",e._textLabel={color:"#313131",fontFamily:"noto",fontSize:12},e._unitShow=!1,e._unitWord="单位：",e._unitFontSize="12",e._unitFontColor="#8C8C8C",e._unitFontFamily="Noto Sans",e._unitX="left",e._unitY="top",e._sourceShow=!1,e._sourceWord="数据来源：",e._sourceFontSize="12",e._sourceFontColor="#5c6066",e._sourceFontFamily="Noto Sans",e._sourceX="left",e._sourceY="bottom",e._transition=!0,e._easeStyle="",e._duration=2,e._startDelay=0,e._moveStyle="",e._endPause=0,e}return h(n,dt),s(n,[{key:"updateCore",value:function(){var o=this,a=o.activeData,t=a,e=o.grid,r=o.tooltip,n=o.rectPlot,i=o.overlay,l=o.selectOverlay,s=o.clipArea,u=o.xScale,h=o.yScale,c=o.widthOfCore,_=o.heightOfCore,d=1.1*Math.min(d3.min(a,function(t){return+t.value}),0);d<0?(o.group.selectAll(".histogram-chart .axis-x-line path").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")"),o.group.selectAll(".histogram-chart .axis-x-line line").attr("transform","translate(0, "+-(h.range()[0]-h(0))+")")):(o.group.selectAll(".histogram-chart .axis-x-line path").attr("transform","translate(0,0)"),o.group.selectAll(".histogram-chart .axis-x-line line").attr("transform","translate(0,0)"));var f=o.defs;f.selectAll("filter").remove();var y=f.append("filter").attr("x","-10%").attr("y","-10%").attr("width","180%").attr("height","180%").attr("id","Drop_Shadow_groupBar").attr("filterUnits","objectBoundingBox");y.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",0).attr("result","blurredAlpha"),y.append("feOffset").attr("in","blurredAlpha").attr("dx",.5).attr("dy",.7).attr("result","offsetBlurredAlpha"),y.append("feFlood").attr("result","flooded").style("flood-color","#FFF").style("flood-opacity","0.5"),y.append("feComposite").attr("in","flooded").attr("in2","offsetBlurredAlpha").attr("operator","in").attr("result","coloredShadow"),y.append("feComposite").attr("in","SourceGraphic").attr("in2","coloredShadow").attr("operator","over"),i.data(u.domain()).isScalePoint(!1).bandWidth(u.step()).bandHeight(_).onMouseover(function(t,e){var n=t,i=[{text:""+(n=="$-"+e?"":n),color:a[e].color},{text:a[e].valueLabel+": "+a[e].value}];r.data(i).update(),o.group.selectAll(".selectOverlay-rect").transition().duration(300).attr("transform","translate("+u(n)+",0)"),r.show()}).onMousemove(function(){r.move(),l.show()}).onMouseout(function(){r.hide(),l.hide()}),n.data(t).xScale(u).yScale(h).fontSize(o._textLabel.fontSize).fontColor(o._textLabel.color).fontFamily(o._textLabel.fontFamily).labelShow(o._labelShow).positionOptions(o._positionOptions).positionChoice(o._positionChoice).transition(o._transition).duration(1e3*o._duration).easeStyle(o._easeStyle).startDelay(1e3*parseFloat(o._startDelay)).moveStyle(o._moveStyle).endPause(o._endPause).textObj({colorFunc:function(){return o._textLabel.color}}).fillOpacity(1),e.width(c).height(_).xTickLocations(o.xAxis.tickLocations.slice(1)).yTickLocations(o.yAxis.tickLocations.slice(1)).showX(o._gridShowX).showY(o._gridShowY).stroke(o._gridStroke).strokeDasharray(o._gridStrokeDasharray),s.width(c).height(_).paddingVertical([0,0]).transition(o._transition).duration(o._duration),l.width(u.step()).height(_).shadowColor("#ccc").hide(),o.coreGroup.attr("transform","translate("+o.yAxis.width+",0)"),0!=o._clipShow.length?(s.width(c).height(_).paddingVertical([0,0]).transition(o._transition).duration(o._duration),o.coreGroup.attr("clip-path","url(#"+s.id+")")):(s.width(o._width).height(o._height).paddingVertical([0,0]).transition(o._transition).duration(o._duration),o.coreGroup.attr("clip-path","")),s.update();var p=o.group.selectAll(".histogram-chart .axis-x-line .tick text").nodes().filter(function(t,e){return t.__data__=="&-"+(e+1)});d3.selectAll(p).remove(),n.update(),l.update(),i.update(),e.update(),d<0?(o.coreGroup.selectAll(".fake-x-line").remove(),o.coreGroup.append("g").attr("class","fake-x-line").append("line").attr("x1",u.range()[0]).attr("y1",h.range()[0]).attr("x2",u.range()[1]).attr("y2",h.range()[0]).attr("stroke","rgb(233, 233, 233)")):o.coreGroup.selectAll(".fake-x-line").remove()}},{key:"curve",value:function(t){return arguments.length?(this._curve="function"==typeof t?t:d3.curveCardinal,this):this._curve}},{key:"configLegend",value:function(){var t=this,i=t.sortedDataCopy.filter(function(t,e){return 1==t.showLegend});t.legend.data(i).onClick(function(e){var n=!d3.select(this).classed("clicked");d3.select(this).classed("clicked",n).style("opacity",n?.5:1),i.forEach(function(t){t.key===e.key&&(t.active=!n)}),t.onDataChange()})}},{key:"setSelfOption",value:function(t){var e=t.label,n=t.animation,i=t.unitDisplay,o=t.sourceDisplay;0!==Object.getOwnPropertyNames(n).length&&(this._transition=n?n.transition:this._transition,this._easeStyle=n.easeStyle?n.easeStyle:this._easeStyle,this._duration=n.duration?n.duration:this._duration,this._startDelay=n.startDelay?n.startDelay:this._startDelay,this._moveStyle=n.moveStyle?n.moveStyle:this._moveStyle,this._endPause=n.endPause?n.endPause:this._endPause),0!==Object.getOwnPropertyNames(i).length&&(this._unitShow=i?i.show:this._unitShow,this._unitWord=i.text?i.text:this._unitWord,this._unitFontSize=i.fontSize?i.fontSize:this._unitSize,this._unitFontColor=i.color?i.color:this._unitColor,this._unitFontFamily=i.fontFamily?i.fontFamily:this._unitFamily,this._unitX=i.xPosition?i.xPosition:this._unitX,this._unitY=i.yPosition?i.yPosition:this._unitY),0!==Object.getOwnPropertyNames(o).length&&(this._sourceShow=o?o.show:this._sourceShow,this._sourceWord=o.text?o.text:this._sourceWord,this._sourceFontSize=o.fontSize?o.fontSize:this._sourceSize,this._sourceFontColor=o.color?o.color:this._sourceColor,this._sourceFontFamily=o.fontFamily?o.fontFamily:this._sourceFamily,this._sourceX=o.xPosition?o.xPosition:this._sourceX,this._sourceY=o.yPosition?o.yPosition:this._sourceY),0!==Object.getOwnPropertyNames(e).length&&(this._labelShow=e?e.display:this._labelShow,this._positionChoice=e.positionChoice?e.positionChoice:this._positionChoice,this._textLabel=e.textLabel?e.textLabel:this._textLabel)}},{key:"computeDomain",value:function(){var t=this.activeData,e=(this._yRange||[]).slice().sort(d3.ascending),n=t.length?t.map(function(t){return t.name}):[0,1],i=void 0;if(t.length){var o=1.1*d3.min(t,function(t){return+t.value}),a=1.1*d3.max(t,function(t){return+t.value});i=o<0?a<=0?[o,0]:[o,a]:[0,a]}else i=[0,1];this._xDomain=n,this._yDomain=[isNaN(parseFloat(e[0]))?i[0]:parseFloat(e[0]),isNaN(parseFloat(e[1]))?isNaN(parseFloat(e[0]))?i[1]:i[1]<e[0]?1.5*e[0]:i[1]:parseFloat(e[1])]}}]),n}(),Xo=new Date;Xo.toLocaleDateString(),console.log("【d3Chart】 update"+Xo),t.ArcDiagramChart=gi,t.BarProgressChart=qn,t.BasicHorizontalBarChart=mi,t.BeeLineChart=Ei,t.CalendarHeatmapChart=yn,t.ChangeWaterfallHistogramChart=Cn,t.ChordChart=de,t.ContrastiveFunnelChart=go,t.DeformedPieChart=Yi,t.DonutChart=Xi,t.FormWaterfallHistogramChart=Pn,t.FunnelChart=Gi,t.GanttChart=ao,t.GroupedBarChart=Fi,t.GroupedHorizontalBarChart=Ci,t.GroupingBubbleChart=un,t.HalfPieChart=Tn,t.HalfProgressPieChart=Nn,t.HistogramChart=Yo,t.HollowChart=gn,t.IconBarChart=ot,t.IconPieChart=ye,t.MixLineBarChart=Ti,t.MultipleBarChart=en,t.MultipleLineChart=Nt,t.NegativeHorizontalBarChart=Pi,t.OneLevelTreemapChart=we,t.OverlapAreaChart=Lt,t.PercentageAreaChart=fi,t.PercentageBarChart=hi,t.PieChart=Y,t.PolarStackBarChart=Lo,t.PolarStackDonutBarChart=No,t.PolygonRadarChart=ti,t.ProgressRoundPieChart=Rn,t.PyramidChart=Ue,t.QuarterRoseChart=tt,t.RadarChart=Ie,t.RadialBarChart=ct,t.RadialLineChart=_t,t.RangeAreaChart=Fo,t.RangeBarChart=Co,t.RangeHorizontalBarChart=Po,t.RankingChangeChart=ai,t.RelativeRadarChart=_o,t.RoseChart=K,t.RoseDonutChart=To,t.RoundCornerDonutChart=j,t.RoundCornerPieChart=X,t.SankeyChart=re,t.SimpleBarChart=Dn,t.SimpleLineChart=to,t.SimpleSankeyChart=le,t.SlopeChart=Vn,t.SmoothLineChart=Hi,t.StackBarChart=Si,t.StackCircleChart=xo,t.StackHorizontalBarChart=bi,t.StackedChart=Sn,t.StackedLinearChart=Ii,t.StepLineChart=Tt,t.StreamgraphChart=Ge,t.SunburstChart=De,t.SymmetricChart=$i,t.TreeChart=Re,t.TwoLevelDonutChart=xe,t.TwoLevelTreemapChart=Oe,t.VerticalSankeyChart=ue,t.WaveCircleChart=H,t.WeightedTreeChart=Te,t.WordCloudChart=ho,t.setUserMd=function(t){window.userId=t},Object.defineProperty(t,"__esModule",{value:!0})});
